define("common/container/model/AllowedActions",["jquery","underscore","backbone","core/util/Service","core/util/Jsonify","core/plugin/jquery.bitparse"],(function(e,t,s,i,o){"use strict";var r=s.Model.extend({url:function(){return i.formatServiceUrl("GET_ALLOWED_ACTIONS")+this.formatItemsParam()},formatItemsParam:function(){var e;return e=this.get("ids")?"items="+t.map(this.get("ids"),function(e){return this.formatItemParamValue(e,this.get("type"))}.bind(this)):this.get("items")?"items="+t.map(this.get("items"),function(e){return this.formatItemParamValue(e.id,e.type)}.bind(this)):"&item="+this.formatItemParamValue(this.get("id"),this.get("type")),this.get("ignoreAccessDenied")&&(e+="&isNoAccessIgnored=true"),e},formatItemParamValue:function(e,t){return("file"===t?"fFileGUID:":"fFolderGUID:")+e},parse:function(s){if(o.convertToRealJson(s),!this.get("ids")&&!this.get("items"))return{allowedActions:e.bitParse(s.LocalData.dAllowedActions,o.allowedActions),roleName:s.LocalData.dRoleName};if(0==parseInt(s.LocalData.StatusCode,10)){var i=t(s.ResultSets.AllowedActions).map((function(t){return{id:t.fItemGUID,allowedActions:e.bitParse(t.dAllowedActions,o.allowedActions),roleName:t.dRoleName}}));return{allowedActionsMap:t(i).indexBy((function(e){return e.id}))}}}});return docs.models.AllowedActions={syncFetch:function(e,t,s){var o=new r({id:e,type:t,ignoreAccessDenied:s});return o.fetch({async:!1,error:function(e,t,o){s&&i.isAccessDenied(t.errorThrown)&&(t.errorHandled=!0,e.set({allowedActions:{}}))}}),o.attributes},syncFetchAll:function(e,t,s){var o=new r({ids:e,type:t,ignoreAccessDenied:s});return o.fetch({method:"POST",url:i.formatServiceUrl("GET_ALLOWED_ACTIONS"),data:o.formatItemsParam(),async:!1,error:function(e,t,o){s&&i.isAccessDenied(t.errorThrown)&&(t.errorHandled=!0)}}),o.attributes},asyncFetchAllItems:function(t,s){var o=e.Deferred(),n=new r({items:t,ignoreAccessDenied:s});return n.fetch({method:"POST",url:i.formatServiceUrl("GET_ALLOWED_ACTIONS"),data:n.formatItemsParam(),async:!0,success:function(e,t,s){o.resolve(e.attributes.allowedActionsMap)},error:function(e,t,r){s&&i.isAccessDenied(t.errorThrown)&&(t.errorHandled=!0,o.resolve({}))}}),o}},docs.models.AllowedActions})),define("common/container/config",["core/util/Globals"],(function(docs){"use strict";return docs.container.Config={itemModels:{},rowViews:{},cellViews:{},tileViews:{},cardViews:{},performanceViews:{},itemActions:{},actionFilters:{}},docs.container.Config})),define("common/container/model/PagerData",["jquery","underscore","backbone","core/util/Session"],(function(e,t,s,i){"use strict";return docs.models.PagerData=s.Model.extend({defaults:{totalCount:0,startRow:0,page:1,pageCount:0,hasMore:0},initialize:function(e){e=e||{},this.scopeKey=e.scopeKey,this.setPageSize(e.pageSize||i.pageSize());var t=e.page||1;this.pageStartRow=(t-1)*this.pageSize},reset:function(){this.pageStartRow=0,this.set(this.defaults)},parseResponse:function(e){var s={};if(e.LocalData&&e.LocalData.pageStats)s.totalCount=e.LocalData.pageStats.totalCount,s.pageCount=e.LocalData.pageStats.pageCount,s.startRow=e.LocalData.pageStats.startRow,s.page=e.LocalData.pageStats.page,s.hasMore=e.LocalData.pageStats.hasMore,this.pageSize=s.totalCount;else if(e.ResultSets&&e.ResultSets.SearchResults){s.totalCount=parseInt(e.LocalData.TotalRows,10),s.pageCount=Math.ceil(s.totalCount/this.pageSize),s.startRow=parseInt(e.LocalData.StartRow,10),s.page=Math.floor(s.startRow/this.pageSize)+1;var i=e.LocalData.PageNumber,o=e.LocalData.NumPages;s.hasMore=i<o}else e.ResultSets&&e.ResultSets.Conversations?(s.totalCount=parseInt(e.LocalData.totalConversationsCount,10),s.pageCount=Math.ceil(s.totalCount/this.pageSize),s.startRow=e.LocalData.conversationsStartRow,s.page=s.startRow/this.pageSize+1,s.hasMore="1"===e.LocalData.hasMoreConversations):e.LocalData&&"AR_BROWSE_CONNECTOR_FILE_SYSTEM"===e.LocalData.IdcService?(s.totalCount=parseInt(e.LocalData.TotalItemsCount,10),s.pageCount=Math.ceil(s.totalCount/this.pageSize),s.startRow=e.LocalData.itemStartRow,s.page=s.startRow/this.pageSize+1,s.hasMore=e.LocalData.hasMoreItems):e.LocalData?(s.totalCount=parseInt(e.LocalData.TotalChildItemsCount,10),s.pageCount=Math.ceil(s.totalCount/this.pageSize),s.startRow=this.pageStartRow,s.page=s.startRow/this.pageSize+1,s.hasMore="1"===e.LocalData.hasMoreChildItems):(t.isUndefined(e.totalResults)?e.items&&e.items.length&&"rankingpolicy"===e.items[0].type||e.items&&!e.items.length?s.totalCount=parseInt(e.count,10):s.totalCount=parseInt(e.limit,10):s.totalCount=parseInt(e.totalResults,10),s.pageCount=Math.ceil(s.totalCount/this.pageSize),s.startRow=this.pageStartRow,s.page=s.startRow/this.pageSize+1,s.hasMore="boolean"==typeof e.hasMore?e.hasMore:"1"===e.hasMore);this.set(s,{silent:!0}),this.trigger("change")},updatePageCount:function(e){var t=Math.ceil(e/this.pageSize);this.set({totalCount:e,pageCount:t})},decrementTotalCount:function(){var e=this.get("totalCount")-1;this.updatePageCount(e)},incrementTotalCount:function(){var e=this.get("totalCount")+1;this.updatePageCount(e)},setPageSize:function(e,t){this.pageSize=e,this.scopeKey&&t&&localStorage.setItem(this.scopeKey+"PageSize",e),this.virtualPageSize=this.pageSize<=50?2*this.pageSize:this.pageSize+25},setPage:function(e){"first"===e?e=1:"last"===e&&(e=this.get("pageCount"));var t=!1;switch(e){case"next":this.pageStartRow<this.get("totalCount")-this.pageSize&&(this.pageStartRow+=this.pageSize,t=!0);break;case"prev":this.pageStartRow>0&&(this.pageStartRow-=this.pageSize,this.pageStartRow<=0&&(this.pageStartRow=0),t=!0);break;default:e>0&&e<=this.get("pageCount")&&e!==this.get("page")&&(this.pageStartRow=(e-1)*this.pageSize,t=!0)}return this.set("page",e,{silent:!0}),t},getPage:function(){var e=this.get("page");return"next"===e||"prev"===e?e=this.pageStartRow/this.pageSize+1:t.isString(e)&&(e=parseInt(e,10)),e}}),docs.models.PagerData})),define("common/container/model/ContainerItems",["jquery","underscore","backbone","common/container/config","common/container/model/PagerData"],(function(e,t,s){"use strict";return docs.models.ContainerItems=s.Collection.extend({url:function(){return this.container.url()},model:function(e,t){var s;if(t.collection&&t.collection.container&&t.collection.container.ContainerItemModel)s=t.collection.container.ContainerItemModel;else{var i=e.type;s=docs.container.Config.itemModels[i]}return new s(e,t)},initialize:function(e,t){t=t||{},this.container=t.container,this.id=t.container?t.container.id:t.id,this.pagerData=new docs.models.PagerData({page:t.page,pageSize:t.pageSize,scopeKey:t.scopeKey}),this.listenTo(this,"sync",this.onSync)},parse:function(e,s){var i;return!t.isFunction(this.validateFetchResult)||this.validateFetchResult(e)?(i=this.container.parseItems(e),this.pagerData.parseResponse(e)):(i=this.toJSON(),s.add=!1,s.merge=!1,s.remove=!1,s.silent=!0),i},onSync:function(){0===this.length&&this.pagerData.reset()},fetch:function(e){return e=e||{},t.isUndefined(e.remove)&&(e.reset=!0),s.Collection.prototype.fetch.call(this,e)},reset:function(e,t){t&&t.parse&&(e=this.parse(e,t),t.parse=!1),s.Collection.prototype.reset.call(this,e||[],t)},comparator:function(e,s){var i,o=e.get("type"),r=s.get("type");if("folder"!==o||"file"!==r||this.noGrouping)if("file"!==o||"folder"!==r||this.noGrouping){var n,a;this.container.options&&this.container.options.useDisplayNameForNameSort?(n=e.get("displayName"),a=s.get("displayName")):(n=e.get("name"),a=s.get("name")),n&&a&&(n=n.toUpperCase(),a=a.toUpperCase());var l=this.container.get("sortOrder");switch(l){case"sort_nameasc":i=n===a?0:n<a?-1:1;break;case"sort_namedsc":i=a===n?0:a<n?-1:1;break;default:case"sort_updated":var c=Date.parse(e.has("modifiedAt")?e.get("modifiedAt"):t.isObject(e.get("updatedDate"))?e.get("updatedDate").value:""),d=Date.parse(s.has("modifiedAt")?s.get("modifiedAt"):t.isObject(e.get("updatedDate"))?s.get("updatedDate").value:"");i=d===c?0:d<c?-1:1;break;case"sort_created":var u=Date.parse(e.has("createdAt")?e.get("createdAt"):e.get("createdDate").value),m=Date.parse(s.has("createdAt")?s.get("createdAt"):s.get("createdDate").value);i=m===u?0:m<u?-1:1;break;case"sort_fileSize":var h=e.get("size"),g=s.get("size");i=h===g?0:h<g?-1:1;break;case"sort_assetType":var f=e.get("selectedAsset"),p=s.get("selectedAsset");i=f===p?0:f<p?-1:1;break;case"sort_relevance":case"sort_num_suggestions":case"sort_category_path":case"sort_connector":i=0;break;case"sort_expiry":var _=new Date(864e13),S=e.has("expiresAt")?Date.parse(e.get("expiresAt")):_,I=s.has("expiresAt")?Date.parse(s.get("expiresAt")):_;i=I===S?0:S<I?-1:1;break;case(l.match(/^sort_custom/)||{}).input:i=this.container.customComparator&&this.container.customComparator(l,e,s)||0}}else i=1;else i=-1;return i},fetchPage:function(e,t){this.pagerData.setPage(e)&&(t?this.fetch({async:!1}):this.fetch())},sortedIndex:function(e){for(var t=0;t<this.length&&this.comparator(e,this.models[t])>=0;)t+=1;return t},add:function(e,i){i=i||{};var o=this;if(t.isArray(e)||e.fetched)o=s.Collection.prototype.add.call(this,e,i);else{var r;if(e instanceof s.Model||(e=new this.model(e,i)),e.has("allowedActions")||e.set("allowedActions",this.container.get("allowedActions"),{silent:!0}),!e.has("roleName")&&this.container.has("roleName")&&e.set("roleName",this.container.get("roleName"),{silent:!0}),this.container.itemAdding(e),"sort_relevance"!==this.container.get("sortOrder")||i.addToEnd?r=this.sortedIndex(e):(r=0,i.at=r),r<this.length||!this.pagerData.get("hasMore")){o=s.Collection.prototype.add.call(this,e,i);var n=this.at(this.pagerData.pageSize);n&&n.trigger("offPage")}this.pagerData.incrementTotalCount()}return o},update:function(e,s){(s=s||{}).modelUpdateFunc=s.modelUpdateFunc||"set",s.updateInPlace=!!s.updateInPlace;var i=this.where({id:e.id})[0];if(i){var o=!1;if(i.isFile){var r=i.get("latestRevision");e.latestRevision&&r&&e.latestRevision>r&&(o=!0)}s.updateInPlace||this.remove(i),t.isFunction(i[s.modelUpdateFunc])&&i[s.modelUpdateFunc](e),i.set("selected",!0,{silent:!0}),o&&(i.unset("reservedAt",{silent:!0}),i.unset("reservedBy",{silent:!0}),i.unset("reservedByName",{silent:!0})),s.updateInPlace||this.add(i)}}}),docs.models.ContainerItems})),define("common/container/model/Container",["jquery","underscore","backbone","core/util/Globals","core/util/Service","common/container/model/AllowedActions","common/container/model/ContainerItems","common/container/config","core/embedapi/EmbedApi"],(function(e,t,s,docs,i,o){"use strict";var r=docs.common.Globals;return docs.models.Container=s.Model.extend({ContainerItems:docs.models.ContainerItems,sideboards:[],modelType:function(){return this.get("type")},url:function(){throw"Derived Container must override url function"},initialize:function(t,s){if(s=s||{},this.options=s,s.container=this,this.items=new this.ContainerItems([],s),this.sortPersistenceKey=s.sortPersistenceKey||s.scopeKey?s.scopeKey+"Sort":"ContainerSort",r.embed){var i=(docs.common.EmbedApi.getName()||"embed")+"_";this.sortPersistenceKey=i+this.sortPersistenceKey}if(s.sortOrder)this.set({sortOrder:s.sortOrder},{silent:!0}),e.sessionStorage(this.sortPersistenceKey,s.sortOrder);else{var o=s.sortDefault||"sort_nameasc";s.sortOrder=e.sessionStorage(this.sortPersistenceKey,void 0,o),this.set({sortOrder:s.sortOrder},{silent:!0})}s.searchTerm&&this.set("searchTerm",s.searchTerm,"silent: true"),s.pageSize?s.scopeKey&&!s.bypassPageSizePersist&&localStorage.setItem(s.scopeKey+"PageSize",s.pageSize):s.scopeKey?s.pageSize=parseInt(localStorage.getItem(s.scopeKey+"PageSize"))||this.items.pagerData.pageSize:s.pageSize=this.items.pagerData.pageSize,this.set({pageSize:s.pageSize},{silent:!0}),this.items.pagerData.setPageSize(this.get("pageSize")),this.listenTo(docs.events,"folder:movecopy",this._handleMoveCopy),this.bind("change:sortOrder",this.fetchOnChange,this),this.bind("change:pageSize",this.fetchOnChange,this)},initializeFilter:function(t){var s="FolderFilter"+t.scopeKey;if(t.filter)this.set("filter",t.filter,"silent: true"),e.sessionStorage(s,t.filter);else{t.filter=e.sessionStorage(s,void 0,"filter_all"),this.set("filter",t.filter,"silent: true")}},getLimit:function(t){var s=e.Deferred();if(!r.isStarterEdition)return s.resolve({isEnabled:!0});var i="/system/api/v1/features/.by.name/"+t;return e.ajax(i,{type:"GET",contentType:"application/json",success:function(e){s.resolve({isEnabled:e.isEnabled,learnMoreUrl:"https://docs.oracle.com/pls/topic/lookup?ctx=cloud&id=CECSA-GUID-743500EB-B173-412D-996D-AFAA2C4F921A"})}}),s.promise()},close:function(){},fetch:function(i){var o=(i=i?t.clone(i):{}).error;if(i.error=function(e,t,s){t.reauthenticate||t.promptForAccessCode||s.skipFetchError||e.trigger("error:fetch",t.errorThrown,t),o&&o(e,t,s)},this.options.fetchAll){var r=function(t){if(this.items.pagerData.get("hasMore")){for(var s=[],i=2;i<=this.items.pagerData.get("pageCount");i++)this.items.pagerData.setPage("next"),s.push(this.items.fetch({remove:!1}));return e.when.apply(e,s)}return e.Deferred().resolve()}.bind(this);this.fetchDfd=s.Model.prototype.fetch.call(this,i).then(r)}else this.fetchDfd=s.Model.prototype.fetch.call(this,i);return this.fetchDfd},parse:function(e){var t=this.parseModel(e);if(t){var s=this.parseItems(e);return this.items.reset(s,{silent:!0}),this.items.pagerData.parseResponse(e),this.bypassChangeMode||(t.mode=this.get("mode"),this.set("mode","",{silent:!0})),t}},parseModel:function(){throw"Derived Container must override parseModel function"},parseItems:function(){throw"Derived Container must override parseItems function"},fetchOnChange:function(){this.items.pagerData.setPage(1),this.items.pagerData.setPageSize(this.get("pageSize")),this.items.fetch()},getThumbnailUrl:function(){throw"Derived Container must override getThumbnailUrl function"},itemAdding:function(){},isOwned:function(){return this.get("ownedBy")===r.userid},isSharedToYou:function(){var e=this.has("flags")&&this.get("flags").isShared,t=this.get("parentShared");return(r.isPublicLink||e||t)&&!this.isOwned()},isSharedByYou:function(){var e=this.has("flags")&&this.get("flags").isShared,t=this.get("parentShared");return(e||t)&&this.isOwned()},isAllowedAction:function(e){var t=this.get("allowedActions");return!!t&&(t.needFetch&&(this.set(o.syncFetch(this.id,"folder"),{silent:!0}),t=this.get("allowedActions")),!0===t[e])},hasRole:function(e){return this.has("roleName")?i.hasRole(this.get("roleName"),e):void 0},deleteItems:function(s){var i=e.Deferred(),o=[],r=[],n=function(){i.resolve(o,r),t.each(o,(function(e){t.defer(function(){this.items.trigger("remove",e.model,this.items,{})}.bind(this))}),this)}.bind(this);return t.each(s,(function(e){e.folderItem.destroy({wait:!0,silent:!0,success:function(e){o.push({model:e}),o.length+r.length===s.length&&n()},error:function(e,t){var i;t.errorHandled=!0,i=t.errorThrown&&t.errorThrown.errorMsgKey?{item:e,itemId:e.id,displayName:e.get("name"),success:!1,statusCode:t.errorThrown.errorCode,statusMessage:t.errorThrown.errorMsgKey,responseData:t,errorMsg:t.errorThrown.message}:t.errorThrown&&t.errorThrown.detailMessage?{item:e,itemId:e.id,displayName:e.get("name"),success:!1,statusCode:t.errorThrown.status,statusMessage:"!deleteItemError",responseData:t,errorMsg:t.errorThrown.detailMessage}:{item:e,itemId:e.id,displayName:e.get("name"),success:!1,statusCode:t.responseJSON&&t.responseJSON.status?t.responseJSON.status:t.status?t.status:-1,statusMessage:"!deleteItemError",responseData:t,errorMsg:t.responseJSON&&t.responseJSON.detail?t.responseJSON.detail:t.statusText?t.statusText:null},r.push(i),o.length+r.length===s.length&&n()}})})),i.promise()},_handleMoveCopy:function(e,t){switch(e.type){case"move":this._handleDelete(e,t),this._handleCopy(e,t);break;case"copy":this._handleCopy(e,t);break;case"delete":this._handleDelete(e,t)}},_handleDelete:function(e){var t,s="fFolderGUID"===e.idType;this.id===e.sourceId?(this.items.remove(e.id),t=this):t=this.items.where({id:e.sourceId})[0],t&&t.isFolder&&i.adjustFolderChildCount(t,-1,s)},_handleCopy:function(e,t){var s="fFolderGUID"===e.idType;this.id&&this.id===e.targetId&&(t?this.items.add(t):-1===e.targetId.indexOf("TRASH")&&this._fetchAndAdd(e.newId,e.idType,e.model,this));var o=this.items.where({id:e.targetId})[0];o&&o.isFolder&&i.adjustFolderChildCount(o,1,s)},_fetchAndAdd:function(e,t,s,i){var o=s||t.toLowerCase().match("f(.+)guid")[1];new(0,docs.container.Config.itemModels[o])({id:e}).fetch({ignoreSync:!0,success:function(e){i.items.add(e)}})},getUrlName:function(){var e=i.filterSpecialCharacters(this.get("name"));return 0!==e.indexOf("_")&&(e="_"+e),e},getNameAndDescription:function(){var e=this.get("name"),t=this.get("description");return t&&""!==t?e+" - "+t:e},isSideboardSupported:function(e){return t.contains(this.sideboards,e)}}),docs.models.Container})),define("common/share/model/ShareUser",["jquery","underscore","backbone","core/util/Service","core/util/Utils","core/util/FeatureFlags","core/util/Globals"],(function(e,t,s,i,o,r){"use strict";var n=docs.common.Globals;return docs.models.ShareUser=s.Model.extend({getValidRoles:function(){return["viewer","downloader","contributor","manager"]},isGroup:function(){return o.isGroup(this.attributes)},isIDCSGroup:function(){return o.isIDCSGroup(this.get("groupOriginType"))},isExternalUser:function(){return this.get("isExternalUser")},getImage:function(){if(this.has("profilePic"))return this.get("profilePic");if(this.isGroup())return this.isIDCSGroup()?osn.images.getDefaultIDCSGroupProfilePicture():osn.images.getDefaultGroupProfilePicture();if(this.isExternalUser())return osn.images.getDefaultExternalUserProfilePicture();if(this.id==n.userid||this.id==n.userLogin){var e=osn.cache.get("PictureDataUri",osn.cache.get("me").id)||{};if(!e.setBySystem&&e.value)return e.value}return osn.images.getDefaultProfilePicture()},updateProfilePic:function(e){e.id===this.get("osnId")&&e.data&&(this.set("profilePic",e.data),this.stopListening(osn.events,"pictureDataUpdated"))}}),docs.models.ShareUser})),define("common/share/model/SharedUserList",["jquery","underscore","backbone","core/util/Globals","core/util/Jsonify","common/share/model/ShareUser"],(function(e,t,s,docs,i,o){"use strict";return docs.models.SharedUserList=s.Collection.extend({model:o,initialize:function(e,t){this.options=t||{},this.on("add",this.userAdded),this.on("update reset",this.listReset)},comparator:function(e,t){return e.get("name").localeCompare(t.get("name"))},userAdded:function(e){this._fetchUserAvatars([e])},listReset:function(){var e=[];this.each((function(t){t.has("profilePic")||e.push(t)})),this._fetchUserAvatars(e)},updateLevels:function(){},isEditable:function(){throw"Derived lists must override isEditable"},_sendAddUsersRequest:function(s,o,r){function n(e){if(e.responseJSON&&e.responseJSON.ResultSets&&(e.responseJSON.ResultSets.ActionStatus||e.responseJSON.ResultSets.AssetsActionStatus)){i.convertToRealJson(e.responseJSON);var s=e.responseJSON.ResultSets.ActionStatus||e.responseJSON.ResultSets.AssetsActionStatus,n=[],l=a.item?a.item.get("id"):a.folder?a.folder.get("id"):"";t.each(s,(function(e){if(e.item.indexOf(l)>-1&&"1"===e.isSuccessful){var s=t.findWhere(o,"group"===e.dTargetUserType?{id:e.dTargetUser}:{loginId:e.dTargetUser});s.isExternalUser=s.isExternalUser||"1"===e.isExternalUser,n.push(s)}})),n.length>0&&a.add(n,r)}}var a=this;e.ajax(s.url,{type:"POST",async:!1,data:s.data,success:function(e,t,s){n(s),a.trigger("addCollaborators:success",o,e),docs.events.trigger("members:updated",a.item?a.item.get("id"):a.folder?a.folder.get("id"):"")},error:function(e,t,s){-1===s.errorMsgKey.indexOf("csFldDoesNotExist")&&-1===s.errorMsgKey.indexOf("csItemInTrash")||docs.events.trigger("FolderViewDetail:reload"),n(e),a.trigger("addCollaborators:error",o,s,t,e)}})},_fetchUserAvatars:function(e){if(!docs.common.Globals.isAppLink&&!this.options.skipAvatars){var s=[],i=[];t.each(e,(function(e){if(!e.has("profilePic")){var t=e.get("loginId");e.has("osnId")?i.push({_class:e.isGroup()?"XGroupSearchInfo":"XUserInfo",ID:e.get("osnId"),Name:t}):e.isGroup()?e.isIDCSGroup()||s.push(["XGroupModule$Server","findGroupsWithLimit",[t,1,!1]]):s.push(["XUserModule$Server","getUserByName",[t]])}}));var o=this;if(s.length>0){var r=t.chain(s).groupBy((function(e,t){return Math.floor(t/100)})).toArray().value();t.each(r,(function(s){osn.fc.sendRequest(s).done((function(s){var i=[];t.each(s,(function(e){t.isEmpty(e.returnValue)||i.push(t.isArray(e.returnValue)?e.returnValue[0]:e.returnValue)})),o._applyUserAvatars(i,e)}))})),this._applyUserAvatars(i,e)}else i.length>0&&this._applyUserAvatars(i,e)}},_applyUserAvatars:function(e,s){e&&0!==e.length&&require(["common/members/model/MembersCollection"],(function(i){i.fetchScaledProfilePics(e),t.each(e,(function(e){var i=t.find(s,(function(t){return t.get("loginId")===e.Name}),this);t.isObject(i)&&!i.has("osnId")&&i.set("osnId",e.ID),t.isObject(i)&&!i.has("loginId")&&i.set("loginId",e.Name),t.isObject(i)&&t.isObject(e)&&e.profilePic?i.set("profilePic",e.profilePic):t.isObject(i)&&i.listenTo(osn.events,"pictureDataUpdated",i.updateProfilePic)}))}))}}),docs.models.SharedUserList})),define("common/share/model/Collaborator",["jquery","underscore","backbone","core/util/Service","core/util/FeatureFlags","core/util/Globals","common/share/model/ShareUser"],(function(e,t,s,i,o,docs,r){"use strict";var n=docs.common.Globals;return docs.models.Collaborator=r.extend({initialize:function(e,t){r.prototype.initialize.call(this,e,t),t.item&&(this.item=t.item),this.itemType=t&&t.itemType?t.itemType:this.item?this.item.modelType():"folder"},getValidRoles:function(){var e=["viewer","downloader","contributor","manager"];return this.get("isExternalUser")&&e.splice(e.indexOf("manager"),1),e},_getServiceParams:function(e,t){var s=i.getServiceParamsForPost(e);s.data.item="fFolderGUID:"+this.get("itemId");var o={url:s.url,wait:!0,data:s.data};return t&&(o.data.dUserID=this.get("id")),o},updateRole:function(e){if(e!==this.get("role")){var t=this._getServiceParams("EDIT_SHARING_ROLE",!0);t.data.dRoleName=e;var s=this;t.success=function(){s.get("id")===n.userid&&window.location.reload(!0)},this.save({role:e},t)}},removeRole:function(e){var t=e?"DELETE_SHARING":"REVOKE_SHARED_USER",s=this._getServiceParams(t,!e),i=this;this.destroy(s).done((function(){docs.events.trigger("members:updated",i.get("itemId")),e&&docs.events.trigger("folder:leave",i.get("itemId"))}))}}),docs.models.Collaborator})),define("common/share/model/Collaborators",["jquery","underscore","backbone","core/util/Service","core/util/Jsonify","core/util/Globals","core/util/Utils","common/share/model/SharedUserList","common/share/model/Collaborator"],(function(e,t,s,i,o,docs,r,n,a){"use strict";var l=docs.common.Globals;return docs.models.Collaborators=n.extend({model:a,initialize:function(e,t){n.prototype.initialize.call(this,e,t),this.fetched=!1,this.folder=t.folder,this.folderId=this.folder.isFile?this.folder.get("parentID"):this.folder.id,this.folderIsHome=this.folder.isHome||"F:USER"===this.folderId.slice(0,6),this.folderIsGlobalSearch="FLD_SEARCH:"===this.folderId.slice(0,11),this.parentFolder=t.parentFolder},url:function(){var e=i.formatServiceUrl("GET_SHARED_FOLDER_USERS");return e+="&item=fFolderGUID:"+this.folderId},_getLevel:function(e){return e===this.folderId?"thisLevel":"othersLevel"},fetch:function(e){if(this.folderIsHome||this.parentFolder&&this.parentFolder.isHome&&!this.folder.get("flags").isShared)return this.you=new a({id:l.userid,name:docs.i18n.t("YOU"),type:"user",role:"owner",level:"thisLevel"},{item:this.folder}),this.others=new docs.models.Collaborators([],this.options),this.folder.collaborators=this,this.reset();if(!this.folderIsGlobalSearch){if(this.parentFolder&&this.parentFolder.collaborators&&!this.folder.get("flags").isShared){var i=this.parentFolder.collaborators;this.you=i.you,this.you.set("level","othersLevel"),this.owner=i.owner;var o=i.others.models.concat(i.models);return this.others=new docs.models.Collaborators(o,this.options),this.folder.collaborators=this,this.reset()}var r=t.extend({itemType:this.folder.get("type")},e);return s.Collection.prototype.fetch.call(this,r)}},parse:function(e){var s=o.parse_GET_SHARED_FOLDER_USER(e);this.folder.isContentType&&t.each(s,(function(e){"downloader"===e.role&&(e.role="viewer")}));var i=l.userid,n=!0===this.folder.get("userLoginAsID");if(r.isYou(this.folder,"ownedBy"))this.you=new a({id:l.userid,name:l.userName,loginId:l.userLogin,type:"user",role:"owner",level:this._getLevel(this.folderId)},{itemType:this.folder.get("type")}),n&&(s=t.filter(s,(function(e){var t=!0;return e.id===i&&(t=!1),t}),this));else{var c;l.isAppLink&&(c={id:l.userid,type:"user",itemId:this.folderId,role:e.LocalData.dRoleName});var d,u="docadmin"===this.folder.get("ownedBy")||n;s=t.filter(s,(function(e){var t=!0;return e.id===i?(c=e,t=!1):u&&r.isUser(this.folder,e,"createdBy")&&((d=e).role="owner",t=!1),t}),this),c&&(c.level=this._getLevel(c.itemId),this.you=new a(c,{itemType:this.folder.get("type")})),u?d&&(this.owner=new a(d,{itemType:this.folder.get("type")})):this.owner=new a({id:this.folder.get("ownedBy"),name:this.folder.get("ownedByName"),type:"user",loginId:this.folder.get("ownedByLoginId"),role:"owner",level:this._getLevel(this.folderId)},{itemType:this.folder.get("type")})}var m=t(s).groupBy((function(e){return this._getLevel(e.itemId)}),this);return m.thisLevel=m.thisLevel?m.thisLevel:[],m.othersLevel=m.othersLevel?m.othersLevel:[],this.others=new docs.models.Collaborators([],this.options),this.others.add(m.othersLevel),this.folder.collaborators=this,this.fetched=!0,m.thisLevel},add:function(e,t){n.prototype.add.call(this,e,t);var s=this.folder.get("flags");this.length>0&&!s.isShared&&(s.isShared=!0,t&&t.silent||(this.folder.trigger("change",this.folder),this.folder.trigger("change:flags",this.folder)))},addCollaborators:function(e,s,o){var r="";t.each(e,(function(e){r&&(r+=","),e.groupId?r+=e.groupId:r+=e.loginId})),this.folder.isContentType&&"viewer"===s&&(s="downloader");var n=i.getServiceParamsForPost("SHARE_FOLDER");n.data.item="fFolderGUID:"+this.folderId,n.data.dUserID=r,n.data.dRoleName=s,o&&o.length>0&&(n.data.dShareMessage=o),this._sendAddUsersRequest(n,e,{itemType:this.folder.get("type")})},remove:function(e,t){s.Collection.prototype.remove.call(this,e,t);var i=this.folder.get("flags");0===this.length&&i.isShared&&(i.isShared=!1,t&&t.silent||(this.folder.trigger("change",this.folder),this.folder.trigger("change:flags",this.folder)))},isCollaborator:function(e){var t,s=this.models;for(t=0;t<s.length;t++)if(e===s[t].attributes.id)return!0;for(s=this.others.models,t=0;t<s.length;t++)if(e===s[t].attributes.id)return!0;return!1},isEditable:function(){return this.folder.isAllowedAction("directShareWrite")||this.folder.isAllowedAction("share")},updateLevels:function(){this.you&&this.you.set({level:this._getLevel(this.you.get("itemId"))},{silent:!0}),this.owner&&this.owner.set({level:this._getLevel(this.owner.get("itemId"))},{silent:!0}),this.each((function(e){e.set({level:this._getLevel(e.get("itemId"))},{silent:!0})}),this),this.others&&this.others.each((function(e){e.set({level:this._getLevel(e.get("itemId"))},{silent:!0})}),this)}}),docs.models.Collaborators})),define("common/fileview/model/Annotation",["jquery","underscore","backbone","core/util/Service","core/util/Globals","core/util/Constants"],(function(e,t,s,i,docs,o){"use strict";var r=docs.common.Globals,n=s.Model.extend({defaults:{selected:!1,context:1,isDeleted:!1},initialize:function(e,s){t.bindAll(this,"update","remove"),this.options=s||{},this.setMemberModel(e),this.options.item&&this.options.item.isAsset&&this.set({isAsset:!0},{silent:!0})},setMemberModel:function(e){var t=e.isCurrentUser?osn.cache.get("me").id:e.creatorLoginId,s=osn.cache.get("XUserInfo",t);this.memberInfo=new osn.models.MemberModel(s,{profilePic:"scaled",needOpaqueAvatar:!0})},parse:function(e){return e},getParticipants:function(){return[{id:this.get("creatorId")||r.userid,name:this.get("creatorName")||r.userName}]},isMyAnnotation:function(){return this.get("creatorId")===r.userid},save:function(){if(this.isCommitted()){var t=n.getAnnotationService("create",this.getItemType()),s=i.getServiceParamsForPost(t);this.getSaveParams(s.data);var o=this;e.ajax(s.url,{type:"POST",data:s.data,async:!1,success:function(e){o.set({id:e.LocalData.dAnnotationID,creatorId:e.LocalData.dUser,creatorName:e.LocalData.dUserFullName,creatorLoginId:r.userLogin}),docs.common.Logger("Viewer").info("Successfully created annotation with ID: "+s.data.dAnnotationID)},error:function(e,t,s){docs.common.Logger("Viewer").error("Failed to create annotation. Error message from server is: "+s.errorMsg),e.errorHandled=!0}})}},getSaveParams:function(e){switch(e.item=this.getUrlParamItem(),this.get("isAsset")?this.has("version")&&(e.arCaaSVersion=this.get("version")):this.has("revision")&&(e.dRevisionID=this.get("revision")),e.dPageNumber=this.get("context"),e.dAnnotationInfo=this.getAnnotationInfoString(),e.dConversationID=this.get("conversationId"),e.dMessageID=this.get("chatId"),this.getItemType().toLowerCase()){case o.ItemType.ASSET_TYPE_DA:e.dLanguageVariationSetID=this.get("itemVarSetId"),this.has("itemRendId")&&(e.dRenditionName=this.get("itemRendId"));break;default:e.dLanguageVariationSetID=this.get("itemVarSetId"),this.has("itemLang")&&(e.dLanguageValue=this.get("itemLang"))}},update:function(){if(this.isCommitted()){var t=n.getAnnotationService("update",this.getItemType()),s=i.getServiceParamsForPost(t);s.data.item=this.getUrlParamItem(),s.data.dAnnotationID=this.get("id"),s.data.dAnnotationInfo=this.getAnnotationInfoString(),e.ajax(s.url,{type:"POST",data:s.data,success:function(){docs.common.Logger("Viewer").info("Successfully updated annotation "+s.data.dAnnotationID)},error:function(e,t,i){docs.common.Logger("Viewer").error("Failed to update annotation "+s.data.dAnnotationID+". Error message from server is: "+i.errorMsg),e.errorHandled=!0}})}},restore:function(t){if(this.isCommitted()&&!1!==this.get("isDeleted"))if(t){var s=n.getAnnotationService("restore",this.getItemType()),o=i.getServiceParamsForPost(s);this.getRestoreParams(o.data);var r=this;e.ajax(o.url,{type:"POST",async:!1,data:o.data,success:function(){docs.common.Logger("Viewer").info("Successfully restored annotation "+o.data.dAnnotationID),r.set("isDeleted",!1)},error:function(e,t,s){docs.common.Logger("Viewer").error("Failed to restore annotation "+o.data.dAnnotationID+". Error message from server is: "+s.errorMsg),e.errorHandled=!0}})}else this.set("isDeleted",!1)},getRestoreParams:function(e){e.item=this.getUrlParamItem(),e.dAnnotationID=this.get("id")},remove:function(t){if(this.isCommitted()&&!0!==this.get("isDeleted"))if(t){var s=n.getAnnotationService("remove",this.getItemType()),o=i.getServiceParamsForPost(s);this.getRemoveParams(o.data);var r=this;e.ajax(o.url,{type:"POST",data:o.data,success:function(){docs.common.Logger("Viewer").info("Successfully removed annotation "+o.data.dAnnotationID),r.set("isDeleted",!0)},error:function(e,t,s){docs.common.Logger("Viewer").error("Failed to remove annotation "+o.data.dAnnotationID+". Error message from server is: "+s.errorMsg),e.errorHandled=!0}})}else this.set("isDeleted",!0)},getRemoveParams:function(e){e.item=this.getUrlParamItem(),e.dAnnotationID=this.get("id")},getItemType:function(){return this.collection&&this.collection.item?this.collection.item.isAsset?this.collection.item.getAssetType():this.collection.item.get("type"):this.get("itemType")},getUrlParamItem:function(){return this.get("isAsset")?"arCaaSGUID:"+this.get("caasGuid"):"fFileGUID:"+this.get("itemGuid")},getAnnotationInfoString:function(){return""},isCommitted:function(){return this.has("conversationId")&&this.has("chatId")},isResizable:function(){return!1},isDraggable:function(){return!1}},{getAnnotationService:function(e,t){var s;switch(t.toLowerCase()){case"file":case"conversation":s={retrieve:"GET_ANNOTATIONS",create:"CREATE_ANNOTATION",update:"UPDATE_ANNOTATION",restore:"RESTORE_ANNOTATIONS",remove:"DELETE_ANNOTATIONS"};break;default:s={retrieve:"AR_GET_ANNOTATIONS",create:"AR_CREATE_ANNOTATION",restore:"AR_RESTORE_ANNOTATIONS",remove:"AR_DELETE_ANNOTATIONS"}}switch(e){case"retrieve":case"create":case"update":case"restore":case"remove":return s[e];default:var i='invalid action "'+e+'"';throw console.log(i),new Error(i)}}});return n})),define("common/container/model/ContainerItem",["jquery","backbone","underscore","core/util/Globals","core/util/Service","core/util/Jsonify","core/util/Utils","common/container/model/AllowedActions","common/share/model/Collaborators","common/fileview/model/Annotation"],(function(e,t,s,docs,i,o,r,n,a,l){"use strict";var c=docs.common.Globals;return docs.models.ContainerItem=t.Model.extend({thumbRenditions:["T","G","P"],sideboards:[],initialize:function(e,t){this.options=t||{}},url:function(){if(this.options.restAPI&&this.urlRoot)return t.Model.prototype.url.call(this);throw"Derived ContainerItem must override url function"},modelType:function(){return this.get("type")},actionType:function(){return s.result(this,"modelType")},type:function(){return this.get("type")},name:function(){return this.get("name")},modifiedAt:function(){return this.get("modifiedAt")},ownedBy:function(){return this.get("ownedBy")},flags:function(){return this.get("flags")},parentShared:function(){return this.get("parentShared")},isOwned:function(){return r.isYou(this,"ownedBy")},isSharedToYou:function(){var e=this.flags().isShared,t=this.parentShared();return(c.isPublicLink||e||t)&&!this.isOwned()},isSharedByYou:function(){var e=this.flags().isShared,t=this.parentShared();return(e||t)&&this.isOwned()},getThumbnailUrl:function(e){return e?c.staticRoot+"images/thumbs/others_120.png":c.staticRoot+"images/thumbs/others_40.png"},_hasThumbnail:function(){var e=this.get("rendition")||"";return s.indexOf(this.thumbRenditions,e.toUpperCase())>-1},getLinkUrl:function(){return i.getLinkUrl(this.get("type"),this.get("id"))},getPublicLinkUrl:function(e){var t=o.parse_GET_SHARED_LINKS_FOR_OBJECT(e);return!!t.flags.isShared&&t},getUrlName:function(){var e=i.filterSpecialCharacters(this.get("name"));return 0!==e.indexOf("_")&&(e="_"+e),e},getNameAndDescription:function(){var e=this.get("name"),t=this.get("description");return t&&""!==t?e+" - "+t:e},getSelectionData:function(){var e=!!this.get("flags")&&this.get("flags").isInTrash,t=s.result(this,"modelType"),i=s.result(this,"actionType");return{id:this.id,name:this.get("name"),type:t,actionType:e?"trash":i,folderItem:this}},updateItem:function(e,t,s){var i=this.get("name"),o=this.get("description"),n=this.buildParamsForSave(e,t,s),a={url:n.url,wait:!0,data:n.data,ignoreSync:!!this.collection,error:function(e,t){e.set({name:i,description:o}),e.trigger("change")},success:function(e){e.attributes.allowedActions&&((e.get("searchResult")||!c.isAppLink&&"folder"===e.get("type")&&!r.isYou(e,"ownedBy"))&&(e.attributes.allowedActions.folderDelete=!1),e.set(e.attributes.allowedActions,{silent:!0}));var t=e.collection;t&&(t.remove(e),e.set("selected",!0,{silent:!0}),t.add(e))}};this.save({name:e,description:t,publicLinkRole:s},a)},rename:function(e){this.updateItem(e,this.get("description"))},buildParamsForSave:function(e,t,s){throw"Derived ContainerItem must override buildParamsForSave function"},getAllowedActions:function(){var e=this.get("allowedActions");return e&&e.needFetch&&(this.set(this._syncFetchAllowedActions(e)),e=this.get("allowedActions"),this.checkAllowedActions(e),this.get("searchResult")&&(e.folderDelete=!1)),e},_syncFetchAllowedActions:function(e){return n.syncFetch(this.id,this.get("type"),e.ignoreAccessDenied)},checkAllowedActions:function(e){},isAllowedAction:function(e){var t=this.getAllowedActions();return!!t&&!0===t[e]},hasRole:function(e){return this.has("roleName")?i.hasRole(this.get("roleName"),e):void 0},isDownloadable:function(){return!1},removeAnnotation:function(e,t){this._updateAnnotation("remove",e,t)},restoreAnnotation:function(e,t){this._updateAnnotation("restore",e,t)},_updateAnnotation:function(t,o,r){var n;n=this.isAsset?this.getAssetType():this.get("type").toLowerCase();var a=l.getAnnotationService(t,n);if(!s.isEmpty(a)&&o&&r&&("file"===n||"conversation"===n)){var c=i.getServiceParamsForPost(a);c.data.item=this.itemId(),c.data.dConversationID=o,c.data.dMessageID=r,e.ajax(c.url,{type:"POST",data:c.data,success:function(e,s,i){var o=t+": successful for chat: "+r;docs.common.Logger("Folder").info(o)},error:function(e,s,i){var o=t+" failed for chat: "+r+". Error message from server is: "+i.errorMsg;docs.common.Logger("Folder").error(o)}})}},get:function(e){return"metadata"!==e||t.Model.prototype.get.call(this,e)||this.updateMetadata(),t.Model.prototype.get.call(this,e)},getCollaborators:function(){var e;return this.collaborators?e=this.collaborators:(e=new a([],{folder:this,parentFolder:this.get("container")})).fetch(),e},updateMetadata:function(){var t=i.formatServiceUrl("GET_METADATA");t+="&items="+this.targetId(),t+="&isAbsolute=false";var r=this;e.ajax(t,{type:"GET",async:!1,success:function(e,t,i){var n=s.isEmpty(r.get("targetID"))?r.get("id"):r.get("targetID"),a=o.parse_item_GET_METADATA(e,n);r.set({metadata:a},{silent:!0}),r.trigger("change:metadata")}})},clean:function(){},isSideboardSupported:function(e){return s.contains(s.result(this,"sideboards"),e)},triggerMoveCopyEvent:function(e,t){docs.events.trigger("folder:movecopy",{model:void 0,type:t,id:this.id,idType:"fFolderGUID",name:this.get("name"),sourceId:e})}},{requestBulkDownload:function(t,o){o&&o.startProgressTimer();var r=i.getServiceParamsForPost("DOCS_BULK_BUILD_ZIP");r.data.items=s.map(t,(function(e){return("folder"===e.get("type")?"fFolderGUID:":"fFileGUID:")+e.id})).join(","),r.data.parent=o?o.parentModel.id:t[0].get("parentID");var n=e.Deferred();function a(e,t,i){if(o){e.errorHandled=!0;var r=s.isObject(i)?i:{title:i};o.set("errorThrown",i),o.set("errorList",[r]),o.set("responseData",e.responseData),o.stopProgressTimer(!0)}n.reject(e,t,i)}return e.ajax(r.url,{type:"POST",data:r.data,success:function(e,s,r){if(r){o.set("jobID",e.LocalData.jobId);var l=i.formatServiceUrl("DOCS_BULK_STATUS",{addToken:!0});l+="&jobId="+e.LocalData.jobId+"&parent="+t[0].get("parentID"),o.set("url",l),n.resolve(e.data?e.data:[])}else a(r,s,"error")},error:function(e,t,s){a(e,t,s)}}),n.promise()}}),docs.models.ContainerItem})),define("common/conversation/AvailableConversationsUtils",["core/osnGlobals","core/fc"],(function(osn){"use strict";return{getAvailableConversationIds:function(e){return osn.fc.sendRequest("XConversationModule$Server","getAssociatedConversationIDs",[e])}}})),define("common/model/PathFolders",["backbone","underscore","core/util/Service","core/util/Jsonify"],(function(e,t,s,i){"use strict";var o=e.Model.extend({url:function(){return s.formatServiceUrl("FLD_GET_PATH_FOLDERS")+"&items="+("folder"===this.get("type")?"fFolderGUID:":"fFileGUID:")+this.id},parse:function(e){return i.parse_FLD_GET_PATH_FOLDERS(e)}});return docs.models.PathFolders={syncFetch:function(e,i){var r=new o({id:e.get("realId")||e.id,type:e.get("type")});return r.fetch({async:!1,error:i?function(e,t){s.isAccessDenied(t.errorThrown)&&(e.attributes.accessDenied=!0,t.errorHandled=!0)}:t.noop}),r.attributes}},docs.models.PathFolders})),define("core/dialog/MessageDialog.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="dialog-flex-webbar"></div><div class="dialog-section" role="alert" aria-labelledby="" tabindex="0">  <div class="message-dialog-text"></div></div>';return __p}})),define("core/dialog/MessageDialog",["jquery","underscore","backbone","core/dialog/OJDialog","core/dialog/MessageDialog.template","core/extensions"],(function(e,t,s,i,o){"use strict";var r=s.View.extend({events:{"change #md-confirm-chk":"onLatchChanged"},initialize:function(e){e=e||{},this.message=e.message?e.message:"dialog message",this.title=t.unescape(e.title?e.title:""),this.modal=!e.modal||"yes"===e.modal,this.context=e.context,this.okButtonText=e.okButtonText?e.okButtonText:docs.i18n.t("GENERAL_CMD_OK"),this.okCallback=e.callback,this.cancelButtonText=e.cancelButtonText?e.cancelButtonText:docs.i18n.t("GENERAL_CMD_CANCEL"),this.cancelCallback=e.cancelCallback,this.showCallback=e.showCallback,this.reverseButtons=!!e.reverseButtons&&"yes"===e.reverseButtons,this.noclose=!!e.noclose,this.noescape=!!e.noescape,this.addClass=e.addClass?e.addClass:"",this.additionalEvents=e.additionalEvents,t.isUndefined(e.defaultButton)&&(e.defaultButton="cancel"),this.doubleLatch=!!e.doubleLatch,this.latchText=e.latchText?e.latchText:docs.i18n.t("ARE_YOU_SURE"),this.danger=e.danger,this.disableScriptProtection=!!e.disableScriptProtection,this.useOJET=e.useOJET||checkFeatureFlag("OJDialogs"),t.bindAll(this,"render","onOpen","onClose","onBeforeOpen","onOk","onCancel","onEvent","onLatchChanged")},render:function(){e(this.el).html(o())},cancelBehavior:function(){return this.noclose&&this.noescape?"none":this.noescape?"escape":"icon"},dialogClassName:function(){var e="";return this.useOJET||(e="dialog-standard"+this.addClass.length>0?" ":""),e+this.addClass.length>0?this.addClass:void 0},width:function(){return this.getResizeValues().width},buttons:function(){var e={chroming:this.reverseButtons?null:"callToAction",text:this.okButtonText,click:this.onOk,id:"okButton",disabled:this.doubleLatch},t=[e];if(this.danger&&(e.class="ui-button-danger"),this.cancelCallback){var s={chroming:this.reverseButtons?"callToAction":null,text:this.cancelButtonText,click:this.onCancel,id:"cancelButton"};this.reverseButtons?t.push(s):t.splice(0,0,s)}return t},onOpen:function(){var s="#okButton";if(this.showCallback&&(this.context.md$el=this.$el,this.callCallback(this.showCallback,this.context)),this.cancelCallback&&("cancel"===this.options.defaultButton||this.doubleLatch)?e(this).parent().find("#cancelButton").focus():e(this).parent().find(s).focus(),this.additionalEvents){var i=t.isArray(this.additionalEvents)?this.additionalEvents:[this.additionalEvents];t(i).each(t.bind((function(t){e(this.el).find(t.selector).on(t.event,t.handler,this.onEvent)}),this))}},onClose:function(){if(this.additionalEvents){var s=t.isArray(this.additionalEvents)?this.additionalEvents:[this.additionalEvents];t(s).each(t.bind((function(t){e(this.el).find(t.selector).off(t.event)}),this))}this.doOk&&this.okCallback?this.callCallback(this.okCallback,this.context):this.doCancel&&this.cancelCallback&&this.callCallback(this.cancelCallback,this.context)},onBeforeOpen:function(){var s=this.$el.find('[role="alert"]');s.uniqueId();var i=t.isArray(this.message)?this.message:[this.message],o=e(this.el).find(".dialog-section"),r=e(this.el).find(".message-dialog-text").remove();t(i).each((function(e){var s=r.clone(),i=this.disableScriptProtection?e:t.escape(e);o.append(s.html(i)),s.uniqueId();var n=s.attr("id"),a=o.attr("aria-labelledby");a=t.isEmpty(a)?n:a+" "+n,o.attr("aria-labelledby",a)}),this),this.useOJET||this.$el.dialog("widget").attr("aria-describedby",s.attr("id")),this.doubleLatch&&(o.append('<div id="md-confirm-line" class="dialog-section" style="display: none;"><input id="md-confirm-chk" class="message-dialog-confirm-chk" type="checkbox"/><label id="md-confirm-label" for="md-confirm-chk"></label></div>'),this.$("#md-confirm-label").text(this.latchText),this.$("#md-confirm-line").show())},onOk:function(){this.doOk=!0,this.close()},onCancel:function(){this.doCancel=!0,this.close()},onEvent:function(e){this.close(),e.data&&e.data(this.context)},onLatchChanged:function(){if(this.useOJET)this.$("#md-confirm-chk").prop("checked")?this.enableButton("okButton",!0):this.enableButton("okButton",!1);else{var e=this.$el.parent().find("#okButton");this.$("#md-confirm-chk").prop("checked")?e.button("enable"):e.button("disable")}},callCallback:function(e,s){this.options.deferCallbacks?t.defer((function(e,t){e.call(t,t)}),e,s):e.call(s,s)},getResizeValues:function(){var t={width:600};return e("#osn-view-options").width()<600&&(t.width=320),t},show:function(){this.render();var s="#okButton",i=[{class:this.reverseButtons?"ui-button-secondary":this.danger?"ui-button-danger":"ui-button-primary",text:this.okButtonText,click:this.onOk,id:"okButton",disabled:this.doubleLatch}];if(this.cancelCallback){var o={class:this.reverseButtons?"ui-button-primary":"ui-button-secondary",text:this.cancelButtonText,click:this.onCancel,id:"cancelButton"};this.reverseButtons?i.push(o):i.splice(0,0,o)}var r=this;this.$el.dialog({modal:this.modal,title:t.unescape(this.title),resizable:!1,width:this.getResizeValues().width,buttons:i,dialogClass:this.addClass+(this.addClass.length>0?" ":"")+(this.noclose?"dialog-standard no-close":"dialog-standard"),closeOnEscape:!this.noescape,open:function(){if(r.showCallback&&(r.context.md$el=r.$el,r.callCallback(r.showCallback,r.context)),r.cancelCallback&&("cancel"===r.options.defaultButton||r.doubleLatch)?e(this).parent().find("#cancelButton").focus():e(this).parent().find(s).focus(),r.additionalEvents){var i=t.isArray(r.additionalEvents)?r.additionalEvents:[r.additionalEvents];t(i).each((function(t){e(r.el).find(t.selector).on(t.event,t.handler,r.onEvent)}))}},close:function(){if(r.additionalEvents){var s=t.isArray(r.additionalEvents)?r.additionalEvents:[r.additionalEvents];t(s).each((function(t){e(r.el).find(t.selector).off(t.event)}))}r.$el.dialog("destroy").remove(),r.doOk&&r.okCallback?r.callCallback(r.okCallback,r.context):r.doCancel&&r.cancelCallback&&r.callCallback(r.cancelCallback,r.context)},create:function(){var s=r.$el.find('[role="alert"]');s.uniqueId();var i=t.isArray(r.message)?r.message:[r.message],o=e(r.el).find(".dialog-section"),n=e(r.el).find(".message-dialog-text").remove();t(i).each((function(e){var s=n.clone(),i=r.disableScriptProtection?e:t.escape(e);o.append(s.html(i)),s.uniqueId();var a=s.attr("id"),l=o.attr("aria-labelledby");l=t.isEmpty(l)?a:l+" "+a,o.attr("aria-labelledby",l)})),r.$el.dialog("widget").attr("aria-describedby",s.attr("id")),r.doubleLatch&&(o.append('<div id="md-confirm-line" class="dialog-section" style="display: none;"><input id="md-confirm-chk" class="message-dialog-confirm-chk" type="checkbox"/><label id="md-confirm-label" for="md-confirm-chk"></label></div>'),r.$("#md-confirm-label").text(r.latchText),r.$("#md-confirm-line").show())},closeText:docs.i18n.t("GENERAL_CMD_CLOSE")})}},{show:function(e){e.DialogClass=r,i.show(e)},showYesNo:function(e,s,i,o){e=e||{},o=t.isUndefined(o)?t.isFunction(i)?t.isFunction(s)?void 0:s:i:o,s=t.isFunction(s)?s:void 0,i=t.isFunction(i)?i:void 0,e.modal="yes",e.cancelButtonText=docs.i18n.t("NO"),e.okButtonText=docs.i18n.t("YES"),e.context=o,e.reverseButtons="no",e.defaultButton="ok",e.cancelCallback=i||e.cancelCallback||t.noop,e.callback=s||e.callback,r.show(e)}});return r})),define("common/preferences/model/Devices",["jquery","underscore","backbone","core/util/Globals","core/util/Service","core/util/Jsonify","core/util/Logger"],(function(e,t,s,docs){"use strict";var i=docs.common.Service,o=docs.common.Jsonify;return docs.models.Device=s.Model.extend({}),docs.models.Devices=s.Collection.extend({model:docs.models.Device,url:function(){return i.formatServiceUrl("SYNC_GET_DEVICES")},initialize:function(e){this.options=e||{}},parse:function(e){docs.common.Logger("Devices").trace("parse","raw data",e);var t=o.parse_SYNC_GET_DEVICES(e);return docs.common.Logger("Devices").trace("parse",t),t}}),docs.models.Devices})),define("common/model/ServerInfo",["jquery","underscore","backbone","core/util/Globals","core/util/Service","core/util/Jsonify"],(function(e,t,s){"use strict";return docs.models.ServerInfo=s.Model.extend({defaults:{},initialize:function(e,t){this.options=t||{},this.fetch({async:!1})},url:function(){var e=docs.common.Service.formatServiceUrl("GET_SERVER_INFO");return this.options.returnCsrfToken&&(e+="&IsReturnCSRFToken=1"),e},parse:function(e){return docs.common.Jsonify.parse_SERVER_INFO(e)}}),docs.models.ServerInfo})),define("common/util/WebEdit",["jquery","underscore","backbone","core/util/Session","core/util/Service","core/dialog/MessageDialog","core/osnGlobals","core/AppEvents","core/util/Globals","core/util/Browser","common/preferences/model/Devices","common/model/ServerInfo"],(function(e,t,s,i,o,r,osn,n,docs,a,l,c){"use strict";return{editDocument:function(e,s){var o=this.getClientSettings(s,a.clientType()),n=this;this.isClientInstalledCheck().done(t.bind((function(){i.webEditPrompt()?r.show({title:o.title,message:o.promptMsg,okButtonText:docs.i18n.t("YES"),cancelButtonText:docs.i18n.t("NO"),callback:function(){i.webEditPrompt(!1),n.doEdit(e)},cancelCallback:t.noop,additionalEvents:[{selector:"#wededit_download_apps",event:"click",handler:n.clickDownloadApps}],disableScriptProtection:!0}):this.doEdit(e)}),this)).fail(t.bind((function(e){e?osn.events.trigger("error",{dialogType:"common/dialog/ConfirmationDialogView",primaryButtonTextI18n:"refresh",message:osn.i18n.t("lostConnection"),confirm:function(){osn.views.BaseView.reload()}}):r.show({title:o.title,message:o.downloadMsg,okButtonText:docs.i18n.t("GENERAL_CMD_DONE"),additionalEvents:[{selector:"#wededit_download_apps",event:"click",handler:n.clickDownloadApps}],disableScriptProtection:!0})}),this))},getClientSettings:function(e,t){var s={};return s.title=docs.i18n.t("WEBEDIT_EDIT_DIALOG_TITLE",e),"mac"===t?(s.downloadMsg=docs.i18n.t("WEBEDIT_DOWNLOAD_CLIENT_MESSAGE_MAC"),s.promptMsg=[docs.i18n.t("WEBEDIT_EDIT_PROMPT_MESSAGE_MAC"),docs.i18n.t("WEBEDIT_EDIT_PROCEED_MESSAGE_MAC")]):(s.downloadMsg=docs.i18n.t("WEBEDIT_DOWNLOAD_CLIENT_MESSAGE_WIN"),s.promptMsg=[docs.i18n.t("WEBEDIT_EDIT_PROMPT_MESSAGE_WIN"),docs.i18n.t("WEBEDIT_EDIT_PROCEED_MESSAGE_WIN")]),s},isEnabled:function(){var e=a.clientType();return"windows"===e||"mac"===e},isClientInstalledCheck:function(){var t=new l;return t.$dfd=e.Deferred(),t.fetch({async:!1,success:this.fetchSuccess,error:this.fetchError}),t.$dfd.promise()},fetchSuccess:function(e){if(e.length>0){var s="mac"===a.clientType()?"desktop.mac":"desktop.windows";t(e.models).filter((function(e){return 0===e.get("type").indexOf(s)})).length>0?e.$dfd.resolve():e.$dfd.reject()}else e.$dfd.reject()},fetchError:function(e,t){var s=!1,i=t.errorThrown;(o.isInvalidToken(i)||o.isInvalidTokenUserInfo(i)||0===i.code&&o.isSSOLoginPage(t)||19===i.code||!docs.common.Globals.isPublicLink&&t.responseText&&t.responseText.indexOf("\x3c!--IdcClientLoginForm=1--\x3e")>-1)&&(s=!0),t.errorHandled=s,e.$dfd.rejectWith({},[s])},clickDownloadApps:function(){docs.common.Globals.URLs.download&&"install"!==docs.common.Globals.URLs.download?window.open(docs.common.Globals.URLs.download):osn.router.navigate("install",{trigger:!0})},doEdit:function(e){new c({},{returnCsrfToken:!0});var t="oracledocuments.edit://"+window.location.hostname+"/edit?id="+e+o.getCSRFTokenParam();document.location=t}}})),define("common/util/O365Edit",["jquery","underscore","backbone","core/util/Session","core/util/Service","core/util/Globals","core/dialog/MessageDialog","core/osnGlobals","core/util/Browser","core/view/MessageBar","core/util/FirstTimeSinceUpdate","core/util/FeatureFlags"],(function(e,t,s,i,o,docs,r,osn,n,a,l,c){"use strict";var d=docs.events;window.localStorage.getItem("debugOfficeFiles")&&(docs.common.Globals.o365=JSON.parse('{"enabled":true,"tenantEnabled":true,"clickTime":1584464960579,"exts":{"view":{"xls":1,"xlsx":1,"potx":1,"docm":1,"pptx":1,"pot":1,"dot":1,"dotm":1,"xlsm":1,"xlsb":1,"dotx":1,"ppsm":1,"ppsx":1,"odp":1,"pps":1,"rtf":1,"ods":1,"odt":1,"ppt":1,"wopitestx":1,"doc":1,"potm":1,"docx":1,"csv":1,"wopitest":1,"pptm":1},"edit":{"ppsx":1,"xlsx":1,"xlsm":1,"docm":1,"xlsb":1,"odp":1,"docx":1,"wopitest":1,"ods":1,"odt":1,"wopitestx":1,"pptx":1}}}'));var u=t.once((function(){return{excel:{exts:["csv","ods","xls","xlsb","xlsm","xlsx"],action_o365_view:{label:docs.i18n.t("ACTION_VIEW_O365_EXCEL"),tooltip:docs.i18n.t("ACTION_VIEW_O365_EXCEL_TT"),hasIcon:!0},action_o365_edit:{label:docs.i18n.t("ACTION_EDIT_O365_EXCEL"),tooltip:docs.i18n.t("ACTION_EDIT_O365_EXCEL_TT"),hasIcon:!0},action_webedit:{label:docs.i18n.t("ACTION_EDIT_DESK_EXCEL"),tooltip:docs.i18n.t("ACTION_EDIT_DESK_EXCEL_TT"),hasIcon:!0},action_view:{label:docs.i18n.t("ACTION_VIEW_WEB"),tooltip:docs.i18n.t("ACTION_VIEW_WEB_TT")},thumbs:{overlayClass:"thumbType-xls",thumb40:"oo/xlsx_32.svg",thumb120:"oo/xlsx_64.svg",thumb150:"oo/xlsx_96.svg",isOfficeIcon:!0,useExtension:!0,gridAlignTop:!0,isImage:!0,wantGeneric:!0,noClip:!0,hasRealThumbnail:!1},appicon:{color:"oo/Excel_48x48.png"}},ppt:{exts:["odp","pot","potm","potx","pps","ppsm","ppsx","ppt","pptm","pptx"],action_o365_view:{label:docs.i18n.t("ACTION_VIEW_O365_PPT"),tooltip:docs.i18n.t("ACTION_VIEW_O365_PPT_TT"),hasIcon:!0},action_o365_edit:{label:docs.i18n.t("ACTION_EDIT_O365_PPT"),tooltip:docs.i18n.t("ACTION_EDIT_O365_PPT_TT"),hasIcon:!0},action_webedit:{label:docs.i18n.t("ACTION_EDIT_DESK_PPT"),tooltip:docs.i18n.t("ACTION_EDIT_DESK_PPT_TT"),hasIcon:!0},action_view:{label:docs.i18n.t("ACTION_VIEW_WEB"),tooltip:docs.i18n.t("ACTION_VIEW_WEB_TT")},thumbs:{overlayClass:"thumbType-ppt",thumb40:"oo/pptx_32.svg",thumb120:"oo/pptx_64.svg",thumb150:"oo/pptx_96.svg",isOfficeIcon:!0,useExtension:!0,isImage:!0,wantGeneric:!0,noClip:!0,hasRealThumbnail:!1},appicon:{color:"oo/PowerPoint_48x48.png"}},word:{exts:["doc","docm","docx","dot","dotm","dotx","odt","rtf"],action_o365_view:{label:docs.i18n.t("ACTION_VIEW_O365_WORD"),tooltip:docs.i18n.t("ACTION_VIEW_O365_WORD_TT"),hasIcon:!0},action_o365_edit:{label:docs.i18n.t("ACTION_EDIT_O365_WORD"),tooltip:docs.i18n.t("ACTION_EDIT_O365_WORD_TT"),hasIcon:!0},action_webedit:{label:docs.i18n.t("ACTION_EDIT_DESK_WORD"),tooltip:docs.i18n.t("ACTION_EDIT_DESK_WORD_TT"),hasIcon:!0},action_view:{label:docs.i18n.t("ACTION_VIEW_WEB"),tooltip:docs.i18n.t("ACTION_VIEW_WEB_TT")},thumbs:{overlayClass:"thumbType-doc",thumb40:"oo/docx_32.svg",thumb120:"oo/docx_64.svg",thumb150:"oo/docx_96.svg",isOfficeIcon:!0,useExtension:!0,gridAlignTop:!0,isImage:!0,wantGeneric:!0,noClip:!0,hasRealThumbnail:!1},appicon:{color:"oo/Word_48x48.png"}},test:{exts:["wopitest"],action_o365_view:{label:docs.i18n.t("ACTION_VIEW_O365_TEST"),tooltip:docs.i18n.t("ACTION_VIEW_O365_TEST_TT"),hasIcon:!0},action_webedit:{label:docs.i18n.t("ACTION_EDIT"),tooltip:docs.i18n.t("ACTION_EDIT_TT"),hasIcon:!1},appicon:{color:"oo/Office-Color-S-16.svg"}},office:{appicon:{color:"oo/Office-wordmark-color.png",width:1417,height:654}}}})),m={isEnabled:function(e){e=e||{};var s=!1,i=!1;if(docs.common.Globals.o365&&(s=docs.common.Globals.o365.enabled,i=docs.common.Globals.o365.tenantEnabled),e.systemOnly)return s;if(e.tenantOnly)return i;if(e.systemAndTenant)return s&&i;if(s&&i){if(!docs.common.Globals.isTenantUser)return!1;if(e.checkUser)return!0;var o=m.getSupportedExtensions(e.action);if(t.property(e.extension)(o)&&m.getAppConfig(e.extension)){var r=n.clientType();return"windows"===r||"mac"===r||"linux"===r}}return!1},getSupportedExtensions:function(e){switch(e){case"action_o365_view":case"action_view":case"action_webedit":return docs.common.Globals.o365.exts.view;case"action_o365_edit":return docs.common.Globals.o365.exts.edit;default:return{}}},getThumbDetails:function(e){if(m.isEnabled({action:"action_o365_view",extension:e})){var s=m.getAppConfig(e);if(s){var o=t.clone(s.thumbs);return o&&t.contains(["layout_grid","layout_tile","layout_smalltile"],i.containerLayout())&&delete o.wantGeneric,o}}},getAppConfig:function(e){var s=e.toLowerCase();return t.find(u(),(function(e){return t.contains(e.exts,s)}))},updateActionProperties:function(e,s){if(m.isEnabled({action:e.id,extension:s})){var i=m.getActionProperties({action:e.id,extension:s});t.extend(e,i)}else delete e.hasIcon,delete e.icon,e.orig_label&&(e.label=e.orig_label),e.orig_tooltip&&(e.tooltip=e.orig_tooltip)},getActionProperties:function(e){var s=m.getAppConfig(e.extension),i={};return t.extend(i,s[e.action]),s.appicon&&i.hasIcon?t.extend(i,{icon:docs.common.Globals.staticRoot+"images/thumbs/"+s.appicon.color,iconClass:"office"}):t.extend(i,{icon:null,iconClass:null}),i},editDocument:function(e,s,i,o){if(l.get("o365aup"))t.defer(m.preEditChecks,e,s,i,o);else{var n=m.getSettings(s,!0);r.show({title:n.title,message:n.promptMsg,okButtonText:docs.i18n.t("GENERAL_CMD_CONTINUE"),cancelButtonText:docs.i18n.t("GENERAL_CMD_CANCEL"),callback:function(){l.set("o365aup"),t.defer(m.preEditChecks,e,s,i,o)},cancelCallback:t.noop,disableScriptProtection:!0})}},viewDocument:function(e,s){if(l.get("o365aup"))t.defer(m.doView,e);else{var i=m.getSettings(s,!1);r.show({title:i.title,message:i.promptMsg,okButtonText:docs.i18n.t("GENERAL_CMD_CONTINUE"),cancelButtonText:docs.i18n.t("GENERAL_CMD_CANCEL"),callback:function(){l.set("o365aup"),t.defer(m.doView,e)},cancelCallback:t.noop,disableScriptProtection:!0})}},getIconForMessage:function(){var e=u().office.appicon;return'<div><img src="'+docs.common.Globals.staticRoot+"images/thumbs/"+e.color+'" width="'+.2*e.width+'" height="'+.2*e.height+'" alt="" /></div>'},getSettings:function(e,s,i){var o,r={};return(i=i||{}).title?r.title=docs.i18n.t(i.title,e):r.title=s?docs.i18n.t("O365_EDIT_DIALOG_TITLE",e):docs.i18n.t("O365_VIEW_DIALOG_TITLE",e),r.promptMsg=[docs.i18n.t("O365_OPEN_PROMPT_MESSAGE"),m.getIconForMessage(),docs.i18n.t("O365_SERVICE_DISCLAIMER")],o=t.has(i,"additionalText")?i.additionalText:m.getTenantAdditionalText(),t.isEmpty(o)||r.promptMsg.push(o),r},preEditChecks:function(e,s,i,o,r){if(i&&c("officePreEditLock"))i.makeReservation({success:function(){m.doEdit(e)},error:function(t,o,r){if(t.responseData){t.errorHandled=!0;var n=r.errorMsgKey;if(n.indexOf("!csFldCannotReserveItemBeingEdit")>0)m.doEdit(e);else if(n.indexOf("!csFldThisItemIsAlreadyReserved")>0){var l=t.responseData.LocalData;l&&l.fReservedBy===docs.common.Globals.userid?m.doEdit(e):(l&&(i.set({reservedAt:l.fReservationDate,reservedBy:l.fReservedBy,reservedByName:l.fReservedByFullName}),i.modelUpdated()),new a({messageText:docs.i18n.t("O365_EDIT_FILE_FAILURE_ALREADY_RESERVED",s,l?l.fReservedByFullName:""),messageType:"error"}))}else n.indexOf("!csFldThisItemDoesNotExist")>0||n.indexOf("!csFldCannotReserveItemInTrash")>0?new a({messageText:docs.i18n.t("O365_EDIT_FILE_FAILURE_NO_FILE",s),messageType:"error"}):new a({messageText:docs.i18n.t("O365_EDIT_FILE_FAILURE_UNKNOWN",s),messageType:"error"})}}});else{var n=new o({id:e});n.fetch({async:!1,success:function(e){r&&d.trigger("file:uploaded",e)},error:function(e,t){if(t){t.errorHandled=!0;var i=t.errorThrown.errorMsgKey;i.indexOf("!csFldThisItemDoesNotExist")>0||i.indexOf("!csFldDoesNotExist")>0?new a({messageText:docs.i18n.t("O365_EDIT_FILE_FAILURE_NO_FILE",s),messageType:"error"}):new a({messageText:docs.i18n.t("O365_EDIT_FILE_FAILURE_UNKNOWN",s),messageType:"error"})}}}),t.isEmpty(n.get("reservedBy"))||n.get("reservedBy")===docs.common.Globals.userid?m.doEdit(e):(i&&(i.set({reservedAt:n.get("reservedAt"),reservedBy:n.get("reservedBy"),reservedByName:n.get("reservedByName")}),i.modelUpdated()),new a({messageText:docs.i18n.t("O365_EDIT_FILE_FAILURE_ALREADY_RESERVED",s,n.get("reservedByName")),messageType:"error"}))}},doEdit:function(e){m._go("office/edit/",e)},doView:function(e){m._go("office/view/",e)},_go:function(e,t){var s=docs.common.Globals.routerRoot;docs.common.Globals.embed&&(s=s.replace(/\/popup|\/ssoembed(\/v\d+)?|\/mobile\/appembed|\/embed(\/v\d+)?/,""));var i="_office_"+t,o=window.open(s+m.getRoutePrefix()+e+t,i);o&&o.focus()},getRoutePrefix:function(){var e="";return docs.common.Service.linkId&&(e=docs.common.Service.isAppLink?"link/app/":"link/",e+=docs.common.Service.linkId+"/"),e},getNewIcon:function(e){var t;switch(e){case"action_o365_new_word":t=m.getActionProperties({action:"action_o365_edit",extension:"docx"});break;case"action_o365_new_ppt":t=m.getActionProperties({action:"action_o365_edit",extension:"pptx"});break;case"action_o365_new_excel":t=m.getActionProperties({action:"action_o365_edit",extension:"xlsx"})}return t?t.icon:null},getNewIconClass:function(e){switch(e){case"action_o365_new_word":case"action_o365_new_ppt":case"action_o365_new_excel":return"office";default:return null}},newOfficeDocument:function(e,t){require(["docs/dialogs/NewFileDialog"],function(s){var i={parentId:e.get("id"),officeType:t,title:docs.i18n.t("NEW_OFFICE_"+t.toUpperCase()+"_DIALOG_TITLE"),ext:"."+t};s.show(i,{cbOk:function(e,t,s){require(["common/docs/folderview/model/FileItem"],(function(t){m.preEditChecks(s,e,null,t,!0)}))},cbContext:this})}.bind(this))},setTenantEnabledValue:function(e){return m._setTenantConfig("O365Disabled",e?"0":"1",(function(){docs.common.Globals.o365&&(docs.common.Globals.o365.tenantEnabled=e)}))},setTenantAdditionalText:function(e){return m._setTenantConfig("O365AdditionalText",e,(function(){docs.common.Globals.o365&&(docs.common.Globals.o365.additionalText=e)}))},getTenantAdditionalText:function(){return docs.common.Globals.o365&&!t.isEmpty(docs.common.Globals.o365.additionalText)?docs.common.Globals.o365.additionalText:""},_setTenantConfig:function(s,i,r){var n,a=o.getServiceParamsForPost("SET_TENANT_CONFIG");return a.data.dTenantOptionName=s,a.data.dTenantOptionValue=i,e.ajax(a.url,{type:"POST",data:a.data,async:!1,success:function(){r&&r.call(m),n="success"},error:function(e){n=t.unescape(e.errorThrown.errorMsg)}}),n},loadStaticFiles:function(){if(c("OfficeOnlinePreload")&&docs.common.Globals.o365.preloads&&(docs.common.Globals.o365.preloads.edit||docs.common.Globals.o365.preloads.view)&&m.isEnabled({systemAndTenant:!0})){var s,i=m.createIframe(e("body"));e(i).on("load",(function(){t.defer((function(){e(i).remove(),m.loadStaticFiles()}))})),docs.common.Globals.o365.preloads.edit&&docs.common.Globals.o365.preloads.edit.length>0?(s=docs.common.Globals.o365.preloads.edit.pop(),0===docs.common.Globals.o365.preloads.edit.length&&delete docs.common.Globals.o365.preloads.edit):docs.common.Globals.o365.preloads.view&&docs.common.Globals.o365.preloads.view.length>0&&(s=docs.common.Globals.o365.preloads.view.pop(),0===docs.common.Globals.o365.preloads.view.length&&delete docs.common.Globals.o365.preloads.view),s&&e(i).attr("src",s)}},createIframe:function(t){var s=document.createElement("iframe"),i=e(s).uniqueId();return i.attr({name:i.attr("id"),src:"javascript:false"}),i.css("display","none"),t.append(i),s}};return osn.events.listenToOnce(osn.events,"osn-fcbc-ready",m.loadStaticFiles),m})),define("common/docs/folderview/model/FileItem",["jquery","underscore","core/util/Globals","core/util/Service","core/util/Jsonify","core/util/Thumbs","common/model/PathFolders","common/util/WebEdit","common/util/O365Edit","common/container/model/ContainerItem","common/docs/VirusScanUtils"],(function(e,t,docs,s,i,o,r,n,a,l,c){"use strict";return docs.models.FileItem=docs.models.ContainerItem.extend({isFile:!0,initialize:function(e,t){docs.models.ContainerItem.prototype.initialize.call(this,e,t),e.caasGuid&&this.set("_linkBackUrl","/collections/view/"+e.parentID+"/"+e.id)},url:function(){var e=s.formatServiceUrl("FLD_INFO",{noLink:this.get("memberAccess")})+"&item=fFileGUID:"+this.id;return this.options.fetchRevision&&this.get("revision")&&(e+="&dRevLabel="+this.get("revision")),e+="&doRetrieveMetadata=1",this.get("hybridLinkId")&&(e+="&dLinkID="+this.get("hybridLinkId")),e},get:function(e){return"metadata"!==e||l.prototype.get.call(this,e)||this.updateMetadata(),l.prototype.get.call(this,e)},getRevision:function(){return this.get("revision")},getLastRevision:function(){return this.get("lastRevision")},itemId:function(){return"fFileGUID:"+this.get("id")},targetId:function(){return t.isEmpty(this.get("targetID"))?this.itemId():"fFileGUID:"+this.get("targetID")},conversationReferenceId:function(){return this.itemId()},parse:function(e){return t.has(e,"LocalData")?i.parse_FLD_INFO_FILE(e):e},getThumbnailUrl:function(e,t,s,i){return o.getUrl({extension:this.get("extension"),id:this.get("id"),revision:this.get("revision"),onDemand:t,size:s?"extra-large":e?"large":"small",inTrash:this.get("flags").isInTrash,infected:this.isVirusScanInfected(),scanPending:this.isVirusScanPending(),skipped:this.isVirusScanSkipped(),wantGeneric:i,thumbDetailsCB:a.getThumbDetails})},getVirusScanOptions:function(){return{infected:this.isVirusScanInfected(),scanPending:this.isVirusScanPending(),skipped:this.isVirusScanSkipped()}},isDownloadable:function(){var e="file"===this.type();return this.isAllowedAction("fileRead")&&e},startDownload:function(e){var t=this.getDownloadUrl(e);window.open(t)},getDownloadUrl:function(e){t.isUndefined(e)&&(e=!0);var i=e?null:this.get("revision");return s.getDownloadUrl(this.get("id"),i)},getLinkUrl:function(){return s.getLinkUrl(this.get("type"),this.get("id"))},getPublicLinkUrl:function(e){var t=i.parse_GET_SHARED_LINKS_FOR_OBJECT(e);return!!t.flags.isShared&&t},buildParamsForSave:function(e,t){var i=s.getServiceParamsForPost("FLD_EDIT_FILE");return i.data.item=this.itemId(),i.data.fFileType="owner",i.data.fFileName=e,i.data.fFileDescription=t,i},getAllowedActions:function(){var e=this.get("allowedActions");return e&&e.needFetch&&(this.getPath(!!this.collection&&this.collection.container.isFavorites),e=this.get("allowedActions")),e},getPath:function(e){var t=this.get("path");if(!t){var s=r.syncFetch(this,e);!s.path&&s.accessDenied&&(this.get("allowedActions").needFetch=!1,this.get("allowedActions").filePreview=!0),t=s.path,this.set("path",t,{silent:!0}),s.itemInfo&&this.set(s.itemInfo,{silent:!0})}return t},modelUpdated:function(){var e=this.collection;if(e){this.set("selected",!0,{silent:!0});var t=this.get("checked");e.remove(this),e.add(this),t&&this.set("checked",!0,{silent:!0})}},isReserved:function(){var e=this.get("reservedBy");return!(!e||e.length<=0)},makeReservation:function(t){t=t||{};var o=s.getServiceParamsForPost("FLD_SET_RESERVATION");o.data.item=this.itemId();var r=this,n=null;e.ajax(o.url,{type:"POST",async:!1,cache:!1,data:o.data,success:t.success?t.success:function(e){var t=i.parse_FLD_SET_RESERVATION(e);t.reservationSet=!0,r.set(t,{silent:!0}),r.set("selected",!0,{silent:!0}),r.modelUpdated(),n={success:!0,fileItem:r},docs.events.trigger("FileItem:makeReservation",n)},error:t.error?t.error:function(e,t,s){e.responseData?(n={success:!1,fileItem:r,error:s},s.errorMsgKey&&s.errorMsgKey.indexOf("csFldThisItemIsAlreadyReserved")>-1&&(e.responseData.LocalData?r.set({reservationSetError:!0,reservedAt:e.responseData.LocalData.fReservationDate,reservedBy:e.responseData.LocalData.fReservedBy,reservedByName:e.responseData.LocalData.fReservedByFullName},{silent:!0}):r.fetch({async:!1}),r.modelUpdated()),docs.events.trigger("FileItem:makeReservation",n),e.errorHandled=!0):(n={success:!1,fileItem:r},docs.events.trigger("FileItem:makeReservation",n),e.errorHandled=!0)}})},clearReservation:function(t){t=t||{};var o=s.getServiceParamsForPost("FLD_CLEAR_RESERVATION");o.data.item=this.itemId(),o.data.fReservedBy=this.get("reservedBy");var r=this,n=null;e.ajax(o.url,{type:"POST",async:!1,cache:!1,data:o.data,success:t.success?t.success:function(e){var t=i.parse_FLD_SET_RESERVATION(e);t.reservationCleared=!0,r.set(t,{silent:!0}),r.set("selected",!0,{silent:!0}),r.unset("reservedAt",{silent:!0}),r.unset("reservedBy",{silent:!0}),r.unset("reservedByName",{silent:!0}),r.modelUpdated(),n={success:!0,fileItem:r},docs.events.trigger("FileItem:clearReservation",n)},error:t.error?t.error:function(e,t,s){e.responseData?(n={success:!1,fileItem:r,error:s},s.errorMsgKey&&s.errorMsgKey.indexOf("csFldReservedUserNotMatched")>-1?(e.responseData.LocalData?r.set({reservationClearedError:!0,reservedAt:e.responseData.LocalData.fReservationDate,reservedBy:e.responseData.LocalData.fReservedBy,reservedByName:e.responseData.LocalData.fReservedByFullName},{silent:!0}):r.fetch({async:!1}),r.modelUpdated()):s.errorMsgKey&&s.errorMsgKey.indexOf("csFldThisItemIsNotReserved")>-1&&(r.unset("reservedAt",{silent:!0}),r.unset("reservedBy",{silent:!0}),r.unset("reservedByName",{silent:!0}),r.modelUpdated()),docs.events.trigger("FileItem:clearReservation",n),e.errorHandled=!0):(n={success:!1,fileItem:r},docs.events.trigger("FileItem:clearReservation",n),e.errorHandled=!0)}})},getMaxLinkRole:function(){return this.has("maxLinkRole")||s.setFolderOptions(this),this.get("maxLinkRole")},isVirusScanned:function(){return c.isScanned(this)},isVirusScanInfected:function(){return c.isInfected(this)},isVirusScanSkipped:function(){return c.isSkipped(this)},isVirusScanPending:function(){return c.isScanPending(this)},defaultConversationName:function(){var e=this.get("name"),s=this.get("extension");return t.isEmpty(s)?e:e.replace(new RegExp("\\."+s+"$"),"")},startEdit:function(e){e&&"desktopEdit"!==e?"o365Edit"===e&&t.defer(a.editDocument,this.get("id"),this.get("name"),this,docs.models.FileItem):t.defer(t.bind((function(){n.editDocument(this.get("id"),this.get("name"))}),this))},startView:function(){t.defer(a.viewDocument,this.get("id"),this.get("name"))},updateMetadata:function(){var o=s.formatServiceUrl("GET_METADATA");this.get("selectedItemsIds")?o+="&items="+this.get("selectedItemsIds"):o+="&items="+this.itemId(),o+="&isAbsolute=false";var r=this;e.ajax(o,{type:"GET",async:!1,success:function(e,s,o){var n=t.isEmpty(r.get("targetID"))?r.get("id"):r.get("targetID"),a=i.parse_item_GET_METADATA(e,n);r.set({metadata:a},{silent:!0}),r.tags=docs.common.Jsonify.parse_item_METADATA_TAGS(e,r.get("selectedItemList")),r.set({tags:r.tags},{silent:!0}),r.trigger("change:metadata")}})}}),docs.models.FileItem})),define("common/docs/folderview/model/FolderItem",["jquery","underscore","core/util/Globals","core/util/Service","core/util/Jsonify","common/model/PathFolders","common/container/model/ContainerItem"],(function(e,t,docs,s,i,o,r){"use strict";var n=docs.common.Globals;return docs.models.FolderItem=docs.models.ContainerItem.extend({isFolder:!0,initialize:function(e,t){docs.models.ContainerItem.prototype.initialize.call(this,e,t)},url:function(){return s.formatServiceUrl("FLD_INFO")+"&item="+this.itemId()+"&fFileType=owner&doRetrieveMetadata=1"},get:function(e){return"metadata"!==e||r.prototype.get.call(this,e)||this.updateMetadata(),r.prototype.get.call(this,e)},itemId:function(){return"fFolderGUID:"+this.get("id")},targetId:function(){return this.itemId()},conversationReferenceId:function(){return this.itemId()},parse:function(e){return t.has(e,"LocalData")?i.parse_FLD_INFO_Item(e):e},getThumbnailUrl:function(e){var t;if(this.get("flags").isInTrash){var s=this.get("scsFlags");if(s&&s.site){var i=this.get("application");return i&&"framework.site.template"===i?n.staticRoot+"images/template_icon_40.svg":n.staticRoot+"images/site_icon.svg"}if(s&&s.theme)return n.staticRoot+"images/theme_icon.svg";if(s&&s.variant)return n.staticRoot+"images/update_icon.svg";if(s&&s.app)return n.staticRoot+"images/app_icon.svg";t="private-folder"}else t=this.isOwned()?this.isSharedByYou()?"sharedbyyou-folder":"private-folder":"sharedtoyou-folder";return n.staticRoot+"images/"+t+(e?"_120.png":".png")},getLinkUrl:function(){return s.getLinkUrl(this.get("type"),this.get("id"))},getPublicLinkUrl:function(e){var t=i.parse_GET_SHARED_LINKS_FOR_OBJECT(e);return!!t.flags.isShared&&t},buildParamsForSave:function(e,t,i){var o=s.getServiceParamsForPost("FLD_EDIT_FOLDER");return o.data.item=this.itemId(),o.data.fFolderName=e,o.data.fFolderDescription=t,o.data.fDefaultLinkRole=i,o},defaultConversationName:function(){return this.get("name")},getAllowedActions:function(){var e=this.get("allowedActions");return e&&e.needFetch&&(this.getPath(this.collection.container.isFavorites),e=this.get("allowedActions")),e},getPath:function(e){var t=this.get("path");if(!t){var s=o.syncFetch(this,e);!s.path&&s.accessDenied&&(this.get("allowedActions").needFetch=!1,this.get("allowedActions").folderPreview=!0),t=s.path,this.set("path",s.path,{silent:!0}),s.itemInfo&&(this.get("searchResult")&&(s.itemInfo.allowedActions.folderDelete=!1),this.set(s.itemInfo,{silent:!0}))}return t},getItemCounts:function(){return(t.isUndefined(this.get("childFoldersCount"))||t.isUndefined(this.get("childFilesCount")))&&(this.fetch({async:!1,silent:!0}),this.attributes.allowedActions&&(this.get("searchResult")&&(this.attributes.allowedActions.folderDelete=!1),this.set(this.attributes.allowedActions,{silent:!0}))),{childFoldersCount:this.get("childFoldersCount"),childFilesCount:this.get("childFilesCount")}},getMaxLinkRole:function(){return this.has("maxLinkRole")||s.setFolderOptions(this),this.get("maxLinkRole")},updateMetadata:function(){var o=s.formatServiceUrl("GET_METADATA");o+="&items="+this.get("selectedItemsIds"),o+="&isAbsolute=false";var r=this;e.ajax(o,{type:"GET",async:!1,success:function(e,s,o){var n=t.isEmpty(r.get("targetID"))?r.get("id"):r.get("targetID"),a=i.parse_item_GET_METADATA(e,n);r.set({metadata:a},{silent:!0}),r.tags=docs.common.Jsonify.parse_item_METADATA_TAGS(e,r.get("selectedItemList")),r.set({tags:r.tags},{silent:!0}),r.trigger("change:metadata")}})}}),docs.models.FolderItem})),define("common/members/CurrentMembersCollection",["jquery","underscore","backbone","core/osnGlobals","core/model/MemberModel"],(function(e,t,s){"use strict";return osn.models.CurrentMembersCollection=s.Collection.extend({initialize:function(e,t){this.options={},osn.debug("model","CurrentMembersCollection: initializing"),this.currentMembersReq=osn.models[t.modelType][t.currentMembersRequestFn](t.id,this.pageSize),this.currentMemberIdsReq=osn.models[t.modelType][t.currentMemberIdsRequestFn](t.id,1e3),this.convId=t.id,this.options.meFirst=t.meFirst,this.completeMemberIds=[]},model:osn.models.MemberModel,pageSize:20,comparator:function(e,t){if(this.options.meFirst){if(e.isMe)return-1;if(t.isMe)return 1}return 0===e.get("_class").indexOf("XUser")&&t.get("_class").indexOf("XUser")<0?-1:0===t.get("_class").indexOf("XUser")&&e.get("_class").indexOf("XUser")<0||(e.get("DisplayName")?e.escape("DisplayName").toLocaleLowerCase():"")>(t.get("DisplayName")?t.escape("DisplayName").toLocaleLowerCase():"")?1:-1},buildCompleteDirectMembersIds:function(s){return this.$buildMemberIdsDfd&&"resolved"!==this.$buildMemberIdsDfd.state()||(osn.debug("model","CurrentMembersCollection: buildCompleteDirectMembersIds ["+this.convId+"]"),this.$buildMemberIdsDfd=e.Deferred(),this.convId&&(t.isEmpty(this.completeMemberIds)||s)?t.isEmpty(this.currentMemberIdsReq)?(this.completeMemberIds=t.pluck(this.models,"id"),this.$buildMemberIdsDfd.resolve(this.completeMemberIds)):this.fetchCompleteDirectMembersIds(0):this.$buildMemberIdsDfd.resolve(this.completeMemberIds)),this.$buildMemberIdsDfd.promise()},fetchCompleteDirectMembersIds:function(e){var s=this.currentMemberIdsReq.args[2];osn.debug("model","CurrentMembersCollection: fetchCompleteDirectMembersIds ["+this.convId+"] with startndex="+e),0===e&&(this.completeMemberIds=[]),this.currentMemberIdsReq.args[1]=e,osn.fc.sendRequest(this.currentMemberIdsReq.module,this.currentMemberIdsReq.request,this.currentMemberIdsReq.args,{ignoreErrorCodes:["waggle.exceptions.AccessDeniedException"]}).done(t.bind((function(i){var o=i[0].returnValue;this.completeMemberIds=t.union(this.completeMemberIds,o),o.length===s&&e<1e4?(e+=s,this.fetchCompleteDirectMembersIds(e)):(this.$buildMemberIdsDfd.resolve(this.completeMemberIds),osn.debug("model","CurrentMembersCollection: fetchCompleteDirectMembersIds ["+this.convId+"] resolved with final total = "+this.completeMemberIds.length))}),this))},build:function(){var e,s=this;return this.isLoading=!0,osn.fc.sendRequest(this.currentMembersReq.module,this.currentMembersReq.request,this.currentMembersReq.args,{ignoreErrorCodes:["waggle.exceptions.AccessDeniedException"]}).done((function(i){var o="add";e=t.map(i[0].returnValue,(function(e){return(e=e.MemberInfo||e).IsExternalUser=!!e.IsExternalUser,e})),s.trigger("updateMembers",e),s.hasMore||(o="reset"),osn.models.MembersCollection.fetchScaledProfilePics(e),s[o](e),s.hasMore=i[0].returnValue.length>=s.pageSize,"XConversationMembersFilterInfo"===s.currentMembersReq.args[0]._class?s.currentMembersReq.args[0].FirstResult+=s.pageSize:s.currentMembersReq.args[1]+=s.pageSize,s.isLoading=!1}))},clean:function(){osn.debug("model","CurrentMembersCollection: cleaning"),this.completeMemberIds&&(this.completeMemberIds=[]),this.invoke("clean")}}),osn.models.CurrentMembersCollection})),define("common/member/MemberShuttleModel",["jquery","underscore","core/osnGlobals","core/model/BaseModel","core/authz","core/util/FeatureFlags","core/model/MemberModel","common/members/CurrentMembersCollection"],(function(e,t,s,i,o,r){"use strict";return osn.models.MemberShuttleModel=osn.models.BaseModel.extend({initialize:function(e){this.options=e||{},this.isGroup="GroupWallModel"===this.options.modelType,this.isConversation="ConversationModel"===this.options.modelType,t.defaults(this.options,{changeCurrentMembersFn:"changeMembers",currentMembersRequestFn:"getCurrentMembersRequest",currentMemberIdsRequestFn:"getCurrentMemberIdsRequest"}),this.changeMembersCall=osn.models[this.options.modelType][this.options.changeCurrentMembersFn],this.options.allowTypeAheadForExternalUsers=osn.authz.can("externalUsersTypeAheadEnabledForItem","All",this),this.buildCurrentMembersCollection(),this.ignoreMembers=[this.id]},buildCurrentMembersCollection:function(){var s=this,i=osn.cache.get("XUserInfo",osn.cache.get("me").id);return this.currentMembersDfd?this.currentMembersDfd:(this.currentMembers=t.extend(new osn.models.CurrentMembersCollection([],this.options),e.Deferred()),this.id?(this.currentMembers.buildCompleteDirectMembersIds(),this.currentMembersDfd=this.currentMembers.build().done((function(){s.originalMemberIds=s.currentMembers.pluck("ID"),s.listenTo(s.currentMembers,"updateMembers",s.updateOriginalMemberIdsList),s.currentMembers.resolve()})),this.currentMembersDfd):(this.currentMembers.add(new osn.models.MemberModel(i,{profilePic:"scaled"})),this.originalMemberIds=[],void this.currentMembers.resolve()))},getManagedModelType:function(){return this.options.modelType},getManagedModelI18nName:function(){return this.options.typeI18nName},isAddingExistingUser:function(e){var s=this.currentMembers.pluck("ID");return e&&t.contains(s,e.get("ID"))},isRemovingSelf:function(){var e=this.getFinalCompleteMemberIds(),s=osn.cache.get("me");return!(t.contains(e,s.id)||t.intersection(e,s.groups).length>0)},getFinalCompleteMemberIds:function(){var e=this.getAddedMemberIds(),s=this.getRemovedMemberIds();return t.union(t.difference(this.currentMembers.completeMemberIds,s),e)},getAddedMemberIds:function(){var e=this.currentMembers.pluck("ID");return t.difference(e,this.originalMemberIds)},getRemovedMemberIds:function(){var e=this.currentMembers.pluck("ID");return t.difference(this.originalMemberIds,e)},getAddedMembers:function(){return t.map(this.getAddedMemberIds(),(function(e){return this.currentMembers.get(e)}),this)},getCurrentMembers:function(){return this.currentMembers.toArray()},addMember:function(e){this.currentMembers.add(e),this.currentMembers.trigger("addMembers",[e])},removeMembersToBeAdded:function(e){var t=this.getAddedMemberIds();this.currentMembers.remove(e||t)},findMembers:function(e,s,i,r,n,a){void 0===n&&this.options&&(n=this.options.allowTypeAheadForExternalUsers),null==i&&(i=!0),null==a&&(a=!1);var l=t.isString(r)?r:"DOCUMENTS";return osn.fc.sendRequest("XMemberModule$Server","findMembers",[{IncludeGroups:o.can("access","Groups")&&i,IncludeUsers:!0,NumResults:s,SearchAllRealms:!1,SearchUserType:l,SearchString:e,ExcludeMembersWithSharingDisabled:!0,ExcludeExternalUsers:!n,ExcludeOCMGroups:a}])},changeMembers:function(){var e=this.changeMembersCall(this.id,this.originalMemberIds,this.currentMembers);return e.done(t.bind((function(){this.updateOriginalMemberIdsList(t.pluck(this.currentMembers.models,"attributes"))}),this)),e},updateOriginalMemberIdsList:function(e){this.originalMemberIds=t.union(t.difference(this.originalMemberIds,this.getRemovedMemberIds()),t.pluck(e,"ID"))},clean:function(){osn.debug("model","MemberShuttleModel: cleaning "+this.id),this.stopListening(),this.currentMembers&&(this.currentMembers.clean(),delete this.currentMembers)}}),osn.models.MemberShuttleModel})),define("common/sites/SitesErrorMap",["jquery","underscore","core/util/SitesGlobals"],(function(e,t,sites){"use strict";var s=function(e,t){return[t.slice(1,t.length).reduce((function(e,t){return e+(e?", ":"")+t.trim().replace(/(\\|SCSTEMPLATE_)/g,"")}),"")]},i=function(e,t){return[t[0],t.slice(1).map((function(e){return e.replace(/\\/,"")})).join(",")]};return sites.common.SitesErrorMap={scsTrashErrorMap:{csScsUnableToDeleteItems:{causes:{csScsUnableToDeleteUsedTheme:{formatString:"CANNOT_DELETE_USED_THEME",argParser:s},csScsUnableToDeleteUsedComponent:{formatString:"CANNOT_DELETE_USED_COMPONENT",argParser:s},csScsUnableToDeleteActiveSiteVariant:{formatString:"CANNOT_DELETE_ACTIVE_SITE"},csAssetsChannelCannotBeDeletedIsPublished:{formatString:"CANNOT_DELETE_SITE_PUBLISHED_ITEMS",args:1},csScsUnableToDeleteUsedEditorComponent:{formatString:"CANNOT_DELETE_USED_FIELD_EDITOR",argParser:s},csScsUnableToDeleteUsedContentFormComponent:{formatString:"CANNOT_DELETE_USED_CONTENT_FORM",argParser:s},csScsUnableToDeleteUsedLayoutComponent:{formatString:"CANNOT_DELETE_USED_CONTENT_LAYOUT",argParser:s}}}},scsCopyErrorMap:{},sitesErrorMap:{csScsSiteNameAlreadyExists:{causes:{csFldPathAlreadyExists:{formatString:"NEW_SITE_DUPLICATE_NAME",args:1}}},csScsSameSiteBeingActivated:{formatString:"ACTIVATE_BY_OTHER_USER"},csScsUnableToCreateSiteWithSameSlugPrefix:{formatString:"NEW_SITE_DUPLICATE_PREFIX",args:2},csScsUnableToActivateSite:{causes:{csCloudItemInsufficientPrivileges:{formatString:"SITE_BRING_ONLINE_NO_PERM"},csScsSiteAlreadyActive:{formatString:"SITE_ALREADY_ACTIVE",args:1},csScsPublicSiteIsNotAllowed:{formatString:"ACTIVATE_SITE_ERROR_SECURITY_MISMATCH"},csScsSiteSecurityNotAllowed:{formatString:"ACTIVATE_SITE_ERROR_SECURITY_MISMATCH"},csScsMLSValidationErrorNoLocalizationPolicy:{formatString:"MLS_VALIDATION_ERROR_NO_LOCALIZATION_POLICY",args:1},csScsMLSValidationErrorDefaultLangNotARequiredLang:{formatString:"MLS_VALIDATION_ERROR_DEFAULT_LANG_NOT_A_REQUIRED_LANG",args:1},csScsMLSValidationErrorSiteTranslationsNotReturned:{formatString:"MLS_VALIDATION_ERROR_SITE_TRANSLATIONS_NOT_RETURNED",argParser:i},csScsMLSValidationErrorSitePagesNotTranslated:{formatString:"MLS_VALIDATION_ERROR_SITE_PAGES_NOT_TRANSLATED",argParser:i},csSCSSitePublishingFailedRepublishRequired:{causes:{csSCSCreateFolderFailed:{causes:{csFldUnableToCreateFolder:{causes:{csFldCantCreateItemForTrash:{formatString:"PUBLISH_SITE_ERROR_IN_TRASH"}}}}}}}}},csScsUnableToValidateSitePublish:{causes:{csScsMLSValidationErrorNoLocalizationPolicy:{formatString:"MLS_VALIDATION_ERROR_NO_LOCALIZATION_POLICY",args:1},csScsMLSValidationErrorDefaultLangNotARequiredLang:{formatString:"MLS_VALIDATION_ERROR_DEFAULT_LANG_NOT_A_REQUIRED_LANG",args:1},csScsMLSValidationErrorSiteTranslationsNotReturned:{formatString:"MLS_VALIDATION_ERROR_SITE_TRANSLATIONS_NOT_RETURNED",argParser:i},csScsMLSValidationErrorSitePagesNotTranslated:{formatString:"MLS_VALIDATION_ERROR_SITE_PAGES_NOT_TRANSLATED",argParser:i},csScsPublishValidationFailureMissingSourceLanguage:{formatString:"MLS_VALIDATION_FAILURE_MISSING_SOURCE_LANG",args:1}}},csScsUnableToPublishSite:{causes:{csCloudItemInsufficientPrivileges:{formatString:"SITE_PUBLISH_NO_PERM"},csScsPublicSiteIsNotAllowed:{formatString:"PUBLISH_SITE_ERROR_SECURITY_MISMATCH"},csScsSiteSecurityNotAllowed:{formatString:"PUBLISH_SITE_ERROR_SECURITY_MISMATCH"},csScsMLSValidationErrorNoLocalizationPolicy:{formatString:"MLS_VALIDATION_ERROR_NO_LOCALIZATION_POLICY",args:1},csScsMLSValidationErrorDefaultLangNotARequiredLang:{formatString:"MLS_VALIDATION_ERROR_DEFAULT_LANG_NOT_A_REQUIRED_LANG",args:1},csScsMLSValidationErrorSiteTranslationsNotReturned:{formatString:"MLS_VALIDATION_ERROR_SITE_TRANSLATIONS_NOT_RETURNED",argParser:i},csScsMLSValidationErrorSitePagesNotTranslated:{formatString:"MLS_VALIDATION_ERROR_SITE_PAGES_NOT_TRANSLATED",argParser:i},csSCSSitePublishingFailedRepublishRequired:{causes:{csSCSCreateFolderFailed:{causes:{csFldUnableToCreateFolder:{causes:{csFldCantCreateItemForTrash:{formatString:"PUBLISH_SITE_ERROR_IN_TRASH"}}}}},csBlackListedExtension:{formatString:"SITE_PUBLISH_ERROR_BLOCKED_EXTENSION",args:1}}}}},csScsUnableToUnpublishSite:{causes:{csCloudItemInsufficientPrivileges:{formatString:"SITE_UNPUBLISH_NO_PERM"}}},csScsUnableToCommitUpdate:{causes:{csCloudItemInsufficientPrivileges:{formatString:"SITE_UNPUBLISH_NO_PERM"}}},csScsUnableToDeactivateSite:{causes:{csCloudItemInsufficientPrivileges:{formatString:"SITE_TAKE_OFFLINE_NO_PERM"}}},csFldUnableToCopyItems:{causes:{csFldPathAlreadyExists:{formatString:"NEW_SITE_DUPLICATE_NAME",args:1},csFldFailOperationExists:{formatString:"NEW_SITE_DUPLICATE_NAME",args:1}}},csSCSAddControllerToSiteFailed:{causes:{csUnabletoValidateCheckInFile:{formatString:"SITE_CREATE_SCAN_ERROR"}}},csScsUnableToGetStructure:{causes:{csCloudItemInsufficientPrivileges:{formatString:"INSUFFICIENT_SITE_ACCESS_ERROR"},csSecurityValidationFailed:{causes:{csFldDoesNotExist:{formatString:"NO_SITE_DETAILS_AVAILABLE_ERROR"}}}}},csScsUnableToGetSiteInfoFile:{causes:{csCloudItemInsufficientPrivileges:{formatString:"SITE_INSUFFICIENT_PRIVILEGE",args:2},csSecurityValidationFailed:{causes:{csFldDoesNotExist:{formatString:"SITE_NOT_AVAILABLE_ERROR",argParser:function(e,t){return t[0]?[t[0].replace("/Sites/","")]:t}}}}}}},sitesRenameErrorMap:{csFldPathAlreadyExists:{formatString:"RENAME_SITE_DUPLICATE_NAME",args:1}},sitesPublishErrorMap:{wwScsUnableToPublishFile:{causes:{csBlackListedExtension:{formatString:"SITE_PUBLISH_ERROR_BLOCKED_EXT",argParser:function(e){var t=e.get("jobMessageKey").split("!")[1].split(",")[1];return[e.get("siteName"),t]}}}},wwScsTaskFailedMessage:{causes:{csScsUnableToPublishSiteWithCaaSPublishError:{causes:{csScsCaaSPublishValidationFailed:{formatString:"SITE_PUBLISH_ERROR_VALIDATION_FAILED_TASK",argParser:function(e){return[e.get("jobMessageKey").split("!")[1].split(",")[1]]}},csScsCaaSLocalizationPolicyValidationFailed:{formatString:"SITE_PUBLISH_ERROR_LP_VALIDATION_FAILED_TASK",argParser:function(e){return[e.get("jobMessageKey").split("!")[1].split(",")[1],e.get("jobMessageKey").split("!")[3].split(",")[1]]}},csScsCaaSPublishAndLocalizationPolicyValidationFailed:{formatString:"SITE_PUBLISH_ERROR_PUB_LP_VALIDATION_FAILED_TASK",argParser:function(e){return[e.get("jobMessageKey").split("!")[1].split(",")[1],e.get("jobMessageKey").split("!")[3].split(",")[1]]}}}}}}},themesErrorMap:{csFldPathAlreadyExists:{formatString:"NEW_THEME_DUPLICATE_NAME",args:1},csFldUnableToCreateFolder:{causes:{csFldPathAlreadyExists:{formatString:"NEW_THEME_DUPLICATE_NAME",args:1}}},csScsSameThemeBeingActivated:{formatString:"THEME_ALREADY_BEING_PUBLISHED",args:1},csFldUnableToCopyItems:{causes:{csFldPathAlreadyExists:{formatString:"NEW_THEME_DUPLICATE_NAME",args:1}}},csUnableToDownloadFile:{causes:{csCloudItemInsufficientPrivileges:{formatString:"THEME_COMPONENTS_ERROR_NO_ACCESS"}}}},templatesErrorMap:{csScsTemplateNameAlreadyExists:{causes:{csFldPathAlreadyExists:{formatString:"NEW_TEMPLATE_DUPLICATE_NAME",args:1}}},csFldUnableToCopyItems:{causes:{csFldPathAlreadyExists:{formatString:"NEW_TEMPLATE_DUPLICATE_NAME",args:1}}},csScsUnableToExportTemplatePackage:{causes:{csSecurityValidationFailed:{causes:{csFldDoesNotExist:{formatString:"EXPORT_TEMPLATE_ERROR_INVALID_FOLDER",args:0,responseArgs:["LocalData.templateName","LocalData.folderName"]}}},csScsInvalidTemplate:{formatString:"EXPORT_TEMPLATE_ERROR_INVALID_TEMPLATE",args:0,responseArgs:["LocalData.templateName","LocalData.folderName"]},csFldItemInTrash:{formatString:"EXPORT_TEMPLATE_ERROR_FOLDER_IN_TRASH",args:0,responseArgs:["LocalData.templateName","LocalData.folderName"]}}},csScsUnableToImportTemplatePackage:{causes:{csSCSInvalidParam:{formatString:"IMPORT_TEMPLATE_FAILED_INVALID",args:2}}},csScsNameInvalidChars:{formatString:"NEW_TEMPLATE_INVALID_CHARS_WARNING"},csScsNameEmpty:{formatString:"TEMPLATE_NAME_EMPTY"},csScsShortDescOverLimit:{formatString:"TEMPLATE_SHORT_DESC_OVER_LIMIT"},csScsLongDescOverLimit:{formatString:"TEMPLATE_LONG_DESC_OVER_LIMIT"},csScsUnableToCopySiteWithEnterpriseAssets:{formatString:"TEMPLATE_COPY_ERROR_DAM",args:1},csFldUnableToEditFolder:{causes:{csFldItemInTrash:{formatString:"TEMPLATE_SAVE_ERROR_ITEM_IN_TRASH"},csFldIsNotADocument:{formatString:"TEMPLATE_SAVE_ERROR_BEING_SAVED"}}},csScsUnableToCopySiteWithContentExportError:{args:1,causes:{csCaaSContentTemplateExportJobRequestFailed:{causes:{csCaaSContentTemplateExportErrorUsedItemUntargetedToChannel:{formatString:"TEMPLATE_FROM_SITE_CONTENT_EXPORT_ITEMS_UNTARGETED"},csCaaSContentTemplateExportErrorUsedItemUnpublishedToChannel:{formatString:"TEMPLATE_FROM_SITE_CONTENT_EXPORT_ITEMS_UNPUBLISHED"}}}}}},templateRenameMap:{csFldPathAlreadyExists:{formatString:"TEMPLATE_NAME_UNIQUE",args:1},csSCSSiteRestrictedWithThatName:{formatString:"TEMPLATE_NAME_RESTRICT",args:1},csUnableToCheckIn:{causes:{csFldItemInTrash:{formatString:"TEMPLATE_SAVE_ERROR_ITEM_IN_TRASH"}}},csPathSegmentContainsIllegalCharacter:{formatString:"TEMPLATE_NAME_RESTRICT",args:1},csFldIsNotADocument:{formatString:"TEMPLATE_SAVE_ERROR_BEING_SAVED"}},templateLogoPreviewImageMap:{csFldUnableToDeleteItems:{formatString:"TEMPLATE_LOGO_IMAGE_DELETE_ERROR_HINT"},csScsUnableToAddLogoScreenshot:{formatString:"TEMPLATE_ADD_SCREENSHOT_INVALID_FILE"}},templatesInstallErrorMap:{csScsUnableToImportTemplatePackage:{causes:{csScsImportError:{causes:{csScsImportErrorOverwriteNoAccess:{formatString:"IMPORT_TEMPLATE_OVERWRITE_NO_ACCESS",args:4},csScsImportErrorOverwriteInTrash:{formatString:"IMPORT_TEMPLATE_OVERWRITE_IN_TRASH",args:2}}},csScsOOTBTemplatesBeingInstalled:{formatString:"IMPORT_OOTB_TEMPLATES_SIMULTANEOUS_ERROR",args:1}}},defaultMsg:{formatString:"SITES_CONFIG_DEFAULT_ERROR",args:0}},appsErrorMap:{csFldPathAlreadyExists:{formatString:"NEW_APP_DUPLICATE_NAME",args:1},csScsUnableToCreateComp:{causes:{csFldUnableToCreateFolder:{causes:{csFldPathAlreadyExists:{formatString:"NEW_APP_DUPLICATE_NAME",args:1},csFldFailOperationExists:{formatString:"NEW_APP_DUPLICATE_NAME",args:1}}},csScsAdminRoleRequired:{formatString:"NEW_APP_ADMIN_ROLE_REQUIRED",args:1}}},csScsUnableToCreateEmptyApp:{causes:{csFldUnableToCreateFolder:{causes:{csFldPathAlreadyExists:{formatString:"NEW_APP_DUPLICATE_NAME",args:1}}}}},csScsSameComponentBeingActivated:{formatString:"APP_ALREADY_BEING_PUBLISHED",args:1},csScsUnableToImportComp:{causes:{csScsInvalidComponentZipFile:{formatString:"IMPORT_APP_INVALID_ZIP",args:1},csScsInvalidZipFile:{formatString:"IMPORT_APP_INVALID_ZIP",args:1}}},csFldUnableToCopyItems:{causes:{csFldPathAlreadyExists:{formatString:"COPY_APP_DUPLICATE_NAME",args:1}}}},updatesErrorMap:{csFldUnableToCreateFolder:{causes:{csFldPathAlreadyExists:{formatString:"NEW_UPDATE_DUPLICATE_NAME",args:1}}}},translationJobErrorMap:{csScsMissingImportJobValidImportFile:{formatString:"MISSING_IMPORT_JOB_VALID_IMPORT_FILE",args:1},csScsUnableToConvertJsonToString:{formatString:"UNABLE_TO_CONVERT_JSON_TO_STRING",args:0},csScsJsonGenerationError:{formatString:"JSON_GENERATION_ERROR",args:0},csScsJsonMappingError:{formatString:"JSON_MAPPING_ERROR",args:0},csScsIOError:{formatString:"IO_ERROR",args:1},csScsMissingImportJobInvalidImportFile:{formatString:"MISSING_IMPORT_JOB_INVALID_IMPORT_FILE",args:1},csScsErrorUpdatingTranslationJob:{formatString:"ERROR_UPDATING_TRANSLATION_JOB",args:0},csScsErrorCreatingTranslationJob:{formatString:"ERROR_CREATING_TRANSLATION_JOB",args:0},csScsErrorDeletingTranslationJob:{formatString:"ERROR_DELETING_TRANSLATION_JOB",args:0},csScsTranslationJobDoesntExist:{formatString:"TRANSLATION_JOB_DOESNT_EXIST",args:1},csScsTranslationJobDoesNotExist:{formatString:"TRANSLATION_JOB_DOES_NOT_EXIST",args:0},csScsTranslationJobAlreadyExists:{formatString:"TRANSLATION_JOB_ALREADY_EXISTS",args:1},csScsUnableToResubmitTranslationJob:{causes:{csScsTranslationJobDoesntExist:{formatString:"TRANSLATION_JOB_DOESNT_EXIST",args:1}}},csScsUnableToExportTranslationJobsAssetsFailed:{formatString:"UNABLE_TO_EXPORT_TRANSLATION_JOBS_ASSETS_FAILED",args:0},csScsUnableToGetTranslationJobsMissingDefaultLang:{formatString:"UNABLE_TO_GET_TRANSLATION_JOBS_MISSING_DEFAULT_LANG",args:0},csScsUnableToGetTranslationJobsNoAccess:{formatString:"UNABLE_TO_GET_TRANSLATION_JOBS_NO_ACCESS",args:0},csScsUnableToGetTranslationJobsNotEnterprise:{formatString:"UNABLE_TO_GET_TRANSLATION_JOBS_NOT_ENTERPRISE",args:0},csScsUnableToImportTranslationJobsMissingDefaultLang:{formatString:"UNABLE_TO_IMPORT_TRANSLATION_JOBS_MISSING_DEFAULT_LANG",args:0},csScsUnableToImportMissingJobFile:{formatString:"UNABLE_TO_IMPORT_MISSING_JOB_FILE",args:0},csScsUnableToGetTranslationJobInfoNoAccess:{formatString:"UNABLE_TO_GET_TRANSLATION_JOB_INFO_NO_ACCESS",args:0},csScsTranslationJobCannotUpdateInvalidStatusChange:{formatString:"TRANSLATION_JOB_CANNOT_UPDATE_INVALID_STATUS_CHANGE",args:3},csScsTranslationJobCannotDeleteInProgress:{formatString:"TRANSLATION_JOB_CANNOT_DELETE_IN_PROGRESS",args:1},csScsInvalidParam:{formatString:"INVALID_PARAM",args:2},csScsInvaildJobType:{formatString:"INVALID_JOB_TYPE",args:1},csScsInvaildValidationMode:{formatString:"INVALID_VALIDATION_MODE",args:1},csRequiredServiceParameterMissing:{formatString:"REQUIRED_SERVICE_PARAMETER_MISSING",args:2},csScsUnableToImportSiteTranslationNoAccessSite:{formatString:"UNABLE_TO_IMPORT_SITE_TRANSLATION_NO_ACCESS_SITE",args:0},csScsUnableToImportSiteTranslationNoAccessRepo:{formatString:"UNABLE_TO_IMPORT_SITE_TRANSLATION_NO_ACCESS_REPO",args:0},csSCSUnableToImportSiteTranslationSiteDoesNotExist:{formatString:"UNABLE_TO_IMPORT_SITE_TRANSLATION_SITE_DOES_NOT_EXIST",args:1},csSCSUnableToImportSiteTranslationRepoDoesNotExist:{formatString:"UNABLE_TO_IMPORT_SITE_TRANSLATION_REPO_DOES_NOT_EXIST",args:1},csSCSUnableToImportSiteTranslationSiteInTrash:{formatString:"UNABLE_TO_IMPORT_SITE_TRANSLATION_SITE_IN_TRASH",args:0},csCaaSTranslationJobImportJobRequestFailed:{causes:{csCaaSTranslationJobImportJobFailToValidateContentType:{formatString:"TRANSLATION_JOB_IMPORT_JOB_FAIL_TO_VALIDATE_CONTENT_TYPE",argParser:function(e,t){return[t.map((function(e){return e.replace(/\\$/,"")})).join(",")]}}}}}},sites.common.SitesErrorMap})),define("docs/folderview/model/Folder",["jquery","underscore","core/util/Service","core/util/Jsonify","core/router/DocsController","core/util/Globals","core/util/Logger","core/view/MessageBar","common/container/model/Container","common/docs/folderview/model/FileItem","common/docs/folderview/model/FolderItem","common/share/model/Collaborators","core/embedapi/EmbedApi"],(function(e,t,s,i,o,docs,r,n,a,l,c,d,u){"use strict";var m=docs.common.Globals;return docs.container.Config.itemModels.folder=docs.models.FolderItem,docs.container.Config.itemModels.file=docs.models.FileItem,docs.models.Folder=a.extend({sideboards:m.isAppLink?["properties"]:["conversation","metadata","aif","properties"],sortParams:{sort_updated:"&combinedSortField=fLastModifiedDate&combinedSortOrder=Desc",sort_deleted:"&combinedSortField=fLastModifiedDate&combinedSortOrder=Desc",sort_nameasc:"&combinedSortField=fItemName&combinedSortOrder=Asc",sort_namedsc:"&combinedSortField=fItemName&combinedSortOrder=Desc"},initialize:function(e,t){a.prototype.initialize.call(this,e,t),this.listenTo(docs.events,"file:uploaded",this._handleUploadMessage),this.listenTo(docs.events,"folder:leave",this._handleLeaveShare)},close:function(){this.stopListening()},url:function(){var e=s.formatServiceUrl("FLD_BROWSE");e+="&item="+this.itemId(),e+="&doCombinedBrowse=1&combinedCount="+this.items.pagerData.virtualPageSize,e+="&combinedStartRow="+this.items.pagerData.pageStartRow;var t=this.get("sortOrder");return e+=this.sortParams[t],"Folder"!==this.options.itemType&&"File"!==this.options.itemType||(e+="&itemType="+this.options.itemType),e},itemId:function(){return"fFolderGUID:"+this.id},targetId:function(){return this.itemId()},conversationReferenceId:function(){return this.itemId()},parse:function(e){return e.LocalData&&"FLD_EDIT_FOLDER"===e.LocalData.IdcService?i.parse_FLD_INFO_FOLDER(e):a.prototype.parse.call(this,e)},parseModel:function(e){var t;return e.ResultSets.FolderInfo?t=i.parse_FLD_BROWSE_FOLDER(e):this.trigger("folder:loaderror",this,e),t},parseItems:function(e){return i.parse_FLD_BROWSE_ITEMS(e)},itemAdding:function(e){if("folder"===e.get("type")){var t=!this.isHome&&this.get("flags").isShared,s=this.get("parentShared");e.set("parentShared",t||s,{silent:!0})}},isFolder:!0,getThumbnailUrl:function(e){var t;return t=this.isOwned()?this.isSharedByYou()?"sharedbyyou-folder":"private-folder":"sharedtoyou-folder",m.staticRoot+"images/"+t+(e?"_120.png":".png")},getLinkUrl:function(){var e=this.get("mode");return(!e||e&&e.length<1)&&(e="folder"),s.getLinkUrl(e,this.get("id"))},getPublicLinkUrl:function(e){var t=i.parse_GET_SHARED_LINKS_FOR_OBJECT(e);return!!t.flags.isShared&&t},getItemCounts:function(){return{childFoldersCount:this.get("childFoldersCount"),childFilesCount:this.get("childFilesCount")}},getMaxLinkRole:function(){return this.has("maxLinkRole")||s.setFolderOptions(this),this.get("maxLinkRole")},createFolder:function(e,t){return this.create(e,t,"folder")},create:function(e,t,i){var o=s.getServiceParamsForPost("FLD_CREATE_FOLDER");o.data.fFolderName=e,o.data.fFolderDescription=t||"",o.data.parent="fFolderGUID:"+this.id;var r=this,a={url:o.url,wait:!0,data:o.data,ignoreSync:!0,success:function(e,t){"0"===t.LocalData.StatusCode&&(s.adjustFolderChildCount(r,1,!0),new n({messageText:docs.i18n.t("CREATE_FOLDER_SUCCESS",m.routerRoot+"folder/"+t.LocalData.fFolderGUID,s.breakWords(t.LocalData.fFolderName)),messageType:"success",disableScriptProtection:!0}))}};this.items.create({name:e,type:i,parentid:this.id,childCount:0},a)},_handleUploadMessage:function(e){if(docs.common.Logger("Folder").debug(this.cid,"got a file:uploaded message",e),e instanceof l)this.id===e.get("parentID")&&"1"===e.get("revision")&&(docs.common.Logger("Folder").debug("adding item"),this.items.add(e),s.adjustFolderChildCount(this,1,!1));else{if(this.id===e.parentID||this.items.where({id:e.id})[0])"1"===e.revision?(docs.common.Logger("Folder").debug("adding item"),this.items.add(e),s.adjustFolderChildCount(this,1,!1)):(docs.common.Logger("Folder").debug("updating item"),e.latestRevision=e.revision,this.items.update(e));else{var i=this.items.where({id:e.parentID})[0];i&&i.isFolder&&"1"===e.revision&&s.adjustFolderChildCount(i,1,!1)}var o;if(m.embed&&u.events.itemUploaded&&t.isFunction(u.events.itemUploaded))this.id===e.parentID?(e.folderItem=this.items.get(e.id)||new l(t.extend(e,{allowedActions:{needFetch:!0}})),o=this):(e.folderItem=new l(t.extend(e,{allowedActions:{needFetch:!0}})),o=this.items.get(e.parentID)||this),u.events.itemUploaded(e,o)}},_handleLeaveShare:function(e){this.id===e?docs.router.navigate("folder/home",{trigger:!0,replace:!0}):this.items.get(e)&&(this.items.remove(e),docs.events.trigger("containerItem:refreshSelection",{}))},updateItem:function(e,t,i){var o=this.get("name"),r=this.get("description"),n=this.get("publicLinkRole"),a=this.id;if(e!==o||t!==r||i!==n){var l=s.getServiceParamsForPost("FLD_EDIT_FOLDER");l.data.fFolderName=e,l.data.fFolderDescription=t,l.data.fDefaultLinkRole=i,l.data.item="fFolderGUID:"+this.get("id");var c={wait:!0,data:l.data,url:l.url,error:function(e,t){e.set({name:o,description:r,publicLinkRole:n}),e.trigger("change")},success:function(e){var t="folder/"+a;docs.router.navigate(t,{trigger:!0,replace:!0})}};this.save({name:e,description:t,publicLinkRole:i},c)}},defaultConversationName:function(){return this.get("name")},get:function(e){return"metadata"!==e||a.prototype.get.call(this,e)||this.getMetadata(),a.prototype.get.call(this,e)},getCollaborators:function(){var e;return this.collaborators?e=this.collaborators:(e=new d([],{folder:this,parentFolder:this.get("container")})).fetch(),e},getMetadata:function(){var t=s.formatServiceUrl("GET_METADATA");t+="&items="+this.itemId(),t+="&isAbsolute=false",e.ajax(t,{type:"GET",async:!1,context:this,success:function(e){var t=i.parse_item_GET_METADATA(e,this.get("id"));this.set({metadata:t},{silent:!0})}})},updateMetadata:function(){var t=s.formatServiceUrl("GET_METADATA");t+="&items="+this.itemId(),t+="&isAbsolute=false",e.ajax(t,{type:"GET",async:!1,context:this,success:function(e){var t=i.parse_item_GET_METADATA(e,this.get("id"));this.set({metadata:t},{silent:!0}),this.trigger("change:metadata")}})}}),docs.models.Folder})),define("common/notification/model/Progressable",["jquery","underscore","backbone","core/util/Logger"],(function(e,t,s){"use strict";return docs.models.Progressable=s.Model.extend({className:"Progressable",defaults:{percentComplete:0,maxPctDisplayed:100,speed:0,timeLeft:1,bytesLoaded:0,previousBytesLoaded:0,previousTime:0,totalBytes:0},isFinished:function(){return 100===this.get("percentComplete")},initialize:function(e){e||(e={}),this.logger=e.logger||this.className},classLogId:function(){return"["+this.className+":"+this.cid+"]"},transferSpeed:function(){return this.get("speed")},timeRemaining:function(){return this.get("timeLeft")},bytesLoaded:function(){var e=this.get("bytesLoaded");return void 0!==e?e:0},setBytesLoaded:function(e){this.set("bytesLoaded",e)},totalBytes:function(){return this.get("totalBytes")||0},updateTransferData:function(e,t){var s=this.get("bytesLoaded"),i=this.get("previousBytesLoaded"),o=e-this.get("previousTime"),r=this.get("totalBytes"),n=this._computeSpeedData(s,i,r,o);if(0!==n.bps){var a=void 0===this.get("percentComplete")||this.get("percentComplete")<100?Math.floor(100*s/r):100;t&&(a=Math.min(t,a)),this.set({previousBytesLoaded:s,previousTime:e,speed:n.bps,timeLeft:n.time<1e3?1e3:n.time,percentComplete:a,maxPctDisplayed:t||100})}},_computeSpeedData:function(e,t,s,i){this.debug("_computeSpeedData","current=",e,"previous=",t,"total=",s,"interval=",i);var o=e-t;if(0!==o){o=Math.abs(Math.floor(o*(1e3/i)));var r=s-e;return this.debug("bps=",o,"time=",Math.floor(r/o)),{bps:o,time:Math.floor(r/o)}}return this.debug("bps=",0,"time=",0),{bps:0,time:0}},startTimer:function(){if(!this.has("previousTime")||0===this.get("previousTime")){var e=(new Date).getTime();this.set({startTime:e,previousTime:e,previousBytesLoaded:0},{silent:!0})}},endTimer:function(){var e=(new Date).getTime();this.set({endTime:e},{silent:!0})},timerSnapshot:function(e){var t=(new Date).getTime(),s={};s[e]=t,this.set(s,{silent:!0})},debug:function(){var e=[];e[0]=this.classLogId(),docs.common.Logger(this.logger).debug.apply(void 0,e.concat([].slice.apply(arguments)))},error:function(){var e=[];e[0]=this.classLogId(),docs.common.Logger(this.logger).error.apply(void 0,e.concat([].slice.apply(arguments)))},warn:function(){var e=[];e[0]=this.classLogId(),docs.common.Logger(this.logger).warn.apply(void 0,e.concat([].slice.apply(arguments)))},info:function(){var e=[];e[0]=this.classLogId(),docs.common.Logger(this.logger).info.apply(void 0,e.concat([].slice.apply(arguments)))},trace:function(){var e=[];e[0]=this.classLogId(),docs.common.Logger(this.logger).trace.apply(void 0,e.concat([].slice.apply(arguments)))}}),docs.models.Progressable})),define("common/notification/model/TimeredProgressable",["jquery","underscore","common/notification/model/Progressable"],(function(e,t){"use strict";return docs.models.TimeredProgressable=docs.models.Progressable.extend({defaults:{itemCount:0,percentComplete:0,actionStatusList:[],errorList:[]},initialize:function(e){docs.models.Progressable.prototype.initialize.call(this,e)},isFinished:function(){return 100===this.get("percentComplete")},timerInterval:500,incrementPercentComplete:function(){var e=this.get("percentComplete");(e+=10-Math.floor(e/10))>95&&(e=95),this.set("percentComplete",e)},startProgressTimer:function(){var e=this;this.progressTimer=window.setInterval((function(){e.incrementPercentComplete()}),this.timerInterval)},stopProgressTimer:function(e,t){window.clearInterval(this.progressTimer),this.progressTimer=void 0;var s=this.get("minPercent");if(s&&s>=this.get("percentComplete",100)){var i=this;this.progressTimer=window.setInterval((function(){i.incrementPercentComplete(),i.stopProgressTimer(e,t)}),this.timerInterval)}else this.set("failed",e,{silent:!0}),this.set("percentComplete",100),e?this.trigger("progressableFailed",this.get("action"),this):this.trigger("progressableComplete",this.get("action"),this),t&&t.call(this)},hideProgressBar:function(){this.trigger("hideProgressBar",this.get("action"),this)},showProgressBar:function(){this.trigger("showProgressBar",this.get("action"),this)}}),docs.models.TimeredProgressable})),define("docs/notification/model/BackgroundJobProgressable",["jquery","underscore","core/util/Service","common/notification/model/TimeredProgressable","core/util/SitesJsonify"],(function(e,t,s,i,o){"use strict";var r=i.extend({defaults:{IdcService:"SCS_GET_JOB_STATUS",timerInterval:2e3,pollAtStart:!1,percentComplete:0},initialize:function(e,s){t.bindAll(this,"progressPolling"),i.prototype.initialize.call(this,s),this.get("pollAtStart")&&this.once("change:jobID",this.progressPolling)},url:function(){var e=s.formatServiceUrl(this.get("IdcService"));return e+="&JobID="+this.get("jobID")},parse:function(e,t){return o.parse_SCS_GET_JOB_STATUS(e)[0]},isFinished:function(){return t.contains(["COMPLETE","FAILED","CANCELLED"],this.get("jobStatus"))},progressPolling:function(){this.has("jobID")&&this.fetch({success:this.checkDone,error:this.syncFailure})},startProgressTimer:function(){this.progressTimer=window.setInterval(this.progressPolling,this.get("timerInterval"))},checkDone:function(e){"COMPLETE"===e.get("jobStatus")?e.stopProgressTimer(!1):t.contains(["FAILED","CANCELLED"],e.get("jobStatus"))&&e.stopProgressTimer(!0)},syncFailure:function(e,t){t.errorThrown&&e.set("queryError",t.errorThrown),e.stopProgressTimer(!0),t.errorHandled=!0}});return docs.models.BackgroundJobProgressable=r,r})),define("common-models-15b22b9.cache",(function(){}));