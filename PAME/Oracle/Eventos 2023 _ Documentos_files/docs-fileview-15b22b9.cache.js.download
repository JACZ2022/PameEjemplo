define("docs/fileview/model/ImageAnnotation",["jquery","underscore","core/util/Constants","common/fileview/model/Annotation"],(function(e,t,i,o){"use strict";var n=docs.common.Constants.Viewer;return docs.models.ImageAnnotation=o.extend({defaults:{left:0,top:0,width:0,height:0},initialize:function(e,i){if(o.prototype.initialize.call(this,e,i),t.isUndefined(e.type)){var s=docs.models.ImageAnnotation.normalizeFraction(e.width)>n.ANNOT_MIN_WIDTH||docs.models.ImageAnnotation.normalizeFraction(e.height)>n.ANNOT_MIN_HEIGHT?n.AnnotationType.RECTANGLE:n.AnnotationType.PUSHPIN;this.set("type",s)}},parse:function(e){return e.left=docs.models.ImageAnnotation.normalizeFraction(e.left),e.top=docs.models.ImageAnnotation.normalizeFraction(e.top),e.width=docs.models.ImageAnnotation.normalizeFraction(e.width),e.height=docs.models.ImageAnnotation.normalizeFraction(e.height),e},getLeft:function(){return this.get("left")},getTop:function(){return this.get("top")},getWidth:function(){return this.get("width")},getHeight:function(){return this.get("height")},getAnnotationInfoString:function(){var e="";return e+="type:"+this.get("type"),e+=", xoffset:"+this.get("left"),e+=", yoffset:"+this.get("top"),this.get("width")&&(e+=", width:"+this.get("width")),this.get("height")&&(e+=", height:"+this.get("height")),e.replace(/\s/g,"")},getDimensions:function(){return{top:docs.models.ImageAnnotation.normalizeFraction(this.get("top")),left:docs.models.ImageAnnotation.normalizeFraction(this.get("left")),height:docs.models.ImageAnnotation.normalizeFraction(this.get("height")),width:docs.models.ImageAnnotation.normalizeFraction(this.get("width"))}},setDimensions:function(e){var i=!1;if(t.isUndefined(e.width)||e.width===this.getWidth()||(this.set("width",docs.models.ImageAnnotation.normalizeFraction(e.width)),i=!0),t.isUndefined(e.height)||e.height===this.getHeight()||(this.set("height",docs.models.ImageAnnotation.normalizeFraction(e.height)),i=!0),!t.isUndefined(e.left)){var o=docs.models.ImageAnnotation.normalizeFraction(e.left),s=this.getWidth(),a=o+s/2;o-s/2<0?o=s/2:a>1&&(o=1-s/2),o!==this.getLeft()&&(this.set("left",o),i=!0)}if(!t.isUndefined(e.top)){var r=docs.models.ImageAnnotation.normalizeFraction(e.top),d=this.getHeight(),l=r+d/2;r-d/2<0?r=d/2:l>1&&(r=1-d/2),r!==this.getTop()&&(this.set("top",r),i=!0)}var h=this.get("width")>n.ANNOT_MIN_WIDTH||this.get("height")>n.ANNOT_MIN_HEIGHT?n.AnnotationType.RECTANGLE:n.AnnotationType.PUSHPIN;return h!==this.get("type")&&(this.set("type",h),i=!0),i},getPageRectangle:function(e){var t=e.height*(this.get("top")-this.get("height")/2),i=e.width*(this.get("left")-this.get("width")/2),o=t+e.height*this.get("height"),n=i+e.width*this.get("width");return n<1&&(n=1),o<1&&(o=1),{top:t,left:i,bottom:o,right:n}},isResizable:function(){return!this.isCommitted()&&this.get("type")!==n.AnnotationType.PUSHPIN},isDraggable:function(){return!this.isCommitted()}},{normalizeFraction:function(e){return e=t.isNumber(e)?e<0?0:e>1?1:e:0},getDimensionsFromPageRect:function(e,t){var i=e.right-e.left,o=e.bottom-e.top;return{left:(e.left+i/2)/t.width,top:(e.top+o/2)/t.height,width:1*i/t.width,height:1*o/t.height}}}),docs.models.ImageAnnotation})),define("docs/fileview/model/OITAnnotation",["jquery","underscore","core/util/Constants","core/util/Logger","common/fileview/model/Annotation"],(function(e,t,i,o,n){"use strict";var s=o(i.Viewer.OIT_LOGGER);return docs.models.OITAnnotation=n.extend({defaults:{},initialize:function(e,t){t=t||{},this.logPrefix=t.logPrefix+this.cid+":",e.rangeType||(e=this.parse(e),this.set(e)),n.prototype.initialize.call(this,e,t)},parse:function(e){switch(t.isEmpty(e.section)&&(e.section=0),e.type){case docs.models.OITAnnotation.TYPE_OIT_PIN:e.rangeType="rect",e.right=e.left,e.bottom=e.top,e.units="tw";break;case docs.models.OITAnnotation.TYPE_OIT_RECT:e.rangeType="rect",e.units="tw";break;case docs.models.OITAnnotation.TYPE_OIT_CELL:e.rangeType="cell"}return e},getAnnotationInfoString:function(){var e="type:"+this.get("type");switch(e+=", section:"+this.get("section"),this.get("type")){case docs.models.OITAnnotation.TYPE_OIT_RECT:e+=", left:"+this.get("left"),e+=", top:"+this.get("top"),e+=", right:"+this.get("right"),e+=", bottom:"+this.get("bottom");break;case docs.models.OITAnnotation.TYPE_OIT_PIN:e+=", left:"+this.get("left"),e+=", top:"+this.get("top");break;case docs.models.OITAnnotation.TYPE_OIT_CELL:e+=", c1:"+this.get("c1"),e+=", r1:"+this.get("r1"),e+=", c2:"+this.get("c2"),e+=", r2:"+this.get("r2")}return e.replace(/\s/g,"")},getDimensions:function(){return s.debug(this._getLogText("getDimensions")),this.getRange()},getDimensionsAsPx:function(){return s.debug(this._getLogText("getDimensionsAsPx")),docs.models.OITAnnotation.convertDimensionsToPixels(this.getRange())},getRange:function(){var e={};switch(this.get("rangeType")){case"rect":e={type:"rect",page:this.get("context")-1,section:this.get("section"),left:this.get("left"),top:this.get("top"),right:this.get("right"),bottom:this.get("bottom"),units:this.get("units")};break;case"cell":e={type:"cell",page:this.get("context")-1,section:this.get("section"),c1:this.get("c1"),r1:this.get("r1"),c2:this.get("c2"),r2:this.get("r2")};break;case"text":e={type:"text",acc:this.get("acc"),accend:this.get("accend")}}return e},setDimensions:function(e){s.debug(this._getLogText("setDimensions"),e);var t=docs.models.OITAnnotation.getDimensionsFromRange(e);return this.set(t),this.hasChanged()},setDimensionsFromParams:function(e){return s.debug(this._getLogText("setDimensions"),e),e=docs.models.OITAnnotation.convertDimensionsToTwips(e),this.get("type")===docs.models.OITAnnotation.TYPE_OIT_PIN&&(e.left&&(e.right=e.left),e.top&&(e.bottom=e.top)),this.set(e),this.hasChanged()},isResizable:function(){return!this.isCommitted()&&this.get("type")!==docs.models.OITAnnotation.TYPE_OIT_PIN},isDraggable:function(){var e=this.get("type");return!this.isCommitted()&&(e===docs.models.OITAnnotation.TYPE_OIT_RECT||e===docs.models.OITAnnotation.TYPE_OIT_PIN)},_getLogText:function(e){return e}},{TYPE_OIT:"oit",TYPE_OIT_CELL:"ocell",TYPE_OIT_RECT:"orect",TYPE_OIT_PIN:"opin",convertPixelsToTwips:function(e,i){return t.isNumber(i)||(i=96),Math.floor(1440*e/i)},convertDimensionsToPixels:function(e,i){return"px"!==e.units&&(t.isNumber(i)||(i=96),(e=docs.models.OITAnnotation.mapObject(e,(function(e,t){switch(t){case"left":case"right":case"top":case"bottom":return Math.floor(e/1440*i);default:return e}}))).units="px"),e},convertDimensionsToTwips:function(e,i){return"tw"!==e.units?(t.isNumber(i)||(i=96),(e=docs.models.OITAnnotation.mapObject(e,(function(e,t){switch(t){case"left":case"right":case"top":case"bottom":return Math.floor(1440*e/i);default:return e}}))).units="tw"):e=docs.models.OITAnnotation.mapObject(e,(function(e,t){switch(t){case"left":case"right":case"top":case"bottom":return Math.floor(e);default:return e}})),e},getDimensionsFromRange:function(e,t){var i={};switch(e.type){case"rect":i=docs.models.OITAnnotation.getDimensionsRect(e,t);break;case"cell":i=docs.models.OITAnnotation.getDimensionsCell(e,t);break;case"text":i=docs.models.OITAnnotation.getDimensionsText(e,t)}return i},getDimensionsRect:function(e,t){var i={rangeType:e.type,context:e.page+1,section:e.section,left:e.left,top:e.top,right:e.right,bottom:e.bottom,units:e.units};return t===docs.models.OITAnnotation.TYPE_OIT&&(e.left===e.right&&e.top===e.bottom?i.type=docs.models.OITAnnotation.TYPE_OIT_PIN:i.type=docs.models.OITAnnotation.TYPE_OIT_RECT),i},getDimensionsCell:function(e,t){var i={rangeType:e.type,context:e.page+1,section:e.section,c1:e.c1,r1:e.r1,c2:e.c2,r2:e.r2};return t===docs.models.OITAnnotation.TYPE_OIT&&(i.type=docs.models.OITAnnotation.TYPE_OIT_CELL),i},getDimensionsText:function(e){return{rangeType:e.type,context:e.page+1,acc:e.acc,accend:e.accend}},mapObject:function(e,i){for(var o,n=t.keys(e),s=n.length,a={},r=0;r<s;r++)a[o=n[r]]=i(e[o],o,e);return a}}),docs.models.OITAnnotation})),define("docs/fileview/model/ContentAnnotation",["common/fileview/model/Annotation"],(function(e){"use strict";return e.extend({getAnnotationInfoString:function(){return"type:"+this.get("type")+",field:"+this.get("field")}})})),define("docs/fileview/model/Annotations",["jquery","underscore","backbone","core/util/Service","core/util/Jsonify","core/util/Globals","core/util/Constants","core/util/Logger","common/fileview/model/Annotation","docs/fileview/model/ImageAnnotation","docs/fileview/model/OITAnnotation","docs/fileview/model/ContentAnnotation"],(function(e,t,i,o,n,docs,s,a,r,d,l,h){"use strict";var c=i.Collection.extend({model:function(e,t){return c.build(e,t)},initialize:function(e,i){t.bindAll(this,"reload","retrieveAnnotation"),this.item=i.item,this.conversationId=i.conversationId,this.handler=i.handler,this.reload()},url:function(){var e=this.item.isAsset?this.item.getAssetType():this.item.get("type"),t=r.getAnnotationService("retrieve",e),i=o.formatServiceUrl(t);return i+=c.getUrlParamItemRevision(this.item),this.conversationId&&(i+="&dConversationID="+this.conversationId),i},parse:function(e){return n.parse_GET_ANNOTATIONS(e)},setConversationId:function(e){this.conversationId||this.isEmpty()?this.conversationId!==e&&(this.conversationId=e,this.reload()):this.conversationId=e},hasConversationId:function(){return!!this.conversationId},retrigger:function(){this.trigger("reset")},reload:function(){if(t.isUndefined(this.item)||t.isUndefined(this.conversationId))this.reset();else{var e=this.item.get("allowedActions");(this.item.isAsset||e&&e.annotationRead)&&this.fetch({reset:!0,error:this._fetchError,item:this.item})}},areAnnotationsDisplayed:function(){var e=!0;return this.handler&&(e=this.handler.areAnnotationsDisplayed()),e},_fetchError:function(e,t){t.errorHandled=!0},retrieveAnnotation:function(i,s){if(!t.isUndefined(i)&&!t.isUndefined(s)&&i===this.conversationId){var d=this.item.isAsset?this.item.getAssetType():this.item.get("type"),l=r.getAnnotationService("retrieve",d),h=o.getServiceParamsForPost(l);this.item.isAsset?(h.data.item="arCaaSGUID:"+this.item.get("id"),this.item.has("version")&&(h.data.arCaaSVersion=this.item.get("version"))):(h.data.item="fFileGUID:"+this.item.get("id"),this.item.has("revision")&&(h.data.dRevisionID=this.item.get("revision"))),h.data.dConversationID=i,h.data.dMessageID=s;var c=this;return e.ajax(h.url,{type:"POST",data:h.data,success:function(e){a("Viewer").debug("Successfully retrieved annotation with chatId: "+s);var i=n.parse_GET_ANNOTATIONS(e);t.each(i,(function(e){c.add(e)}))},error:function(){a("Viewer").error("Failed to retrieve annotation with chatId: "+s)}})}return e.when()},addFromParameters:function(e){var t=c.build(e,{},this);return this.add(t),t}},{fetchA8NUserModels:function(i){var o=e.Deferred(),n=[],s=t.uniq(t.pluck(t.map(i,(function(e){return e.attributes})),"creatorLoginId"));return t.each(s,(function(e){n.push(["XUserModule$Server","getUserByName",[e]])})),n.length&&osn.fc.sendRequest(n).done((function(e){var n=t.pluck(t.pluck(e,"returnValue"),"ID");t.each(i,(function(e){var i=t.indexOf(s,e.get("creatorLoginId")),o=osn.cache.get("XUserInfo",n[i]);e.memberInfo=new osn.models.MemberModel(o,{profilePic:"scaled",needOpaqueAvatar:!0})}),this),o.resolve()})),o.promise()},getModel:function(e){var t;if(e)switch(e){case"oit":case"orect":case"opin":case"ocell":t=l;break;case"contentitem":t=h;break;default:t=d}else t=d;return t},build:function(e,t){return new(c.getModel(e.type))(e,t)},getUrlParamItemRevision:function(e){var t;return e.isAsset?(t="&item=arCaaSGUID:"+e.get("id"),e.has("version")&&(t+="&arCaaSVersion="+e.get("version"))):(t="&item=fFileGUID:"+e.get("id"),e.has("revision")&&(t+="&dRevisionID="+e.get("revision"))),t}});return c})),define("docs/fileview/model/FileViewHandler",["jquery","underscore","backbone","core/cache","core/util/Constants","core/util/FeatureFlags","core/util/Globals","core/util/LinkBackContext","docs/fileview/model/Annotations","common/conversation/AvailableConversationsUtils","common/site/SitesUtils"],(function(e,t,i,o,n,s,docs,a,r,d,l){"use strict";var h=docs.common.Globals;return docs.models.FileViewHandler=i.Model.extend({config:{},minZoom:n.Viewer.MIN_ZOOM,maxZoom:n.Viewer.MAX_ZOOM,zoomStep:n.Viewer.ZOOM_STEP,allowZoomTo100pct:!1,annotationsAllowed:!0,notViewable:!1,annotationMode:!1,showAnnotations:!1,initialize:function(e){t.bindAll(this,"zoomIn","zoomOut","zoom100","fitToHeight","fitToWidth","fitBest","isZoomMode","messagePosted","messageCreated","messageUpdated","setConversation","addAnnotation","_loadOtherAnnotation"),this.item=e.item,this.set({zoomMode:e.zoomMode||this.getDefaultZoomMode(),zoomValue:e.zoomValue||n.Viewer.DEFAULT_ZOOM_VALUE}),this.annotations=new r([],{item:this.item,conversationId:e.conversationId,handler:this}),this.listenTo(docs.events,"osn:conversationChanged",this.setConversation),this.listenTo(osn.events,"messageEntry-post",this.messagePosted),this.listenTo(osn.events,"messageEntry-cancel",this.messageCancelled),this.listenTo(osn.events,"chatCreated",this.messageCreated),this.listenTo(osn.events,"chatUpdated",this.messageUpdated),this.listenTo(docs.events,"viewer:start:annotation",this.onViewerStartAnnotation),this.listenTo(osn.events,"osn:conversation:open",this.onConversationOpen),this.listenTo(osn.events,"osn:conversation:closed",this.onConversationClosed)},reinit:function(){},isRenditionChanged:function(e){if(!t.isObject(e))return!1;var i=this.get("item");return e.getType()!==i.get("renditionType")||e.getId()!==i.get("renditionId")},viewRendition:function(e){var t=this.get("item");t.unset("renditionChanged",{silent:!0}),this.persistRendition({itemId:t.get("id"),itemRev:t.getRevisionNumber(),renditionType:e.getType(),renditionId:e.getId()}),t.set({renditionType:e.getType(),renditionId:e.getId(),renditionName:e.getName(),renditionExt:e.getExtension(),renditionChanged:!0,isReply:e.get("_replyToChatId")})},persistRendition:function(t){e.sessionStorage("assetRendition",t)},getPersistedRendition:function(){var t=e.sessionStorage("assetRendition");if(t&&t.itemId===this.get("item").get("id")&&t.itemRev===this.get("item").getRevisionNumber())return t},getDefaultZoomMode:function(){var e=this.item.get("fileType");switch(!e&&this.item.isAsset&&this.item.isDigitalAsset()&&this.item.has("fields")&&(e=this.item.get("fields").mimeType),e){case"image/png":case"image/jpeg":case"image/gif":case"image/tiff":case"application/vnd.apple.keynote":case"application/vnd.oasis.opendocument.presentation":case"application/vnd.ms-powerpoint":case"application/powerpoint":case"application/vnd.openxmlformats-officedocument.presentationml.presentation":return n.Viewer.ZoomMode.FIT_BEST;case"video/mp4":case"video/webm":case"video/ogv":case"video/ogg":case"video/mpg":return n.Viewer.ZoomMode.ZOOM_TO_VALUE;default:return n.Viewer.ZoomMode.DEFAULT_ZOOM_MODE}},isZoomMode:function(e){return e===this.get("zoomMode")},fitToHeight:function(){this.set("zoomMode",n.Viewer.ZoomMode.FIT_HEIGHT)},fitBest:function(){this.set("zoomMode",n.Viewer.ZoomMode.FIT_BEST)},fitToWidth:function(){this.set("zoomMode",n.Viewer.ZoomMode.FIT_WIDTH)},getZoomValue:function(){return{zoomValue:this.get("zoomValue"),zoomMode:this.get("zoomMode")}},restoreZoomValue:function(e){this.setZoomValue(e.zoomValue,t.omit(e,"zoomValue"))},setZoomValue:function(e,t){if(t=t||{},e){var i={zoomValue:e=(e=(e=Math.round(e))<this.minZoom?this.minZoom:e)>this.maxZoom?this.maxZoom:e};t.zoomMode&&(i.zoomMode=t.zoomMode,delete t.zoomMode),this.set(i,t)}},isSupported:function(){return!t.isUndefined(this.type)},isAnnotationCompatible:function(){return!0},onConversationOpen:function(){this.annotationsAllowed=!0,this.isInAnnotationMode()||this.trigger("viewer:allowAnnotation",!0)},onConversationClosed:function(){this.annotationsAllowed=!1,this.setAnnotationMode(!1),this.trigger("viewer:allowAnnotation",!1)},canViewAnnotations:function(){return this.supportsAnnotations()},canAnnotate:function(){return!(!this.annotationsAllowed||this.notViewable)&&this.supportsAnnotations()},supportsAnnotations:function(){var e=this.item.getRendition();if(e&&!e.isPreview())return!!e.get("renditionPreviewAvailable");if(t.isFunction(this.item.isDigitalAsset)&&this.item.isDigitalAsset()){var i=this.item.get("previewAvailable");return!(t.isBoolean(i)&&!i)}var o=l.isSites(this.item);return this.isSupported()&&this.item.getAllowedActions().annotationWrite&&!(h.isAppLink||h.isPublicLink&&h.isPublicUser||o)},isZoomable:function(){return this.isSupported()},isZoomable100:function(){return this.allowZoomTo100pct},zooming:function(e){e=(e-=this.zoomStep)<this.minZoom?this.minZoom:e,this.set({zoomMode:n.Viewer.ZoomMode.ZOOM_TO_VALUE,zoomValue:e})},zoomOut:function(){var e=this.get("zoomValue")-this.zoomStep;this.setZoomValue(e,{zoomMode:n.Viewer.ZoomMode.ZOOM_TO_VALUE})},zoomIn:function(){var e=this.get("zoomValue")+this.zoomStep;this.setZoomValue(e,{zoomMode:n.Viewer.ZoomMode.ZOOM_TO_VALUE})},zoom100:function(){this.set({zoomValue:100,zoomMode:n.Viewer.ZoomMode.ZOOM_100})},setMasterViewRegion:function(e){this.masterViewRegion=e,this.trigger("viewer:visibleRegionChanged",this.masterViewRegion)},getMasterViewRegion:function(){return this.masterViewRegion},deleteUncommittedAnnotations:function(){var e=this.getUncommittedAnnotations();this.annotations.remove(e)},hasUncommittedAnnotations:function(){return this.getUncommittedAnnotations().length>0},getUncommittedAnnotations:function(){return t.filter(this.annotations.models,(function(e){return!e.isCommitted()}))},fetchPinnedConversationId:function(){var i=this;if(t.contains(["folder","file"],this.item.get("type"))){var o=e.Deferred();return require(["docs/sidebar/view/ConversationPane"],t.bind((function(e){return e.fetchPinnedConvId(this.item.conversationReferenceId()).then((function(e){i.annotations.setConversationId(e),o.resolve()}))}),this)),o}var n=this.item.conversationReferenceId();return d.getAvailableConversationIds([n]).then((function(e){var o=e[0].returnValue;!t.isEmpty(o)&&o[n]&&i.annotations.setConversationId(o[n])}))},areAnnotationsDisplayed:function(){return this.showAnnotations||this.isInAnnotationMode()},isAnnotationModeAllowed:function(){return this.annotationsAllowed},setShowAnnotations:function(e){docs.events.trigger("osn:resethighlightchat"),e&&!this.annotations.hasConversationId()&&this.fetchPinnedConversationId(),this.showAnnotations!==e&&(this.showAnnotations=e,this.trigger("viewer:showAnnotationsChanged",this.showAnnotations))},setAnnotationMode:function(e){docs.events.trigger("osn:resethighlightchat"),e&&!this.annotations.hasConversationId()&&this.fetchPinnedConversationId(),this.annotationMode!==e&&(this.deleteUncommittedAnnotations(),this.annotationMode=e,this.isInAnnotationMode()?this.clearSelectedAnnotations():docs.events.trigger("osn:endAnnotation"),this.trigger("viewer:annotationModeChanged",this.annotationMode))},isInAnnotationMode:function(){return t.isBoolean(this.annotationMode)?this.annotationMode:!!t.isString(this.annotationMode)&&!t.isEmpty(this.annotationMode)},updateAnnotation:function(e,i){if(!t.isUndefined(e)&&!t.isUndefined(i)){if(t.has(i,"context")){var o=i.context;o!==e.get("context")&&(this.annotations.remove(e),e.set("context",o),this.annotations.add(e))}if((t.has(i,"left")||t.has(i,"top")||t.has(i,"width")||t.has(i,"height"))&&e.setDimensions(i)){var n=this.item.getAllowedActions();n&&n.annotationUpdate&&e.update(),e.trigger("viewer:annotationDimensionsChanged"),this.trigger("viewer:annotationDimensionsChanged",e)}}},setConversation:function(e){t.isEmpty(e)||this.annotations.conversationId===e||(this.annotations.setConversationId(e),this.trigger("viewer:conversationChanged",e))},messagePosted:function(){this.trigger("viewer:enableAnnotation",!1)},messageCancelled:function(){this.trigger("viewer:enableAnnotation",!0)},messageCreated:function(e){var i=e&&e[0]&&e[0].Arguments&&e[0].Arguments[0];if(i){var n=i&&i.CommentOnID&&i.ID!==i.TopLevelChatID,s=a.getLinkBackContext(i.ChatProperties);if(s&&this.item.get("id")===s.objectId){var r=o.get("XLoginInfo").UserID===i.CreatedByUserID,d=t.filter(this.annotations.models,(function(e){return!e.isCommitted()}));if(this.isInAnnotationMode())r&&d.length>0&&(t.each(d,(function(e){var t={conversationId:i.ConversationID,chatId:i.ID};e.has("itemRendId")&&(t.renditionId=e.get("itemRendId")),e.set(t),this.annotations.remove(e),e.save(),this.annotations.add(e)}),this),this.setShowAnnotations(!0),this.setAnnotationMode(!1),this.trigger("viewer:enableAnnotation",!0)),n&&this.setAnnotationMode(!1),r||this._loadOtherAnnotation(i.ConversationID,i.ID);else{if(r)return void this.trigger("viewer:enableAnnotation",!0);this._loadOtherAnnotation(i.ConversationID,i.ID)}}}},_loadOtherAnnotation:function(e,i){t.delay(t.bind((function(){this.annotations.retrieveAnnotation(e,i).done(t.bind((function(){}),this))}),this),1e3)},messageUpdated:function(e){var i=e&&e[0]&&e[0].Arguments&&e[0].Arguments[0];if(i){var o=i.ConversationID,n=i.ID;if(o&&n&&o===this.annotations.conversationId){var s=this.annotations.where({chatId:n});t.each(s,(function(e){!0===i.Removed?e.remove(!0):e.restore(!0)}))}}},onViewerStartAnnotation:function(){e(".content-sidebar-layout").last().find("div#mev_conv").length>0?docs.events.trigger("osn:startAnnotation"):(this.listenTo(docs.events,"setLinkBack",t.bind((function(){if(this.stopListening(docs.events,"setLinkBack"),this.hasUncommittedAnnotations()){var i=t.bind((function(){e(".content-sidebar-layout").last().find("div#mev_conv").is(":visible")?(this.setInAnnotationCreate(),t.defer((function(){docs.events.trigger("osn:startAnnotation")}))):t.delay(i,100)}),this);t.delay(i,0)}}),this)),docs.events.trigger("sidebar:showSidebar","conversation"))},setInAnnotationCreate:function(){this.isInA8nCreate=!0},isInAnnotationCreate:function(){return this.isInA8nCreate},clearInAnnotationCreate:function(){delete this.isInA8nCreate},getAnnotations:function(){return this.annotations},getFilteredAnnotations:function(e){var i=this.annotations.where(e);if(this.item.isAsset&&this.item.isDigitalAsset()){var o=this.item.get("renditionType"),s=this.item.get("renditionId"),a=this.getRenditionUniqueId(o,s),r=t.isEmpty(s)||o===n.Rendition.Type.PREVIEW&&s===n.Rendition.ID.PREVIEW;i=t.filter(i,(function(e){var i=e.get("renditionId");return!(!r||!t.isEmpty(i))||i===a}))}return i},addAnnotation:function(e){this.addAnnotationDefaultParameters(e);var t=this.annotations.addFromParameters(e);return this.setSelectedAnnotation(t),this.trigger("viewer:annotationAdded",t),t},addAnnotationDefaultParameters:function(e){if(e.id=t.uniqueId(n.Viewer.PlaceholerAnnotationPrefix),e.isAsset=this.item.isAsset,e.itemGuid=this.item.get("id"),this.item.getRevision()&&(e.revision=this.item.getRevision()),e.isCurrentUser=!0,this.item.isAsset)switch(e.caasGuid=this.item.get("id"),this.item.getRevision()&&(e.version=this.item.getRevision()),e.itemType=this.item.getAssetType(),e.itemType.toLowerCase()){case n.ItemType.ASSET_TYPE_DA:e.itemVarSetId=this.item.get("varSetId"),this.item.has("renditionId")&&(e.itemRendId=this.getRenditionUniqueId(this.item.get("renditionType"),this.item.get("renditionId")));break;default:e.itemVarSetId=this.item.get("varSetId"),e.itemLang=this.item.get("language")}else e.itemType=this.item.get("type")},getRenditionUniqueId:function(e,t){return e+"_"+t},addPlaceholderAnnotation:function(){var e=this.getMasterViewRegion(),t={context:(e?e.getParam("topIndex"):0)+1,left:.45,top:.45,width:.1,height:.1};return this.addAnnotation(t)},removeAnnotation:function(e){e&&(e.remove(),this.annotations.remove(e))},setSelectedAnnotation:function(e){this.clearSelectedAnnotations(e),e&&(e.unset("selected",{silent:!0}),e.set("selected",!0))},clearSelectedAnnotations:function(e){var i=this.annotations.where({selected:!0});e&&(i=t.without(i,e)),t.each(i,(function(e){e.set("selected",!1)}))},startLoading:function(){this.reinit()},stopLoading:function(){},handleRenderError:function(e){!t.isUndefined(e.renderCode)||19!==e.errorCode&&4!==e.errorCode||(e.renderCode=n.Viewer.RenderCode.UNSUPPORTED),this.item.set("previewAvailable",!1),this.item.trigger("viewer:renderError",e)},handleRenderWarning:function(e){this.item.trigger("viewer:renderWarning",e)},renderBoilerplate:function(e){this.item.trigger("viewer:renderBoilerplate",e)},viewOtherViewer:function(){var e=/\/wimg/,t=i.history.getFragment();e.test(t)?t=t.replace(e,""):t+="/wimg",docs.router.navigate(t,{trigger:!0,replace:!1})},getConversionUrlParameters:function(e){return e.isAsset?{itemPrefix:"&item=arCaaSGUID:",versionPrefix:"&arCaaSVersion=",id:e.get("id"),revision:e.get("version")}:{itemPrefix:"&item=fFileGUID:",versionPrefix:"&dRevLabel=",id:e.get("id"),revision:e.get("revision")}},remove:function(){this.stopLoading(),this.stopListening()}}),docs.models.FileViewHandler})),define("docs/fileview/model/FileViewPage",["jquery","underscore","backbone"],(function(e,t,i){"use strict";return docs.models.FileViewPage=i.Model.extend({imageLoaded:!1,toString:function(){return"{pageId:"+this.get("pageId")+",imageUrl:"+this.get("imageUrl")+"}"},getPageSize:function(){return{width:this.get("width"),height:this.get("height")}}}),docs.models.FileViewPage})),define("docs/fileview/model/FileViewPages",["jquery","underscore","backbone","core/util/Globals","docs/fileview/model/FileViewPage"],(function(e,t,i,docs){"use strict";var o=docs.events;return docs.models.FileViewPages=i.Collection.extend({model:docs.models.FileViewPage,pageWidth:0,pageHeight:0,_widthM2:0,_heightM2:0,selectedPage:0,initialize:function(){i.Collection.prototype.initialize.call(this),this.on("change:width",this.onDimensionChange)},onDimensionChange:function(){this.pageWidth=0,this.pageHeight=0,this._widthM2=0,this._heightM2=0;var e=this;this.each((function(t){t&&e.update(t.get("width"),t.get("height"))})),o.trigger("docsmain:forceresize")},resetPageData:function(){this.pageWidth=0,this.pageHeight=0,this._widthM2=0,this._heightM2=0,this.selectedPage=0},add:function(e){i.Collection.prototype.add.call(this,e),e&&this.update(e.get("width"),e.get("height"))},widthVariance:function(){return this.length>1?this._widthM2/(this.length-1):0},heightVariance:function(){return this.length>1?this._heightM2/(this.length-1):0},getRepresentativePageSize:function(){return{width:this.arePageWidthsSimilar()?this.pageWidth:null,height:this.arePageHeightsSimilar()?this.pageHeight:null}},arePageHeightsSimilar:function(){return this.length<=1||this.length>100&&this.heightVariance()<.1},arePageWidthsSimilar:function(){return this.length<=1||this.length>100&&this.widthVariance()<.1},update:function(e,t){1===this.length&&(this.pageWidth=e,this.pageHeight=t);var i=e-this.pageWidth;this.pageWidth+=i/this.length,this._widthM2+=i*(e-this.pageWidth);var o=t-this.pageHeight;this.pageHeight+=o/this.length,this._heightM2+=o*(t-this.pageHeight)}}),docs.models.FileViewPages})),define("docs/fileview/model/PagedDocumentHandler",["jquery","underscore","docs/fileview/model/FileViewHandler"],(function(e,t){"use strict";return docs.models.PagedDocumentHandler=docs.models.FileViewHandler.extend({defaults:{selectedPage:0},initialize:function(e){docs.models.FileViewHandler.prototype.initialize.call(this,e)},pageCount:function(){return this.pages?this.pages.length:-1},pageByIndex:function(e){return this.pages&&e>=0&&e<this.pages.length?this.pages.at(e):null},setSelectedPage:function(e){e=(e=e>=this.pageCount()?-1:e)<0?-1:e,this.set({selectedPage:e},{silent:!0}),this.trigger("change:selectedPage")},getSelectedPage:function(){return this.get("selectedPage")},reinit:function(){docs.models.FileViewHandler.prototype.reinit.call(this),this.set("selectedPage",0)}}),docs.models.PagedDocumentHandler})),define("docs/fileview/template/DocumentViewer.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div id="thumbs-area"></div><div id="pages-area" style="width:100%; height:100%;">  <div class="alta-spinner">    <div id="bp_start_viewer" class="bp_class">      <div value="-1" class="progress-circle" role="progressbar" aria-valuetext="In Progress">        <div class="progress-circle-indeterminate">          <div class="progress-circle-indeterminate-inner"></div>        </div>      </div>      <div tabindex="0" aria-labelledby="bp_start_viewer_text bp_start_viewer_detail" class="skipTarget">        <h3 id="bp_start_viewer_text" class="bp-info-text">'+(null==(__t=i18n.t("BP_FILE_PREVIEW_LOADING_MSG"))?"":__t)+'</h3>        <div id="bp_start_viewer_detail" class="bp-details-text">'+(null==(__t=i18n.t("BP_FILE_PREVIEW_LOADING_DETAIL_SHORT"))?"":_.escape(__t))+"</div>      </div>    </div>  </div></div>";return __p}})),define("docs/fileview/view/DocumentViewer",["jquery","underscore","backbone","core/util/Globals","docs/fileview/template/DocumentViewer.template","core/util/Utils"],(function(e,t,i,docs,o){"use strict";return docs.views.DocumentViewer=i.View.extend({id:"document-viewer",events:{"contextmenu #pages-area":"hideContextMenu"},initialize:function(e){t.bindAll(this,"refresh"),this.container=e.container,this.minNavWidth=177,this.maxNavWidth=400,this.resizerMargin=0;var i=o({i18n:docs.i18n});return this.$el.html(i),this.$el.attr("role","application"),this.model&&this.model.viewHandler&&(this.model.viewHandler.pageCount()>0&&this.refreshContent(),this.model.viewHandler.bind("viewer:pageCountChanged",this.refreshContent,this)),this},refresh:function(){var i=!1;!this.pagesView&&this.model.viewHandler.pageCount()>0&&(this.container.html(this.$el),this.createPagesView(),i=!0);var o=this.container.height(),n=e("#thumbs-area",this.$el);n.height(o),!this.thumbsView&&!this.options.thumbnails.hide&&this.model.viewHandler.pageCount()>1&&!docs.common.Utils.isInFullScreenMode()&&this.createNavigator(),this.thumbsView&&!1===n.collapsableresizer("isCollapsed")&&(this.navAreaWidth=t.isUndefined(this.navAreaWidth)?this.minNavWidth:this.navAreaWidth,this.navAreaWidth=this.navAreaWidth>this.maxNavWidth?this.maxNavWidth:this.navAreaWidth,this.navAreaWidth=this.navAreaWidth<this.minNavWidth?this.minNavWidth:this.navAreaWidth,n.width(Math.floor(this.navAreaWidth)),docs.common.Utils.isInFullScreenMode()&&n.width(0));var s=this.container.width()-n.outerWidth(!0)-1;if(this.pagesView&&(this.pagesView.$el.width(s),this.pagesView.$el.height(o),this.pagesView.display(s,o)),this.thumbsView){var a=n.outerWidth(!0)-this.resizerMargin;this.thumbsView.display(a,o),n.collapsableresizer("updateButtons")}i&&docs.events.trigger("action:viewer_open")},refreshContent:function(){this.refresh(),this.updateDescriptions()},updateDescriptions:function(){this.$el.attr("aria-label",this.getAriaLabel()),this.pagesView&&this.pagesView.updateDescription(),this.thumbsView&&this.thumbsView.updateDescription()},createPagesView:function(){this.pagesView||(this.pagesView=new this.options.pagesView({model:this.model,master:!0,editable:!0,startingChatId:this.options.urlParams.chatId}),this.pagesView&&this.pagesView.initializeView({container:e("#pages-area",this.$el)}))},createNavigator:function(){if(!this.thumbsView){var t=e("#thumbs-area",this.$el);this.thumbsView=new this.options.navView({model:this.model,master:!1,editable:!1}),e("#thumbs-area",this.$el).html(this.thumbsView.el);var i=this;t.collapsableresizer({handles:"e",minWidth:this.minNavWidth,maxWidth:this.maxNavWidth,autoHide:!0,collapsed:!this.options.thumbnails.expand,collapse:e.proxy(this.refresh,this),expand:e.proxy(this.refresh,this),resize:function(e,t){i.navAreaWidth=t.size.width}});var o=e(".ui-resizable-handle",t);o&&o.length>0&&(this.resizerMargin=parseInt(o.css("margin-left"),10)+o.width()),this.thumbsView.initializeView({container:t})}},getAriaLabel:function(){var e=1===this.model.viewHandler.pageCount();return this.model.viewHandler.isDocumentComplete()?e?docs.i18n.t("VIEWER_DOC_DESC_COMPLETE_SINGLE"):docs.i18n.t("VIEWER_DOC_DESC_COMPLETE",this.model.viewHandler.pageCount()):this.model.isAllowedAction("fileRead")?e?docs.i18n.t("VIEWER_DOC_DESC_INCOMPLETE_SINGLE_W_DOWNLOAD"):docs.i18n.t("VIEWER_DOC_DESC_INCOMPLETE_W_DOWNLOAD",this.model.viewHandler.pageCount()):e?docs.i18n.t("VIEWER_DOC_DESC_INCOMPLETE_SINGLE_WO_DOWNLOAD"):docs.i18n.t("VIEWER_DOC_DESC_INCOMPLETE_WO_DOWNLOAD",this.model.viewHandler.pageCount())},hideContextMenu:function(){var e=this.model.viewHandler.item.getAllowedActions();if(!e.fileRead&&!e.fileWrite)return!1},remove:function(){if(this.model&&this.model.viewHandler&&this.model.viewHandler.unbind("viewer:pageCountChanged",this.refreshContent),this.pagesView&&(this.pagesView.remove(),delete this.pagesView),this.thumbsView){var t=e("#thumbs-area",this.$el);t.length&&t.hasClass("ui-resizable")&&t.collapsableresizer("destroy"),this.thumbsView.remove(),delete this.thumbsView}}}),docs.views.DocumentViewer})),define("docs/fileview/template/DocumentView.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="content-wrapper" aria-label="'+(null==(__t=description)?"":_.escape(__t))+"\" tabindex=\"0\">  <div class='page-filler top-page-filler'></div>  <div class=\"content-pages\"></div>  <div class='page-filler bottom-page-filler'></div>  <div class='export-status-area' title=\""+(null==(__t=incompleteAlt)?"":_.escape(__t))+'" aria-label="'+(null==(__t=incompleteAlt)?"":_.escape(__t))+'" tabindex="0">    <img src="'+(null==(__t=incompleteImage)?"":_.escape(__t))+'" alt="'+(null==(__t=incompleteAlt)?"":_.escape(__t))+'"/>  </div></div>';return __p}})),define("docs/fileview/template/PageView.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="page-content">  <img class="page-image" draggable="false" alt="" role="presentation"/></div><div class="page-caption" role="presentation"></div>';return __p}})),define("docs/fileview/view/PageView",["jquery","underscore","backbone","core/util/Globals","core/util/Utils","docs/fileview/model/Annotations","docs/fileview/template/PageView.template","common/plugin/jquery.stringformat"],(function(e,t,i,docs,o,n,s){"use strict";var a=docs.common.Globals,r=docs.events;return docs.views.PageView=i.View.extend({errorImageURL:o.getBoilerplateImageUrl(a.staticRoot+"images/Boilerplate_Error.png"),emptyImageURL:a.staticRoot+"images/t.gif",events:{},initialize:function(e){return t.bindAll(this,"pageClicked","pageFocused","pageBlurred","keyDownOnPage","imageLoaded","imageError","attachLoaderImage","setTotalPageCount","annotationAdded"),this.index=e.index,this.viewHandler=e.viewHandler,this.model=this.viewHandler.pageByIndex(this.index),this.imageUrl=this.model.get("imageUrl"),this.editable=!t.isBoolean(e.editable)||e.editable,this.showParticipants=!t.isBoolean(e.showParticipants)||e.showParticipants,this.render()},render:function(){this.$el.addClass("page-wrapper"),this.$el.attr("pageid",this.index);var t=s();return this.$el.html(t),this.pageContent=e(".page-content",this.$el),this.pageImage=e(".page-image",this.$el),this.setTotalPageCount(),"LOADED"===this.state?this.attachRealImage():this.attachLoaderImage(),this.pageContent.bind("click",this.pageClicked),this.pageContent.bind("focus",this.pageFocused),this.pageContent.bind("blur",this.pageBlurred),this.pageImage.bind("error",this.imageError),this.pageContent.bind("keydown",this.keyDownOnPage),this.viewHandler&&this.viewHandler.isSVGPreview&&this.pageContent.addClass("svg-icon-image"),this},update:function(e,t){this.width=e,this.height=t,this.pageContent.css({width:Math.round(this.width)+"px",height:Math.round(this.height)+"px"}),this.$el.width(Math.round(this.width)),this.setTotalPageCount()},pageFocused:function(e){this.pageContent.addClass("ui-state-focus"),!0!==this.model.imageLoaded&&this.attachLoaderImage()},pageBlurred:function(e){this.pageContent.removeClass("ui-state-focus")},keyDownOnPage:function(t){(t.keyCode||t.which)===e.ui.keyCode.ENTER&&(this.pageContent.click(),t.preventDefault())},pageClicked:function(e){!0!==this.model.imageLoaded&&this.attachLoaderImage(),this.options.selectCb&&this.options.selectCb(this.index)},attachRealImage:function(){this._setState("LOADED"),this.removeLoaderImage(),this.viewHandler&&(this.viewHandler.showAnnotations||this.viewHandler.annotationMode)&&this.renderAnnotations()},attachLoaderImage:function(){this.createLoaderImage();var e=this;t.delay((function(){e.loaderImage&&e._setState("LOADING")}),1e3)},createLoaderImage:function(){this.loaderImage?(this.loaderImage.attr("src",""),this.loaderImage.attr("src",this.imageUrl)):(this.pageContent.append(e('<img class="loader-image" src="'+this.imageUrl+'">')),this.loaderImage=e(".loader-image",this.pageContent),this.loaderImage.bind("load",this.imageLoaded),this.loaderImage.bind("error",this.imageError))},removeLoaderImage:function(){this.loaderImage&&(this.loaderImage.unbind("error",this.imageError),this.loaderImage.unbind("load",this.imageLoaded),this.loaderImage.remove(),delete this.loaderImage)},imageLoaded:function(e){var i;if(t.isNumber(this.model.get("width"))||((i=i||{}).width=e.currentTarget.naturalWidth),t.isNumber(this.model.get("height"))||((i=i||{}).height=e.currentTarget.naturalHeight),i){this.model.set(i),this.trigger("viewer:pageCountChanged");var o=this.model.get("pageId");if(t.isString(o)){var n=o.indexOf("_");n>-1&&(i.renditionType=o.substring(0,n),i.renditionId=o.substring(n+1))}r.trigger("viewer:imageDimsUpdated",i)}this.model.imageLoaded=!0,this.removeLoaderImage(),this.pageContent.unbind("mouseenter",this.attachLoaderImage),this.attachRealImage()},imageError:function(e){this._setState("ERROR"),this.removeLoaderImage(),this.pageContent.unbind("mouseenter",this.attachLoaderImage),this.options.skipMouseEventOnError||this.pageContent.bind("mouseenter",this.attachLoaderImage)},_setState:function(e){this.state!==e&&(this.state=e,this.pageImage.attr("src",this.emptyImageURL),this.pageImage.parents(".page-wrapper").removeClass("page-wrapper-failed"),this.pageImage.parents(".content-pages").removeClass("content-pages-flex"),this.pageImage.removeClass("page-image-loaded"),this.pageImage.removeClass("page-image-failed"),"LOADED"===this.state?(osn.views.SpinnerView.hideSpinner(this.pageImage),this.pageImage.one("load",t.bind((function(){this.pageImage.addClass("page-image-loaded")}),this)),this.pageImage.attr("src",this.imageUrl)):"LOADING"===this.state?osn.views.SpinnerView.showSpinner(this.pageImage,{extraClasses:"centered medium"}):"ERROR"===this.state&&(osn.views.SpinnerView.hideSpinner(this.pageImage),this.pageImage.parents(".page-wrapper").addClass("page-wrapper-failed"),this.pageImage.parents(".content-pages").addClass("content-pages-flex"),this.pageImage.one("load",t.bind((function(){this.pageImage.addClass("page-image-failed")}),this)),this.pageImage.prop("src",this.errorImageURL)));var i="LOADED"===this.state||"ERROR"===this.state?0:Math.max(0,Math.round((this.height-this.pageImage.outerHeight(!0))/2));this.pageImage.css({top:i+"px"}),this.updateTextLabels()},setTotalPageCount:function(){var i=this.viewHandler.pageCount();if(this.totalPages!==i){var o=this.index+1;this.altText=this.options.altTextFmt?e.stringFormat(this.options.altTextFmt,o,i):void 0,this.altErrorText=this.options.altErrorTextFmt?e.stringFormat(this.options.altErrorTextFmt,o,i):void 0,this.toolbarText=this.options.toolbarTextFmt?e.stringFormat(this.options.toolbarTextFmt,o,i):void 0,this.captionText=this.options.captionTextFmt?e.stringFormat(this.options.captionTextFmt,o,i):void 0,this.errorDownloadLinkCb=t.isFunction(this.options.errorDownloadLinkCb)?this.options.errorDownloadLinkCb:void 0,this.totalPages=i}this.updateTextLabels()},updateTextLabels:function(t){"ERROR"===this.state?(this.setImageWrapperAttr("title",this.altErrorText),this.setImageWrapperAttr("aria-label",this.altErrorText)):(this.setImageWrapperAttr("title",this.tooltipText),this.setImageWrapperAttr("aria-label",this.altText)),this.captionText?(e(".page-caption",this.$el).html(this.captionText),"ERROR"===this.state&&this.errorDownloadLinkCb&&e(".page-caption",this.$el).find("#bp-download-link").click(this.errorDownloadLinkCb)):e(".page-caption",this.$el).hide()},setImageWrapperAttr:function(e,t){e&&(t?this.pageContent.attr(e,t):this.pageContent.removeAttr(e))},getOuterDimensions:function(){return{width:this.$el.outerWidth(!0),height:this.$el.outerHeight(!0)}},getPageDimensions:function(){var e=this.pageContent.position();return{left:e.left,top:e.top,width:this.pageContent.outerWidth(!0),height:this.pageContent.outerHeight(!0)}},renderAnnotations:function(){e(".annotation",this.$el).remove();var i=this.viewHandler.getFilteredAnnotations({context:this.model.get("pageId")});n.fetchA8NUserModels(i).done(t.bind((function(){require(["docs/fileview/view/AnnotationView"],t.bind((function(){t.each(i,(function(e){var t=new docs.views.AnnotationView({model:e,container:this});this.pageContent.append(t.$el)}),this)}),this))}),this))},annotationAdded:function(e){e.get("context")===this.model.get("pageId")&&require(["docs/fileview/view/AnnotationView"],t.bind((function(){var t=new docs.views.AnnotationView({model:e,container:this});this.pageContent.append(t.$el)}),this))},getZoomLevel:function(){return 100*this.pageContent.width()/this.model.get("width")},getDimensions:function(){return{width:this.pageContent.width(),height:this.pageContent.height()}},remove:function(){this.loaderImage&&(this.loaderImage.unbind("error",this.imageError),this.loaderImage.unbind("load",this.imageLoaded)),this.pageContent&&this.pageContent.unbind(),this.pageImage&&this.pageImage.unbind(),i.View.prototype.remove.call(this)}}),docs.views.PageView})),define("docsplugins/jquery.ui.collapsableresizer",["jquery","underscore","jqueryui-amd/widgets/button","jqueryui-amd/widgets/resizable"],(function(e,t){"use strict";e.widget("ui.collapsableresizer",{options:{},_create:function(){t.bindAll(this,"togglePane","renderButton","updateButtons","enableActiveButtonState","disableActiveButtonState","handleKeyDown"),e(this.element).resizable(this.options),this.elementWidth=e(this.element).width(),this.collapsed=!!this.options.collapsed&&this.options.collapsed,this.handler=e(".ui-resizable-handle",e(this.element)),this.handler.addClass("ui-collapse-resize-handle"),this.handler.on("mouseenter",this.enableActiveButtonState),this.handler.on("mouseleave",this.disableActiveButtonState),this.handler.on("dblclick",this.togglePane),this.collapsed?this.collapsePane():this.expandPane()},_destroy:function(){this.expandButton&&(this.expandButton.off().remove(),delete this.expandButton),this.collapseButton&&(this.collapseButton.off().remove(),delete this.collapseButton),this.handler&&(this.handler.removeClass("ui-resizable-e-collapsed"),this.handler.removeClass("ui-collapse-resize-handle"),this.handler.off("mouseenter",this.enableActiveButtonState),this.handler.off("mouseleave",this.disableActiveButtonState),this.handler.off("dblclick",this.togglePane)),e(this.element).resizable("destroy")},updateButtons:function(){this.collapsed?(this.handler.addClass("ui-resizable-e-collapsed"),this.expandButton=this.renderButton(this.expandButton,"expandButton","oj-ux-ico-chevron-double-right",docs.i18n.t("EXPAND_BUTTON_TOOLTIP")),this.collapseButton&&(this.collapseButton.is(":focus")&&this.expandButton.focus(),this.collapseButton.hide()),this.expandButton.show()):(this.handler.removeClass("ui-resizable-e-collapsed"),this.collapseButton=this.renderButton(this.collapseButton,"collapseButton","oj-ux-ico-chevron-double-left",docs.i18n.t("COLLAPSE_BUTTON_TOOLTIP")),this.expandButton&&(this.expandButton.is(":focus")&&this.collapseButton.focus(),this.expandButton.hide()),this.collapseButton.show())},renderButton:function(t,i,o,n){t||((t=e('<div class="resizer-button"></div>')).button({text:!1,icons:{primary:o}}),t.attr("id",i),t.attr("title",n),t.attr("aria-label",n),t.attr("tabindex",0),e(this.element).append(t),t.on("click",this.togglePane),t.on("mouseenter",this.enableActiveButtonState),t.on("mouseleave",this.disableActiveButtonState),t.on("keydown",this.handleKeyDown));e(this.element).width(),t.outerWidth(!1);var s=(e(this.element).height()-t.outerHeight(!1))/2;return t.css({top:s>0?s:"0px"}),t},handleKeyDown:function(t){(t.keyCode||t.which)===e.ui.keyCode.ENTER&&(this.togglePane(),t.preventDefault())},togglePane:function(){this.collapsed?(this.collapsed=!1,this.expandPane(),this.options.expand&&this.options.expand()):(this.collapsed=!0,this.collapsePane(),this.options.collapse&&this.options.collapse())},expandPane:function(){e(this.element).width(this.elementWidth),e(this.element).children().show(),e(this.element).resizable("enable"),this.updateButtons()},collapsePane:function(){this.elementWidth=e(this.element).width(),e(this.element).width(this.handler.outerWidth()),e(this.element).children().hide(),e(this.element).resizable("disable"),this.handler.show(),this.updateButtons()},isCollapsed:function(){return this.collapsed},enableActiveButtonState:function(e){this.collapsed?(this.expandButton.removeClass("ui-state-default"),this.expandButton.addClass("ui-state-active")):(this.collapseButton.removeClass("ui-state-default"),this.collapseButton.addClass("ui-state-active"))},disableActiveButtonState:function(t){var i=e(t.relatedTarget);this.collapsed?"expandButton"!==i.attr("id")&&(this.expandButton.addClass("ui-state-default"),this.expandButton.removeClass("ui-state-active")):"collapseButton"!==i.attr("id")&&(this.collapseButton.addClass("ui-state-default"),this.collapseButton.removeClass("ui-state-active"))}})})),define("docsplugins/jquery.ui.draghandler",["jquery","underscore"],(function(e,t){"use strict";e.widget("ui.draghandler",{options:{minimumMove:1},_create:function(){t.bindAll(this,"startDrag","mouseMoved","endDrag"),this.options.callback&&(e(this.element).on({mousedown:this.startDrag}),this.minimumMove=this.options.minimumMove,this.callback=this.options.callback)},_destroy:function(){e(this.element).off("mousedown",this.startDrag),e(this.element).off("mousemove",this.mouseMoved),e(this.element).off("mouseup",this.endDrag),e(this.element).off("mouseleave",this.endDrag)},startDrag:function(t){this.startX=t.pageX,this.startY=t.pageY,e(this.element).css("cursor","all-scroll"),e(this.element).on({mousemove:this.mouseMoved,mouseup:this.endDrag,mouseleave:this.endDrag})},mouseMoved:function(t){if("all-scroll"===e(this.element).css("cursor")){var i=t.pageX,o=t.pageY,n=i-this.startX,s=o-this.startY;Math.abs(n)>=this.options.minimumMove&&Math.abs(s)>=this.options.minimumMove&&(this.callback(n,s),this.startX=i,this.startY=o)}},endDrag:function(){e(this.element).off({mousemove:this.mouseMoved,mouseup:this.endDrag,mouseleave:this.endDrag}),e(this.element).css("cursor","auto")}})})),define("docsplugins/jquery.ui.viewport",["jquery","underscore"],(function(e,t){"use strict";e.widget("ui.viewport",{options:{screenMode:!1},_create:function(){t.bindAll(this,"update","_enableScreenMode","_disableScreenMode"),this.screenMode=this.options.screenMode,this.viewPort=this._createViewPort(),e(this.element).append(this.viewPort),this.viewArea=e("#view-port-view-area",this.viewPort),this.viewAreaStyleOverheadHoriz=this.viewArea.outerWidth(!1)-this.viewArea.width(),this.viewAreaStyleOverheadVert=this.viewArea.outerHeight(!1)-this.viewArea.height(),this.screenMode&&e(this.element).on({mouseenter:e.proxy(this._disableScreenMode,this),mouseleave:e.proxy(this._enableScreenMode,this),focusin:e.proxy(this._disableScreenMode,this),focusout:e.proxy(this._enableScreenMode,this)}),this.viewPort.hide()},_destroy:function(){e('<div id="view-port"></div>',this.element).remove(),e(this.element).off({mouseenter:e.proxy(this._disableScreenMode,this),mouseleave:e.proxy(this._enableScreenMode,this),focusin:e.proxy(this._disableScreenMode,this),focusout:e.proxy(this._enableScreenMode,this)})},_createViewPort:function(){var t=e('<div id="view-port"></div>');return t.append('<div id="view-port-top-filler" class="view-port-filler"></div>'),t.append('<div id="view-port-left-filler" class="view-port-filler"></div>'),t.append('<div id="view-port-view-area" class="view-port-view"></div>'),t.append('<div id="view-port-right-filler" class="view-port-filler"></div>'),t.append('<div id="view-port-bottom-filler" class="view-port-filler"></div>'),t},update:function(t,i,o,n){var s=e(this.element)[0].clientWidth,a=e(this.element)[0].scrollHeight;if(this.screenMode){this.viewPort.css({top:"0px",left:"0px",width:s+"px",height:a+"px"}),this.viewArea.css({top:Math.round(t)+"px",left:Math.round(i)+"px",width:Math.round(o-this.viewAreaStyleOverheadHoriz)+"px",height:Math.round(n-this.viewAreaStyleOverheadVert)+"px"});var r=this.viewArea.outerWidth(!1),d=this.viewArea.outerHeight(!1);e("#view-port-top-filler",this.viewPort).css({height:Math.round(t)+"px"});var l=s-(i+r);e("#view-port-right-filler",this.viewPort).css({top:Math.round(t)+"px",left:Math.round(i+r)+"px",width:Math.round(l)+"px",height:Math.round(d)+"px"});var h=a-(t+d);e("#view-port-bottom-filler",this.viewPort).css({top:Math.round(t+d)+"px",height:Math.round(h)+"px"}),e("#view-port-left-filler",this.viewPort).css({top:Math.round(t)+"px",width:Math.round(i)+"px",height:Math.round(d)+"px"}),e(".view-port-filler",this.viewPort).show()}else this.viewPort.css({top:Math.round(t)+"px",left:Math.round(i)+"px",width:Math.round(o-this.viewAreaStyleOverheadHoriz)+"px",height:Math.round(n-this.viewAreaStyleOverheadVert)+"px"}),this.viewArea.css({top:"0px",left:"0px",width:"100%",height:"100%"}),e(".view-port-filler",this.viewPort).hide();this.viewPort.show()},hideViewPort:function(){this.viewPort.hide()},_enableScreenMode:function(){this.screenMode||(this.screenMode=!0,this.viewPort.is(":visible")&&e(".view-port-filler",this.viewPort).show())},_disableScreenMode:function(){this.screenMode&&(this.screenMode=!1,this.viewPort.is(":visible")&&e(".view-port-filler",this.viewPort).hide())}})})),define("docs/fileview/view/DocumentView",["jquery","underscore","backbone","core/util/Constants","docs/fileview/template/DocumentView.template","core/util/Globals","core/util/Logger","docs/fileview/view/PageView","docsplugins/jquery.ui.collapsableresizer","docsplugins/jquery.ui.draghandler","docsplugins/jquery.ui.viewport"],(function(e,t,i,o,n){"use strict";var s=docs.common.Globals;return docs.views.DocumentView=i.View.extend({events:{},initialize:function(e){t.bindAll(this,"renderContent","scrollPages","handleDragScroll","handleKeyDown"),this.visibleRegion={scrollTop:0,scrollLeft:0,topIndex:0,bottomIndex:0,hiddenTop:0,hiddenBottom:0,hiddenLeft:0,hiddenRight:0,setParam:function(e,i){t.has(this,e)&&(0===e.indexOf("hidden")&&(i<0?i=0:i>1&&(i=1)),this[e]=i)},getParam:function(e){var t=this[e];return 0===e.indexOf("hidden")&&(t<0?t=0:t>1&&(t=1)),t}},this.isMasterView=!t.isUndefined(e.master)&&e.master},getAriaLabel:function(){return""},initializeView:function(i){if(i&&i.container){var o=n({description:this.getAriaLabel(),incompleteImage:s.staticRoot+"images/doc_incomplete_icon.png",incompleteAlt:this.model.isAllowedAction("fileRead")?docs.i18n.t("FILEVIEW_INCOMPLETE_W_DOWNLOAD"):docs.i18n.t("FILEVIEW_INCOMPLETE_WO_DOWNLOAD")});this.$el.html(o),i.container.css("width","").css("height",""),i.container.html(this.$el),this.container=i.container,this.wrapper=e(".content-wrapper",this.$el),this.topFiller=e(".top-page-filler",this.wrapper),this.pagesContent=e(".content-pages",this.wrapper),this.bottomFiller=e(".bottom-page-filler",this.wrapper),this.expStatus=e(".export-status-area",this.wrapper),this.isMasterView&&this.wrapper.addClass("skipTarget"),this.pagesContent.draghandler({callback:this.handleDragScroll}),this.isMasterView||(this.hasViewPort=!0,this.wrapper.viewport({screenMode:!1})),this.determineStyleOverheads(),this.pageSearchString="",this.pageViews=[],this.wrapper.scroll(t.debounce(this.scrollPages,100)),this.wrapper.bind("keydown",this.handleKeyDown),this.wrapper.bind("click",(function(t){e(t.currentTarget).focus()}))}},display:function(e,t){t=t||this.container.height(),this.wrapper.height(t-1),e=e||this.container.width();var i=this.wrapper.scrollLeft()+(e-this.wrapper.width())/2;this.wrapper.width(e);var o=this.getScrollTopFromTopIndex();this.renderContent(o,i),!this.isMasterView&&this.model.viewHandler.getMasterViewRegion()&&this.highlightVisibleRegion()},createTopFiller:function(e){var i,o=0,n=0;if(this.topFiller){var s=this.model.viewHandler.getRepresentativePageSize();if(t.isNull(s.height))for(;o<this.model.viewHandler.pageCount();o++){if(s=this.model.viewHandler.pageByIndex(o).getPageSize(),!(n+(i=this.fitPageToDisplay(s).height+this.pageWrapperStyleOverhead.vert())<e))break;n+=i}else i=this.fitPageToDisplay(s).height+this.pageWrapperStyleOverhead.vert(),(o=Math.floor(e/i))>this.model.viewHandler.pageCount()-1&&(o=this.model.viewHandler.pageCount()-1),n=i*o;this.topFiller.css({height:Math.round(n)+"px"})}return docs.common.Logger("Viewer").debug("TopFiller: Pages="+o+" Height="+n),o},createBottomFiller:function(e){var i=0;if(this.bottomFiller){var o=this.model.viewHandler.pageCount()-1;if(e<=o){var n=this.model.viewHandler.getRepresentativePageSize();if(t.isNull(n.height))for(;e<=o;e++){n=this.model.viewHandler.pageByIndex(e).getPageSize(),i+=this.fitPageToDisplay(n).height+this.pageWrapperStyleOverhead.vert()}else i=(this.fitPageToDisplay(n).height+this.pageWrapperStyleOverhead.vert())*(o-e+1)}this.bottomFiller.css({height:Math.round(i)+"px"})}return docs.common.Logger("Viewer").debug("BottomFiller: Height="+i),i},updateStatusArea:function(){var e=0;if(this.expStatus){var i=t.last(this.pageViews);!(!i||i.index!==this.model.viewHandler.pageCount()-1)&&!this.isMasterView&&this.model.viewHandler.isDocumentPartial()?(this.expStatus.width(this.wrapper[0].clientWidth),this.expStatus.show(),e=this.expStatus.outerHeight(!0)):this.expStatus.hide()}return e},renderContent:function(i,n){if(this.wrapper.is(":visible")&&this.wrapper[0].clientWidth>0&&this.wrapper[0].clientHeight){i=t.isFinite(i)?i<0?0:i:this.wrapper.scrollTop(),n=t.isFinite(n)?n<0?0:n:this.wrapper.scrollLeft();var s=this.wrapper[0].clientWidth,a=this.wrapper[0].clientWidth-this.containerStyleOverhead.horiz(),r=this.containerStyleOverhead.top,d=this.createTopFiller(i);r=this.topFiller.outerHeight(!0);for(var l,h,c,g=this.model.viewHandler.pageCount()-1,u=i+this.wrapper[0].clientHeight,m=d;m<=g&&r<u;m++){h=(l=this.model.viewHandler.pageByIndex(m)).getPageSize(),c=this.fitPageToDisplay(h),m===d&&(this.visibleRegion.setParam("topIndex",m),this.visibleRegion.setParam("hiddenTop",(i-(this.containerStyleOverhead.top+this.pageWrapperStyleOverhead.top+r))/c.height)),a<c.width&&(a=c.width);var p=this.pageViews[m];p||(p=this.createPageView(m,l),this.pageViews[m]=p,this.pagesContent.prepend(p.el)),p.update(c.width,c.height);var v=p.getOuterDimensions().height;if(v,((r+=v)>=u||m===g)&&(this.visibleRegion.setParam("bottomIndex",m),r>=u?this.visibleRegion.setParam("hiddenBottom",(r-(u-this.pageWrapperStyleOverhead.bottom))/c.height):this.visibleRegion.setParam("hiddenBottom",0),this.isMasterView&&!this.model.viewHandler.isZoomMode(o.Viewer.ZoomMode.ZOOM_100))){var w=100*c.width/Math.abs(h.width);this.model.viewHandler.setZoomValue(w)}}t.each(this.pageViews,(function(e){e&&(e.index<d||e.index>m)&&(e.remove(),delete this[e.index])}),this.pageViews);var f=e(".page-wrapper",this.pagesContent);f.detach();var I=f.sort((function(t,i){var o=parseInt(e(t).attr("pageid"),10),n=parseInt(e(i).attr("pageid"),10);return o>n?1:o<n?-1:0}));this.pagesContent.prepend(I),r+=this.createBottomFiller(m),r+=this.updateStatusArea();var _=this.model.viewHandler.get("zoomMode");if(_!==o.Viewer.ZoomMode.FIT_BEST&&_!==o.Viewer.ZoomMode.FIT_HEIGHT&&r>this.wrapper[0].clientHeight-this.containerStyleOverhead.vert()){if("scroll"!==this.wrapper.css("overflow-y")){if(this.wrapper.css({"overflow-y":"scroll"}),this.isMasterView&&!this.model.viewHandler.scrollBarAdded&&_!==o.Viewer.ZoomMode.FIT_BEST&&_!==o.Viewer.ZoomMode.FIT_HEIGHT&&_!==o.Viewer.ZoomMode.ZOOM_100){this.model.viewHandler.scrollBarAdded=!0;var T=100*(this.wrapper[0].clientWidth-this.containerStyleOverhead.horiz())/Math.abs(h.width);this.model.viewHandler.setZoomValue(T)}return void this.renderContent(i,n)}}else"scroll"===this.wrapper.css("overflow-y")&&this.wrapper.css({"overflow-y":"hidden"});if(s>=a+this.containerStyleOverhead.horiz())this.visibleRegion.setParam("hiddenLeft",0),this.visibleRegion.setParam("hiddenRight",0);else{var b=n,C=a-(b+s);this.visibleRegion.setParam("hiddenLeft",b/a),this.visibleRegion.setParam("hiddenRight",C/a)}this.wrapper.scrollTop(i),this.visibleRegion.setParam("scrollTop",this.wrapper.scrollTop()),this.wrapper.scrollLeft(n),this.visibleRegion.setParam("scrollLeft",this.wrapper.scrollLeft()),this.isMasterView&&this.model.viewHandler.setMasterViewRegion(this.visibleRegion)}},removeAllPages:function(){t.each(this.pageViews,(function(e){e&&(e.remove(),delete this[e.index])}),this.pageViews),t.isFunction(this.pageViews.resetPageData)&&this.pageViews.resetPageData()},fitPageToDisplay:function(e){var t,i,n=this.fixedZoomMode||this.model.viewHandler.get("zoomMode"),s=this.wrapper[0].clientWidth-this.containerStyleOverhead.horiz(),a=n===o.Viewer.ZoomMode.FIT_BEST||n===o.Viewer.ZoomMode.FIT_HEIGHT?this.wrapper.height():this.wrapper[0].clientHeight;if(1===this.model.viewHandler.pageCount()&&(a-=this.containerStyleOverhead.vert()+this.pageWrapperStyleOverhead.vert()),n===o.Viewer.ZoomMode.FIT_BEST){var r=Math.min((s-this.pageStyleOverhead.horiz())/e.width,(a-this.pageStyleOverhead.vert())/(e.height+24));t=e.width*r,i=e.height*r}else if(n===o.Viewer.ZoomMode.FIT_WIDTH)t=s-this.pageStyleOverhead.horiz(),i=s*e.height/e.width;else if(n===o.Viewer.ZoomMode.FIT_HEIGHT)i=a-this.pageStyleOverhead.vert(),t=a*e.width/e.height;else if(n===o.Viewer.ZoomMode.ZOOM_100)i=e.height,t=e.width;else{var d=this.model.viewHandler.get("zoomValue");t=Math.floor(e.width*d/100),i=Math.floor(e.height*d/100)}return{width:isNaN(t)||t<1?1:t,height:isNaN(i)||i<1?1:i}},handleDragScroll:function(e,t){var i=this.wrapper.scrollLeft()+e,o=this.wrapper.scrollTop()+t;(i=i<0?0:i)!==this.wrapper.scrollLeft()&&this.wrapper.scrollLeft(i),(o=o<0?0:o)!==this.wrapper.scrollTop()&&this.wrapper.scrollTop(o)},handleKeyDown:function(t){var i,o=t.keyCode||t.which,n=-1;switch(o){case e.ui.keyCode.HOME:n=0;break;case e.ui.keyCode.END:n=this.getScrollTopFromTopIndex(this.model.viewHandler.pageCount()-1,1);break;case e.ui.keyCode.PAGE_UP:(i=this.visibleRegion.getParam("topIndex"))>0&&(n=this.getScrollTopFromTopIndex(i-1,0));break;case e.ui.keyCode.PAGE_DOWN:(i=this.visibleRegion.getParam("topIndex"))<this.model.viewHandler.pageCount()-1&&(n=this.getScrollTopFromTopIndex(i+1,0));break;case e.ui.keyCode.ENTER:if(/^\d+$/.test(this.pageSearchString)){var s=parseInt(this.pageSearchString,10)-1;s=s>=this.model.viewHandler.pageCount()?this.model.viewHandler.pageCount()-1:s,this.model.viewHandler.setSelectedPage(s)}return void(this.pageSearchString="");default:o>=96&&o<=105&&(o-=48);var a=String.fromCharCode(o);return void(/\d/.test(a)&&(this.pageSearchString+=a))}n>=0&&(this.renderContent(n),t.preventDefault(),t.stopPropagation())},scrollToPage:function(e,t){var i=this.getScrollTopFromTopIndex(e,t);i+=this.pageWrapperStyleOverhead.top,this.renderContent(i)},scrollAnnotationIntoView:function(e){var t=e.getDimensions(),i=e.get("context")-1;this.scrollRectOnPageIntoView(t,i)},scrollRectOnPageIntoView:function(e,t){var i=this.model.viewHandler.pageByIndex(t),o=this.fitPageToDisplay(i.getPageSize()),n=e.top-e.height/2,s=this.getScrollTopFromTopIndex(t,n);s-=(this.wrapper.height()-o.height*e.height)/2;var a=e.left-e.width/2,r=o.width*a;r-=(this.wrapper.width()-o.width*e.width)/2,this.renderContent(s,r)},createPageView:function(){throw"Extending view must implement createPageView(index [,pageData])"},getScrollTopFromTopIndex:function(e,i){e=(e=(e=t.isUndefined(e)?this.visibleRegion.getParam("topIndex"):e)<0?0:e)>=this.model.viewHandler.pageCount()?this.model.viewHandler.pageCount()-1:e,i=t.isUndefined(i)?this.visibleRegion.getParam("hiddenTop"):i;var o=this.containerStyleOverhead.top;if(e>=0&&e<this.model.viewHandler.pageCount()){var n,s=this.model.viewHandler.getRepresentativePageSize();if(t.isNull(s.height))for(var a=0;a<=e;a++){s=this.model.viewHandler.pageByIndex(a).getPageSize(),n=this.fitPageToDisplay(s),a<e&&(o+=n.height+this.pageWrapperStyleOverhead.vert())}else o+=e*((n=this.fitPageToDisplay(s)).height+this.pageWrapperStyleOverhead.vert());o+=i?n.height*i:0}return o},getScrollTopFromBottomIndex:function(e,i){e=(e=(e=t.isUndefined(e)?this.visibleRegion.getParam("bottomIndex"):e)<0?0:e)>=this.model.viewHandler.pageCount()?this.model.viewHandler.pageCount()-1:e,i=t.isUndefined(i)?this.visibleRegion.getParam("hiddenBottom"):i;var o=this.containerStyleOverhead.top;if(e>=0&&e<this.model.viewHandler.pageCount()){var n,s=this.model.viewHandler.getRepresentativePageSize();if(t.isNull(s.height))for(var a=0;a<=e;a++){s=this.model.viewHandler.pageByIndex(a).getPageSize(),o+=(n=this.fitPageToDisplay(s)).height+this.pageWrapperStyleOverhead.vert()}else o+=(e+1)*((n=this.fitPageToDisplay(s)).height+this.pageWrapperStyleOverhead.vert());o-=i?n.height*i:0}return o=o>this.wrapper.height()?o-this.wrapper.height():0},determineStyleOverheads:function(){var t=new docs.views.PageView({index:0,viewHandler:this.model.viewHandler,captionTextFmt:this.isMasterView?void 0:docs.i18n.t("VIEWER_THUMBNAIL_CAPTION_TEXT")});this.pagesContent.append(t.el),t.update(1,1,1);var i=e('.page-wrapper[pageid="0"]',this.pagesContent),o=e(".page-content",i);this.pageStyleOverhead={top:parseFloat(o.css("margin-top"))+parseFloat(o.css("border-top-width"))+parseFloat(o.css("padding-top")),bottom:parseFloat(o.css("margin-bottom"))+parseFloat(o.css("border-bottom-width"))+parseFloat(o.css("padding-bottom")),left:parseFloat(o.css("margin-left"))+parseFloat(o.css("border-left-width"))+parseFloat(o.css("padding-left")),right:parseFloat(o.css("margin-right"))+parseFloat(o.css("border-right-width"))+parseFloat(o.css("padding-right")),horiz:function(){return this.left+this.right},vert:function(){return this.top+this.bottom}};var n=e(".page-caption",i);this.pageWrapperStyleOverhead={top:parseFloat(i.css("margin-top"))+parseFloat(i.css("border-top-width"))+parseFloat(i.css("padding-top")),bottom:(n.is(":visible")?n.height():0)+parseFloat(i.css("margin-bottom"))+parseFloat(i.css("border-bottom-width"))+parseFloat(i.css("padding-bottom")),left:parseFloat(i.css("margin-left"))+parseFloat(i.css("border-left-width"))+parseFloat(i.css("padding-left")),right:parseFloat(i.css("margin-right"))+parseFloat(i.css("border-right-width"))+parseFloat(i.css("padding-right")),horiz:function(){return i.outerWidth(!0)-i.width()},vert:function(){return this.top+this.bottom}},i.remove(),t.remove(),this.containerStyleOverhead={top:parseFloat(this.pagesContent.css("margin-top"))+parseFloat(this.pagesContent.css("border-top-width"))+parseFloat(this.pagesContent.css("padding-top")),bottom:parseFloat(this.pagesContent.css("margin-bottom"))+parseFloat(this.pagesContent.css("border-bottom-width"))+parseFloat(this.pagesContent.css("padding-bottom")),left:parseFloat(this.pagesContent.css("margin-left"))+parseFloat(this.pagesContent.css("border-left-width"))+parseFloat(this.pagesContent.css("padding-left")),right:parseFloat(this.pagesContent.css("margin-right"))+parseFloat(this.pagesContent.css("border-right-width"))+parseFloat(this.pagesContent.css("padding-right")),vert:function(){return this.top+this.bottom},horiz:function(){return this.left+this.right}}},highlightVisibleRegion:function(e,i){if(docs.common.Logger("Viewer").debug(e),this.hasViewPort&&this.wrapper.is(":visible")&&(e||(e=this.model.viewHandler.getMasterViewRegion()),e)){if(e.topIndex<0||e.bottomIndex<0)return;var o,n=this.getPageView(e.topIndex),s=this.getPageView(e.bottomIndex);if(n&&s){var a=n.getPageDimensions(),r=s.getPageDimensions(),d=a.top+a.height*e.hiddenTop,l=r.top+r.height*(1-e.hiddenBottom)-d,h=a.left+r.width*e.hiddenLeft,c=r.left+r.width*(1-e.hiddenRight)-h;if(this.wrapper.viewport("update",this.wrapper.scrollTop()+d,this.wrapper.scrollLeft()+h,c,l,!0),e.bottomIndex===this.model.viewHandler.pageCount()-1&&0===e.hiddenBottom&&(l+=this.pageWrapperStyleOverhead.bottom),d<0)o=this.wrapper.scrollTop()+d-3;else{if(!(d+l>this.wrapper.height()))return;o=this.wrapper.scrollTop()+(d+l-this.wrapper.height())+3}}else e.topIndex<this.visibleRegion.getParam("topIndex")?o=this.getScrollTopFromTopIndex(e.topIndex,e.hiddenTop):e.bottomIndex>this.visibleRegion.getParam("bottomIndex")&&(o=this.getScrollTopFromBottomIndex(e.bottomIndex,e.hiddenBottom));i||t.isUndefined(o)||(this.renderContent(o),this.highlightVisibleRegion(e,!0))}},updateDescription:function(){this.wrapper.attr("aria-label",this.getAriaLabel())},scrollPages:function(){this.renderContent()},zoomModeChanged:function(){var e=this.getScrollTopFromTopIndex();this.renderContent(e,this.visibleRegion.getParam("hiddenLeft"))},zoomChanged:function(){if(this.model.viewHandler.isZoomMode(o.Viewer.ZoomMode.ZOOM_TO_VALUE)){for(var e=1*this.model.viewHandler.get("zoomValue")/this.model.viewHandler._previousAttributes.zoomValue,t=this.visibleRegion.getParam("topIndex"),i=this.visibleRegion.getParam("bottomIndex"),n=[],s=0,a=t;a<=i;a++){var r=this.getPageView(a);r&&(n[a]=r.getPageDimensions().height,s+=n[a])}var d,l,h=n[t]*this.visibleRegion.getParam("hiddenTop")+(e-1)*s/2;for(a=t;a<=i;a++){var c=n[a]*e;if(c>=h){d=a,l=e>1?h/c:this.visibleRegion.getParam("hiddenTop");break}h-=c}var g,u=this.getScrollTopFromTopIndex(d,l),m=(e-1)*this.pagesContent.width();g=0===this.wrapper.scrollLeft()?(this.pagesContent.width()+m-(this.wrapper[0].clientWidth+this.containerStyleOverhead.horiz()))/2:this.wrapper.scrollLeft()+m/2,this.renderContent(u,g)}},getPageView:function(e){return t.find(this.pageViews,(function(t){return!(!t||t.index!==e)}))},remove:function(){this.pagesContent&&(this.pagesContent.off(),this.pagesContent.data("ui-draghandler")&&this.pagesContent.draghandler("destroy")),this.hasViewPort&&(this.hasViewPort=!1,this.wrapper.viewport("destroy")),this.wrapper&&this.wrapper.unbind(),this.model&&(this.model=null),i.View.prototype.remove.call(this)}}),docs.views.DocumentView})),define("docs/fileview/view/AnnotationsViewMixin",["jquery","underscore","core/util/Session","core/util/Globals","core/util/Logger","core/view/MessageBar"],(function(e,t,i){"use strict";var o=docs.common.Globals;return docs.views.AnnotationsViewMixin={annotationMixinInitialize:function(e){t.bindAll(this,"renderAnnotations","annotationAdded","annotationModeChanged","annotationModeChangedThumbs","showAnnotationsChanged","viewOtherViewer"),this.editable=!t.isUndefined(e.editable)&&e.editable,this.annotations=this.model.viewHandler.getAnnotations(),this.annotations&&(this.listenTo(this.annotations,"reset",this.renderAnnotations),this.listenTo(this.annotations,"add",this.annotationAdded))},annotationMixinInitializeView:function(){this.cleaned||(this.listenTo(this.model.viewHandler,"viewer:annotationModeChanged",this.isMasterView&&this.editable?this.annotationModeChanged:this.annotationModeChangedThumbs),this.listenTo(this.model.viewHandler,"viewer:showAnnotationsChanged",this.showAnnotationsChanged))},annotationMixinCleanView:function(){this.stopListening(this.model.viewHandler,"viewer:annotationModeChanged"),this.stopListening(this.model.viewHandler,"viewer:showAnnotationsChanged"),this.cleaned=!0},annotationModeChangedThumbs:function(e){this.renderAnnotations()},annotationModeChanged:function(e){this.renderAnnotations(),e?this.annotationModeOn(e):this.annotationModeOff()},showAnnotationsChanged:function(){this.renderAnnotations(),this.model.viewHandler.clearSelectedAnnotations()},scrollToAnnotation:function(e){e&&(this.viewNotLoaded?this.pendingScrollToChatId=e:(this.model.viewHandler.setShowAnnotations(!0),t.defer(t.bind((function(){var i=this.model.viewHandler.getFilteredAnnotations({chatId:e});i.length>0?(this.closeIncompatibleMessage(),this.closePageNotLoadedMessage(),t.each(i,(function(e){if(this.model.viewHandler.isAnnotationCompatible(e)){var t=e.get("context");this.model.viewHandler.pageCount()<t?this.pageNotLoadedMessage=new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_PAGE_NOT_LOADED",t),messageType:"warning"}):this.annotationActivated(e,!0)}else this.incompatibleMessage=new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_INCOMPATIBLE_ANNOTATION"),messageType:"warning",commands:[{text:docs.i18n.t("ACTION_VIEW_OTHER"),tooltip:docs.i18n.t("ACTION_VIEW_OTHER_TT"),id:"viewOtherButton",click:this.viewOtherViewer}]})}),this)):docs.common.Logger("Viewer").info("No annotation found with message id: "+e)}),this))))},annotationActivated:function(n,s){if(n&&!this.model.viewHandler.isInAnnotationMode()&&(this.scrollAnnotationIntoView(n),this.model.viewHandler.setSelectedAnnotation(n),!0!==s)){var a={chatID:n.get("chatId"),doDefaultFocus:!0,highlight:n.get("creatorId")===o.userid?"currentUser":"otherUser"};i.documentSidebar()&&"conversation"===i.documentSidebarTab()?e("div#mev_conv").length<=0?(docs.events.trigger("sidebar:showSidebar","conversation"),e("div#mev_conv").is(":visible")&&t.defer((function(){docs.events.trigger("osn:scrollChat",a)}))):docs.events.trigger("osn:scrollChat",a):(this.listenToOnce(docs.events,"conversation:rendered",(function(){docs.events.trigger("osn:scrollChat",a)})),docs.events.trigger("sidebar:showSidebar","conversation"))}},renderAnnotations:function(){this.removeAnnotations(),this.annotations.areAnnotationsDisplayed()&&this.annotations.length>0&&t.each(this.pageViews,(function(e){e&&e.renderAnnotations()})),(this.options.startingAnnotationId||this.options.startingChatId)&&(this.scrollToAnnotation(this.options.startingAnnotationId||this.options.startingChatId),delete this.options.startingChatId,delete this.options.startingAnnotationId)},annotationAdded:function(e){var t=e.get("context")-1,i=this.getPageView(t);i&&i.annotationAdded(e)},refreshAnnotations:function(){this.annotations&&this.annotations.retrigger()},viewOtherViewer:function(){this.model.viewHandler.viewOtherViewer(),this.closeIncompatibleMessage(),this.closePageNotLoadedMessage()},closeIncompatibleMessage:function(){this.incompatibleMessage&&(this.incompatibleMessage.closeWebBar(),delete this.incompatibleMessage)},closePageNotLoadedMessage:function(){this.pageNotLoadedMessage&&(this.pageNotLoadedMessage.closeWebBar(),delete this.pageNotLoadedMessage)}},docs.views.AnnotationsViewMixin})),define("docs/fileview/view/ViewerUtils",["jquery","underscore"],(function(e,t){"use strict";return docs.common.ViewerUtils={getMousePosition:function(e,t){var i=t.offset(),o=e.pageX-i.left,n=e.pageY-i.top;return{left:o=o<0?0:o>t.width()?t.width():o,top:n=n<0?0:n>t.height()?t.height():n}}},docs.common.ViewerUtils})),define("docs/fileview/view/AreaSelectorView",["jquery","underscore","backbone","core/util/Constants","docs/fileview/view/ViewerUtils"],(function(e,t,i,o){"use strict";return docs.views.AreaSelectorView=i.View.extend({tagName:"div",className:"area-selector my_annotation",events:{},initialize:function(){return this},selectArea:function(t){return this.container=t.container,this.callback=t.callback,this.data=t.data,this.$el.css({left:t.data.left,top:t.data.top,width:o.Viewer.ANNOT_MIN_WIDTH+"px",height:o.Viewer.ANNOT_MIN_HEIGHT+"px"}),this.$el.appendTo(this.container),this.parentContainer=this.container.closest(".mainViewContainer").find(".content-pages, .sidebar-conversation-pane"),this.container.on("mousemove",e.proxy(this.handleMouseMove,this)),this.parentContainer.on("mouseup",e.proxy(this.handleMouseUp,this)),this},handleMouseMove:function(e){var t=docs.common.ViewerUtils.getMousePosition(e,this.container);this.data.width=Math.abs(t.left-this.data.left),this.data.height=Math.abs(t.top-this.data.top),t.left<this.data.left&&(this.data.left=t.left),t.top<this.data.top&&(this.data.top=t.top),this.$el.css({left:this.data.left+"px",top:this.data.top+"px",width:this.data.width+"px",height:this.data.height+"px"})},handleMouseUp:function(){this.container.off("mousemove"),this.parentContainer.off("mouseup"),t.isUndefined(this.data.width)&&(this.data.width=this.$el.width()),t.isUndefined(this.data.height)&&(this.data.height=this.$el.height()),t.isFunction(this.callback)&&(this.data.left=(this.data.left+this.data.width/2)/this.container.width(),this.data.top=(this.data.top+this.data.height/2)/this.container.height(),this.data.width=1*this.data.width/this.container.width(),this.data.height=1*this.data.height/this.container.height(),this.$el.detach(),this.callback(this.data))}}),docs.views.AreaSelectorView})),define("docs/fileview/view/VerticalDocumentView",["jquery","underscore","docs/fileview/view/DocumentView","docs/fileview/view/AnnotationsViewMixin","docs/fileview/view/AreaSelectorView","docs/fileview/view/PageView","docs/fileview/view/ViewerUtils"],(function(e,t,i){"use strict";return docs.views.VerticalDocumentView=i.extend(t.extend({id:"content-viewer",events:{},initialize:function(e){return t.bindAll(this,"pageSelectionChanged","startAnnotCreation","addAnnotation"),i.prototype.initialize.call(this,e),this.model&&this.model.viewHandler&&(this.listenTo(this.model.viewHandler,"change:zoomValue",this.zoomChanged),this.listenTo(this.model.viewHandler,"change:zoomMode",this.zoomModeChanged),this.listenTo(this.model.viewHandler,"change:selectedPage",this.pageSelectionChanged)),this.listenTo(docs.events,"viewer:annotationActivated",this.annotationActivated),this.listenTo(docs.events,"viewer:scrollToAnnotation",this.scrollToAnnotation),this.annotationMixinInitialize(e),this},initializeView:function(e){i.prototype.initializeView.call(this,e),this.annotationMixinInitializeView()},createPageView:function(e,i){var o={altTextFmt:docs.i18n.t("ALT_VIEWER_PAGE"),altErrorTextFmt:docs.i18n.t("ALT_VIEWER_PAGE_ERROR"),tooltipTextFmt:docs.i18n.t("ALT_VIEWER_PAGE")},n=i&&i.has("pageViewOptions")?i.get("pageViewOptions"):{};return new docs.views.PageView(t.extend({},o,n,{index:e,viewHandler:this.model.viewHandler}))},pageSelectionChanged:function(){var e=this.model.viewHandler.getSelectedPage();e>=0&&e<this.model.viewHandler.pageCount()&&this.scrollToPage(e,0)},getAriaLabel:function(){return 1===this.model.viewHandler.pageCount()?docs.i18n.t("VIEWER_VIEW_PANE_DESC_SINGLE"):docs.i18n.t("VIEWER_VIEW_PANE_DESC",this.model.viewHandler.pageCount())},downloadFile:function(){this.model.startDownload(!1)},editFile:function(){this.model.startEdit()},annotationModeOn:function(){this.pagesContent&&this.pagesContent.on("mousedown",this.startAnnotCreation)},annotationModeOff:function(){this.pagesContent&&this.pagesContent.off("mousedown")},removeAnnotations:function(){this.$(".annotation").remove()},startAnnotCreation:function(t){var i=e(t.target).closest(".page-wrapper").first();if(i&&i.length>0){var o=0===e(t.target).closest(".uncommitted").length;if(i&&o){this.pagesContent&&this.pagesContent.off("mousedown"),t.stopPropagation(),t.preventDefault();var n=parseInt(i.attr("pageId"),10),s=this.pageViews[n];if(s){this.model.viewHandler.deleteUncommittedAnnotations();var a=docs.common.ViewerUtils.getMousePosition(t,s.pageContent);a.context=n+1,(new docs.views.AreaSelectorView).selectArea({container:s.pageContent,data:a,callback:this.addAnnotation})}}}},addAnnotation:function(e){this.model.viewHandler.addAnnotation(e),docs.events.trigger("viewer:start:annotation"),this.pagesContent&&this.pagesContent.on("mousedown",this.startAnnotCreation)},remove:function(){this.annotationMixinCleanView(),i.prototype.remove.call(this)}},docs.views.AnnotationsViewMixin)),docs.views.VerticalDocumentView})),define("docs/fileview/view/VerticalThumbsView",["jquery","underscore","docs/fileview/view/DocumentView","core/util/Constants","docs/fileview/view/AnnotationsViewMixin","docs/fileview/view/PageView"],(function(e,t,i,o){"use strict";return docs.views.VerticalThumbsView=i.extend(t.extend({id:"content-navigator",fixedZoomMode:o.Viewer.ZoomMode.FIT_WIDTH,initialize:function(e){return i.prototype.initialize.call(this,e),this.model&&this.model.viewHandler&&this.listenTo(this.model.viewHandler,"viewer:visibleRegionChanged",this.highlightVisibleRegion),this.annotationMixinInitialize(e),this},initializeView:function(e){i.prototype.initializeView.call(this,e),this.annotationMixinInitializeView()},createPageView:function(t){return new docs.views.PageView({index:t,viewHandler:this.model.viewHandler,editable:this.editable,showParticipants:!1,altTextFmt:docs.i18n.t("ALT_VIEWER_THUMBNAIL"),altErrorTextFmt:docs.i18n.t("ALT_VIEWER_THUMBNAIL_ERROR"),captionTextFmt:docs.i18n.t("VIEWER_THUMBNAIL_CAPTION_TEXT"),selectCb:e.proxy(this.selectedThumbnail,this)})},selectedThumbnail:function(e){this.model.viewHandler.setSelectedPage(e)},getAriaLabel:function(){return 1===this.model.viewHandler.pageCount()?docs.i18n.t("VIEWER_NAVIGATION_PANE_DESC_SINGLE"):docs.i18n.t("VIEWER_NAVIGATION_PANE_DESC",this.model.viewHandler.pageCount())},removeAnnotations:function(){this.$(".annotation").remove()},remove:function(){this.annotationMixinCleanView(),i.prototype.remove.call(this)}},docs.views.AnnotationsViewMixin)),docs.views.VerticalThumbsView})),define("docs/fileview/model/ImageDocumentHandler",["jquery","underscore","core/util/Constants","core/util/Service","core/util/Jsonify","core/util/Globals","core/util/Logger","docs/fileview/model/FileViewPage","docs/fileview/model/FileViewPages","docs/fileview/model/PagedDocumentHandler","docs/fileview/view/DocumentViewer","docs/fileview/view/VerticalDocumentView","docs/fileview/view/VerticalThumbsView"],(function(e,t,i,o,n){"use strict";var s=docs.common.Globals;return docs.models.ImageDocumentHandler=docs.models.PagedDocumentHandler.extend({type:i.Viewer.DocumentType.IMAGES,config:{viewer:docs.views.DocumentViewer,pagesView:docs.views.VerticalDocumentView,navView:docs.views.VerticalThumbsView,dimsPanelView:"docs/fileview/view/ImageAnnotationDimsPanel"},initialize:function(e){docs.models.PagedDocumentHandler.prototype.initialize.call(this,e)},getDefaultZoomMode:function(){var e=this.item.has("extension")?this.item.get("extension").toLowerCase():"";return t.isEmpty(e)&&t.isFunction(this.item.getExtension)&&(e=this.item.getExtension()),t.contains(i.oit.doctype.pdf.extensions,e)?i.Viewer.ZoomMode.FIT_WIDTH:i.Viewer.ZoomMode.FIT_BEST},isDocumentComplete:function(){return!1===this.ExportInProgress&&!0!==this.ExceededMaxPages&&!0!==this.exportTimedOut},isDocumentPartial:function(){return!1===this.ExportInProgress&&(!0===this.ExceededMaxPages||!0===this.exportTimedOut)},reinit:function(){docs.models.PagedDocumentHandler.prototype.reinit.call(this),this.continueLoadingPages=!0,this.ExceededMaxPages=!1,this.firedMaxPagesWarning=!1,this.exportTimedOut=!1,this.firedExportTimedOutWarning=!1,this.statusCheckTries=0,this.baseURLForIamges=this.getBaseURLForImages(),this.pages=new docs.models.FileViewPages},updateExportStatus:function(t){var i=this.getConversionUrlParameters(this.item),s=o.formatServiceUrl("GET_CLOUD_EXPORT_STATUS")+i.itemPrefix+i.id;i.revision&&(s+=i.versionPrefix+i.revision),t||(s+="&IsRepeat=1");var a=this;e.ajax(s,{type:"GET",success:function(e){var t=n.parse_PAGE_EXPORT_STATUS(e);t.Infected?a.Error={Infected:!0,errorMsgKey:t.ExportError,errorMsg:t.ErrorMessage,errorCode:t.ReturnCode}:(a.ImagesCached="1"===t.PreviewIsStored,a.ExportInProgress="1"===t.ExportInProgress,a.ExceededMaxPages="1"===t.ExceededMaxPages,void 0!==t.Timeout?a.exportTimedOut=t.Timeout:a.Error=void 0===t.PreviewHasError?void 0:{errorMsgKey:t.ExportError,errorMsg:t.ErrorMessage,errorCode:t.ReturnCode},a.ExportPages=t.Pages,(a.ExceededMaxPages||a.exportTimedOut)&&a.stopPageLoad())},error:function(e,t,i){a.Error=i,e.errorHandled=!0,docs.common.Logger("ImageDocumentHandler").error("updateExportStatus","Error",t,i)},async:!1}),this.ImagesCached||this.ExportInProgress||this.startDocumentExport()},orderRowsByPageId:function(e){for(var t=e.length,i=[],o=0;o<t;o++){var n=e[o];i[parseInt(n.PageId,10)-1]=n}e.rows=i},startDocumentExport:function(){var t=this.getConversionUrlParameters(this.item),i=o.formatServiceUrl("GET_CLOUD_PREVIEW_CONVERSION")+t.itemPrefix+t.id;i+="&pagesToWaitFor=0",t.revision&&(i+=t.versionPrefix+t.revision);var n=this;e.ajax(i,{type:"GET",error:function(e,t,i){n.stopPageLoad(),n.handleRenderError(i),e.errorHandled=!0,docs.common.Logger("ImageDocumentHandler").error("startDocumentExport","Error",t,i)},async:!1})},processCacheStatus:function(i){if(this.updateExportStatus(i),this.statusCheckTries++,this.Error)return docs.common.Logger("ImageDocumentHandler").error("processCacheStatus","Error",this.Error),void this.handleRenderError(this.Error);this.ExportInProgress&&(this.statusCheckTries=0);for(var o=this.pages.length!==this.ExportPages.length,n=this.pages.length;n<this.ExportPages.length&&n<=s.maxPages;n++){var a=this.ExportPages[n],r=parseInt(a.width,10),d=parseInt(a.height,10),l={pageId:parseInt(a.pageId,10),width:r,height:d,imageUrl:this.baseURLForIamges+"&Rendition="+a.name};this.addPage(l)}if(o&&this.trigger("viewer:pageCountChanged"),this.fireWarnings(),!(!this.ExportInProgress&&this.ImagesCached)&&!this.Error&&this.continueLoadingPages&&this.statusCheckTries<60)t.delay(e.proxy(this.processCacheStatus,this),3e3);else{if(this.Error)return void this.handleRenderError(this.Error);if(this.statusCheckTries>=60)return this.Error={viewerError:"maxTriesExceeded"},void this.handleRenderError(this.Error)}},addPage:function(e){var t=new docs.models.FileViewPage(e);this.pages.add(t)},getBaseURLForImages:function(){var e,t;return this.baseURLForIamges?this.baseURLForIamges:this.item.isAsset?(e=o.formatServiceUrl("GET_RENDITION",{skipSuppress:!0,addAccessToken:!0}),e+="&AuxRenditionType=system",e+="&item=arCaaSGUID:"+this.item.get("id"),(t=this.item.get("version"))&&(e+="&arCaaSVersion="+t),e+="&noSaveAs=1"):(e=o.formatServiceUrl("GET_RENDITION",{skipSuppress:!0,addAccessToken:!0}),e+="&AuxRenditionType=system",e+="&item=fFileGUID:"+this.item.get("id"),(t=this.item.getRevision())&&(e+="&dRevLabel="+t),e+="&noSaveAs=1")},determineImageId:function(e){var t="pages";if(e>0){for(var i=e.toString(16);i.length<4;)i="0"+i;t+=i}return t+=".png"},stopPageLoad:function(){this.continueLoadingPages=!1,this.ExportInProgress=!1},fireWarnings:function(){this.ExceededMaxPages&&!this.firedMaxPagesWarning&&(this.handleRenderWarning({code:i.Viewer.RenderCode.MAX_PAGES_WARNING}),this.firedMaxPagesWarning=!0),this.exportTimedOut&&!this.firedExportTimedOutWarning&&(this.handleRenderWarning({code:i.Viewer.RenderCode.TIMEOUT_WARNING}),this.firedExportTimedOutWarning=!0)},getRepresentativePageSize:function(){return this.pages.getRepresentativePageSize()},exportInProgress:function(){return this.ExportInProgress},startLoading:function(){this.reinit(),this.processCacheStatus(!0)},stopLoading:function(){this.stopPageLoad()}}),docs.models.ImageDocumentHandler})),define("docs/fileview/view/HTML5Viewer",["jquery","underscore","backbone","core/util/Globals","core/util/Constants","core/util/Logger","core/util/Browser","docs/fileview/template/DocumentViewer.template"],(function(e,t,i,docs,o,n,s,a){"use strict";var r=o.Viewer;return docs.views.HTML5Viewer=i.View.extend({id:"document-viewer",events:{},fit_width:s.isMobile?"mobile":"pagewidth",fit_best:s.isMobile?"mobile":"page",initialize:function(e){return n(r.OIT_LOGGER).debug("initialize view"),t.bindAll(this,"refresh","updateLayout","pagesViewLoaded","thumbsViewLoaded","zoomChanged","zoomModeChanged","handlePageAdded","viewedAreaChanged","handleThumbsZoomChanged"),this.container=e.container,this.minNavWidth=177,this.maxNavWidth=400,this.resizerMargin=0,this.initializeView(),this},initializeView:function(){var e=a({i18n:docs.i18n});return this.$el.html(e),this.container.html(this.$el),this.$el.attr("role","application"),this.createPagesView(),this},refresh:function(){this.updateLayout()},updateLayout:t.throttle((function(){n(r.OIT_LOGGER).debug("updateLayout");var i=this.container.parent().height(),o=e("#thumbs-area",this.$el),s=e("#pages-area",this.$el);o.height(i),this.thumbsView&&o.data("ui-collapsableresizer")&&!1===o.collapsableresizer("isCollapsed")?(this.navAreaWidth=t.isUndefined(this.navAreaWidth)?this.minNavWidth:this.navAreaWidth,this.navAreaWidth=this.navAreaWidth>this.maxNavWidth?this.maxNavWidth:this.navAreaWidth,this.navAreaWidth=this.navAreaWidth<this.minNavWidth?this.minNavWidth:this.navAreaWidth,o.width(Math.floor(this.navAreaWidth)),this.thumbsView.setWidth(o.width()-5)):o.width(0);var a=this.container.parent().width();if(o.is(":visible")){var d=o.outerWidth(!0);a-=d,0===d?s.css("float","initial"):s.css("float","")}else s.css("float","initial");s.width(a).height(i),o.data("ui-collapsableresizer")&&o.collapsableresizer("updateButtons")}),50),createPagesView:function(){this.pagesView||(this.pagesView=this.model.viewHandler.getPagesView({model:this.model,master:!0,editable:!0,startingChatId:this.options.urlParams.chatId,startingAnnotationId:this.options.urlParams.annotationId,viewLoadedCb:this.pagesViewLoaded}),this.pagesView&&this.pagesView.initializeView({container:e("#pages-area",this.$el)}))},pagesViewLoaded:function(){this.listenTo(this.pagesView,"zoom",this.pagesZoomed),this.listenTo(this.pagesView,"pagesChanged",this.handlePageAdded),this.listenTo(this.pagesView,"scroll",this.viewedAreaChanged),this.listenTo(this.model.viewHandler,"change:zoomValue",this.zoomChanged),this.listenTo(this.model.viewHandler,"change:zoomMode",this.zoomModeChanged),this.updateLayout(),this.handlePageAdded(),this.zoomModeChanged(),docs.events.trigger("action:viewer_open")},createNavigator:function(){this.thumbsView||(this.thumbsView=this.model.viewHandler.getNavigatorView({model:this.model,master:!1,editable:!1,viewLoadedCb:this.thumbsViewLoaded}),this.thumbsView&&this.thumbsView.initializeView({container:e("#thumbs-area",this.$el)}))},makeThumbsViewResizable:function(){n(r.OIT_LOGGER).debug("adding collapsable resizer");var i=e("#thumbs-area",this.$el),o=this;i.collapsableresizer({handles:"e",minWidth:this.minNavWidth,maxWidth:this.maxNavWidth,autoHide:!0,collapsed:!this.options.thumbnails.expand,collapse:e.proxy(this.refresh,this),expand:e.proxy(this.refresh,this),resize:function(e,i){o.navAreaWidth=i.size.width,t.throttle(o.thumbsView.handleThumbsPageChanged,50)}});var s=e(".ui-resizable-handle",i);s&&s.length>0&&(this.resizerMargin=parseInt(s.css("margin-left"),10)+s.width())},thumbsViewLoaded:function(){this.makeThumbsViewResizable(),this.updateLayout(),this.listenTo(this.thumbsView,"zoom",this.handleThumbsZoomChanged),this.thumbsView.zoom("pagewidth")},viewedAreaChanged:function(e){e||(e=this.model.viewHandler.getScrollRegion()),e&&this.thumbsView&&this.thumbsView.isVisible()&&this.thumbsView.renderViewPort(e),this.zoomModeChanged()},handlePageAdded:function(){this.$el.attr("aria-label",this.getAriaLabel()),!this.thumbsView&&!this.options.thumbnails.hide&&this.pagesView&&this.pagesView.isNavigableDocument()&&this.createNavigator()},handleThumbsZoomChanged:function(){this.viewedAreaChanged()},zoomChanged:function(){if(this.pagesView&&this.model.viewHandler.isZoomMode(r.ZoomMode.ZOOM_TO_VALUE)){var e=this.model.viewHandler.get("zoomValue");e=e?e/100:1,this.pagesView.zoom(e)}},zoomModeChanged:function(){if(this.pagesView)if(this.model.viewHandler.isZoomMode(r.ZoomMode.FIT_WIDTH))this.pagesView.zoom(this.fit_width);else if(this.model.viewHandler.isZoomMode(r.ZoomMode.FIT_BEST))this.pagesView.zoom(this.fit_best);else if(this.model.viewHandler.isZoomMode(r.ZoomMode.ZOOM_TO_VALUE)){var e=this.model.viewHandler.get("zoomValue");e=e?e/100:1,this.pagesView.zoom(e)}else this.pagesView.zoom(1)},pagesZoomed:function(e){this.model.viewHandler.pagesZoomed(e),this.viewedAreaChanged()},getAriaLabel:function(){var e=this.pagesView.getPageCount(),t=1===e;return t?docs.i18n.t("VIEWER_DOC_DESC_COMPLETE_SINGLE"):docs.i18n.t("VIEWER_DOC_DESC_COMPLETE",e)},remove:function(){if(n(r.OIT_LOGGER).debug("remove view"),this.pagesView&&(this.pagesView.remove(),delete this.pagesView),this.thumbsView){var t=e("thumbs-area",this.$el);if(t){t.data("ui-collapsableresizer")&&t.collapsableresizer("destroy");var o=e(".document-frame",t);o&&o.off()}this.thumbsView.remove(),delete this.thumbsView}i.View.prototype.remove.call(this)}}),docs.views.HTML5Viewer})),define("docs/fileview/model/OITPageModel",["jquery","underscore","backbone"],(function(e,t,i){"use strict";return docs.models.OITPageModel=i.Model.extend({initialize:function(e,t){this.OIT=t.OIT},getPageName:function(){return this.OIT.pages.pageName(this.get("page"))},getPageCount:function(){return this.OIT.pages.count()}}),docs.models.OITPageModel})),define("docs/fileview/view/OITDocumentView",["jquery","underscore","backbone","core/util/Browser","core/util/Constants","core/util/Globals","core/util/Logger","docs/fileview/model/OITAnnotation","docs/fileview/model/OITPageModel","docs/fileview/view/AnnotationsViewMixin"],(function(e,t,i){"use strict";var o=docs.common.Constants.Viewer,n=docs.common.Constants.oit.highlight,s=docs.common.Globals.staticRoot+"gemini-oit-"+docs.common.Globals.cacheId+".css",a=docs.common.Globals.staticRoot+"libs/jquery-ui.css";return docs.views.OITDocumentView=i.View.extend(t.extend({tagName:"iframe",logPrefix:"",oitLogger:docs.common.Logger(docs.common.Constants.Viewer.OIT_LOGGER),initialize:function(e){this.isMasterView=!t.isUndefined(e.master)&&e.master,this.oitLogger.debug(this._getLogText("initialize")),t.bindAll(this,"onLoad","pageAdded","handleOITError","documentLoaded","documentUnloaded","documentDone","documentZoom","documentSelection","docOptionsChanged","highlightsAdd","highlightsClick","highlightsActivate","highlightsMove","highlightsRemove","attachmentsClick","hideContextMenu"),this.viewNotLoaded=!0,this.eventListeners=[],this.pageViews=[],this.definedStamps=[],this.annotationMixinInitialize(e)},initializeView:function(e){var t=this;this.model.viewHandler.getDocumentURL().done((function(i){t.$el.on("load",t.onLoad),t.$el.attr("src",i),e&&e.container&&e.container.html(t.$el),t.annotationMixinInitializeView()})).fail((function(e){"image"!==e&&console.log("getDocumentURL failed",e)}))},onLoad:function(i){if(t.isUndefined(i))i=1;else if(i>10)return void this.oitLogger.error("frame loaded",i);this.oitLogger.trace("frame loaded",i);var o=this.$el[0];if(o.contentWindow&&o.contentWindow.OIT){var n=this.$el.contents().find("head");if(!n.data("view-init")){(!this.options.disableFind&&docs.common.checkFeatureFlag("HTML5Find")||docs.common.checkFeatureFlag("HTML5MobileNav")||docs.common.checkFeatureFlag("HTML5SinglePageMode"))&&(n.append('<link rel="stylesheet" href="'+a+'" />'),n.append('<link rel="stylesheet" href="'+s+'" />'));var r="<style>";r+=".fullscreenMode.oit-pagestream {background-color: #fcfbfa !important}",r+=".oit-view-root.pages-view .oit-pagestream {background-color: "+(this.options.pagestreamBackground?this.options.pagestreamBackground:"transparent")+"}",r+=".oit-view-root.pages-view .oit-page {box-shadow: none}",r+=".oit-view-root.pages-view .oit-bitmap {box-shadow: none}",r+=".oit-view-root.pages-view .oit-slide {box-shadow: none}",r+=".oit-view-root.pages-view .oit-drawing {box-shadow: none}",r+=".oit-highlight-style[style*='.svg'] {z-index: 5}",e(r+="</style>").appendTo(n),n.data("view-init",!0);var d=this.model.viewHandler.item.getAllowedActions();d.fileRead||d.fileWrite||e('<style id="noprint">@media print { .pages-view { display: none; } }</style>').appendTo(n),this.container=o,this.OIT=o.contentWindow.OIT,this.oitViewRoot=e(".oit-view-root",this.$el.contents()),this.pagesContent=this.oitViewRoot,this.addEventListener("document","optionschanged",this.docOptionsChanged),this.setOITOptions(),this.addEventListener("document","error",this.handleOITError),this.addEventListener("document","load",this.documentLoaded),this.addEventListener("document","unload",this.documentUnloaded),this.addEventListener("document","done",this.documentDone),this.addEventListener("pages","add",this.pageAdded),this.addEventListener("document","zoom",this.documentZoom),this.addEventListener("document","keydown",this.handleKeydown),this.addEventListener("attachments","click",this.attachmentsClick),this.addEventListener("document","select",this.documentSelection),this.isMobileBrowser()||this.isSafariWithTouchSupport()?this.addEventListener("highlights","touchend",this.highlightsClick):this.addEventListener("highlights","mouseup",this.highlightsClick),this.isMasterView&&(this.addEventListener("highlights","add",this.highlightsAdd),this.addEventListener("highlights","remove",this.highlightsRemove),this.addEventListener("highlights","move",this.highlightsMove),this.definePointerStamps()),e(this.$el.contents()).on("contextmenu",this.hideContextMenu)}}else t.delay(this.onLoad,50,i++)},setOITOptions:function(){var e=this.getOITOptions();this.OIT.document.setOptions(e)},getOITOptions:function(){return{contentTimeout:6e4,highlightActivationBoxColor:null}},viewLoaded:function(){this.options.viewLoadedCb&&this.options.viewLoadedCb(),this.oitViewRoot.find(".oit-view").focus()},viewUnloaded:function(){},addEventListener:function(e,t,i){this.OIT&&this.OIT[e]&&(this.OIT[e].addEventListener(t,i),this.eventListeners.push({category:e,name:t,fn:i}))},removeEventListener:function(e,i,o){this._removeEventListener(e,i,o),this.eventListeners=t.without(this.eventListeners,{category:e,name:i,fn:o})},_removeEventListener:function(e,t,i){this.OIT&&this.OIT[e]&&this.OIT[e].removeEventListener(t,i)},handleOITError:function(e){this.oitLogger.error("OIT Error",e)},documentLoaded:function(e){if(this.isDocumentLoaded&&(this.oitLogger.warn(this._getDocLogText("view already loaded")),this.documentUnloaded()),this.oitLogger.debug(this._getDocLogText("loaded")),this.isMasterView){var t=this.OIT.view.info();this.oitLogger.debug(e.detail,"version: "+t.version+"\nlib ver: "+t.libversion)}this.viewLoaded(),this.setSelectionStyle(),delete this.viewNotLoaded,this.isDocumentLoaded=!0},documentUnloaded:function(){this.oitLogger.debug(this._getDocLogText("unloaded")),this.viewUnloaded(),delete this.isDocumentLoaded},documentDone:function(e){this.oitLogger.debug(this._getDocLogText("done"),e.detail),this.removeEventListener("document","done",this.documentDone),this.isMasterView&&(this.oitLogger.debug(this._getDocLogText("features"),this.model.viewHandler.features),this.model.viewHandler.documentDone()),this.refreshAnnotations(),this.pendingScrollToChatId&&(this.scrollToAnnotation(this.pendingScrollToChatId),delete this.pendingScrollToChatId)},docOptionsChanged:function(e){this.oitLogger.debug(this._getDocLogText("options changed"),e.detail),e.detail.scrollMode&&(this.singleScrollMode="single"===e.detail.scrollMode)},pageAdded:function(t){this.oitLogger.debug(this._getPagesLogText("add"),"start:"+t.detail.startPage);for(var i=t.detail.startPage;i<this.OIT.pages.count();i++){var o,n=this.pageViews[i];if(!this.isMasterView&&n||(o=new docs.models.OITPageModel(this.OIT.pages.info(i),{OIT:this.OIT,singleScrollMode:this.singleScrollMode})),this.isMasterView&&this.model.viewHandler.addPage(o),!n){var s=e(e(".oit-section",this.pagesContent)[i]);n=this.createPageView({index:i,model:o,pageContent:s,hasCaptions:this.hasPageCaptions,OIT:this.OIT,docView:this,logPrefix:this.logPrefix}),this.pageViews[i]=n}}this.trigger("page added"),this.oitLogger.debug(this._getPagesLogText("add:complete"))},createPageView:function(){throw"Extending view must implement createPageView(options)"},getPageView:function(e){return this.pageViews[e]},nextPage:function(){this.OIT.pages.movetoNext()},prevPage:function(){this.OIT.pages.movetoPrev()},currentPage:function(){return this.OIT.pages.current()},moveToPage:function(e){this.oitLogger.debug("moveToPage",e),this.OIT.pages.moveto(e)},rotateLeft:function(){var e=this.OIT.document.rotate()+90;this.OIT.document.rotate(e),this.model.viewHandler.rotate(e)},rotateRight:function(){var e=this.OIT.document.rotate()-90;this.OIT.document.rotate(e),this.model.viewHandler.rotate(e)},zoom:function(e){this.oitLogger.trace(this._getDocLogText("zoom"),e),delete this.desiredZoomMode,this.OIT.document.zoom(this.fixedZoomMode||e)},getPageCount:function(){return this.OIT.pages.count()},getPages:function(){return this.model.viewHandler.getPages()},isSlideshowMode:function(){return!!this.slideshowMode},isMobileBrowser:function(){if(docs.common.Browser.isIOS||docs.common.Browser.isAndroid)return!0},isSafariWithTouchSupport:function(){if(docs.common.Browser.isSafari&&docs.common.Browser.supportsTouchEvents())return!0},isNavigableDocument:function(){if(docs.common.checkFeatureFlag("HTML5SinglePageMode")||this.isMobileBrowser()&&this.options.mobileNav())return!1;var e=this.OIT.pages.info(0);if(e)if(this.OIT.pages.count()>1)switch(e.type){case"bitmap":case"page":case"drawing":case"slide":case"chart":return!0;case"worksheet":return docs.common.checkFeatureFlag("HTML5WorksheetNav");case"email":return!1}else if("worksheet"===e.type)return docs.common.checkFeatureFlag("HTML5WorksheetNav");return!1},isVisible:function(){return e(this.oitViewRoot).is(":visible")},documentZoom:function(e){if(this.oitLogger.debug(this._getDocLogText("zoom"),e.detail.zoom,e.detail.mode),t.each(this.pageViews,(function(t){t.adjustForZoom(e.detail)})),e.detail){if(e.detail.mode&&"pagewidth"===e.detail.mode){this.zoomHistory||(this.zoomHistory=[],delete this.desiredZoomMode),this.oitLogger.trace(this._getDocLogText("zoom history"),this.zoomHistory);var i=this.OIT.document.zoom(),o=t.findWhere(this.zoomHistory,{zoom:i});if(o){if(o.count=o.count+1,o.count>2){if(2===this.zoomHistory.length){this.desiredZoomMode={mode:e.detail.mode,count:0};var n=this;t.defer((function(){n.oitLogger.trace(n._getDocLogText("setting fixed zoom"),i),n.OIT.document.zoom(i)}))}delete this.zoomHistory}}else this.zoomHistory.push({zoom:i,count:1,mode:e.detail.mode})}}else delete this.desiredZoomMode,this.OIT.view.fitToContainer();this.trigger("zoom",e.detail)},setWidth:function(t){e(this.container).width(t),this.OIT.view.fitToContainer()},definePointerStamps:function(){var e={sizing:"scale",opacity:1,defaultSize:n.avatar.stamp.pointer.size};t.each(n.avatar.stamp.images,(function(t,i){this.oitLogger.trace("defining stamp",i,t,e),this.OIT.highlights.defineStamp(i,docs.common.Globals.staticRoot+"images/css/"+t,e)}),this)},scrollAnnotationIntoView:function(e){this.oitLogger.debug(this._getLogText("scrollIntoView"),e.attributes,"current "+this.OIT.highlights.current(),"active "+this.OIT.highlights.active());var t=e.get("context")-1;this.currentPage()!==t&&this.moveToPage(t)},annotationModeOn:function(e){this.oitLogger.debug("annotatonModeOn",e),this.clearSelection(),this.setAnnotationMode(e),this.OIT.highlights.autoHighlight("selection",{style:n.style.placeholder,sticky:!0,properties:this.getPlaceholderAnnotationProps(o.AnnotationType.RECTANGLE)})},setAnnotationMode:function(e){this.initialSelectionMode||(this.initialSelectionMode=this.OIT.document.selectionMode(),this.OIT.document.setOptions({highlightActivationBoxColor:n.style.activationColor}),this.oitLogger.debug("saving selection mode",this.initialSelectionMode)),t.isBoolean(e)&&(this.annotationMode=e,this.model.viewHandler.hasFeature("cellselection")?this.OIT.document.selectionMode("cell"):this.OIT.document.selectionMode("rect"))},annotationModeOff:function(){this.oitLogger.debug("annotationModeOff"),delete this.annotationMode,this.OIT.highlights.autoHighlight(!1),this.initialSelectionMode&&(this.OIT.document.setOptions({highlightActivationBoxColor:null}),this.oitLogger.debug("restoring selection mode",this.initialSelectionMode),this.OIT.document.selectionMode(this.initialSelectionMode),delete this.initialSelectionMode,this.setSelectionStyle())},removeAnnotations:function(){this.isMasterView&&this.removeEventListener("highlights","remove",this.highlightsRemove);try{this.OIT&&this.OIT.highlights&&(t.each(this.pageViews,(function(e){e.removeAnnotations()})),this.OIT.highlights.clear())}catch(e){console.log(e.toString())}finally{this.isMasterView&&this.addEventListener("highlights","remove",this.highlightsRemove)}},setSelectionStyle:function(){switch(this.OIT.document.selectionMode()){case"rect":case"cell":this.OIT.document.selectionStyle(n.style.selection);break;default:this.OIT.document.selectionStyle(null)}},getPlaceholderAnnotationProps:function(e){var t={placeholder:!0};return e&&(t.a8nType=e),t},clearSelection:function(){this.OIT.document.select(null,!1)},highlightsAdd:function(e){this.oitLogger.trace("highlightsAdd",e.detail);var t=e.detail.highlightid,i=this.OIT.highlights.properties(t);i&&i.isMoved?this.processMovedAnnotation(t):i&&i.placeholder&&this.processPlaceholderAnnotation(t)},processMovedAnnotation:function(e){this.oitLogger.debug("process moved",e),this.OIT.highlights.property(e,"isMoved",null)},processPlaceholderAnnotation:function(e){this.model.viewHandler.deleteUncommittedAnnotations();var i=this.getDeviceIndependentRange(e),o=this.OIT.pages.info(i.page);this.oitLogger.debug("process placeholder",e,"range",i);var n={highlightid:e,context:i.page+1,type:this.OIT.highlights.property(e,"type")||"oit"};t.defer(t.bind((function(){this.model.viewHandler.addAnnotation(n,i,o)}),this)),docs.events.trigger("viewer:start:annotation"),this.annotationMode&&this.annotationModeOn(this.annotationMode)},getDeviceIndependentRange:function(e){var t=this.OIT.highlights.getJSON(e),i=JSON.parse(t).range;return i=docs.models.OITAnnotation.convertDimensionsToTwips(i)},highlightsRemove:function(e){this.oitLogger.trace("highlightsRemove",e.detail);var i=e.detail.highlightid,o=this.OIT.highlights.properties(i);if(o&&o.placeholder&&o.isMain&&!o.isMoved){var n=this.model.viewHandler.getFilteredAnnotations({id:o.annotid});1===n.length&&t.defer(t.bind((function(e){this.model.viewHandler.removeAnnotation(e),this.model.viewHandler.setAnnotationMode(!1)}),this,n[0]))}},highlightsActivate:function(e){this.oitLogger.debug(this._getHighlightsLogText("activate"),e.detail,"props:"+this._getHighlightProperties(e.detail.highlightid),"current "+this.OIT.highlights.current(),"active "+this.OIT.highlights.active())},_getHighlightProperties:function(e){var i={};return t.isNumber(e)&&(i=this.OIT.highlights.properties(e)),i},triggerActivate:function(e){if(this.userclick&&t.isNumber(e)){var i=this.OIT.highlights.properties(e);if(i)if(i.placeholder)t.noop();else if(i.annotid){var o=this.model.viewHandler.getFilteredAnnotations({id:i.annotid});if(1===o.length){this.oitLogger.debug(this._getHighlightsLogText("trigger"),i.annotid);var n=o[0];this.isMasterView&&(n.originalHighlight=i.isMain?e:i.a8nh7t),docs.events.trigger("viewer:annotationActivated",n)}}}delete this.userclick},highlightsClick:function(e){this.oitLogger.debug(this._getHighlightsLogText("highlight clicked"),e.detail,e.type,"current "+this.OIT.highlights.current(),"active "+this.OIT.highlights.active()),this.userclick=!0,this.triggerActivate(e.detail.highlightid)},highlightsMove:function(e){this.oitLogger.debug(this._getHighlightsLogText("move"),e.detail);var t=e.detail.highlightid,i=this.OIT.highlights.properties(t);if(i&&i.annotid){var o=this.getDeviceIndependentRange(t),n=this.OIT.pages.info(o.page),s=this.model.viewHandler.getFilteredAnnotations({id:i.annotid});this.oitLogger.debug(this._getHighlightsLogText("updating annotation"),i.annotid,o,n),this.OIT.highlights.property(t,"triggeredmove",!0),this.model.viewHandler.updateAnnotation(s[0],o,n)}},attachmentsClick:function(e){this.oitLogger.debug(this._getAttachmentsLogText("click"),e.detail)},documentSelection:function(e){var i;if(this.annotationMode){if(t.isBoolean(this.annotationMode))if(e.detail.empty&&t.isNull(e.detail.selection))t.noop();else if(e.detail.empty&&t.isObject(e.detail.selection)&&"rect"===e.detail.selection.type){var o=(i=e.detail.selection).right-i.left,s=i.bottom-i.top;t.isUndefined(e.detail.highlightid)&&0===o&&0===s?(this.oitLogger.debug("documentSelection:pushpin",e.detail),this.OIT.highlights.add(n.style.placeholder,i,this.getPlaceholderAnnotationProps(docs.models.OITAnnotation.TYPE_OIT_PIN))):this.oitLogger.debug("documentSelection:something else clicked",e.detail)}else e.detail.empty&&t.isObject(e.detail.selection)&&"cell"===e.detail.selection.type?(i=e.detail.selection,this.oitLogger.debug("documentSelection:singlecell",e.detail),this.OIT.highlights.add(n.style.placeholder,i,this.getPlaceholderAnnotationProps(docs.models.OITAnnotation.TYPE_OIT_CELL))):this.oitLogger.debug("documentSelectionrectangle",e.detail)}else this.handleDocumentSelection(e)},handleDocumentSelection:function(e){this.oitLogger.debug("handleDocumentSelection",e.detail)},handleKeydown:function(t){var i=e.Event("keypress"),o=t.detail.srcEvent;!o.shiftKey&&o.keyCode>=65&&o.keyCode<=90?(i.keyCode=o.keyCode+32,i.which=o.which+32):(i.keyCode=o.keyCode,i.which=o.which),window.parent.$(window.parent.document.body).trigger(i)},hasStamp:function(e){return t.indexOf(this.definedStamps,e)>=0},addStamp:function(e){this.hasStamp(e)||this.definedStamps.push(e)},_getLogText:function(e){return this.logPrefix+e},_getDocLogText:function(e){return this._getLogText("document:")+e},_getPagesLogText:function(e){return this._getLogText("pages:")+e},_getHighlightsLogText:function(e){return this._getLogText("highlights:")+e},_getAttachmentsLogText:function(e){return this._getLogText("attachments:")+e},hideContextMenu:function(){var e=this.model.viewHandler.item.getAllowedActions();if(!e.fileRead&&!e.fileWrite)return!1},getElementDimensions:function(e,t){if(e&&0!==e.length){var i=e.offset();return i.width=e.width(),i.height=t?e.outerHeight():e.height(),i}},remove:function(){e(this.$el.contents()).off("contextmenu",this.hideContextMenu),this.annotationMixinCleanView(),this.OIT&&(t.each(this.eventListeners,(function(e){this._removeEventListener(e.category,e.name,e.fn)}),this),delete this.eventListeners),t.each(this.pageViews,(function(e){e.remove()})),delete this.pageViews,delete this.definedStamps,this.$el.off(),i.View.prototype.remove.call(this)}},docs.views.AnnotationsViewMixin)),docs.views.OITDocumentView})),define("docs/fileview/template/OITFindBar.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="mainViewFindBar">',obj.displayShowCells&&(__p+='<div class="displayOptionButtons">    <button type="button" id="" class="secondary short showHiddenBtn" title="'+(null==(__t=osn.i18n.t("showHiddenText"))?"":_.escape(__t))+'"            aria-label="'+(null==(__t=osn.i18n.t("showHiddenText"))?"":_.escape(__t))+'">      <span class="icon"></span>    </button></div>'),__p+='<div class="findButtons">    <label class="findLabel" for="findWithText">'+(null==(__t=osn.i18n.t("find"))?"":_.escape(__t))+':</label>    <button type="button" id="" class="secondary short findBtn" title="'+(null==(__t=osn.i18n.t("findWithText"))?"":_.escape(__t))+'"            '+(null==(__t=obj.mode?"":"disabled")?"":_.escape(__t))+'            aria-label="'+(null==(__t=osn.i18n.t("findWithText"))?"":_.escape(__t))+'">      <span class="icon"></span>    </button></div><div id="searchWidget" class="searchWide ui-helper-hidden"></div><div class="stepperContainer">    <div class="counter"><span class="text"></span></div>    <div class="stepper">        <button type="button" class="stepup" title="'+(null==(__t=osn.i18n.t("findStepUp"))?"":_.escape(__t))+'" aria-label="'+(null==(__t=osn.i18n.t("findStepUp"))?"":_.escape(__t))+'" disabled tabindex="0">            <span class="stepup"></span>        </button>    </div>    <div class="stepper">        <button type="button" class="stepdown" title="'+(null==(__t=osn.i18n.t("findStepDown"))?"":_.escape(__t))+'" aria-label="'+(null==(__t=osn.i18n.t("findStepDown"))?"":_.escape(__t))+'" disabled tabindex="0">            <span class="stepdown"></span>        </button>    </div></div><div class="clear"></div></div>';return __p}})),define("docs/fileview/model/OITFindBarModel",["jquery","underscore","backbone","core/util/Constants","core/util/Logger"],(function(e,t,i){"use strict";var o=docs.common.Constants.Viewer,n=docs.common.Constants.oit.highlight;return docs.models.OITFindBarModel=i.Model.extend({defaults:{mode:"none",showHidden:!1,caseSensitive:!1},initialize:function(e){t.bindAll(this,"searchPhraseFound","highlightChanged"),this.OIT=e.OIT,this.hitRanges=[],this.maxHits=e&&e.maxHits?e.maxHits:100,this.changeMode(this.get("mode")),this.OIT.highlights.addEventListener("activate",this.highlightChanged)},changeMode:function(e){docs.common.Logger(o.OIT_LOGGER).debug("Changing model to "+e),this.set("mode",e),this.clearAll()},find:function(t){t=e.trim(t),this.clearFind(),t.length&&(this.clearStepper(),this.clearHighlights(),this.set({searchTerm:t,status:"searching"}),this.OIT.document.highlight(t,n.style.find,this.searchPhraseFound,this.get("caseSensitive"),{isFindResult:!0}))},searchPhraseFound:function(e,i){if(e){if(docs.common.Logger(o.OIT_LOGGER).trace("phrase found",e,i),this.OIT.highlights.setOptions(i,{enableUserDelete:!1,enableUserMove:!1,enableUserResize:!1,enableUserComment:!1}),this.hitRanges.push({range:e,id:i}),this.set("totalSteps",this.hitRanges.length),this.hitRanges.length>this.maxHits)return docs.common.Logger(o.OIT_LOGGER).debug("too many hits - stopping"),this.set("status","too_many_hits"),this.stepFirst(),!1}else docs.common.Logger(o.OIT_LOGGER).debug("finished search"),t.isEmpty(this.hitRanges)?this.set("status","no_hits"):(this.set("status","idle"),this.stepFirst())},clearFind:function(){this.unset("searchTerm"),this.unset("status"),this.unset("totalSteps"),this.hitRanges=[],this.clearStepper(),this.clearHighlights()},clearStepper:function(){this.unset("step"),this.unset("stepDirection"),this.unset("stepMessageId"),this.unset("moreAbove"),this.unset("moreBelow")},clearAll:function(){this.clearFind()},clearHighlights:function(){this.OIT.highlights.clear(this.findHighlightFilter)},findHighlightFilter:function(e,t){return t.isFindResult},stepFirst:function(){if(this.hitRanges.length>0){var e=t.first(this.hitRanges).id;this.moveToHighlight(e,"down")}},stepUp:function(){var e,t=!0,i=this.currentIndex-1;return i<0&&(i=0,t=!1),e=this.hitRanges[i].id,this.moveToHighlight(e,"up"),t},stepDown:function(){var e,t=!0,i=this.currentIndex+1;return i>=this.hitRanges.length&&(i=this.currentIndex,t=!1),e=this.hitRanges[i].id,this.moveToHighlight(e,"down"),t},moveToHighlight:function(e,i){docs.common.Logger(o.OIT_LOGGER).debug("step "+i,e),t.isNumber(this.currentIndex)&&this.OIT.highlights.style(this.hitRanges[this.currentIndex].id,n.style.find),this.updateStepperAttributes(e,i),this.OIT.highlights.moveto(e),this.OIT.highlights.activate(e)},updateStepperAttributes:function(e,t){this.currentIndex=docs.models.OITFindBarModel.findIndex(this.hitRanges,{id:e});var i={step:this.currentIndex,moreAbove:this.currentIndex>0,moreBelow:this.currentIndex<this.hitRanges.length-1};t&&(i.stepDirection=t),this.set(i)},highlightChanged:function(e){docs.common.Logger(o.OIT_LOGGER).debug("highlightChanged",e.detail);var i=e.detail.highlightid;if(t.isNumber(i)&&!e.detail.before&&!e.detail.after){var s=this.OIT.highlights.properties(i);s&&s.isFindResult&&(this.OIT.highlights.style(i,n.style.find_selected),this.updateStepperAttributes(i))}},clean:function(){this.OIT.highlights.removeEventListener("activate",this.highlightChanged)}},{findIndex:function(e,i){for(var o=0;o<e.length;){if(t.iteratee(i)(e[o]))return o;o+=1}return-1}}),docs.models.OITFindBarModel})),define("docs/fileview/view/OITFindBarView",["jquery","underscore","backbone","docs/fileview/template/OITFindBar.template","core/util/Constants","core/util/Logger","docs/fileview/model/OITFindBarModel"],(function(e,t,i,o){"use strict";var n=docs.common.Constants.Viewer;return docs.views.OITFindBarView=i.View.extend({className:"gem-oit-addon",attributes:function(){return{"aria-label":osn.i18n.t("findToolbarAriaLabel"),role:"toolbar"}},events:{"click .findBtn":"handleClickFindButton","click .showHiddenBtn":"handleClickShowHiddenButton","click button.stepup":"handleClickStepupButton","click button.stepdown":"handleClickStepdownButton",keydown:"handleKeydown"},initialize:function(){docs.common.Logger(n.OIT_LOGGER).debug("initializing view"),t.bindAll(this,"handleSearch","handleClearSearch","disableSteppers"),this.model=new docs.models.OITFindBarModel({OIT:this.options.OIT,maxHits:9999}),this.listenTo(this.model,"change:mode",this.handleModeChange),this.listenTo(this.model,"change:step",this.handleStepChange),this.listenTo(this.model,"change:totalSteps",this.handleTotalStepsChange),this.listenTo(this.model,"change:moreAbove",this.handleMoreAboveChange),this.listenTo(this.model,"change:moreBelow",this.handleMoreBelowChange),this.listenTo(this.model,"change:showHidden",this.updateShowHiddenBtn),this.listenTo(this.model,"change:status",this.handleStatusChange),this.listenTo(osn.events,"resize",this.resize),this.searchBoxView=new osn.views.SearchBoxView({placeholderText:osn.i18n.t("enterSearchText"),fieldId:"oitFindBarSearch",autofocus:!0,shortHeight:!0,searchFn:this.handleSearch,clearFn:this.handleClearSearch}),this.render()},render:function(){docs.common.Logger(n.OIT_LOGGER).debug("render view");var e=o(t.extend(this.model.toJSON(),this.options));return this.$el.html(e),this.$("#searchWidget").append(this.searchBoxView.render().el),this.model.has("mode")&&this.handleModeChange(),this},resize:function(){docs.common.Logger(n.OIT_LOGGER).debug("resize handler");var e=this.$("#searchWidget");"find"===this.model.get("mode")?this.calculateAvailWidth()<300?(this.$el.addClass("findBarStacked"),e.removeClass("searchWide").addClass("searchNarrow")):(this.$el.removeClass("findBarStacked"),e.removeClass("searchNarrow").addClass("searchWide")):this.$el.removeClass("findBarStacked"),this.trigger("resize")},calculateAvailWidth:function(){return this.$el.width()-this.$(".displayOptionButtons").outerWidth()-this.$(".findButtons").outerWidth()-this.$(".stepperContainer").outerWidth()},isStacked:function(){return this.$el.is(".findBarStacked")},handleSearch:function(){var e=this.$(".osn-search-input").val();this.model.find(e)},handleStatusChange:function(e,t){switch(docs.common.Logger(n.OIT_LOGGER).debug("handling model status change",t),t){case"no_hits":this.trigger("toast",{content:osn.i18n.t("findSearchNoResults")});break;case"too_many_hits":this.trigger("toast",{content:osn.i18n.t("findSearchTooManyResults")})}},handleClearSearch:function(){this.model.clearFind()},handleModeChange:function(){docs.common.Logger(n.OIT_LOGGER).debug("handling model mode change"),this.updateFindBtn(),this.updateSearchBox(),this.enableButton("findBtn",!0),this.updateStepperArrows()},handleHiddenChanged:function(){docs.common.Logger(n.OIT_LOGGER).debug("handling hidden change"),this.updateShowHiddenBtn()},handleMoreAboveChange:function(){this.updateStepperArrows()},handleMoreBelowChange:function(){this.updateStepperArrows()},updateHitsCounter:function(){var e,t=this.$(".counter").find("span.text");t.text(""),"find"===this.model.get("mode")&&this.model.has("totalSteps")&&this.model.has("step")&&(e=this.model.get("step")+1,t.text(e+"/"+this.model.get("totalSteps")),this.isStacked()||this.resize())},updateStepperArrows:function(){this.model.has("moreAbove")?this.enableStepUp(this.model.get("moreAbove")):this.enableStepUp(!!this.model.get("totalSteps")),this.model.has("moreBelow")?this.enableStepDown(this.model.get("moreBelow")):this.enableStepDown(!!this.model.get("totalSteps"))},enableStepUp:function(e){var t=this.steppersDisabled||!e;this.$("button.stepup").prop("disabled",t)},enableStepDown:function(e){var t=this.steppersDisabled||!e;this.$("button.stepdown").prop("disabled",t)},handleStepChange:function(){this.updateHitsCounter(),this.updateStepperArrows()},handleTotalStepsChange:function(){this.updateHitsCounter(),this.updateStepperArrows()},setButtonCounter:function(e,t){this.$("."+e).find("span.text").text(t)},enableButton:function(e,t){this.$("."+e).prop("disabled",!t)},updateFindBtn:function(){var e=this.$(".findBtn");"find"===this.model.get("mode")?(e.addClass("active"),e.attr("aria-pressed",!0)):(e.removeClass("active"),e.attr("aria-pressed",!1))},updateShowHiddenBtn:function(){var e,t=this.$(".showHiddenBtn");this.model.get("showHidden")?(e=osn.i18n.t("showHiddenText"),t.addClass("active"),t.attr("aria-pressed",!0),t.attr("title",e),t.attr("aria-label",e),this.trigger("showHidden",!0)):(e=osn.i18n.t("resetHiddenText"),t.removeClass("active"),t.attr("aria-pressed",!1),t.attr("title",e),t.attr("aria-label",e),this.trigger("showHidden",!1))},updateSearchBox:function(){var e=this.$("#searchWidget");"find"===this.model.get("mode")?(e.removeClass("ui-helper-hidden"),this.isStacked()||this.resize()):(e.addClass("ui-helper-hidden"),this.searchBoxView.clearText(),this.isStacked()&&this.resize())},handleClickFindButton:function(){docs.common.Logger(n.OIT_LOGGER).debug("Handling find button click"),"find"===this.model.get("mode")?this.model.changeMode("none"):(this.model.changeMode("find"),this.$("#oitFindBarSearch").focus())},handleClickShowHiddenButton:function(){docs.common.Logger(n.OIT_LOGGER).debug("Handling show hidden button click"),this.model.get("showHidden")?this.model.set("showHidden",!1):this.model.set("showHidden",!0)},handleClickStepupButton:function(){var e;docs.common.Logger(n.OIT_LOGGER).debug("Handling step up click"),this.model.stepUp()||(e="findStepperToastUp_"+this.model.get("mode"),osn.events.trigger("toast",{content:osn.i18n.t(e)}))},handleClickStepdownButton:function(){var e;docs.common.Logger(n.OIT_LOGGER).debug("Handling step down click"),this.model.stepDown()||(e="findStepperToastDown_"+this.model.get("mode"),osn.events.trigger("toast",{content:osn.i18n.t(e)}))},handleKeydown:function(t){t.shiftKey||t.keyCode!==e.ui.keyCode.TAB||(osn.lastActiveElementInFindBarView=t.target)},disableSteppers:function(e){this.steppersDisabled=e,this.updateStepperArrows()},remove:function(){docs.common.Logger(n.OIT_LOGGER).debug("removing view"),this.model&&t.isFunction(this.model.clean)&&(this.model.clean(),delete this.model),this.searchBoxView&&this.searchBoxView.clean(),i.View.prototype.remove.call(this)}}),docs.views.OITFindBarView})),define("docs/fileview/view/OITPageView",["jquery","underscore","backbone","core/util/Constants","core/util/Logger","docs/fileview/model/Annotations","docs/fileview/view/OITDocumentView"],(function(e,t,i,o,n,s){"use strict";var a=o.Viewer;return docs.views.OITPageView=i.View.extend({contentWrapperClass:"gem-page-wrapper",initialize:function(i){this.logPrefix=this.options.logPrefix+this.cid+":",n(a.OIT_LOGGER).debug(this._getLogText("initializing")),t.bindAll(this,"pageClicked","pageFocused","pageBlurred"),this._viewPointers=[],this.index=i.index,this.viewHandler=i.viewHandler,i.singleScrollMode?this.pageContent=e():this.pageContent=i.pageContent,this.docView=i.docView,this.OIT=i.OIT,this.editable=!t.isBoolean(i.editable)||i.editable,this.showParticipants=!t.isBoolean(i.showParticipants)||i.showParticipants,this.hasCaptions=!i.singleScrollMode&&this.options.hasCaptions&&this.viewHandler.hasCaptions();var o=this.getContentWrapper();return o&&(o.on("click",this.pageClicked),o.on("focus",this.pageFocused),o.on("blur",this.pageBlurred),this.hasCaptions&&(this.listenTo(this.docView,"page added",this.addOrUpdatePageCaption),this.addOrUpdatePageCaption())),this},adjustForZoom:function(e){this.hasCaptions&&(this.updateCaptionZoom(e.zoom),this.updateElementTransformPosition(this.findPageCaption())),this.updateAnnotationPointers()},addOrUpdatePageCaption:function(){if(this.hasCaptions){var t=this.getContentWrapper(),i=this.OIT.pages.count(),o=this.findPageCaption();o&&0!==o.length||(o=e('<div class="page-caption" role="presentation" >'),t.append(o));var n=this.index+1;o.text(docs.i18n.t(this.options.captionTextKey,n,i)),this.updateElementTransformPosition(o),this.updateCaptionZoom()}},findPageCaption:function(){return this.hasCaptions?e(".page-caption",this.getContentWrapper()):e()},updateCaptionZoom:function(e){var i=e||this.OIT.document.zoom();t.isNumber(i)&&this.findPageCaption().css({"font-size":11/i+"px"})},renderAnnotations:function(){if(this.viewHandler.supportsAnnotations()){this.removeViews();var e=this.viewHandler.getFilteredAnnotations({context:this.model.get("page")+1});s.fetchA8NUserModels(e).done(t.bind((function(){t.each(e,(function(e){this.addCompatibleAnnotation(e)}),this)}),this))}},removeAnnotations:function(){this.removeViews()},updateAnnotationPointers:function(){if(n(a.OIT_LOGGER).trace(this._getLogText("updating views"),this._viewPointers),this._viewPointers){var e=t.filter(this._viewPointers,(function(e){return e.hasHighlight()})),i=t.difference(this._viewPointers,e);t.invoke(i,"remove"),this._viewPointers=e,t.isEmpty(this._viewPointers)||t.invoke(this._viewPointers,"moveAvatar")}},annotationAdded:function(e){e.get("context")-1===this.model.get("page")&&this.addCompatibleAnnotation(e)},addCompatibleAnnotation:function(e){this.viewHandler.isAnnotationCompatible(e)?require(["docs/fileview/view/OITAnnotationView"],t.bind((function(t){var i=new t({model:e,container:this,oit:this.OIT,logPrefix:this.options.logPrefix});this._viewPointers.push(i),n(a.OIT_LOGGER).trace(this._getLogText("adding view"),i.cid,this._viewPointers)}),this)):n(a.OIT_LOGGER).debug(this._getLogText("skipping annotation"),e.get("type"))},getContentWrapper:function(){if(this.hasCaptions&&this.pageContent.length>0){var e=this.pageContent.parent("."+this.contentWrapperClass);if(0===e.length){var t=this.model.get("width"),i=this.model.get("height")+(this.hasCaptions?230:0);this.pageContent.wrap('<div class="'+this.contentWrapperClass+'" style="position: relative; width: '+t+"px; height: "+i+'px;">'),e=this.pageContent.parent("."+this.contentWrapperClass)}return e}},removeContentWrapper:function(){this.hasCaptions&&this.pageContent.length>0&&(this.pageContent.parent("."+this.contentWrapperClass).off(),this.findPageCaption().remove(),this.pageContent.unwrap())},updateElementTransformPosition:function(e){if(e&&e.length>0&&this.pageContent.length>0){var t=this.getAStyle(this.pageContent[0],"transform");t.indexOf("matrix")>-1&&(t=(t=t.substring(7,t.length-1)).split(","),e.css({left:parseInt(t[4],10),top:parseInt(t[5],10)}))}},getAStyle:function(e,t){return window.getComputedStyle(e,null)[t]},pageClicked:function(){this.options.selectCb&&this.options.selectCb(this.index)},pageFocused:function(){this.pageContent.addClass("ui-state-focus")},pageBlurred:function(){this.pageContent.removeClass("ui-state-focus")},getZoomLevel:function(){return 100*this.pageContent.width()/this.model.get("width")},getPageSize:function(){return{width:this.model.get("width"),height:this.model.get("height")}},_getLogText:function(e){return this.logPrefix+e},removeViews:function(){n(a.OIT_LOGGER).debug(this._getLogText("removing views"),this._viewPointers),this._viewPointers&&!t.isEmpty(this._viewPointers)&&(t.invoke(this._viewPointers,"remove"),this._viewPointers=[])},remove:function(){n(a.OIT_LOGGER).debug(this._getLogText("removing")),this.removeContentWrapper(),this.removeViews(),i.View.prototype.remove.call(this)}}),docs.views.OITPageView})),define("docs/fileview/template/OITPageBar.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="viewerToolBar">    <div class="pageToolBar">    <form>        <select class="pageselect paging"></select>        <button type="button" class="pageup containerview-toolbar-button paging" title="'+(null==(__t=docs.i18n.t("VIEWER_PREV_PAGE"))?"":_.escape(__t))+'" aria-label="'+(null==(__t=docs.i18n.t("VIEWER_PREV_PAGE"))?"":_.escape(__t))+'"></button>        <button type="button" class="pagedown containerview-toolbar-button paging" title="'+(null==(__t=docs.i18n.t("VIEWER_NEXT_PAGE"))?"":_.escape(__t))+'" aria-label="'+(null==(__t=docs.i18n.t("VIEWER_NEXT_PAGE"))?"":_.escape(__t))+'"></button>        <button type="button" class="rotateleft containerview-toolbar-button rotation" title="'+(null==(__t=docs.i18n.t("VIEWER_ROTATE_LEFT"))?"":_.escape(__t))+'" aria-label="'+(null==(__t=docs.i18n.t("VIEWER_ROTATE_LEFT"))?"":_.escape(__t))+'" tabindex="0"></button>        <button type="button" class="rotateright containerview-toolbar-button rotation" title="'+(null==(__t=docs.i18n.t("VIEWER_ROTATE_RIGHT"))?"":_.escape(__t))+'" aria-label="'+(null==(__t=docs.i18n.t("VIEWER_ROTATE_RIGHT"))?"":_.escape(__t))+'" tabindex="0"></button>    </form>    </div></div>';return __p}})),define("docs/fileview/view/OITPageBarView",["jquery","underscore","backbone","docs/fileview/template/OITPageBar.template","core/util/Constants","core/util/Logger","jqueryui-amd/widgets/button"],(function(e,t,i,o){"use strict";var n=docs.common.Constants.Viewer;return docs.views.OITPageBarView=i.View.extend({className:"gem-oit-addon",attributes:function(){return{role:"toolbar"}},events:{"change select.pageselect":"handlePageSelectChange","click .pageup":"handleClickPageUpButton","click .pagedown":"handleClickPageDownButton","click .rotateleft":"handleClickRotateLeftButton","click .rotateright":"handleClickRotateRightButton",keydown:"handleKeydown"},initialize:function(){return docs.common.Logger(n.OIT_LOGGER).debug("initializing view"),this.listenTo(osn.events,"resize",this.resize),this.listenTo(this.options.documentView,"page added",this.updatePageSelector),this.render()},render:function(){docs.common.Logger(n.OIT_LOGGER).debug("render view");var i=o(t.extend({},this.options));return this.$el.html(i),this.$select=e("select.pageselect",this.$el),e(".containerview-toolbar-button.pageup",this.$el).button({text:!1,icons:{primary:"ui-icon-oit-page-up"}}),e(".containerview-toolbar-button.pagedown",this.$el).button({text:!1,icons:{primary:"ui-icon-oit-page-down"}}),e(".containerview-toolbar-button.rotateleft",this.$el).button({text:!1,icons:{primary:"ui-icon-oit-rotate-left"}}),e(".containerview-toolbar-button.rotateright",this.$el).button({text:!1,icons:{primary:"ui-icon-oit-rotate-right"}}),this},enableButton:function(t,i){e(t,this.$el).button(i?"enable":"disable")},resize:function(){docs.common.Logger(n.OIT_LOGGER).debug("resize handler"),this.trigger("resize")},calculateAvailWidth:function(){return this.$el.width()-this.$(".displayOptionButtons").outerWidth()-this.$(".findButtons").outerWidth()-this.$(".stepperContainer").outerWidth()},isStacked:function(){return this.$el.is(".findBarStacked")},updatePageSelector:function(){for(var t=this.options.documentView.getPages(),i=this.$select.children("option").length;i<t.length;i++){var o=t.at(i),n=e("<option>",{value:o.get("page"),text:o.getPageName()});this.$select.append(n)}},pageChanged:function(t){var i=this.options.documentView.getPages().at(t.detail.page?t.detail.page:0);e('select.pageselect option[value="'+i.get("page")+'"]',this.$el).prop("selected",!0);var o=t.detail.features?t.detail.features:i.get("features");this.pagerEnabled=!!o&&o.pages,this.pagerEnabled&&1===i.getPageCount()&&(this.pagerEnabled=!1),e(".paging",this.$el).toggle(this.pagerEnabled),this.pagerEnabled&&(this.enableButton(".pageup",!this.isFirstPage()),this.enableButton(".pagedown",!this.isLastPage()));var n=!!o&&o.rotate;e(".rotation",this.$el).toggle(n),this.enableButton(".rotateleft",n),this.enableButton(".rotateright",n)},handlePageSelectChange:function(e){docs.common.Logger(n.OIT_LOGGER).debug("Handling page selector change"),e&&e.stopPropagation(),this.options.documentView.moveToPage(parseInt(this.$select.val(),10))},handleClickPageUpButton:function(e){docs.common.Logger(n.OIT_LOGGER).debug("Handling page up click"),e&&e.stopPropagation(),this.options.documentView.prevPage()},handleClickPageDownButton:function(e){docs.common.Logger(n.OIT_LOGGER).debug("Handling page down click"),e&&e.stopPropagation(),this.options.documentView.nextPage()},handleClickRotateLeftButton:function(e){docs.common.Logger(n.OIT_LOGGER).debug("Handling rotate left click"),e&&e.stopPropagation(),this.options.documentView.rotateLeft()},handleClickRotateRightButton:function(e){docs.common.Logger(n.OIT_LOGGER).debug("Handling rotate right click"),e&&e.stopPropagation(),this.options.documentView.rotateRight()},handleKeydown:function(t){!t.shiftKey&&(t.keyCode,e.ui.keyCode.TAB)},isFirstPage:function(){if(this.options.documentView.isSlideshowMode()){for(var t=parseInt(this.$select.prop("selectedIndex"),10);t>0;t--){var i=parseInt(e(this.$select.children[t]).val(),10);if(!this.options.documentView.getPages().findWhere({page:i}).isHiddenFromSlideshow())return!1}return!0}return 0===parseInt(this.$select.val(),10)},isLastPage:function(){if(this.options.documentView.isSlideshowMode()){for(var t=this.$select.children("option"),i=parseInt(this.$select.prop("selectedIndex"),10)+1;i<t.length;i++){var o=parseInt(e(t[i]).val(),10);if(!this.options.documentView.getPages().findWhere({page:o}).isHiddenFromSlideshow())return!1}return!0}return parseInt(this.$select.val(),10)>=this.options.documentView.getPages().length-1},remove:function(){docs.common.Logger(n.OIT_LOGGER).debug("removing view"),i.View.prototype.remove.call(this)}}),docs.views.OITPageBarView})),define("docs/fileview/view/OITVerticalDocumentView",["jquery","underscore","core/util/Browser","core/util/Globals","docs/fileview/view/OITDocumentView","docs/fileview/view/OITFindBarView","docs/fileview/view/OITPageView","docs/fileview/view/OITPageBarView"],(function(e,t){"use strict";return docs.views.OITVerticalDocumentView=docs.views.OITDocumentView.extend({id:"pages-frame",className:"document-frame skipTarget",logPrefix:"main:",attributes:function(){return{tabindex:0,title:docs.i18n.t("VIEWER_FRAME_TITLE")}},pageBarLocation:"top",findBarLocation:"top",initialize:function(e){t.bindAll(this,"pageSelectionChanged","viewedAreaChanged","documentZoomed","handlePageAdded","handlePageChanged","hyperlinkClick","handleHiddenCells"),docs.views.OITDocumentView.prototype.initialize.call(this,e),this.model&&this.model.viewHandler&&this.listenTo(this.model.viewHandler,"change:selectedPage",this.pageSelectionChanged)},getOITOptions:function(){var e={};return this.isMobileBrowser()?this.options.mobileNav()?e.scrollMode="single":(e.scrollMode="vertical",e.nochrome=!1):docs.common.checkFeatureFlag("HTML5SinglePageMode")&&(e.scrollMode="single"),t.extend(docs.views.OITDocumentView.prototype.getOITOptions.call(this),e)},viewLoaded:function(){this.oitViewRoot.addClass("pages-view"),docs.views.OITDocumentView.prototype.viewLoaded.call(this),this.addEventListener("document","scroll",this.viewedAreaChanged),this.addEventListener("document","zoom",this.documentZoomed),this.addEventListener("pages","add",this.handlePageAdded),this.addEventListener("hyperlinks","click",this.hyperlinkClick),this.listenTo(docs.events,"viewer:annotationActivated",this.annotationActivated),this.listenTo(docs.events,"viewer:scrollToAnnotation",this.scrollToAnnotation),this.options.disableSelection&&this.OIT.document.selectionMode("none"),this.showPageBar()&&!this.oitPageBarView&&(this.oitPageBarView=new docs.views.OITPageBarView({documentView:this}),this.listenTo(this.oitPageBarView,"resize",this.resizePageBar),this.oitPageToolBarId=this.OIT.toolbars.add(this.pageBarLocation,this.oitPageBarView.el,{visible:!0}),this.addEventListener("pages","change",this.handlePageChanged),this.trigger("page added")),this.showFindBar()&&!this.oitFindBarView&&(this.oitFindBarView=new docs.views.OITFindBarView({OIT:this.OIT,displayShowCells:this.options.displayShowCells}),this.listenTo(this.oitFindBarView,"resize",this.resizeFindBar),this.listenTo(this.oitFindBarView,"showHidden",this.showHideCells),this.listenTo(this.oitFindBarView,"toast",this.handleToast),this.oitFindToolBarId=this.OIT.toolbars.add(this.findBarLocation,this.oitFindBarView.el,{visible:!0}))},viewUnloaded:function(){docs.views.OITDocumentView.prototype.viewUnloaded.call(this),this.deletePageToolbar(),this.deleteFindToolbar()},showPageBar:function(){if(this.isMobileBrowser()&&this.options.mobileNav()||docs.common.checkFeatureFlag("HTML5SinglePageMode")){var e=this.OIT.pages.info(0);if(e)switch(e.type){case"email":case"worksheet":return!1}return!0}return!1},showFindBar:function(){return!this.options.disableFind&&docs.common.checkFeatureFlag("HTML5Find")},createPageView:function(t){return new docs.views.OITPageView(e.extend(!0,t,{viewHandler:this.model.viewHandler,editable:this.editable}))},pageSelectionChanged:function(){var e=this.model.viewHandler.getSelectedPage();e>=0&&e<this.model.viewHandler.pageCount()&&this.moveToPage(e,0)},viewedAreaChanged:function(i){if(this.oitLogger.debug("viewedAreaChanged",i),t.defer(this.handleHiddenCells),i&&i.detail){var o={topLeft:t.clone(i.detail.viewUpperLeft),bottomRight:t.clone(i.detail.viewLowerRight),rotation:this.OIT.document.rotate()},n=["height","width"];o.topLeft.info=t.pick(this.OIT.pages.info(o.topLeft.pageIndex),n),o.bottomRight.info=t.pick(this.OIT.pages.info(o.bottomRight.pageIndex),n);var s=e(".oit-ssrowheader",this.oitViewRoot);if(s&&s.length>0){var a=s.position()?s.position().top:0,r=s.width()?s.width():0;o.topLeft.x+=r,o.topLeft.y+=a,o.bottomRight.x+=r,o.bottomRight.y+=a}this.oitLogger.debug(o),this.model.viewHandler.setScrollRegion(o),this.desiredZoomMode&&(this.desiredZoomMode.count>1?(this.oitLogger.debug("zoom to desired zoom mode",this.desiredZoomMode),this.zoom(this.desiredZoomMode.mode)):this.desiredZoomMode.count=this.desiredZoomMode.count+1),this.trigger("scroll",o)}},documentZoomed:function(e){this.oitLogger.debug("documentZoomed",e,this.OIT.document.zoom()),e.detail.mode&&"page"===e.detail.mode?this.oitViewRoot.addClass("fitpage"):this.oitViewRoot.removeClass("fitpage")},handlePageAdded:function(e){this.oitLogger.debug("handlePageAdded",e),this.trigger("pagesChanged",e)},handlePageChanged:function(e){e&&this.oitLogger.debug(this._getPagesLogText("change"),e.detail),this.oitPageBarView.pageChanged(e)},hyperlinkClick:function(e){if(this.oitLogger.debug("hyperlinkClick",e.detail),e.detail.external){e.preventDefault();var i=e.detail.url,o=docs.common.Browser.isMac;if(!o&&e.detail.srcEvent.ctrlKey||o&&e.detail.srcEvent.metaKey||e.detail.srcEvent.shiftKey)return void window.open(i,"_blank");if(0===i.indexOf(window.location.origin)){var n=i.substring(window.location.origin.length);if(this.oitLogger.debug("internal link",n),0===n.indexOf(docs.common.Globals.routerRoot)){if(t.find(docs.router.anchorPaths,(function(e){return 0===n.indexOf(docs.common.Globals.routerRoot+e)})))return void docs.router.handleAnchorHref(n);this.oitLogger.debug("not routable",n)}}0===i.toLowerCase().indexOf("mailto:")?(this.oitLogger.debug("loading new location",i),t.defer((function(){window.location=i}))):(this.oitLogger.debug("loading location in new window",i),t.defer((function(){window.open(i,"_blank")})))}else this.oitLogger.debug("viewer document link")},resizeFindBar:function(){this.OIT.toolbars.hide("top","auto")},showHideCells:function(e){this.hiddenCells=e,this.handleHiddenCells()},handleHiddenCells:function(){this.oitFindBarView&&(this.OIT.document.showHidden(this.hiddenCells?"all":"none"),this.model.viewHandler.showHiddenCells(this.hiddenCells))},handleToast:function(e){this.oitLogger.debug("handleToast",e)},resizePageBar:function(){this.OIT.toolbars.hide(this.pageBarLocation,"auto")},deletePageToolbar:function(){this.oitPageToolBarId&&(this.OIT.toolbars.remove(this.oitPageToolBarId),delete this.oitPageToolBarId),this.oitPageBarView&&(this.oitPageBarView.remove(),delete this.oitPageBarView)},deleteFindToolbar:function(){this.oitFindToolBarId&&(this.OIT.toolbars.remove(this.oitFindToolBarId),delete this.oitFindToolBarId),this.oitFindBarView&&(this.oitFindBarView.remove(),delete this.oitFindBarView,delete this.hiddenCells)},remove:function(){this.deletePageToolbar(),this.deleteFindToolbar(),docs.views.OITDocumentView.prototype.remove.call(this)}}),docs.views.OITVerticalDocumentView})),define("docs/fileview/view/OITVerticalThumbsView",["jquery","underscore","docs/fileview/view/OITDocumentView","docs/fileview/view/OITPageView"],(function(e,t){"use strict";return docs.views.OITVerticalThumbsView=docs.views.OITDocumentView.extend({id:"thumbs-frame",className:"document-frame",logPrefix:"nav:",attributes:function(){return{tabindex:0,title:docs.i18n.t("VIEWER_THUMBNAIL_FRAME_TITLE")}},fixedZoomMode:"pagewidth",hasPageCaptions:!0,initialize:function(e){t.bindAll(this,"thumbsZoomed","hyperlinkClick","handleThumbsPageChanged"),docs.views.OITDocumentView.prototype.initialize.call(this,e)},setWidth:function(e){docs.views.OITDocumentView.prototype.setWidth.call(this,e),this.OIT.document.zoom("pagewidth")},getOITOptions:function(){var e={};return this.isMobileBrowser()&&(e.scrollMode="vertical",e.nochrome=!1),t.extend(docs.views.OITDocumentView.prototype.getOITOptions.call(this),e)},viewLoaded:function(){this.oitViewRoot.addClass("nav-view"),this.$el.contents().find("head").append('<style type="text/css">.page-caption {position: relative; text-align: center; width: 100%;} \n.nav-view .oit-pagestream {background-color: #fff;} \n#view-port {position: absolute; background-color: transparent; border: none; z-index: 20; pointer-events: none;} \n#view-port-view-area {position: absolute; border: 2px solid #5f7d4f;} \n.view-port-filler {position: absolute; background-color: #e6e8e; opacity: 0.5;} \n#view-port-top-filler {top: 0; width: 100%;} \n#view-port-bottom-filler {bottom: 0; width: 100%;} \n#view-port-right-filler {right: 0;} \n#view-port-left-filler {left: 0;} \n</style>'),docs.views.OITDocumentView.prototype.viewLoaded.call(this),this.addEventListener("document","zoom",this.thumbsZoomed),this.addEventListener("pages","change",this.handleThumbsPageChanged),this.addEventListener("hyperlinks","click",this.hyperlinkClick),this.OIT.document.selectionMode("none"),e(".oit-tab-bar",this.oitViewRoot).hide(),this.listenTo(this.model.viewHandler,"showHiddenCells",this.showHiddenCells),this.listenTo(this.model.viewHandler,"rotate",this.handleRotation)},createPageView:function(t){return new docs.views.OITPageView(e.extend(!0,t,{viewHandler:this.model.viewHandler,editable:this.editable,captionTextKey:"VIEWER_THUMBNAIL_CAPTION_TEXT",selectCb:e.proxy(this.selectedThumbnail,this),showParticipants:!1}))},selectedThumbnail:function(e){this.oitLogger.debug("selectedThumbnail",e),this.model.viewHandler.setSelectedPage(e)},thumbsZoomed:function(e){this.oitLogger.debug("thumbsZoomed",e,this.OIT.document.zoom());var i=this;if(this.OIT.document.zoom()>=1)t.defer((function(){i.OIT.document.zoom(i.fixedZoomMode)}));else if(e.detail.mode&&"pagewidth"===e.detail.mode){this.zoomHistory||(this.zoomHistory=[]);var o=this.OIT.document.zoom(),n=t.findWhere(this.zoomHistory,{zoom:o});n?(n.count=n.count+1,n.count>2&&(2===this.zoomHistory.length?(delete this.zoomHistory,t.defer((function(){i.OIT.document.zoom(o)}))):delete this.zoomHistory)):this.zoomHistory.push({zoom:o,count:1})}this.trigger("zoom",e)},handleThumbsPageChanged:function(e){this.oitLogger.debug("handleThumbsPageChanged",e),this.options.singleImageNav&&this.OIT.document.zoom(1.1)},hyperlinkClick:function(e){e.preventDefault()},renderViewPort:function(t){if(t&&this.OIT.pages.count()>0){this.oitLogger.debug("renderViewPort","page",t.topLeft.pageIndex,"total pages",this.OIT.pages.count()),this.OIT.pages.moveto(t.topLeft.pageIndex);var i=e(".oit-section",this.oitViewRoot),o=t.topLeft.pageIndex,n=t.bottomRight.pageIndex,s=e(i[o]),a=e(i[n]);if(s&&a){var r=n===i.length-1&&t.bottomRight.y>=t.bottomRight.info.height,d=r&&this.pageViews[n]?this.pageViews[n].findPageCaption():void 0,l=this.OIT.document.zoom(),h=this.getElementDimensions(s),c=this.getElementDimensions(a),g=r&&d?this.getElementDimensions(d,!0):void 0,u=h.top+(t.topLeft.y<=0?0:t.topLeft.y*l),m=(r&&g?g.top+g.height*l:c.top+t.bottomRight.y*l)-u,p=h.left+(t.topLeft.x<=0?0:t.topLeft.x*l),v=c.left+t.bottomRight.x*l-p;v>c.width*l&&(v=c.width*l);var w=e(".oit-ssrowheader",this.oitViewRoot);w&&w.length>0&&(u+=w.position()?w.position().top:0,p+=w.width()?w.width():0);var f=e(".oit-view",this.oitViewRoot);f.data("viewport")||f.viewport({screenMode:!1}),f.viewport("update",f.scrollTop()+u,f.scrollLeft()+p,v,m,!0)}}},showHiddenCells:function(e){this.OIT.document.showHidden(e?"all":"none")},handleRotation:function(e){this.OIT.document.rotate(e)}}),docs.views.OITVerticalThumbsView})),define("docs/fileview/model/OITDocumentHandler",["jquery","backbone","underscore","core/util/Service","core/util/Jsonify","docs/fileview/model/Annotations","docs/fileview/model/ImageAnnotation","docs/fileview/model/OITAnnotation","docs/fileview/model/PagedDocumentHandler","docs/fileview/view/HTML5Viewer","docs/fileview/view/OITVerticalDocumentView","docs/fileview/view/OITVerticalThumbsView"],(function(e,t,i,o,n){"use strict";var s=docs.common.Constants.Viewer,a=docs.common.Constants;function r(){return docs.common.checkFeatureFlag("HTML5MobileNav")}var d={annotationTypes:[docs.models.OITAnnotation.TYPE_OIT_CELL],defaultZoom:s.ZoomMode.ZOOM_TO_VALUE,hasCaptions:!1,pageViewOptions:{displayShowCells:!0,mobileNav:r,pagestreamBackground:"transparent"},navViewOptions:{singleImageNav:!0}},l={annotationTypes:[docs.models.OITAnnotation.TYPE_OIT_RECT,docs.models.OITAnnotation.TYPE_OIT_PIN],defaultZoom:s.ZoomMode.DEFAULT_ZOOM_MODE,hasCaptions:!0,pageViewOptions:{displayShowCells:!1,mobileNav:r,pagestreamBackground:"#f5f4f2"},navViewOptions:{singleImageNav:!1}},h={annotationTypes:[docs.models.OITAnnotation.TYPE_OIT_RECT,docs.models.OITAnnotation.TYPE_OIT_PIN],defaultZoom:s.ZoomMode.FIT_BEST,hasCaptions:!0,pageViewOptions:{disableSelection:!0,disableFind:!0,displayShowCells:!1,mobileNav:r,pagestreamBackground:"transparent"},navViewOptions:{singleImageNav:!1}},c=i.extend({},i.object(a.oit.doctype.spreadsheet.extensions,i.range(a.oit.doctype.spreadsheet.extensions.length).map((function(){return d}))),i.object(a.oit.doctype.presentation.extensions,i.range(a.oit.doctype.presentation.extensions.length).map((function(){return l}))),i.object(a.oit.doctype.document.extensions,i.range(a.oit.doctype.document.extensions.length).map((function(){return l}))),i.object(a.oit.doctype.pdf.extensions,i.range(a.oit.doctype.pdf.extensions.length).map((function(){return l}))),i.object(a.oit.doctype.email.extensions,i.range(a.oit.doctype.email.extensions.length).map((function(){return l}))),i.object(a.oit.doctype.text.extensions,i.range(a.oit.doctype.text.extensions.length).map((function(){return l}))),i.object(a.oit.doctype.image.extensions,i.range(a.oit.doctype.image.extensions.length).map((function(){return h}))),i.object(a.oit.doctype.webpage.extensions,i.range(a.oit.doctype.webpage.extensions.length).map((function(){return l}))),i.object(a.oit.doctype.other.extensions,i.range(a.oit.doctype.other.extensions.length).map((function(){return l}))));return docs.models.OITDocumentHandler=docs.models.PagedDocumentHandler.extend({type:s.DocumentType.HTML5,config:{viewer:docs.views.HTML5Viewer,pagesView:docs.views.OITVerticalDocumentView,navView:docs.views.OITVerticalThumbsView,dimsPanelView:"docs/fileview/view/OITAnnotationDimsPanel"},allowZoomTo100pct:!0,features:{},oitLogger:docs.common.Logger(docs.common.Constants.Viewer.OIT_LOGGER),initialize:function(e){docs.common.Logger(s.OIT_LOGGER).debug("initialize view"),docs.models.PagedDocumentHandler.prototype.initialize.call(this,e)},getConversionURL:function(e,t){var i=this.getConversionUrlParameters(t),n=o.formatServiceUrl(e,{addAccessToken:!0})+i.itemPrefix+i.id;return i.revision&&(n+=i.versionPrefix+i.revision),n},getDocumentURL:function(){var t=e.Deferred();if(i.isUndefined(this.html5Url)){var o=this.getConversionURL("GET_HTML5_VIEW",this.item),s=this;return e.ajax(o,{type:"GET",success:function(e){var i=n.parse_GET_HTML5_VIEW(e);s.html5Url=i.html5Url,t.resolve(s.html5Url)},error:function(e,i,o){s.handleRenderError(o),e.errorHandled=!0,t.reject()}}),t.promise()}return t.resolve(this.html5Url)},isAnnotationCompatible:function(e){var t=this.getTypeDetails();return!t||i.contains(t.annotationTypes,e.get("type"))},supportsAnnotations:function(){var e=this.getTypeDetails();return!(e&&e.annotationTypes.length<1)&&docs.models.PagedDocumentHandler.prototype.supportsAnnotations.call(this)},reinit:function(){docs.models.PagedDocumentHandler.prototype.reinit.call(this),delete this.html5Url,this.destroyPages(),this.pages=new t.Collection},documentDone:function(){var e=this.hasFeature("highlights")&&(this.hasFeature("rectselection")||this.hasFeature("cellselection"));this.trigger("viewer:enableAnnotation",e)},addPage:function(e){docs.common.Logger(s.OIT_LOGGER).trace("addPage",e),this.pages.add(e),this.updateFeatures(e.get("features"))},getPages:function(){return this.pages},updateFeatures:function(t){e.extend(this.features,t)},hasFeature:function(e){return this.features[e]},getDefaultZoomMode:function(){var e=this.getTypeDetails();return e&&e.defaultZoom?e.defaultZoom:docs.models.PagedDocumentHandler.prototype.getDefaultZoomMode.call(this)},pagesZoomed:function(e){this.set("zoomValue",100*e.zoom)},hasCaptions:function(){var e=this.getTypeDetails();return!e||e.hasCaptions},getPagesView:function(e){var t=e,o=this.getTypeDetails();return o&&o.pageViewOptions&&(t=i.extend({},e,o.pageViewOptions)),new this.config.pagesView(t)},getNavigatorView:function(e){var t=e,o=this.getTypeDetails();return o&&o.navViewOptions&&(t=i.extend({},e,o.navViewOptions)),new this.config.navView(t)},destroyPages:function(){this.pages&&(this.pages.reset(),delete this.pages)},showHiddenCells:function(e){this.trigger("showHiddenCells",e)},addAnnotation:function(t,o,n){var a;this.addAnnotationDefaultParameters(t),a=i.isUndefined(t.type)||t.type===s.AnnotationType.RECTANGLE||t.type===s.AnnotationType.PUSHPIN?docs.models.ImageAnnotation.getDimensionsFromPageRect(o,n):docs.models.OITAnnotation.getDimensionsFromRange(o,t.type),e.extend(!0,t,a);var r=this.annotations.addFromParameters(t);return this.setSelectedAnnotation(r),this.trigger("viewer:annotationAdded",r),r},addPlaceholderAnnotation:function(){var e=this.getScrollRegion(),t=this.pageByIndex(e?e.topLeft.pageIndex:0),o={context:t.get("page")+1},n={page:t.get("page"),section:0},s=t.get("features");return s.rectselection?(i.extend(o,{type:docs.models.OITAnnotation.TYPE_OIT_RECT}),i.extend(n,{type:"rect",left:Math.floor(.45*t.get("width")),top:Math.floor(.45*t.get("height")),right:Math.floor(.55*t.get("width")),bottom:Math.floor(.55*t.get("height")),units:"px"}),n=docs.models.OITAnnotation.convertDimensionsToTwips(n)):s.cellselection&&(i.extend(o,{type:docs.models.OITAnnotation.TYPE_OIT_CELL}),i.extend(n,{type:"cell",c1:0,r1:0,c2:0,r2:0})),this.addAnnotation(o,n)},updateAnnotationFromParams:function(e,t){if(this.oitLogger.debug("updateAnnotationFromParams",e,t),!i.isUndefined(e)&&!i.isUndefined(t)){if(i.has(t,"context")){var o=t.context;o!==e.get("context")&&(this.annotations.remove(e),e.set("context",o),this.annotations.add(e))}if((i.has(t,"left")||i.has(t,"top")||i.has(t,"right")||i.has(t,"bottom")||i.has(t,"c1")||i.has(t,"r1")||i.has(t,"c2")||i.has(t,"r2"))&&e.setDimensionsFromParams(t)){var n=this.item.get("allowedActions");n&&n.annotationUpdate&&e.update(),e.trigger("viewer:annotationDimensionsChanged"),this.trigger("viewer:annotationDimensionsChanged",e)}}},updateAnnotation:function(e,t,o){if((this.oitLogger.debug("updateAnnotation",e,t,o),!i.isUndefined(e)&&!i.isUndefined(t)&&!i.isUndefined(o))&&e.setDimensions(t)){var n=this.item.get("allowedActions");n&&n.annotationUpdate&&e.update(),e.trigger("viewer:annotationDimensionsChanged"),this.trigger("viewer:annotationDimensionsChanged",e)}},getTypeDetails:function(){var e=i.isFunction(this.item.getExtension)?this.item.getExtension().toLowerCase():this.item.get("extension").toLowerCase();return c[e]},setScrollRegion:function(e){this.scrollRegion=e},getScrollRegion:function(){return this.scrollRegion},rotate:function(e){this.trigger("rotate",e)},remove:function(){docs.common.Logger(s.OIT_LOGGER).debug("remove view"),docs.models.PagedDocumentHandler.prototype.remove.call(this),this.destroyPages()}}),docs.models.OITDocumentHandler})),define("docs/fileview/model/PDFDocumentHandler",["jquery","underscore","core/util/Service","core/util/Jsonify","core/util/Constants","core/util/Logger","docs/fileview/model/OITDocumentHandler"],(function(e,t,i,o,n,s,a){"use strict";return a.extend({maxRetry:60,retry:0,continuePolling:!0,getDocumentURL:function(){var i=e.Deferred();return t.isUndefined(this.html5Url)?(this.callPreviewService(i),i.promise()):i.resolve(this.html5Url)},callPreviewService:function(i){var s=this.getConversionURL("GET_PDF_PREVIEW",this.item),a=this;e.ajax(s,{type:"GET",success:function(e){var s=o.parse_GET_PDF_PREVIEW(e);switch(s.previewType){case"html5":a.html5Url=s.html5Url,i.resolve(a.html5Url);break;case"image":i.reject("image"),a.item.set({viewerVersion:n.Viewer.PDF_IMAGE});break;case"unknown":a.continuePolling?a.retry<a.maxRetry?(a.retry++,t.delay(t.bind(a.callPreviewService,a),3e3,i)):(i.reject("retry exceeded"),a.Error={viewerError:"maxTriesExceeded"},a.handleRenderError(a.Error)):i.reject("polling cancelled")}},error:function(e,t,o){a.handleRenderError(o),e.errorHandled=!0,i.reject()}})},stopLoading:function(){this.continuePolling=!1}})})),define("docs/fileview/template/VideoViewer.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<video class="video-player" src="'+(null==(__t=url)?"":_.escape(__t))+'" aria-label="'+(null==(__t=ariaLabel)?"":_.escape(__t))+'" style="display:none;">  '+(null==(__t=unsupportedMsg)?"":_.escape(__t))+"</video>";return __p}})),define("docs/fileview/view/VideoViewer",["jquery","underscore","backbone","core/util/Constants","docs/fileview/template/VideoViewer.template","core/extensions","core/util/Globals"],(function(e,t,i,o,n){"use strict";return docs.views.VideoViewer=i.View.extend({id:"video-viewer",events:{},initialize:function(e){t.bindAll(this,"metadataLoaded","handleError","refresh","keyPressedOnDummyButton","startStopVideo"),this.container=e.container,this.render()},render:function(){var t=n({url:this.model.viewHandler.getVideoUrl(),unsupportedMsg:docs.i18n.t("BROWSER_DOES_NOT_SUPPORT_VIDEO_MSG"),ariaLabel:docs.i18n.t("VIDEO_ARIA_LABEL",this.model.get("name"))});this.$el.html(t),this.container.html(this.$el),this.videoPlayer=e(".video-player",this.$el),this.options.videoControls.hide||this.videoPlayer.attr("controls",1),this.options.videoControls.autoplay&&this.videoPlayer.attr("autoplay",1),this.options.videoControls.loop&&this.videoPlayer.attr("loop",1),this.options.videoControls.mute&&(this.videoPlayer.attr("muted",1),this.videoPlayer.prop("muted",!0)),this.videoPlayer.bind("loadedmetadata",this.metadataLoaded),this.videoPlayer.bind("error",this.handleError),this.videoPlayer.prop("tabindex","0"),this.videoPlayer.addClass("skipTarget"),this.model&&this.model.viewHandler&&(this.model.viewHandler.bind("change:zoomValue",this.refresh,this),this.model.viewHandler.bind("change:zoomMode",this.refresh,this))},refresh:function(){if(this.container&&this.videoPlayer){var e,t,i=!0,n=this.container[0].clientWidth,s=this.container[0].clientHeight,a=this.videoPlayer.prop("videoWidth")||n,r=this.videoPlayer.prop("videoHeight")||s;if(this.model.viewHandler.isZoomMode(o.Viewer.ZoomMode.FIT_BEST)){var d=Math.min(n/a,s/(r+48));e=a*d,t=r*d}else if(this.model.viewHandler.isZoomMode(o.Viewer.ZoomMode.FIT_WIDTH))e=n,t=n*r/a;else if(this.model.viewHandler.isZoomMode(o.Viewer.ZoomMode.FIT_HEIGHT))t=s,e=s*a/r;else if(this.model.viewHandler.isZoomMode(o.Viewer.ZoomMode.ZOOM_100))e=a,t=r;else{i=!1;var l=this.model.viewHandler.get("zoomValue");e=a*l/100,t=r*l/100}var h=e,c=t,g=Math.round(s-t)/2;g<0?(g=0,this.container.css({"overflow-y":"scroll"}),h-=17):this.container.css({"overflow-y":"hidden"});var u=Math.round(n-e)/2;if(u<0?(u=0,this.container.css({"overflow-x":"scroll"}),c-=17):this.container.css({"overflow-x":"hidden"}),this.videoPlayer.css({top:g+"px",left:u+"px"}),h=Math.round(h),c=Math.round(c),this.videoPlayer.prop("width",h),this.videoPlayer.prop("height",c),i){var m=100*h/a;this.model.viewHandler.setZoomValue(m)}}},metadataLoaded:function(e){this.refresh(),this.videoPlayer.is(":visible")||(this.videoPlayer.show(),docs.events.trigger("action:viewer_open"))},handleError:function(t){var i=this.model.viewHandler.getVideoUrl(),n=this;e.ajax(i,{type:"GET",success:function(e){n.model.viewHandler.handleRenderError({renderCode:o.Viewer.RenderCode.UNSUPPORTED_VIDEO,mediaError:n.videoPlayer[0].error})},error:function(e,t,i){e.errorHandled=!0,n.model.trigger("viewer:renderError",i)}})},keyPressedOnDummyButton:function(t){if(this.dummyButton)switch(t.keyCode||t.which){case e.ui.keyCode.ENTER:case e.ui.keyCode.SPACE:this.startStopVideo()}},startStopVideo:function(){this.dummyButton&&(this.dummyButton.hasClass("video-playing")?(this.videoPlayer[0].pause(),this.dummyButton.removeClass("video-playing")):(this.videoPlayer[0].play(),this.dummyButton.addClass("video-playing")))},remove:function(){this.videoPlayer&&this.videoPlayer.unbind(),this.dummyButton&&this.dummyButton.unbind(),this.model&&this.model.viewHandler&&(this.model.viewHandler.unbind("change:zoomValue"),this.model.viewHandler.unbind("change:zoomMode"),this.model=null),i.View.prototype.remove.call(this)}}),docs.views.VideoViewer})),define("docs/fileview/model/VideoHandler",["jquery","underscore","core/util/Constants","core/util/Service","core/util/FeatureFlags","docs/fileview/model/FileViewHandler","docs/fileview/view/VideoViewer"],(function(e,t,i,o){"use strict";return docs.models.VideoHandler=docs.models.FileViewHandler.extend({type:i.Viewer.DocumentType.VIDEO,config:{viewer:docs.views.VideoViewer},initialize:function(e){docs.models.FileViewHandler.prototype.initialize.call(this,e)},getDefaultZoomMode:function(){return i.Viewer.ZoomMode.FIT_BEST},getVideoUrl:function(){var e=this.getConversionUrlParameters(this.item),t=o.formatServiceUrl("GET_RENDITION_STREAM",{addAccessToken:!0})+e.itemPrefix+e.id;return t+="&Rendition=VideoH264",e.revision&&(t+=e.versionPrefix+e.revision),t},isAnnotationCompatible:function(){return!0},supportsAnnotations:function(){return!1},reinit:function(){docs.models.FileViewHandler.prototype.reinit.call(this)},remove:function(){docs.models.FileViewHandler.prototype.remove.call(this)}}),docs.models.VideoHandler})),define("docs/fileview/model/WebpImageHandler",["jquery","underscore","core/util/Session","core/util/Constants","core/util/Globals","core/util/Service","docs/fileview/model/FileViewPage","docs/fileview/model/FileViewPages","docs/fileview/model/PagedDocumentHandler","docs/fileview/view/DocumentViewer","docs/fileview/view/VerticalDocumentView","docs/fileview/view/VerticalThumbsView"],(function(e,t,i,o,docs,n,s,a,r,d,l,h){"use strict";return r.extend({type:o.Viewer.DocumentType.IMAGES,config:{viewer:d,pagesView:l,navView:h,dimsPanelView:"docs/fileview/view/ImageAnnotationDimsPanel"},initialize:function(e){r.prototype.initialize.call(this,e)},getDefaultZoomMode:function(){return o.Viewer.ZoomMode.FIT_BEST},isDocumentComplete:function(){return this.isComplete},isDocumentPartial:function(){return!1},reinit:function(){r.prototype.reinit.call(this),this.continueLoadingPages=!0,this.pages=new a,this.isComplete=!1},getFile:function(){var o=this.getConversionUrlParameters(this.item),s=n.formatServiceUrl("GET_RENDITION_STREAM",{addAccessToken:!0})+o.itemPrefix+o.id;s+=o.versionPrefix+o.revision,s+="&Rendition=Preview&noSaveAs=1",e.ajax(s,{type:"GET",contentType:"image/webp",xhrFields:{responseType:"blob"},beforeSend:function(e){i.setAuthorizationHeader(e)}}).done(t.bind((function(e){var i=new FileReader;i.onloadend=t.bind((function(){var e=new Image;e.onload=t.bind((function(){var t={pageId:1,width:e.width,height:e.height,imageUrl:i.result};this.addPage(t),this.isComplete=!0,this.trigger("viewer:pageCountChanged")}),this),e.src=i.result}),this),i.readAsDataURL(e)}),this)).fail(t.bind((function(e,t,i){e.errorHandled=!0,e.showWebBar=!1,this.isComplete=!0,this.stopPageLoad(),this.handleRenderError(i)}),this))},addPage:function(e){var t=new s(e);this.pages.add(t)},stopPageLoad:function(){this.continueLoadingPages=!1,this.ExportInProgress=!1},getRepresentativePageSize:function(){return this.pages.getRepresentativePageSize()},startLoading:function(){this.reinit(),this.getFile()},stopLoading:function(){this.stopPageLoad()}})})),define("docs/fileview/model/SvgImageHandler",["jquery","underscore","core/util/Session","core/util/Constants","core/util/Globals","core/util/Service","docs/fileview/model/FileViewPage","docs/fileview/model/FileViewPages","docs/fileview/model/PagedDocumentHandler","docs/fileview/view/DocumentViewer","docs/fileview/view/VerticalDocumentView","docs/fileview/view/VerticalThumbsView"],(function(e,t,i,o,docs,n,s,a,r,d,l,h){"use strict";return r.extend({isSVGPreview:!0,type:o.Viewer.DocumentType.IMAGES,config:{viewer:d,pagesView:l,navView:h,dimsPanelView:"docs/fileview/view/ImageAnnotationDimsPanel"},initialize:function(e){r.prototype.initialize.call(this,e)},getDefaultZoomMode:function(){return o.Viewer.ZoomMode.FIT_BEST},isDocumentComplete:function(){return this.isComplete},isDocumentPartial:function(){return!1},reinit:function(){r.prototype.reinit.call(this),this.continueLoadingPages=!0,this.pages=new a,this.isComplete=!1},getFile:function(){var o;if(this.item.has("repositoryModel"))o="/content/management/api/v1.1",this.item.isArchivedAsset()&&(o+="/archive"),o+="/assets/"+this.item.get("id"),this.item&&this.item.isArchivedAsset()||(o+="/versions/"+this.item.getRevisionNumber()),o+="/native/"+encodeURIComponent(this.item.get("name"));else{var s=this.getConversionUrlParameters(this.item);o=n.formatServiceUrl("GET_RENDITION_STREAM",{addAccessToken:!0})+s.itemPrefix+s.id,o+=s.versionPrefix+s.revision,o+="&Rendition=Preview&noSaveAs=1"}e.ajax(o,{type:"GET",contentType:!1,xhrFields:{},beforeSend:function(e){i.setAuthorizationHeader(e)}}).done(t.bind((function(e){const i=(new XMLSerializer).serializeToString(e.documentElement),o=new Blob([i],{type:"image/svg+xml"}),n=URL.createObjectURL(o);var s=new Image;s.onload=t.bind((function(){var e={pageId:1,width:s.width,height:s.height,imageUrl:n};this.addPage(e),this.isComplete=!0,this.trigger("viewer:pageCountChanged")}),this),s.src=n}),this)).fail(t.bind((function(e,t,i){e.errorHandled=!0,e.showWebBar=!1,this.isComplete=!0,this.stopPageLoad(),this.handleRenderError(i)}),this))},addPage:function(e){var t=new s(e);this.pages.add(t)},stopPageLoad:function(){this.continueLoadingPages=!1,this.ExportInProgress=!1},getRepresentativePageSize:function(){return this.pages.getRepresentativePageSize()},startLoading:function(){this.reinit(),this.getFile()},stopLoading:function(){this.stopPageLoad()}})})),define("docs/fileview/FileViewConfig",["require","jquery","underscore","core/util/Constants","core/util/Globals","common/assets/advvideo/AdvVideoUtils","common/docs/VirusScanUtils","docs/fileview/model/FileViewHandler","docs/fileview/model/ImageDocumentHandler","docs/fileview/model/OITDocumentHandler","docs/fileview/model/PDFDocumentHandler","docs/fileview/model/VideoHandler","docs/fileview/model/WebpImageHandler","docs/fileview/model/SvgImageHandler"],(function(require,e,t,i,docs,o,n,s,a,r,d,l,h,c){"use strict";var g=docs.common.Globals,u="digitalassettype",m="contenttype";return docs.views.FileViewConfig={getViewerConfig:function(e){var t,o={};if(n.isActionAllowed(e,n.Action.VIEW)){t=this.isRenditionView(e)?this.getRenditionViewType(e):this.getFileViewType(e);var g=e.get("viewerVersion");"OIT"===t?"img"===g&&(t="STANDARD"):"STANDARD"===t?g===i.Viewer.PDF_HTML5&&(t="OIT"):"PDF"===t&&("img"===g||g===i.Viewer.PDF_IMAGE?t="STANDARD":g===i.Viewer.PDF_HTML5&&(t="OIT"))}else t="VIRUS_BLOCK";switch(t){case"STANDARD":o.handler=a;break;case"DIGITALASSET":o.handler=require("assets/model/ARImageDocumentHandler");break;case"PDF":o.handler=d;break;case"OIT":o.handler=r;break;case"CAAS_ITEM":o.handler=require("docs/fileview/model/CaaSItemViewHandler");break;case"ADVANCED_VIDEO":o.handler=require("assets/advvideo/AdvVideoHandler");break;case"VIDEO":o.handler=l;break;case"WEBP":o.handler=h;break;case"SVG":o.handler=c;break;default:o.handler=s}return o},getExtension:function(e){return t.isFunction(e.getExtension)?e.getExtension():e.get("extension")},getAssetTypeCategory:function(e){if(e.isAsset)return e.isDigitalAsset()?u:m},getFileViewType:function(e){var t=this.getAssetTypeCategory(e),i=this.getExtension(e);return this.getFileType(t,i,e)},getRenditionViewType:function(e){var t,i=this.getAssetTypeCategory(e);return t=this.isRenditionView(e)?e.get("renditionExt"):this.getExtension(e),this.getRenditionType(i,t)},getFileType:function(e,n,s){if(e&&e===m)return"CAAS_ITEM";if(s.options&&s.options.previewInLayout)return"CAAS_ITEM";if(s.repository&&o.isRepositoryEnabled(s.repository)&&o.isFileItemAdvancedVideo(s)){var a=o.getVideoStatus(s.get("fields"));if(a!==o.statusMap.ERROR&&a!==o.statusMap.FAILED)return"ADVANCED_VIDEO"}if(n&&(n=n.toLowerCase()),n){if(g.previews&&1===g.previews[n])return e&&e===u&&t.contains(i.digitalasset.doctype.image.extensions,n)?"DIGITALASSET":t.contains(i.oit.doctype.spreadsheet.extensions,n)||t.contains(i.oit.doctype.document.extensions,n)||t.contains(i.oit.doctype.email.extensions,n)||t.contains(i.oit.doctype.presentation.extensions,n)||t.contains(i.oit.doctype.text.extensions,n)||t.contains(i.oit.doctype.image.extensions,n)||t.contains(i.oit.doctype.webpage.extensions,n)||t.contains(i.oit.doctype.other.extensions,n)||t.contains(i.oit.doctype.other.extensions2,n)?"OIT":t.contains(i.oit.doctype.pdf.extensions,n)?"PDF":"STANDARD";if(1===g.thumbs.checkin[n]&&"webp"===n)return"WEBP";if(checkFeatureFlag("svg.preview")&&"svg"===n)return"SVG";if(t.contains(i.video.extensions,n))return"VIDEO"}return"NONE"},getRenditionType:function(e,o){return e&&e===m?"CAAS_ITEM":(o&&(o=o.toLowerCase()),e&&e===u?(t.contains(i.digitalasset.doctype.image.extensions,o),"DIGITALASSET"):"NONE")},isRenditionView:function(e){return e.has("renditionType")&&e.get("renditionType")!==i.Rendition.Type.PREVIEW&&e.get("renditionType")!==i.Rendition.Type.ORIGINAL},getMetadataCategories:function(e){var t=e.get("metadata");if(t&&t.dDefaultFolderMetaCollection&&t.dDefaultFolderMetaCollection.values)return t.dDefaultFolderMetaCollection.values.xCategories}},docs.views.FileViewConfig})),define("docs/folderview/model/FilesOnlyFolder",["jquery","underscore","core/util/Service","docs/folderview/model/Folder"],(function(e,t,i){"use strict";return docs.models.FilesOnlyFolder=docs.models.Folder.extend({sortParams_files:{sort_updated:"&filesSortField=fLastModifiedDate&filesSortOrder=Desc",sort_nameasc:"&filesSortField=fFileName&filesSortOrder=Asc",sort_namedsc:"&filesSortField=fFileName&filesSortOrder=Desc"},initialize:function(e,t){docs.models.Folder.prototype.initialize.call(this,e,t)},url:function(){var e=i.formatServiceUrl("FLD_BROWSE");e+="&item=fFolderGUID:"+this.id,e+="&folderCount=0&itemType=File";var t=this.items.pagerData.pageStartRow;return e+="&fileCount="+this.items.pagerData.pageSize,e+="&fileStartRow="+t,e+=this.sortParams_files[this.get("sortOrder")]}}),docs.models.FilesOnlyFolder})),define("docs/fileview/model/FileViewItem",["jquery","underscore","core/util/Constants","core/util/Session","core/util/Service","core/util/Jsonify","core/util/Globals","docs/fileview/FileViewConfig","common/docs/folderview/model/FileItem","docs/folderview/model/FilesOnlyFolder"],(function(e,t,i,o,n,s){"use strict";var a=docs.common.Globals;const r=/\/(auth)?link\/(L[0-9A-F]*)\//;return docs.models.FileViewItem=docs.models.FileItem.extend({totalCountThreshold:500,pagerPageSize:250,sideboards:function(){return a.isAppLink?["properties"]:!a.isPublicUser&&r.exec(window.location.pathname)?["conversation"]:["conversation","metadata","aif","properties"]},initialize:function(e){t.bindAll(this,"updateViewHandler","handleSuccess","updateRendition"),this.id=e.id,this.revision=e.revision,this.on("change:renditionChanged",this.updateRendition)},fetch:function(i){var o=i&&i.success;return i=t.extend(i||{},{success:e.proxy((function(){this.handleSuccess(),t.isFunction(o)&&o(this)}),this),error:e.proxy(this.handleError,this)}),docs.models.FileItem.prototype.fetch.call(this,i)},url:function(){var e=n.formatServiceUrl("FLD_INFO")+"&item=fFileGUID:"+this.id;return this.revision&&(e+="&dRevLabel="+this.revision),e},parse:function(e){var t=s.parse_FLD_INFO_FILE(e);return t.guid=t.id,t},handleSuccess:function(){this.updateViewHandler(),this.on("change:revision",this.updateViewHandler),this.on("change:viewerVersion",this.updateViewHandler)},handleError:function(e,t){if(t.errorThrown){if(n.isAccessDenied(t.errorThrown)||n.isNonExistingItem(t.errorThrown)||n.isInvalidLink(t.errorThrown))return;if(n.isItemInTrash(t.errorThrown))return void e.trigger("error:fetch");t.errorHandled=!0;var o=t.errorThrown;19!==o.errorCode&&4!==o.errorCode||(o.renderCode=i.Viewer.RenderCode.UNSUPPORTED),e.trigger("viewer:renderError",o)}},isRenditionView:function(){return docs.views.FileViewConfig.isRenditionView(this)},hasRenditions:function(){return this.has("renditionList")},getRenditions:function(){return this.get("renditionList")},setRenditions:function(e,t){this.set({renditionList:e},t)},clearRenditions:function(){this.unset("renditionList",{silent:!0})},getRenditionByTypeId:function(e,t){var i;return this.hasRenditions()&&(i=this.getRenditions().findRenditionByTypeId(e,t)),i},getRendition:function(){return this.getRenditionByTypeId(this.get("renditionType"),this.get("renditionId"))},getPreviewRendition:function(){return this.getRenditionByTypeId(i.Rendition.Type.PREVIEW,i.Rendition.ID.PREVIEW)},updateRendition:function(){this.updateViewHandler({preserveZoom:!0})},updateViewHandler:function(e){var t;e=e||{},this.viewHandler&&(t=this.viewHandler,this.viewHandler.remove(),delete this.viewHandler);var i={item:this,conversationId:t&&t.annotations?t.annotations.conversationId:void 0};t&&e.preserveZoom&&(i.zoomMode=t.get("zoomMode"),i.zoomValue=t.get("zoomValue"));var o=docs.views.FileViewConfig.getViewerConfig(this);this.viewHandler=new o.handler(i),this.trigger("viewer:viewHandlerUpdated",t,this.viewHandler)},reset:function(){},initFolder:function(){return new docs.models.FilesOnlyFolder({id:this.get("parentID")},{pageSize:this.pagerPageSize})},loadFolder:function(e){if(e||n.linkId&&"LD"===n.linkId.slice(0,2))this.trigger("change:folder",this);else{var t=this.initFolder();t.bind("change",this._setFolder,this),t.bind("folder:loaderror",this._folderLoadFailure,this),t.fetch({async:!this.waitForFolder})}},_folderLoadFailure:function(e){e.unbind("change"),e.unbind("folder:loaderror"),a.isPublicLink&&(this.publicFileLink=!0),this.trigger("FilePreView:NoFolder",this)},_setFolder:function(e){e.unbind("change"),e.get("id")===o.getPersonalFolderId()&&e.set("name",docs.i18n.t("GENERAL_HOME"),{silent:!0}),this.set("folder",e,{silent:!0}),this.trigger("change:folder",this),this.publicFileLink=!1},navigateCurrentVersion:function(){docs.router.navigate("fileview/"+this.id,{trigger:!0,replace:!0})},remove:function(){this.off("change:revision",this.updateViewHandler),this.off("change:viewerVersion",this.updateViewHandler),this.off("change:renditionChanged",this.updateRendition)}}),docs.models.FileViewItem})),define("docs/fileview/template/Viewer.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="viewer-hidden"></div><div class="viewer-content-area"></div>';return __p}})),define("docs/fileview/view/Viewer",["jquery","underscore","backbone","core/util/Constants","core/util/Session","core/util/Service","core/util/Utils","core/authz","core/embedapi/EmbedApi","common/upload/Manager","core/util/Globals","common/assets/UserConfig","docs/fileview/template/Viewer.template","common/docs/VirusScanUtils","core/util/FeatureFlags","core/util/Logger","docs/mixins/FavoritesMixin","common/mixin/ConversationsMixin","core/view/MessageBar","common/sidebar/SidebarConfig","common/plugin/jquery.stringformat"],(function(e,t,i,o,n,s,a,r,d,l,docs,h,c,g){"use strict";var u=docs.events,m=docs.common.Globals,p=docs.common.Constants.FileViewRE,v=[o.ItemType.ASSET_TYPE_DA,o.ItemType.ASSET_TYPE_CI];return docs.views.Viewer=i.View.extend(t.extend({contextSidebarTabs:function(){return docs.sidebar.Config.getTabs(this.model,this.options)},id:"viewer-container",events:t.extend({},docs.mixins.FavoritesMixin.favoriteContainerEvents(),{}),initialize:function(e){t.bindAll(this,"fileUploaded","downloadFile","refresh","loadCurrentVersion","annotationModeChanged","viewOtherViewer","_refreshExtUsersLinksBanner"),this.options=e||{},delete this.options.el,this.options.urlParams=e.urlParams||{},this.containerView=e.containerView,this.contextActions=e.contextActions;var i=c({i18n:docs.i18n});return this.$el.html(i),this.showInitialBoilerPlate(),this.listenTo(this.model,"viewer:renderError",this.handleRenderError),this.listenTo(this.model,"viewer:renderWarning",this.handleRenderWarning),this.listenTo(this.model,"viewer:viewHandlerUpdated",this.viewHandlerUpdated),this.listenTo(this.model,"viewer:renderBoilerplate",this.handleRenderBoilerplate),this.listenTo(docs.events,"file:uploaded",this.fileUploaded),this.listenTo(docs.events,"webbar:added",this.refresh),this.listenTo(docs.events,"webbar:removed",this.refresh),this.listenTo(docs.events,"osn:navigateToAnnotation",this.navigateToAnnotation),this.listenTo(osn.events,"navbar:toggled",this.refresh),this.listenTo(osn.events,"resize",this.refresh),this.listenTo(docs.events,"annot:dimsPanel",this.annotDimsPanel),this.listenTo(docs.events,"viewer:rendition",this.viewRendition),this.registerContainerFavoritesListener(),this.listenTo(docs.events,"links:updated",this._refreshExtUsersLinksBanner),this},viewHandlerUpdated:function(e){this.model.viewHandler&&(this.viewer&&(this.viewer.remove(),this.showInitialBoilerPlate()),this.dimsPanelView&&this.dimsPanelView.remove(),this.model.viewHandler.startLoading(),this.model.viewHandler.setConversation(this.options.urlParams.conversationId),e&&this.stopListening(e,"viewer:annotationModeChanged",this.annotationModeChanged),this.listenTo(this.model.viewHandler,"viewer:annotationModeChanged",this.annotationModeChanged),this.render(),this.model.viewHandler&&this.options.controls&&!this.fitModeSet&&("page"===this.options.controls.fit?this.model.viewHandler.fitBest():"width"===this.options.controls.fit?this.model.viewHandler.fitToWidth():"original"===this.options.controls.fit&&this.model.viewHandler.zoom100(),this.fitModeSet=!0))},render:function(){if(this.updateUrl(),this.contextActions&&(this.model.get("folder")?this._setContextActionSelection():(this.listenTo(this.model,"change:folder",this._setContextActionSelection),this.model.loadFolder(!(this.options.breadcrumb&&this.options.breadcrumb.nextprev&&!this.options.breadcrumb.hide)))),this.model.viewHandler){var i=e(".viewer-content-area",this.$el),n=t.defaults({container:i,model:this.model,urlParams:this.options.urlParams,contextActions:this.contextActions,containerView:this.containerView},this.options);if(this.model.viewHandler.type)this.viewer=new this.model.viewHandler.config.viewer(t.extend({},n,this.model.viewHandler.config));else{this.model.set("previewAvailable",!1);var s={};switch(g.getScanValue(this.model)){case g.Status.SKIPPED:case g.Status.SKIPPED_ENCRYPTED:s={renderCode:o.Viewer.RenderCode.SCAN_SKIPPED};break;default:s={renderCode:o.Viewer.RenderCode.UNSUPPORTED}}this.handleRenderError(s)}this.setupViewerRoleStyle()}return docs.events.on("action:toggleSidebar",this.refresh),this.renderExternalUsersLinksBanner(),this},updateUrl:function(){var e=this.containerView.options&&this.containerView.options.viewContext;if(!e||"dialog"!==e){var i=t.result(this.containerView,"url");if((m.isPublicLink&&m.isPublicUser||!m.isPublicLink&&!this.model.isAllowedAction("fileRead"))&&this.model.getRevision()!==this.model.getLastRevision())docs.router.navigate(i,{trigger:!0,replace:!0});else{if(this.model.isAsset){var n=this.model.getMyRevision();n&&(i+=n===this.model.getLastRevision()?"":"/v"+n)}else i+=this.model.getRevision()===this.model.getLastRevision()?"":"/v"+this.model.getRevision();var s=!1,a=this.model.get("viewerVersion");a&&"oit"!==a&&a!==o.Viewer.PDF_IMAGE?(i+="/w"+a,s=a!==o.Viewer.PDF_HTML5&&a!==o.Viewer.PDF_IMAGE):this.options.urlParams.viewerVersion&&(i+="/w"+this.options.urlParams.viewerVersion,s=this.options.urlParams.viewerVersion!==o.Viewer.PDF_HTML5&&this.options.urlParams.viewerVersion!==o.Viewer.PDF_IMAGE),this.options.urlParams.conversationId&&(i+="/o"+this.options.urlParams.conversationId),this.options.urlParams.chatId&&(i+="/m"+this.options.urlParams.chatId),this.options.urlParams.conversationLinkId&&(i+="/l"+this.options.urlParams.conversationLinkId),this.options.urlParams.replyToChat&&(i+="/reply"),this.closeLegacyViewerMessage(),s&&this.displayLegacyMessage(),docs.common.Service.linkId&&(i="link/"+docs.common.Service.linkId+"/"+i);var r=/repository=([A-F0-9]*)/gim.exec(window.location.href);if(r){var d=r[1];h.set("repositoryId",d,{async:!1,globalsKey:"repositoryId"})}docs.router.navigate(i,{trigger:!1,replace:!0})}}},displayLegacyMessage:function(){this.legacyMessage=new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_LEGACY_VIEWER"),messageType:"info",commands:[{text:docs.i18n.t("ACTION_VIEW_CURRENT"),tooltip:docs.i18n.t("ACTION_VIEW_CURRENT_TT"),id:"viewOitButton",click:this.viewOtherViewer}]})},viewOtherViewer:function(){this.model.viewHandler.viewOtherViewer(),this.closeLegacyViewerMessage()},closeLegacyViewerMessage:function(){this.legacyMessage&&(this.legacyMessage.closeWebBar(),delete this.legacyMessage)},_setContextActionSelection:function(){this.stopListening(this.model,"change:folder"),this.contextActions&&(this.contextActions.setContainer(this.model),this.contextActions.setSelection([]))},refresh:function(){this.viewer&&this.viewer.refresh()},downloadFile:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.startDownload(!1)},editFile:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.startEdit()},loadCurrentVersion:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.navigateCurrentVersion()},fileUploaded:function(e){e.folderItem=this.model.set(e,{silent:!0}),d.events.itemUploaded(e,{id:this.model.get("parentID")}).then(function(){if(this.model.id===e.id&&"1"!==e.revision){var t=s.filterSpecialCharacters(e.name);0!==t.indexOf("_")&&(t="_"+t);var i="fileview/"+e.id+"/"+t+"/"+e.revision;docs.router.navigate(i,{trigger:!0,replace:!0,preserveNotification:!0})}}.bind(this))},viewRendition:function(e){t.isFunction(this.model.viewHandler.isRenditionChanged)&&this.model.viewHandler.isRenditionChanged(e)&&this.model.viewHandler.viewRendition(e)},annotDimsPanel:function(){!0===this.model.viewHandler.annotationMode&&require([this.model.viewHandler.config.dimsPanelView],t.bind((function(t){this.dimsPanelView||(this.dimsPanelView=new t({contentArea:e(".viewer-content-area",this.$el),viewHandler:this.model.viewHandler}),e(".viewer-hidden",this.$el).append(this.dimsPanelView.el));var i=this.model.viewHandler.addPlaceholderAnnotation();this.dimsPanelView.show(i)}),this))},annotationModeChanged:function(t){t?e(".viewer-content-area",this.$el).addClass("annotation_mode"):(this.dimsPanelView&&(this.dimsPanelView.hide(),this.dimsPanelView.remove(),delete this.dimsPanelView),e(".viewer-content-area",this.$el).removeClass("annotation_mode"))},reloadPage:function(e){e&&(e.stopPropagation(),e.preventDefault()),window.location.reload(!0)},gotoTrash:function(e){e&&(e.stopPropagation(),e.preventDefault()),docs.router.navigate("folder/home/trash",{trigger:!0,replace:!0})},gotoHome:function(e){e&&(e.stopPropagation(),e.preventDefault()),docs.router.navigate("folder/home",{trigger:!0,replace:!0})},canDownload:function(){return this.options.actions.download&&this.model&&this.model.isAllowedAction("fileRead")},canUpload:function(){return this.options.actions.uploadNewVersion&&this.model&&this.model.isAllowedAction("fileUpdate")},navigateToAnnotation:function(e){if(docs.common.Logger(o.OsnLogger).trace("navigateToAnnotation",e),e){var n;if(this.isDifferentDocument(e,i.history.getFragment()))return n=e.assetType&&!t.isEmpty(e.assetType)&&e.assetView&&!t.isEmpty(e.assetView)?docs.common.Constants.FileViewTypes[e.assetView]+"/"+(e.assetCollection?e.assetCollection:"all")+"/"+e.docId:t.contains(v,e.assetType)?"assets/"+e.docId:"fileview/"+e.docId,n+="/_"+e.docName+"/"+e.docRevision,t.isUndefined(e.conversationId)||(n+="/o"+e.conversationId),t.isUndefined(e.chatId)||(n+="/m"+e.chatId),t.isUndefined(e.linkId)||(n+="/l"+e.linkId),docs.common.Logger(o.OsnLogger).trace("navigating router",n),void docs.router.navigate(n,!0);if(this.model.isSideboardSupported("rendition")){var s;if(t.isUndefined(e.renditionType)||t.isUndefined(e.renditionId)){var a=this.model.viewHandler.getPersistedRendition();s=a?this.model.getRenditionByTypeId(a.renditionType,a.renditionId):this.model.getRenditionByTypeId(o.Rendition.Type.PREVIEW,o.Rendition.ID.PREVIEW)}else s=this.model.getRenditionByTypeId(e.renditionType,e.renditionId);s&&(s.set("_replyToChatId",e.chatId),u.trigger("viewer:rendition",s))}this.model.viewHandler.isInAnnotationCreate()?this.model.viewHandler.clearInAnnotationCreate():(docs.common.Logger(o.OsnLogger).trace("setting conversation id",e.conversationId),this.model.viewHandler.setConversation(e.conversationId),t.isUndefined(e.chatId)||(this.model.viewHandler.setAnnotationMode(!1),docs.common.Logger(o.OsnLogger).trace("dispatching viewer:scrollToAnnotation"),docs.events.trigger("viewer:scrollToAnnotation",e.chatId.toString())))}},isDifferentDocument:function(e,t){var i=p.re.exec(t),o=!i||e.docId!==i[p.index_file_id]||e.assetView&&docs.common.Constants.FileViewTypes[e.assetView]!==i[p.index_view_type]||e.assetCollection&&e.assetCollection!==i[p.index_asset_collection];return o||(o=i[p.index_revision]?!a.areVersionsEqual(e.docRevision,i[p.index_revision]):!a.areVersionsEqual(e.docRevision,this.model.getRevision())),o},handleRenderWarning:function(e){switch(e.code){case o.Viewer.RenderCode.MAX_PAGES_WARNING:this.showMaxPagesWarning();break;case o.Viewer.RenderCode.TIMEOUT_WARNING:this.model.viewHandler.notViewable=!0,this.warnRenditionTimedout()}},warnRenditionTimedout:function(){this.canDownload()?new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_TIMEDOUT_W_DOWNLOAD"),messageType:"warning",commands:[{text:docs.i18n.t("GENERAL_CMD_DOWNLOAD"),tooltip:docs.i18n.t("ACTION_DOWNLOAD_FILE_TT",this.model.get("name")),id:"downloadButton",click:this.downloadFile}]}):new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_TIMEDOUT_NO_DOWNLOAD"),messageType:"warning"})},showMaxPagesWarning:function(){this.canDownload()?new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_TOO_MANY_PAGES_W_DOWNLOAD",m.maxPages),messageType:"warning",commands:[{text:docs.i18n.t("GENERAL_CMD_DOWNLOAD"),tooltip:docs.i18n.t("ACTION_DOWNLOAD_FILE_TT",this.model.get("name")),id:"downloadButton",click:this.downloadFile}]}):new docs.views.MessageBar({messageText:docs.i18n.t("FILEVIEW_TOO_MANY_PAGES_NO_DOWNLOAD",m.maxPages),messageType:"warning"})},handleRenderBoilerplate:function(e){(e=e||{}).bpClass=e.bpClass||"bp-large",e.imgSrc=e.imgSrc||"css-spinner",e.isContentError=!!e.isContentError,this.showBoilerPlate(e.bpClass,e.imgSrc,e.bpText,e.bpDetails,null,e.isContentError)},handleRenderError:function(e){this.model.viewHandler.notViewable=!0,s.isOutboundLimitExceeded(e)?this.showBoilerPlateOutboundLimitExceeded(e):e.renderCode===o.Viewer.RenderCode.UNSUPPORTED_VIDEO?(e.mediaError&&console.error(e.mediaError),this.showBoilerPlateVideoIncompatible(e)):e.renderCode===o.Viewer.RenderCode.CANNOT_DOWNLOAD?this.showBoilerPlateDownloadDenied(e):e.renderCode===o.Viewer.RenderCode.VIDEO_CONVERSION_ERROR?this.showBoilerPlateConversionError(e):e.errorMsgKey&&e.errorMsgKey.includes("!csVirusScanInProgress")?this.showBoilerPlateVirusScanPending(e):e.renderCode===o.Viewer.RenderCode.SCAN_SKIPPED?this.showBoilerPlateVirusUnscannable(e):e.Infected||s.isItemInfected(e)?n.isAnonymous()?this.showBoilerPlateAccessDenied(e):this.showBoilerPlateItemInfected(e):s.isItemInTrash(e)||s.isNonExistingItem(e)?this.showBoilerPlateItemDeleted(e):s.isTooLargeConvert(e)?this.showBoilerPlateTooLargeToConvert(e):this.showBoilerPlateUnknown(e,e.renderCode===o.Viewer.RenderCode.UNSUPPORTED)},showInitialBoilerPlate:function(){this.showBoilerPlate("bp-large","css-spinner",docs.i18n.t("BP_FILE_PREVIEW_LOADING_MSG"),docs.i18n.t("BP_FILE_PREVIEW_LOADING_DETAIL_SHORT"),null,!1)},showBoilerPlateVideoIncompatible:function(i){var o=this.canDownload(),n=docs.i18n.t("BP_FILE_PREVIEW_VIDEO_INCOMPATIBLE_MSG"),s=o?docs.i18n.t("BP_FILE_PREVIEW_VIDEO_INCOMPATIBLE_DETAIL"):docs.i18n.t("BP_FILE_PREVIEW_VIDEO_INCOMPATIBLE_DETAIL_SHORT");if(this.showBoilerPlateError(i,n,s,null,!1),o){var a=e("#bp-download-link");t.isEmpty(a)||a.click(this.downloadFile)}},showBoilerPlateVirusScanPending:function(e){var t=docs.i18n.t("BP_FILE_PREVIEW_SCAN_PENDING_MSG"),i=docs.i18n.t("BP_FILE_PREVIEW_SCAN_PENDING_DETAIL");this.showBoilerPlateError(e,t,i,null,!1)},showBoilerPlateVirusUnscannable:function(e){var t=docs.i18n.t("BP_FILE_PREVIEW_NOT_SCANNABLE_MSG"),i=docs.i18n.t("BP_FILE_PREVIEW_NOT_SCANNABLE_DETAIL");this.showBoilerPlateError(e,t,i,null,!1)},showBoilerPlateUnknown:function(i,o){var n=this.canDownload(),s=o?docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_UNSUPPORTED_MSG"):docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_MSG"),a="";if(a=o?n?docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_UNSUPPORTED_DETAIL"):docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_UNSUPPORTED_DETAIL_SHORT"):n?docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_DETAIL"):docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_DETAIL_SHORT"),this.showBoilerPlateError(i,s,a,null,!1),n){var r=e("#bp-download-link");t.isEmpty(r)||r.click(this.downloadFile)}var d=e("#bp-reload-link");t.isEmpty(d)||d.click(this.reloadPage)},showBoilerPlateAccessDenied:function(e){var t;t=n.isAnonymous()?docs.i18n.t("BP_ACCESS_DENIED_DETAIL_UNAUTH_SIGNIN",m.memberRoot.slice(0,-1)):docs.i18n.t("BP_ACCESS_DENIED_DETAIL_BACK"),this.showBoilerPlateError(e,docs.i18n.t("BP_ACCESS_DENIED_HEADER"),t,null,!0)},showBoilerPlateDownloadDenied:function(e){var t=docs.i18n.t("BP_DOWNLOAD_DENIED_HEADER"),i=docs.i18n.t("BP_DOWNLOAD_DENIED_DETAIL");this.showBoilerPlateError(e,t,i,null,!1)},showBoilerPlateConversionError:function(i){var o=this.canDownload(),n=docs.i18n.t("BP_FILE_PREVIEW_VIDEO_CONV_ERROR_MSG"),s=o?docs.i18n.t("BP_FILE_PREVIEW_VIDEO_CONV_ERROR_DETAIL"):docs.i18n.t("BP_FILE_PREVIEW_VIDEO_CONV_ERROR_DETAIL_SHORT");if(this.showBoilerPlateError(i,n,s,null,!1),o){var a=e("#bp-download-link");t.isEmpty(a)||a.click(this.downloadFile)}},showBoilerPlateItemDeleted:function(i){var o,n;if(this.model.revision?(o=docs.i18n.t("BP_FILE_PREVIEW_DELETED_VERSION_MSG"),n=docs.i18n.t("BP_FILE_PREVIEW_DELETED_VERSION_DETAIL")):(o=docs.i18n.t("BP_FILE_PREVIEW_DELETED_DOCUMENT_MSG"),n=m.embed?docs.i18n.t("BP_FILE_PREVIEW_DELETED_DOCUMENT_DETAIL_SHORT"):docs.i18n.t("BP_FILE_PREVIEW_DELETED_DOCUMENT_DETAIL")),this.showBoilerPlateError(i,o,n,null,!0),this.model.revision){var s=e("#bp-view-current");t.isEmpty(s)||s.click(this.loadCurrentVersion)}else if(!m.embed){var a=e("#bp-home-link");t.isEmpty(a)||a.click(this.gotoHome)}},showBoilerPlateItemInfected:function(i){var o=docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_INFECTED_MSG"),n=m.embed?docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_INFECTED_DETAIL_SHORT"):docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_INFECTED_DETAIL");if(this.showBoilerPlateError(i,o,n,null,!1),!m.embed){var s=e("#bp-trash-link");t.isEmpty(s)||s.click(this.gotoTrash);var a=e("#bp-home-link");t.isEmpty(a)||a.click(this.gotoHome)}},showBoilerPlateTooLargeToConvert:function(i){var o=this.canDownload(),n=docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_TOO_LARGE_MSG"),s=o?docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_TOO_LARGE_DETAIL"):docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_TOO_LARGE_DETAIL_SHORT");if(this.showBoilerPlateError(i,n,s,null,!1),o){var a=e("#bp-download-link");t.isEmpty(a)||a.click(this.downloadFile)}},showBoilerPlateOutboundLimitExceeded:function(e){var t=e.errorMsgKey,i=t.split(",")[1],o=t.split(",")[2],n=docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_OUTBOUND_LIMIT_EXCEEDED"),s=docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_OUTBOUND_LIMIT_EXCEEDED_DETAIL",i,o),a=docs.i18n.t("BP_FILE_PREVIEW_LOAD_FAIL_OUTBOUND_LIMIT_EXCEEDED_EXTRA_DETAIL");this.showBoilerPlateError(e,n,s,a,!1)},showBoilerPlateError:function(e,i,n,s,a){var r,d;(this.showBoilerPlate("bp-large bp-redwood-illustration",m.staticRoot+"images/Boilerplate_Error.png",i,n,s,a),e)&&(e.errorCode?(r=e.errorCode,d=e.errorMsgKey):r=e.renderCode===o.Viewer.RenderCode.UNSUPPORTED?o.HostedDialogsErrorCodes.UNSUPPORTED_CONTENT:e.renderCode===o.Viewer.RenderCode.UNSUPPORTED_VIDEO?o.HostedDialogsErrorCodes.INCOMPATIBLE_CONTENT:o.HostedDialogsErrorCodes.UNKNOWN_ERROR,t.isUndefined(window.dialogErrorCallback)||window.dialogErrorCallback(r,i,d))},showBoilerPlate:function(t,i,o,n,s,r){var d=a.getGenericBoilerplateHtml(t,i,o,n,s),l=r&&this.options.bpContainer?this.options.bpContainer:e(".viewer-content-area",this.$el);l.html(d);var h=e(":tabbable",l);h.length>0?h.first().addClass("skipTarget"):e(".bp_class",l).addClass("skipTarget")},setupViewerRoleStyle:function(){var t=this.model.viewHandler.item.getAllowedActions();t.fileRead||t.fileWrite?e('head [id="noprint"]').remove():e('<style id="noprint">@media print { .page-content { display: none; } }</style>').appendTo("head")},remove:function(){e(window).off("resize.viewer"),this.uploader&&(l.destroyUploader(this.uploader),this.uploader=null),this.viewer&&(this.viewer.remove(),this.viewer=null),this.dimsPanelView&&(this.dimsPanelView.remove(),delete this.dimsPanelView),this.model&&(this.model.viewHandler&&(this.model.viewHandler.remove(),delete this.model.viewHandler),this.model=null),i.View.prototype.remove.call(this)},close:function(){this.remove()},renderExternalUsersLinksBanner:function(i){var o=this.model.get("hasExternalUserAccess"),n=this.model.get("hasExternalLinks");if(r.can("showExternalUserLinkBanner","All")&&(o||n)){var s=docs.i18n.t(o&&n?"FILE_BAR_WARNING_EXT_USERS_PUBLIC_LINK":o?"FILE_BAR_WARNING_EXT_USERS":"FILE_BAR_WARNING_PUBLIC_LINK","http://www.oracle.com/pls/topic/lookup?ctx=cloud&id=CECSA-GUID-925E928C-E14C-459C-A047-DA7DCBF18B2D");this.messageBar&&this.messageBar.$el.is(":visible")||(this.messageBarText=s,this.messageBar=new docs.views.MessageBar({customIconClass:"athena-icon-16-info-blue",messageType:"info_iconFont",messageText:s,disableScriptProtection:!0,noImmediateProtectedPeriod:!0}),i||t.defer(function(){var t=this.$el.closest("#content-wrapper").find(".wbMessage");e("a",t).focus()}.bind(this)))}else this.messageBar&&(this.messageBar.closeWebBar(),delete this.messageBar,delete this.messageBarText)},_refreshExtUsersLinksBanner:function(e){if(e===this.model.id&&r.can("showExternalUserLinkBanner","All")){var t=this;this.model.fetch().then((function(){t.renderExternalUsersLinksBanner(!0)}))}}},docs.mixins.FavoritesMixin,docs.mixins.ConversationsMixin)),docs.views.Viewer})),define("docs/fileview/template/FileBrowser.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="fileBrowser">\t<button id="prevFile" class="containerview-toolbar-button" title="'+(null==(__t=prevText)?"":_.escape(__t))+'" aria-label="'+(null==(__t=prevText)?"":_.escape(__t))+'"></button>\t<button id="nextFile" class="containerview-toolbar-button" title="'+(null==(__t=nextText)?"":_.escape(__t))+'" aria-label="'+(null==(__t=nextText)?"":_.escape(__t))+'"></button></div>';return __p}})),define("docs/fileview/view/FileBrowserView",["jquery","underscore","backbone","docs/fileview/template/FileBrowser.template","core/util/Utils","docs/fileview/FileViewConfig","jqueryui-amd/widgets/button"],(function(e,t,i,o){"use strict";return docs.views.FileBrowserView=i.View.extend({prevTT:"BROWSE_PREVIOUS_FILE",nextTT:"BROWSE_NEXT_FILE",initialize:function(e){t.bindAll(this,"_updatefolderItems","_setFolder","_showButtons","_hideButtons","_updateFilteredFolderItems"),this.options=e||{},this.prevItem=void 0,this.currItem=void 0,this.nextItem=void 0,this.lastItem=void 0,this.prevPageLastItem=void 0,this.filteredFolderItemIds=[],this.fileId=this.options.file.get("id"),this.options.file.get("folder")?this._updatefolderItems():this.listenTo(this.options.file,"change:folder",this._updatefolderItems)},_setFolder:function(){this.folder||(this.folder=this.options.file.get("folder"),this.listenTo(this.folder.items,"reset",this._updatefolderItems),this.listenTo(this.folder,"sync",this._updatefolderItems))},_updatefolderItems:function(){if(this._setFolder(),t.each(this.folder.items.models,(function(e){"NONE"!==docs.views.FileViewConfig.getFileViewType(e)&&this.filteredFolderItemIds.push(e.get("id"))}),this),this.options.filterUnsupportedTypes)this._updateFilteredFolderItems();else{var e=this.folder.items.pagerData,i=e.get("totalCount");if(this.options.totalCountThreshold&&i>this.options.totalCountThreshold)this._hideButtons();else{var o=e.get("hasMore"),n=e.get("page"),s=e.get("pageCount"),a=this.folder.items.length;1===n&&(this.firstItem=this.folder.items.first()),n===s&&(this.lastItem=this.folder.items.last());var r=this.folder.items.findWhere({id:this.fileId})||this.folder.items.findWhere({shortcutID:this.fileId});if(r){this.currItem=r;var d=this.folder.items.indexOf(r);d>0&&(this.prevItem=this.folder.items.at(d-1)),d+1<a&&(this.nextItem=this.folder.items.at(d+1))}var l=i>1,h=i>1;this.currItem&&(l&&!this.prevItem&&(this.prevItem=this.prevPageLastItem||this.lastItem),h&&!this.nextItem&&(this.currItem===this.lastItem?this.nextItem=this.firstItem:r||(this.nextItem=this.folder.items.first()))),this.prevPageLastItem=this.lastItem=this.folder.items.last(),!this.currItem&&o||this.currItem&&o&&h&&!this.nextItem?this.folder.items.fetchPage("next"):this.currItem&&this.nextItem&&o&&l&&!this.prevItem?(this.prevPageLastItem=void 0,this.folder.items.fetchPage("last")):this.currItem&&l&&this.prevItem&&h&&this.nextItem?this._showButtons():this._hideButtons()}}},updateNavigationIcons:function(){this.options.filterUnsupportedTypes=!!docs.common.Utils.isInFullScreenMode(),this._updatefolderItems()},_updateFilteredFolderItems:function(){var e=this.folder.items.pagerData,i=e.get("hasMore"),o=e.get("page"),n=e.get("pageCount"),s=e.get("totalCount"),a=this.folder.items.length;1===o&&(this.firstItem=this.folder.items.findWhere({id:t.first(this.filteredFolderItemIds)})),o===n&&(this.lastItem=this.folder.items.findWhere({id:t.last(this.filteredFolderItemIds)}));var r=this.folder.items.findWhere({id:this.fileId});if(r){this.currItem=r;var d=this.filteredFolderItemIds.indexOf(r.id);d>0&&(this.prevItem=this.folder.items.findWhere({id:this.filteredFolderItemIds[d-1]})),d+1<a&&(this.nextItem=this.folder.items.findWhere({id:this.filteredFolderItemIds[d+1]}))}var l=s>1,h=s>1;this.currItem&&(l&&!this.prevItem&&(this.prevItem=this.prevPageLastItem||this.lastItem),h&&!this.nextItem&&(this.currItem===this.lastItem?this.nextItem=this.firstItem:r||(this.nextItem=this.folder.items.findWhere({id:t.first(this.filteredFolderItemIds)})))),this.prevPageLastItem=this.lastItem=this.folder.items.findWhere({id:t.last(this.filteredFolderItemIds)}),!this.currItem&&i||this.currItem&&i&&h&&!this.nextItem?this.folder.items.fetchPage("next",!0):this.currItem&&this.nextItem&&i&&l&&!this.prevItem?(this.prevPageLastItem=void 0,this.folder.items.fetchPage("last",!0)):this.currItem&&l&&this.prevItem&&h&&this.nextItem?this._showButtons():this._hideButtons()},_showButtons:function(){e(".fileBrowser",this.options.browserContainer).remove(),e(this.options.browserContainer).append(o({i18n:docs.i18n,prevText:docs.i18n.t(this.prevTT),nextText:docs.i18n.t(this.nextTT)}));var t=this;e("#prevFile",this.options.browserContainer).button({text:!1,icons:{primary:"ui-icon-athena-browse-left"}}).click((function(){t._openFile(t.prevItem)})),e("#nextFile",this.options.browserContainer).button({text:!1,icons:{primary:"ui-icon-athena-browse-right"}}).click((function(){t._openFile(t.nextItem)}))},_hideButtons:function(){e(".fileBrowser",this.options.browserContainer).remove()},_openFile:function(e){var t="fileview/"+e.get("id");docs.router.navigate(t,{trigger:!0,replace:!0})}}),docs.views.FileBrowserView})),define("docs/container/view/ViewerContainerView",["jquery","underscore","backbone","common/container/view/ContainerView","docs/fileview/view/Viewer","common/container/view/BreadCrumbView","docs/fileview/view/FileBrowserView","core/util/Utils","core/util/Service","docs/container/template/ContainerView.template","jqueryui-amd/widgets/button"],(function(e,t,i,o,n,s,a,r,d,l){"use strict";var h=docs.common.Globals,c="webkitfullscreenchange mozfullscreenchange msfullscreenchange fullscreenchange MSFullscreenChange";return o.extend({id:void 0,template:l,url:void 0,ContainerViewDetail:void 0,BreadCrumbView:void 0,BreadCrumbMenuView:void 0,BreadCrumbMenu2View:void 0,FileBrowserView:void 0,pageUploader:!1,contextSidebarTabs:function(){return docs.sidebar.Config.getTabs(this.model,this.options)},breadcrumbWrapperSelector:"",breadcrumbSelector:".containerview-breadcrumbs",breadcrumbMenuSelector:"",bcToolbarSelector:".containerview-breadcrumbs",bcBrowserSelector:".containerview-breadcrumbs",initialize:function(e){return o.prototype.initialize.call(this,e),t.bindAll(this,"nameChanged","onFullScreenChange","showFullScreenHeader"),this.listenTo(this.model,"change:guid",this.renderContent),this.listenTo(this.model,"change:name",this.nameChanged),this},renderContent:function(){var i=e(".mainViewContainer").width();this.trigger("view:renderContent");var o,n=this.template({i18n:docs.i18n});(this.$el.html(n),e(document).on(c,this.onFullScreenChange),this.contextActions=this.contextActions||new docs.models.ContextActions(this.options),this.options.contextActions=this.contextActions,this.contextActions.container=this.model,this.contextActions.filterItemActions(this.options),this.options.header.hide)||(o="dialog"===this.options.viewContext?this.ContainerViewHeader:t.result(this,"ContainerViewHeader"),this.containerViewHeader=new o(t.defaults({el:this.$(".containerview-header"),model:this.model},this.options)),this.containerViewHeader.render());if(this.BreadCrumbView&&(t.isUndefined(this.options.breadcrumb)||!this.options.breadcrumb.hide||this.options.breadcrumb.back)){var s=t.result(this,"BreadCrumbViewOptions",{});this.containerBreadcrumbView=new this.BreadCrumbView(t.defaults({folderItem:this.model,urlParams:this.options.urlParams},this.options,s)),this.$(this.breadcrumbSelector).html(this.containerBreadcrumbView.$el);var a=t.result(this,"BreadCrumbMenuView");a&&(this.containerBreadcrumbMenuView=new a({model:this.model,breadcrumbView:this.containerBreadcrumbView,menuContainer:e(this.breadcrumbMenuSelector)}),this.$(this.breadcrumbMenuSelector).html(this.containerBreadcrumbMenuView.$el)),(a=t.result(this,"BreadCrumbMenu2View"))&&(this.containerBreadcrumbMenu2View=new a({model:this.model,breadcrumbView:this.containerBreadcrumbView,menuContainer:e(this.breadcrumbMenu2Selector)}),this.$(this.breadcrumbMenu2Selector).html(this.containerBreadcrumbMenu2View.$el))}!this.FileBrowserView||(h.isPublicLink||h.isAppLink)&&"LD"===d.linkId.slice(0,2)||h.isStarterEdition&&this.model.isFile&&!h.embed||!this.options.breadcrumb||!this.options.breadcrumb.nextprev||this.options.breadcrumb.hide||(this.fileBrowserView=new this.FileBrowserView({file:this.model,browserContainer:this.$(this.bcBrowserSelector),filterUnsupportedTypes:!!r.isInFullScreenMode(),totalCountThreshold:this.model.totalCountThreshold,contextActions:this.contextActions}));var l=t.result(this,"ContainerViewDetail");return this.containerViewDetail=new l(t.defaults({el:this.$(".containerview-detail"),containerView:this,model:this.model},this.options)),r.isInFullScreenMode()&&i>0&&(this.$el.closest(".mainViewContainer").width(i),this.onFullScreenChange()),this},delayedViewTimeout:function(){var e=docs.common.Utils.getGenericBoilerplateHtml("bp-large","css-spinner",docs.i18n.t("BP_LOAD_MSG"),docs.i18n.t("BP_LOAD_FOLDER_DETAIL"));return this.$el.html(e),this},nameChanged:function(){if(this.containerBreadcrumbView){var e=this.model.get("name");this.containerBreadcrumbView.updateTrailEnd(e)}},showFullScreenHeader:function(e){"click"!==e.type&&e.clientX===this.clientX&&e.clientY===this.clientY||(this.clientX=e.clientX,this.clientY=e.clientY,this.idleTimerId&&clearTimeout(this.idleTimerId),this.hideFullScreenHeader())},hideFullScreenHeader:function(){r.isInFullScreenMode()&&this.$(".containerview-header").slideDown("slow",t.bind((function(){this.$(".fileBrowser").fadeIn(),clearTimeout(this.idleTimerId),this.idleTimerId=setTimeout(t.bind((function(){r.isInFullScreenMode()&&(this.$(".containerview-header").slideUp("slow"),this.$(".fileBrowser").fadeOut())}),this),3e3)}),this))},onFullScreenChange:function(i){var o=!(!i||!i.target||"advanced-video-frame"!==i.target.id),n=this.$el.closest(".full-page-dialog");0===n.length&&(n=this.$el.closest(".mainViewContainer")),r.isInFullScreenMode()?(docs.events.trigger("viewer:fullscreenMode",{isFullScreen:!0}),n.addClass("fullscreenContainer"),n.find(".containerview").addClass("fullscreenMode"),n.find("#version_button").is("button")&&(n.find("#version_button").button(),n.find("#version_button").button("disable").removeClass("ui-state-disabled")),this.model.viewHandler&&this.model.viewHandler.setShowAnnotations(!1),this.$el.addClass("fullscreenMode"),this.$el.find("iframe").contents().find(".oit-view").addClass("fullscreenMode"),this.$el.find("iframe").contents().find(".oit-overlay").addClass("fullscreenMode"),this.$(".containerview-header").hide(),e(document).on("mousemove click",t.debounce(this.showFullScreenHeader,200,!0)),this.$(".containerview-header").slideDown("slow"),this.hideFullScreenHeader(),!o&&this.model.viewHandler&&(this.previousZoomSettings=this.model.viewHandler.getZoomValue(),this.model.viewHandler.setZoomValue(150))):(this.options.header&&this.options.header.hide?this.$(".containerview-header").hide():this.$(".containerview-header").show(),this.$el.removeClass("fullscreenMode"),this.$el.find("iframe").contents().find(".oit-view").removeClass("fullscreenMode"),this.$el.find("iframe").contents().find(".oit-overlay").removeClass("fullscreenMode"),e(document).off("mousemove click"),this.idleTimerId&&clearTimeout(this.idleTimerId),n.removeClass("fullscreenContainer"),n.find(".containerview").removeClass("fullscreenMode"),n.find("#version_button").button("enable"),!o&&this.model.viewHandler&&this.previousZoomSettings&&this.model.viewHandler.restoreZoomValue(this.previousZoomSettings),docs.events.trigger("viewer:fullscreenMode",{isFullScreen:!1})),this.fileBrowserView&&i&&this.fileBrowserView.updateNavigationIcons(),this.containerViewDetail.refresh()},onCloseView:function(){this.fileBrowserView&&this.fileBrowserView.close(),this.$el.closest(".mainViewContainer").off("mousemove click"),e(document).off(c,this.onFullScreenChange),docs.views.ContainerView.prototype.onCloseView.call(this)}})})),define("docs/fileview/view/FileView",["jquery","underscore","core/util/Service","core/util/Utils","core/util/Globals","docs/container/view/ViewerContainerView","docs/fileview/view/FileViewHeader","common/sidebar/SidebarConfig","common/container/model/ContextActions","common/container/view/ContainerView","common/container/view/BreadCrumbView","docs/fileview/view/FileBrowserView","docs/fileview/view/Viewer"],(function(e,t,i,o,docs,n,s,a,r,d,l,h,c){"use strict";docs.common.Globals;return docs.views.FileView=n.extend({id:"fileview",alertText:function(){return docs.i18n.t("FOLDERVIEW_FILE_ROW")+" "+this.model.get("name")},url:function(){return"fileview/"+this.model.id+"/"+this.model.getUrlName()},ContainerViewHeader:function(){return s},getContainerViewHeader:function(){return this.ContainerViewHeader()},ContainerViewDetail:function(){return c},BreadCrumbView:l,FileBrowserView:h,contextSidebarTabs:function(){return a.getTabs(this.model,this.options)},initialize:function(e){return n.prototype.initialize.call(this,e),this}}),docs.views.FileView})),define("docs/fileview/template/Annotation.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="annot-pointer">  <div class="avatars-container"></div>  <button type="button" class="ws-toolbar-button close-button" style="display:none;" tabindex="-1"          title="'+(null==(__t=i18n.t("ANNOTATAION_REMOVE_BUTTON_LABEL"))?"":_.escape(__t))+'">'+(null==(__t=i18n.t("ANNOTATAION_REMOVE_BUTTON_LABEL"))?"":_.escape(__t))+"</button></div>";return __p}})),define("common/view/UserAvatar.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div>  <img id="'+(null==(__t=o.avatarId)?"":__t)+'" class="profile-pic user'+(null==(__t=o.hideUserLink?"":" osn-clickable")?"":__t)+" "+(null==(__t=o.IsExternalUser?"external-user-avatar":"")?"":__t)+'"       src="'+(null==(__t="wallsize"===o.size?o.wallProfilePic:o.profilePic)?"":__t)+'"       ',print('title="'+o.avatarDesc+'"'),__p+=' alt="'+(null==(__t=o.avatarDesc)?"":__t)+'"/></div>';return __p}})),define("common/view/UserAvatarView",["jquery","underscore","backbone","core/osnGlobals","common/view/UserAvatar.template","core/util/FeatureFlags","core/view/BaseView","core/model/UserModel"],(function(e,t,i,osn,o,n){"use strict";return osn.views.UserAvatarView=osn.views.BaseView.extend({displayName:"UserAvatarView",className:function(){var e="userAvatar "+this.options.size;return this.model.get("Enabled")||(e+=" osn-deactivated"),e},events:{"click .user.osn-clickable":"goToUserWall"},initialize:function(){this.listenTo(this.model,"change:profilePic",this.render),this.listenTo(this.model,"change:wallProfilePic",this.render),this.listenTo(this.model,"change:Enabled",this.setAvatarStyle),this.render()},render:function(){return osn.debug("view",this.displayName+": render user "+this.model.get("DisplayName")),this.options.avatarDesc=this.getAvatarDesc(!1),this.options.avatarId=this.options.avatarId||"avatar"+this.model.id,this.$el.html(o({o:t.extend(this.model.toJSON(),this.options)})),this.setAvatarStyle(),this},setAvatarStyle:function(){this.$el.attr("class",t.result(this,"className"))},getAvatarDesc:function(){var e=this.model.get("IsExternalUser")?osn.i18n.t("externalUserTooltip",this.model.get("DisplayName")):this.model.get("DisplayName");return t.escape(e)},goToUserWall:function(e){if(e.preventDefault(),e.stopPropagation(),!this.options.inSharebar){var t=osn.models.UserModel.hasWall(this.model.id)?"/wall":"/profile";i.history.navigate("people/"+this.model.id+t,!0)}},clean:function(){osn.debug("view","UserAvatarView: cleaning "+this.model.id),this.stopListening(),osn.views.BaseView.prototype.clean.call(this)}}),osn.views.UserAvatarView})),define("docs/fileview/view/AnnotationView",["jquery","underscore","backbone","core/util/Constants","docs/fileview/template/Annotation.template","core/util/Logger","common/view/UserAvatarView","jqueryui-amd/widgets/button","jqueryui-amd/widgets/draggable","jqueryui-amd/widgets/resizable"],(function(e,t,i,o,n){"use strict";return docs.views.AnnotationView=i.View.extend({className:"annotation",initialize:function(e){t.bindAll(this,"render","getAnnotDims","dragCompleted","resizeCompleted","handleKeyPress","handleClick","annotationDimensionsChanged","hideRemoveButton","changeSelected","deletedStatusChanged","remove"),this.container=e.container,this.viewHandler=this.container.viewHandler,this.model=e.model,this.render(),this.viewHandler.on("viewer:enableAnnotation",this.hideRemoveButton),this.model.on("viewer:annotationDimensionsChanged",this.annotationDimensionsChanged),this.model.on("change:selected",this.changeSelected),this.model.on("change:isDeleted",this.deletedStatusChanged),this.model.on("remove",this.remove)},render:function(){var t=n({i18n:docs.i18n});if(this.$el.html(t),this.$el.attr("annotid",this.model.get("id")),this.model.has("type")&&this.$el.addClass(this.model.get("type")),!this.model.isMyAnnotation()&&this.model.isCommitted()||this.$el.addClass("my_annotation"),this.model.isCommitted()?this.$el.attr("aria-label",docs.i18n.t("VWR_COMMITTED_ANNOTATION_ARIA_LABEL",this.model.get("type"),this.model.get("creatorName"))):(this.$el.addClass("uncommitted"),this.$el.attr("aria-label",docs.i18n.t("VWR_UNCOMMITTED_ANNOTATION_ARIA_LABEL"))),this.changeSelected(),this.renderAvatars(),this.isEditable()){var i=e(".close-button",this.$el);this.model.isCommitted()?i.hide():(i.show(),i.button({text:!1,icons:{primary:"oj-ux-icon oj-ux-ico-close"}}),i.click(e.proxy(this.removeButtonClicked,this))),e(".annot-pointer",this.$el).show(),this.$el.attr("tabindex",0),this.model.isDraggable()&&this.$el.draggable({containment:"parent",stop:this.dragCompleted}),this.model.isResizable()&&this.$el.resizable({handles:"all",containment:"parent",stop:this.resizeCompleted})}else e(".annot-pointer",this.$el).hide();this.$el.on("click",this.handleClick),this.$el.on("keydown",this.handleKeyPress),this.annotationDimensionsChanged(),this.deletedStatusChanged()},annotationDimensionsChanged:function(){var e=this.getAnnotDims(),t=100*(e.left-e.width/2),i=100*(e.top-e.height/2),n=100*(e.width?e.width:o.Viewer.ANNOT_MIN_WIDTH),s=100*(e.height?e.height:o.Viewer.ANNOT_MIN_HEIGHT);return this.$el.css({position:"absolute",left:Math.round(t)+"%",top:Math.round(i)+"%",width:Math.round(n)+"%",height:Math.round(s)+"%"}),docs.common.Logger("Viewer").debug("render annotation at left: "+t+" top: "+i+" width: "+n+" height: "+s),this},getAnnotDims:function(){var e=this.model.getDimensions();if(this.model.get("type")===o.Viewer.AnnotationType.PUSHPIN){var t=this.container.getZoomLevel()/100,i=this.container.getDimensions();e.width=o.Viewer.ANNOT_PUSHPIN_WIDTH*t/i.width,e.height=o.Viewer.ANNOT_PUSHPIN_HEIGHT*t/i.height}else e.width=e.width||o.Viewer.ANNOT_MIN_WIDTH,e.height=e.height||o.Viewer.ANNOT_MIN_HEIGHT;return e},changeSelected:function(){!0===this.model.get("selected")?this.$el.addClass("selected"):this.$el.removeClass("selected")},deletedStatusChanged:function(){!0===this.model.get("isDeleted")?(this.$el.hide(),this.$el.attr("aria-hidden",!0)):(this.$el.show(),this.$el.attr("aria-hidden",!1))},isEditable:function(){return this.container.editable},dragCompleted:function(e,t){var i,o,n=this.container.getDimensions(),s=this.$el.outerWidth(!1),a=this.$el.outerHeight(!1);i=t.position.left+s<=n.width?(t.position.left+s/2)/n.width:1-s/2/n.width,o=t.position.top+a<=n.height?(t.position.top+a/2)/n.height:1-a/2/n.height,this.viewHandler.updateAnnotation(this.model,{left:i,top:o})},resizeCompleted:function(e,t){var i=this.container.getDimensions();this.viewHandler.updateAnnotation(this.model,{left:(t.position.left+t.size.width/2)/i.width,top:(t.position.top+t.size.height/2)/i.height,width:1*t.size.width/i.width,height:1*t.size.height/i.height})},handleClick:function(e){e.preventDefault(),e.stopPropagation(),docs.events.trigger("viewer:annotationActivated",this.model)},handleKeyPress:function(t){switch(t.keyCode||t.which){case e.ui.keyCode.DELETE:this.model.isCommitted()||(t.preventDefault(),t.stopPropagation(),this.removeButtonClicked());break;case e.ui.keyCode.ENTER:case e.ui.keyCode.RIGHT:this.handleClick(t)}},renderAvatars:function(){var e=this.$(".avatars-container");this.userAvatarView||(this.userAvatarView=new osn.views.UserAvatarView({model:this.model.memberInfo,size:"membersize",hideUserLink:!0,avatarId:"avatar"+(this.model.memberInfo?this.model.memberInfo.id:"")+t.uniqueId("_")})),this.userAvatarView.$el.detach(),this.container.showParticipants&&e.html(this.userAvatarView.el)},hideRemoveButton:function(e){e||this.$(".close-button").hide()},removeButtonClicked:function(){this.viewHandler.removeAnnotation(this.model),this.viewHandler.setAnnotationMode(!1)},remove:function(){this.$el.data("draggable")&&this.$el.draggable("destroy"),this.$el.data("resizable")&&this.$el.resizable("destroy"),this.model.off(null,null,this),this.viewHandler.off(null,null,this),i.View.prototype.remove.call(this)}}),docs.views.AnnotationView})),define("docs/fileview/template/ImageAnnotationDimsPanel.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<input class="id-fld" type="hidden"><table>  <tr>    <td><span class="dialog-label">'+(null==(__t=i18n.t("ANNOT_PANEL_PAGE"))?"":_.escape(__t))+'</span></td>    <td><span class="dialog-label">'+(null==(__t=i18n.t("ANNOT_PANEL_LEFT"))?"":_.escape(__t))+'</span></td>    <td><span class="dialog-label">'+(null==(__t=i18n.t("ANNOT_PANEL_TOP"))?"":_.escape(__t))+'</span></td>    <td><span class="dialog-label">'+(null==(__t=i18n.t("ANNOT_PANEL_WIDTH"))?"":_.escape(__t))+'</span></td>    <td><span class="dialog-label">'+(null==(__t=i18n.t("ANNOT_PANEL_HEIGHT"))?"":_.escape(__t))+'</span></td>    <td><span class="dialog-label">&nbsp;</span></td>  </tr>  <tr>    <td><input class="context-fld dialog-value" aria-label="'+(null==(__t=i18n.t("ANNOT_PANEL_PAGE"))?"":_.escape(__t))+'" pattern="[0-9]{3}" type="text" name="context" min="1" max="100" step="1" size="3"></td>    <td><input class="left-fld dialog-value" aria-label="'+(null==(__t=i18n.t("ANNOT_PANEL_LEFT"))?"":_.escape(__t))+'" type="number" name="left" min="0" max="100" step="1" size="5"></td>    <td><input class="top-fld dialog-value" aria-label="'+(null==(__t=i18n.t("ANNOT_PANEL_TOP"))?"":_.escape(__t))+'" type="number" name="top" min="0" max="100" step="1" size="5"></td>    <td><input class="width-fld dialog-value" aria-label="'+(null==(__t=i18n.t("ANNOT_PANEL_WIDTH"))?"":_.escape(__t))+'" type="number" name="width" min="0" max="100" step="1" size="5"></td>    <td><input class="height-fld dialog-value" aria-label="'+(null==(__t=i18n.t("ANNOT_PANEL_HEIGHT"))?"":_.escape(__t))+'" type="number" name="height" min="0" max="100" step="1" size="5"></td>    <td><button class="containerview-header-button" aria-label="'+(null==(__t=i18n.t("GENERAL_CMD_OK"))?"":_.escape(__t))+'">'+(null==(__t=i18n.t("GENERAL_CMD_OK"))?"":_.escape(__t))+"</button></td>  </tr></table>";return __p}})),define("docs/fileview/view/AnnotationDimsPanel",["jquery","underscore","backbone","jqueryui-amd/widgets/button"],(function(e,t,i){"use strict";return docs.views.AnnotationDimsPanel=i.View.extend({tagName:"div",className:"annot-dims-panel",attributes:function(){return{style:"display:none;","aria-label":docs.i18n.t("ANNOT_PANEL_ARIA_MSG")}},events:{"change input":"dimsPanelFieldChanged","click button":"startAnnotation"},initialize:function(e){return t.bindAll(this,"dimsPanelFieldChanged","startAnnotation","populateDimsPanel"),this.options=e||{},this.options.viewHandler&&(this.listenTo(this.options.viewHandler,"viewer:pageCountChanged",this.handlePageCountChange),this.listenTo(this.options.viewHandler,"viewer:annotationAdded",this.populateDimsPanel),this.listenTo(this.options.viewHandler,"viewer:annotationDimensionsChanged",this.populateDimsPanel)),this.render()},render:function(){return this},show:function(t){this.populateDimsPanel(t),e("button",this.$el).button(),this.positionPanel(),this.$el.show(),this.$el.focus()},hide:function(){this.$el.hide()},positionPanel:function(){var e=this.options.contentArea.position();this.$el.css({top:e.top+"px",left:e.left+this.options.contentArea.innerWidth()-this.$el.outerWidth(!0)+"px"})},dimsPanelFieldChanged:function(){if(this.options.viewHandler){var t=e(event.target),i=t.attr("name"),o=this.getFieldValue(t),n=this.getAnnotation(),s={};s[i]=o,this.updateAnnotation(n,s)}},updateAnnotation:function(e,t){this.options.viewHandler.updateAnnotation(e,t)},getAnnotation:function(){var t=e(".id-fld",this.$el).val();return this.options.viewHandler.getFilteredAnnotations({id:t})[0]},getFieldValue:function(e){return e.val()},populateDimsPanel:function(t){if(t&&!t.isCommitted()){e(".id-fld",this.$el).val(t.get("id"));var i=t.get("context")||1;e(".context-fld",this.$el).val(i),this.populateFields(t)}},populateFields:function(){},startAnnotation:function(e){e.preventDefault(),this.hide(),docs.events.trigger("viewer:start:annotation")},getContextValue:function(){return parseInt(e(".context-fld",this.$el).val()||0,10)},handlePageCountChange:function(){if(this.options.viewHandler&&t.isFunction(this.options.viewHandler.pageCount)){var i=this.options.viewHandler.pageCount(),o=e(".context-fld",this.$el).first();o&&o.attr("max",i)}}}),docs.views.AnnotationDimsPanel})),define("docs/fileview/view/ImageAnnotationDimsPanel",["jquery","underscore","docs/fileview/template/ImageAnnotationDimsPanel.template","docs/fileview/view/AnnotationDimsPanel"],(function(e,t,i){"use strict";return docs.views.ImageAnnotationDimsPanel=docs.views.AnnotationDimsPanel.extend({render:function(){var e=i({i18n:docs.i18n});return this.$el.html(e),this.handlePageCountChange(),this},getFieldValue:function(e){var t;switch(e.attr("name")){case"context":t=parseInt(e.val()||1,10);break;case"top":case"left":case"width":case"height":t=(e.val()||0)/100}return t},populateFields:function(t){var i,o=t.getDimensions();i=(100*o.left).toFixed(2),e(".left-fld",this.$el).val(i),i=(100*o.top).toFixed(2),e(".top-fld",this.$el).val(i),i=(100*o.width).toFixed(2),e(".width-fld",this.$el).val(i),i=(100*o.height).toFixed(2),e(".height-fld",this.$el).val(i)}}),docs.views.ImageAnnotationDimsPanel})),define("docs-fileview-15b22b9.cache",(function(){}));