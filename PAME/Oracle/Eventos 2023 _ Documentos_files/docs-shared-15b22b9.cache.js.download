define("docs/fileview/template/FileViewHeader.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="containerview-title">    <h1 class="containerview-title-label" title="'+(null==(__t=title)?"":__t)+'">'+(null==(__t=title)?"":__t)+"</h1>    ",revision&&revision.display&&(__p+='    \t<div class="containerview-title-subtitle">        ',revision.dispLink?__p+='        <button id="version_button" title="'+(null==(__t=revision.title)?"":_.escape(__t))+'" class="containerview-header-button">'+(null==(__t=revision.value)?"":_.escape(__t))+"</button>        ":__p+='        <div class="revision-label" title="'+(null==(__t=revision.title)?"":_.escape(__t))+'">'+(null==(__t=revision.value)?"":_.escape(__t))+"</div>        ",__p+="      </div>    "),__p+='</div><div class="containerview-header-buttons flush-right"></div><div class="containerview-header-color-stripe"></div>';return __p}})),define("docs/fileview/view/FileViewHeader",["jquery","backbone","underscore","core/util/Constants","common/aif/Manager","core/util/Globals","core/util/Session","common/container/view/ContainerViewHeader","core/dialog/MessageDialog","common/mixin/ConversationsMixin","docs/mixins/FavoritesCache","docs/mixins/FavoritesMixin","common/util/O365Edit","common/container/view/ContextToolbarView","docs/fileview/template/FileViewHeader.template","common/site/SitesUtils","common/plugin/jquery.ui.headerbuttons","common/sidebar/SidebarConfig","jqueryui-amd/widgets/button","jqueryui-amd/widgets/slider"],(function(e,t,i,a,n,docs,s,o,l,d,r,c,u,h,p,m){"use strict";var f=docs.common.Globals,_=docs.common.Service,g=docs.events;return docs.views.FileViewHeader=o.extend(i.extend({id:"fileview-header",template:p,events:i.extend({},o.prototype.events,c.favoriteContainerEvents(),{"click #version_button":"showVersionHistory"}),initialize:function(e){return this.options=e||{},o.prototype.initialize.call(this,e),i.bindAll(this,"zoomMoving","zoomChanged","downloadFile","editFile","toggleShowAnnotations","toggleAnnotationMode","showPropsSidebar","showTagsMetadataSidebar","showConversationsSidebar","hasRevision","conversationChanged","showVersionHistory","annotationModeChanged","hasActions","fileNameChanged","viewHandlerUpdated","revisionChanged","onCloseView","buttonState"),this.listenTo(this.model,"viewer:viewHandlerUpdated",this.viewHandlerUpdated),this.listenTo(this.model,"change:name",this.fileNameChanged),this.listenTo(this.model,"change:revision",this.revisionChanged),this.listenTo(this.model,"change:previewAvailable",this.handleRenderError),this.listenTo(g,"action_exit_fullscreen",this.exitFullScreen),this.listenTo(g,"viewer:fullscreenMode",this.reloadHeaderButtons),this},renderData:function(){var e=parseInt(this.model.get("revision"),10),t=this.options.sidebar.properties;return{title:this.model.get("name"),revision:{dispLink:t,value:docs.i18n.t("FILEVIEW_REV",e).replace(/[()]/g,""),title:docs.i18n.t(t?"ACTION_VERS_TT":"FILEVIEW_ARIA_REV",e),display:this.hasRevision()}}},hasRevision:function(){return!f.isPublicLink},setupHeaderButtons:function(){},viewHandlerUpdated:function(){this.listenTo(this.model.viewHandler,"change:zoomValue",this.zoomChanged),this.listenTo(this.model.viewHandler,"viewer:conversationChanged",this.conversationChanged),this.listenTo(this.model.viewHandler,"viewer:annotationModeChanged",this.annotationModeChanged),this.listenTo(this.model.viewHandler,"viewer:showAnnotationsChanged",this.showAnnotationsChanged),this.listenTo(this.model.viewHandler,"viewer:enableAnnotation",this.enableAnnotation),this.listenTo(this.model.viewHandler,"viewer:allowAnnotation",this.allowAnnotation),this.configureHeaderButtons(),this.renderHeaderButtons()},handleRenderError:function(){this.$(".containerview-header-buttons").headerbuttons("update")},renderHeaderButtons:function(){o.prototype.renderHeaderButtons.call(this),this.$("#version_button").button(),docs.common.Utils.isInFullScreenMode()&&this.$("#version_button").button("disable").removeClass("ui-state-disabled")},configureHeaderButtons:function(){o.prototype.configureHeaderButtons.call(this);var t=i.findWhere(this.headerButtonConfig.items,{action:"action_zoom_slider"});t&&(t.min=this.model.viewHandler.minZoom,t.max=this.model.viewHandler.maxZoom,t.value=this.model.viewHandler.get("zoomValue"),t.slide=e.proxy(this.zoomMoving,this)),this.headerButtonConfig.buttonState=e.proxy(this.buttonState,this)},buttonState:function(e){switch(e){case"action_annotate":return!!this.model.viewHandler&&this.model.viewHandler.annotationMode;case"action_show_annotations":return!!this.model.viewHandler&&(this.model.viewHandler.showAnnotations||this.model.viewHandler.annotationMode);default:throw"Unexpected action requesting state: "+e}},actionSelected:function(t,a){switch(t){case"action_download":this.downloadFile();break;case"action_webedit":this.editFile(a);break;case"action_o365_edit":this.actionO365Edit(a);break;case"action_o365_view":this.actionO365View(a);break;case"action_reserve":this.model.makeReservation();break;case"action_free":var n=this.model.get("reservedBy");n&&n===f.userid?this.model.clearReservation():l.show({title:docs.i18n.t("CLEAR_RESERVE_TITLE",this.model.get("name")),message:docs.i18n.t("CLEAR_RESERVE_CONFIRMATION",this.model.get("reservedByName"),this.model.get("name")),okButtonText:docs.i18n.t("YES"),callback:e.proxy(this.model.clearReservation,this.model),cancelButtonText:docs.i18n.t("NO"),cancelCallback:i.noop,reverseButtons:"no",defaultButton:"cancel",disableScriptProtection:!0});break;case"action_favorite":r.addFavorite(this,this.model);break;case"action_clear_favorite":r.deleteFavorite(this,this.model);break;case"action_rename":var o=i.unescape(this.model.get("name")),d=this.model.get("extension");require(["common/dialog/RenameDialog"],i.bind((function(e){e.show({curName:o,curExt:d,cbOk:function(e){this.model.rename(e)},cbContext:this})}),this));break;case"action_properties":this.showPropsSidebar();break;case"action_tag":this.showTagsMetadataSidebar();break;case"action_conversation":this.showConversationsSidebar();break;case"action_zoom_in":this.model.viewHandler.zoomIn();break;case"action_zoom_out":this.model.viewHandler.zoomOut();break;case"action_zoom_100":this.model.viewHandler.zoom100();break;case"action_fit_page":this.model.viewHandler.fitBest();break;case"action_fit_width":this.model.viewHandler.fitToWidth();break;case"action_show_annotations":this.toggleShowAnnotations(a);break;case"action_annotate":this.toggleAnnotationMode(a);break;case"action_show_aif_sidebar":case"action_hide_aif_sidebar":this.toggleAifSidebar();break;case"action_metadata":g.trigger("sidebar:toggleSidebar","metadata");break;case"action_fullscreen":this.enterFullScreen();break;case"action_exit_fullscreen":this.exitFullScreen();break;case"action_links":this.showLinksDlg();break;case"action_api_info":g.trigger("sidebar:toggleSidebar","api_info");break;case"action_toggle_sidebar":g.trigger("sidebar:toggleSidebar");break;case"action_close":i.isEqual(this.model.get("parentID"),s.getPersonalFolderId())?docs.router.navigate("home",{trigger:!0,replace:!0}):docs.router.navigate("folder/"+this.model.get("parentID"),{trigger:!0,replace:!0});break;default:this.contextActions.triggerAction(t,a)}},fileNameChanged:function(){var e=this.model.get("name");this.$(".containerview-title-label").text(e).attr({title:e}),g.trigger("action:headerRename")},revisionChanged:function(){if(this.hasRevision()){var t="v"+parseInt(this.model.get("revision"),10);e("#version_button",this.$el).attr({title:t}).button("option","label",t),g.trigger("action:headerRename")}},zoomMoving:function(t,i){checkFeatureFlag("BidiSupportSlider")?(this.model.viewHandler&&this.model.viewHandler.setZoomValue(i.value,{zoomMode:a.Viewer.ZoomMode.ZOOM_TO_VALUE}),e('[data-action="action_zoom_slider"]',this.$el).attr("title",docs.i18n.t("GENERAL_CMD_ZOOM_PCT",this.model.viewHandler.get("zoomValue")))):(this.model.viewHandler&&this.model.viewHandler.zooming(i.value),e('[data-action="action_zoom_slider"]',this.$el).slider().find(".ui-slider-handle").attr("title",docs.i18n.t("GENERAL_CMD_ZOOM_PCT",this.model.viewHandler.get("zoomValue"))))},zoomChanged:function(){var t=this.model.viewHandler.get("zoomValue");checkFeatureFlag("BidiSupportSlider")?e('[data-action="action_zoom_slider"]',this.$el).prop("value",Math.min(t,a.Viewer.MAX_ZOOM)).attr("title",docs.i18n.t("GENERAL_CMD_ZOOM_PCT",t)):e('[data-action="action_zoom_slider"]',this.$el).slider("value",t).find(".ui-slider-handle").attr("title",docs.i18n.t("GENERAL_CMD_ZOOM_PCT",t))},conversationChanged:function(e){(i.isUndefined(e)||i.isEmpty(e))&&this.model.viewHandler.setAnnotationMode(!1)},enableAnnotation:function(e){this.$(".containerview-header-buttons").headerbuttons("enableButton","action_annotate",e)},allowAnnotation:function(){this.updateHeaderButtons()},annotationModeChanged:function(e){var t=this.$(".containerview-header-buttons");t.headerbuttons("updateStateButton","action_annotate",e),i.isBoolean(e)&&e||i.isString(e)&&!i.isEmpty(e)?(t.headerbuttons("updateStateButton","action_show_annotations",!0),t.headerbuttons("enableButton","action_show_annotations",!1)):(t.headerbuttons("updateStateButton","action_show_annotations",this.model.viewHandler.showAnnotations),t.headerbuttons("enableButton","action_show_annotations",!0))},showAnnotationsChanged:function(e){this.$(".containerview-header-buttons").headerbuttons("updateStateButton","action_show_annotations",e)},toggleShowAnnotations:function(){this.model.viewHandler&&this.model.viewHandler.setShowAnnotations(!this.model.viewHandler.showAnnotations)},toggleAnnotationMode:function(t){if(this.model.viewHandler&&(this.model.viewHandler.setAnnotationMode(!this.model.viewHandler.annotationMode),t)){var i=t.keyCode||t.which;!t.shiftKey||i!==e.ui.keyCode.ENTER&&i!==e.ui.keyCode.SPACE||g.trigger("annot:dimsPanel")}},toggleAifSidebar:function(){g.trigger("sidebar:toggleSidebar","aif")},downloadFile:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.startDownload(!1),g.trigger("history:modified")},editFile:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.startEdit()},actionO365Edit:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.startEdit("o365Edit")},actionO365View:function(e){e&&(e.stopPropagation(),e.preventDefault()),this.model.startView()},onCloseView:function(){this.stopListening(),o.prototype.onCloseView.call(this)},showPropsSidebar:function(t){this.$sideboard=e(".layout-sidebar-sideboard");var i=this.$sideboard.find('.sideboard-button[data-name="properties"]');!i.hasClass("selected")||i.removeClass("selected"),t=t||"propTab",sessionStorage.setItem("DocsSelectedtab",t),g.trigger("sidebar:showSidebar","properties")},showTagsMetadataSidebar:function(){g.trigger("sidebar:toggleSidebar","metadata")},showConversationsSidebar:function(){g.trigger("sidebar:toggleSidebar","conversation")},showVersionHistory:function(){docs.common.Utils.isInFullScreenMode()||this.showPropsSidebar("versionTab")},showLinksDlg:function(){require(["docs/share/ShareLinkDialog"],i.bind((function(e){e.show({item:this.model,container:this.model,dialogTitle:docs.i18n.t("LINK_SHARE_DLG_TITLE",i.unescape(this.model.get("name")))})}),this))},enterFullScreen:function(){var t=this.$el.closest(".full-page-dialog");0===t.length&&(t=e(".mainViewContainer"));var i=t.get(0);i.requestFullscreen?i.requestFullscreen():i.mozRequestFullScreen?i.mozRequestFullScreen():i.webkitRequestFullscreen?i.webkitRequestFullscreen():i.msRequestFullscreen&&i.msRequestFullscreen()},exitFullScreen:function(){docs.common.Utils.isInFullScreenMode()&&(document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen())},hasActions:function(){var t=docs.common.Utils.isInFullScreenMode(),a=this.$el.closest(".full-page-dialog").length>0,s=this.contextActions.hasActions(this.model,["action_download","view_menu","edit_menu","action_webedit","action_o365_edit","action_o365_view","action_links","action_upload_version","action_rename","action_properties","action_tag","action_conversation","action_reserve","action_free"]),o=f.isPublicLink,l=f.isPublicUser,d=f.isAppLink,r=f.isGuestWithHybLink,c=this.model.isReserved(),h=this.options.actions.favorite&&docs.mixins.FavoritesMixin.isFavoritesEnabled(this.model),p=!!h&&this.isFavorite(this.model),g=this.model.viewHandler&&this.model.viewHandler.isZoomable(),v=this.model.viewHandler&&this.model.viewHandler.canAnnotate()&&this.options.header.annotate,b=this.model.viewHandler&&this.model.viewHandler.canViewAnnotations()&&this.options.header.annotate,D=!this.options.controls.zoom,y=!this.options.controls.zoom,A=!this.options.controls.fitPage,T=!this.options.controls.fitWidth,w=this.options.urlParams.hide_sidebar,E=(n.hasSidebarActions(this.model)&&this.options.urlParams.hide_aif,e(".sideboard-pane-content.aif-pane").is(":visible"),m.isSites(this.model)),M=m.isTheme(this.model),C=m.isApp(this.model),k=m.isTemplate(this.model);s.action_reserve=s.action_reserve&&!c&&!t,s.action_free=s.action_free&&c&&!t,s.action_links=s.action_links&&!d&&!t,s.action_close=this.options.header.close&&!((f.isPublicLink||f.isAppLink)&&"LD"===_.linkId.slice(0,2)),u.isEnabled({systemAndTenant:!0})&&(s.edit_menu=s.action_o365_edit||s.action_webedit,s.action_webedit&&!s.action_o365_edit?delete s.edit_menu:s.edit_menu&&delete s.action_webedit,s.view_menu=s.action_o365_view),s.action_metadata=!l&&!E&&!d&&!w&&f.isMetadataEnabled&&!t;var S={action_favorite:!p&&h&&!t,action_clear_favorite:p&&h&&!t,action_zoom_out:g&&!D,action_zoom_slider:g&&!y&&!D,action_zoom_in:g&&!D,action_zoom_100:g&&this.model.viewHandler&&this.model.viewHandler.isZoomable100()&&!D,action_fit_page:g&&!A,action_fit_width:g&&!T,action_annotate:(!o||!l)&&!d&&!r&&v&&!t&&!a,action_show_annotations:(!o||!l)&&!d&&!r&&b&&!t&&!a},I=!!this.options.urlParams.conversationId,N=!l,O=(N||!o||N&&I)&&!w&&(!E||M||C||k)&&!t,x=this.options.header.fullScreen,L={action_toggle_sidebar:O&&docs.sidebar.Config.getTabs(this.model,this.options).length>0,action_fullscreen:!t&&docs.common.Utils.isFullScreenModeSupported()&&x&&!1!==this.model.get("previewAvailable"),action_exit_fullscreen:t&&docs.common.Utils.isFullScreenModeSupported()},F=e.extend(!0,{},s,S,L);if(t){var V={};i.each(s,(function(e,t){V[t]=!1})),F=e.extend(!0,{},V,S,L)}return F},headerButtonConfig:{menu:{text:"CONTEXT_TOOLBAR_MORE"},hasActions:null,items:[{action:"view_menu",location:"left",locationOrder:0,menu:"show",weight:5,menuOrder:0,locationType:"comboButton",tooltip:"MENU_VIEW_TT",text:"ACTION_VIEW"},{action:"edit_menu",location:"left",locationOrder:1,menu:"show",weight:4,menuOrder:1,locationType:"comboButton",tooltip:"MENU_EDIT_TT",text:"ACTION_EDIT"},{action:"action_webedit",location:"left",locationOrder:1,menu:"show",menuOrder:1,weight:4,tooltip:"ACTION_EDIT_TT",text:"GENERAL_CMD_EDIT"},{action:"action_download",location:"left",locationOrder:3,menu:"show",menuOrder:2,weight:6,title:"ACTION_DOWNLOAD_TT",tooltip:"ACTION_DOWNLOAD_TT",text:"GENERAL_CMD_DOWNLOAD"},{action:"action_favorite",location:"menu",menu:"show",menuOrder:3,title:"ACTION_ADD_FAVORITE",text:"ACTION_ADD_FAVORITE"},{action:"action_clear_favorite",location:"menu",menu:"show",menuOrder:4,title:"ACTION_DELETE_FAVORITE",text:"ACTION_DELETE_FAVORITE"},{action:"action_reserve",location:"menu",menu:"show",menuOrder:5,title:"ACTION_RESERVE_TT",text:"ACTION_RESERVE"},{action:"action_free",location:"menu",menu:"show",menuOrder:6,title:"ACTION_FREE_TT",text:"ACTION_FREE"},{action:"action_close",location:"left",locationOrder:5,menu:"show",weight:8,menuOrder:7,title:"ACTION_CLOSE_TT",tooltip:"ACTION_CLOSE_TT",text:"GENERAL_CMD_CLOSE"},{menuSeparator:!0,location:"menu",menuOrder:8},{action:"action_links",location:"left",locationOrder:1,menu:"show",menuOrder:9,weight:2,tooltip:"ACTION_LINKS_FOLDER_TOOLTIP",title:"ACTION_LINKS_FOLDER_TOOLTIP",text:"ACTION_LINKS"},{menuSeparator:!0,location:"menu",menuOrder:10},{action:"action_upload_version",location:"menu",menu:"show",menuOrder:11,title:"ACTION_UPLOAD_NEW_VERSION_TT",text:"ACTION_UPLOAD_NEW_VERSION",isUploader:!0,isSingleFile:!0},{action:"action_rename",location:"menu",menu:"show",menuOrder:12,title:"ACTION_RENAME_TT",text:"ACTION_RENAME"},{action:"action_properties",location:"menu",menu:"show",menuOrder:13,title:"ACTION_PROPERTIES_TT",text:"ACTION_PROPERTIES"},{action:"action_tag",location:"menu",menu:"show",menuOrder:14,title:"METADATA_ACTION_TAG_TT",text:"METADATA_ACTION_TAG"},{action:"action_conversation",location:"menu",menu:"show",menuOrder:15,title:"ACTION_CONVERSATION_TT",text:"ACTION_CONVERSATION"},{menuSeparator:!0,location:"menu",menuOrder:16},{action:"action_show_annotations",location:"right",locationOrder:5,menu:"show",menuOrder:17,weight:7,title:"GENERAL_CMD_SHOW_ANNOT",icon:"ui-icon-annotation-show oj-ux-icon oj-ux-ico-annotation",locationType:"stateButton"},{action:"action_annotate",location:"right",locationOrder:4,menu:"show",menuOrder:18,weight:7,text:"GENERAL_CMD_ANNOT_MODE",icon:"ui-icon-annot-mode oj-ux-icon oj-ux-ico-message",locationType:"stateButton"},{menuSeparator:!0,location:"menu",menuOrder:19},{action:"action_zoom_out",location:"right",locationOrder:1,menu:"show",menuOrder:20,weight:3,title:"GENERAL_CMD_ZOOM_OUT",icon:"oj-ux-ico-minus"},{action:"action_zoom_slider",location:"right",locationOrder:2,menu:"hide",menuOrder:21,weight:3,locationType:"slider",min:0,max:100,value:50},{action:"action_zoom_in",location:"right",locationOrder:3,menu:"show",menuOrder:22,weight:3,title:"GENERAL_CMD_ZOOM_IN",icon:"oj-ux-ico-plus"},{action:"action_zoom_100",location:"menu",menu:"show",menuOrder:23,title:"GENERAL_CMD_ZOOM_100",text:"GENERAL_CMD_ZOOM_100"},{action:"action_fit_page",location:"menu",menu:"show",menuOrder:24,title:"GENERAL_CMD_PAGE",text:"GENERAL_CMD_PAGE"},{action:"action_fit_width",location:"menu",menu:"show",menuOrder:25,title:"GENERAL_CMD_WIDTH",text:"GENERAL_CMD_WIDTH"},{menuSeparator:!0,location:"menu",menuOrder:26},{action:"action_toggle_sidebar",location:"side",menu:"show",menuOrder:27,weight:5,title:"ACTION_TOGGLE_SIDEBAR_TT",text:"ACTION_TOGGLE_SIDEBAR",icon:"header-sider-icon oj-ux-icon oj-ux-ico-side-bar"},{menuSeparator:!0,location:"menu",menuOrder:28},{action:"action_fullscreen",location:"left",locationOrder:4,menu:"show",weight:1,menuOrder:29,tooltip:"ACTION_FULLSCREEN_TT",text:"ACTION_FULLSCREEN"},{action:"action_exit_fullscreen",location:"left",locationOrder:4,menu:"show",menuOrder:29,tooltip:"ACTION_EXIT_FULLSCREEN_TT",text:"ACTION_EXIT_FULLSCREEN"}]},getItemActions:function(){var e=new t.Collection(this.contextActions.itemActions[this.model.get("type")]);return e.remove("action_view"),h.resolveMenuItems(e),e},getComboButtonItems:function(e,t){switch(e){case"view_menu":case"edit_menu":return this.getActionSubmenuList(e,t)}},getActionSubmenuList:function(e,t){var a=this.getItemActions(),n=[],s=a.findWhere({id:e});if(s){var o=s.get("children"),l=a.filter((function(e){return i.contains(o,e.get("id"))}));i.each(l,(function(e,i){this.contextActions.hasActions(this.model,[e.id])[e.id]&&n.push(this.getItemProps(e,i,{verbose:t}))}),this)}return n},getItemProps:function(e,t,i){var a="";return(i=i||{}).noTooltip||(a=e.get("tooltip")?e.get("tooltip"):e.get("label")),{action:e.id,locationType:"comboAction",order:t,rawText:e.get("label"),rawTooltip:a,itemIcon:e.has("icon")?e.get("icon"):null,itemIconClass:e.has("iconClass")?e.get("iconClass"):null}}},c,d)),docs.views.FileViewHeader})),define("docs/metadata/template/MetadataAdmin.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-admin-body">  <div id="metadata-admin" class="metadata-admin-header">    <h1 class="metadata-heading" id="metadata-admin-boilerplate-title">'+(null==(__t=i18n.t("METADATA_FIELD_NAME"))?"":_.escape(__t))+'</h1>    <button type="button" class="metadata_button" id="metadata-admin-button" style="margin-top: -40px">'+(null==(__t=i18n.t("METADATA_NEW_GROUP"))?"":_.escape(__t))+'</button>    <hr>    <p class="metadata-descriptive-text">'+(null==(__t=i18n.t("METADATA_ADMIN_PROMPT_TEXT"))?"":_.escape(__t))+'</p>    \x3c!--div class="form-row" id="enable-metadata-pairs-row"--\x3e      <div class="enable-metadata-pairs-div">        <fieldset>          <legend>            <label class="form-label" style="text-align: start;">'+(null==(__t=i18n.t("METADATA_ADMIN_SHOW_CUSTOM_PROPERTIES"))?"":_.escape(__t))+'</label>            <input id="enable-metadata-pairs" type="radio" class="adminField oj-ux-icon-radio" name="enable-metadata-pairs" '+(null==(__t=enableMetadataPairs)?"":_.escape(__t))+' ></input>            <label for="enable-metadata-pairs">'+(null==(__t=i18n.t("APP_CONFIG_ENABLED_APP"))?"":_.escape(__t))+'</label>            <input id="enable-metadata-pairs-off" type="radio" class="adminField oj-ux-icon-radio" name="enable-metadata-pairs" '+(null==(__t=enableMetadataPairsOff)?"":_.escape(__t))+'>            <label for="enable-metadata-pairs-off">'+(null==(__t=i18n.t("APP_CONFIG_DISABLED_APP"))?"":_.escape(__t))+'</label>          </legend>        </fieldset>      </div>    \x3c!--/div--\x3e  </div>  <div class="admin-metadata-flex"></div></div>';return __p}})),define("docs/metadata/model/MetadataTenantInfo",["jquery","underscore","backbone","core/view/BaseView","core/util/Globals","core/util/Service","core/util/Jsonify","core/util/Logger","core/view/MessageBar"],(function(e,t,i){"use strict";var a=docs.common.Service,n=docs.common.Jsonify,s=docs.common.Globals,o=docs.views.MessageBar;return docs.models.MetadataTenantInfo=i.Model.extend({defaults:function(){return{enableMetadataTags:"true",enableMetadataPairs:"false",enableMetadataAdmin:"false",tenantID:""}},initialize:function(){this.fetch({async:!1})},url:function(){return a?a.formatServiceUrl("GET_TENANT_CONFIG"):s.serviceRoot+"?IdcService=GET_TENANT_CONFIG"},parse:function(e){var i=n.parse_TENANT_INFO(e);return t.defaults(i,this.defaults),i.user_trash_expiration<0&&(i.user_trash_expiration=this.defaults.user_trash_expiration),null!==i.allowSites&&void 0!==i.allowSites||(i.allowSites=i.tenant_flags.allowPublicLinks),i},commit:function(i){if(i&&!t.isEmpty(i)){var n=a.getServiceParamsForPost("SET_TENANT_CONFIG"),s=[];t.each(i,(function(e,t){"enableMetadataTags"===t?s.push(["EnableMetadataTags",e,"BOOLEAN"]):"enableMetadataPairs"===t?s.push(["EnableMetadataPairs",e,"BOOLEAN"]):"enableMetadataAdmin"===t&&s.push(["EnableMetadataAdmin",e,"BOOLEAN"])}),this);var l={LocalData:n.data};s.length>0&&(l.ResultSets={TenantOptions:{fields:[{name:"dTenantOptionName"},{name:"dTenantOptionValue"},{name:"dTenantOptionDataType"}],rows:s}});var d=JSON.stringify(l),r=null;this.changedAttrs=i;var c=this;return e.ajax(n.url,{type:"POST",data:d,async:!1,contentType:"application/json",success:function(){docs.common.Logger("Metadata").info("Custom Properties successfully set");var e="true"===c.changedAttrs.enableMetadataPairs,t=e?docs.i18n.t("METADATA_CUSTOM_PROPERTIES_ENABLED"):docs.i18n.t("METADATA_CUSTOM_PROPERTIES_DISABLED");new o({messageText:t,messageType:"success"}),docs.common.Globals.isMetadataEnabled=e},error:function(e,t,i){r={errorThrown:i,showErrorBar:!e.reauthenticate&&!e.showBoilerplate},e.showWebBar=!1}}),r}}}),docs.models.MetadataTenantInfo})),define("docs/metadata/model/MetadataDefinition",["jquery","underscore","backbone","core/util/Globals","core/util/Service","common/metadata/common/Utils","core/view/MessageBar","core/util/Logger"],(function(e,t,i,docs,a,n,s){"use strict";return docs.models.MetadataDefinition=i.Model.extend({initialize:function(e,t){this.options=t||{}},getExistingField:function(e){var i=this.get("fields");return t.find(i,(function(t){return e.id?e.id!==t.id&&t.name.toUpperCase()===e.name.toUpperCase():t.name.toUpperCase()===e.name.toUpperCase()}))},deleteDefinition:function(){var t=this.get("id");if(!this.get("displayName"))throw"A metadata definition must be selected to delete that definition.";var i=a.getServiceParamsForPost("DELETE_METADATA_COLLECTION");i.data.collections="dCollectionName:"+t;var n=this;e.ajax(i.url,{type:"POST",data:i.data,async:!1,success:function(){n.commitState={result:!0},docs.common.Logger("Metadata").info("Successfully deleted metadata definition"),new s({messageText:docs.i18n.t("METADATA_DELETE_SUCCESS_MSG",n.get("name")),messageType:"success"})},error:function(e,t,i){if(n.commitState={result:!1},i.errorMsgKey.indexOf("csMetaCollectionDoesntExist")>-1){var a=n.get("displayName")?n.get("displayName"):n.get("name");i.errorMsg=docs.i18n.t("METADATA_DELETE_GROUP_FAIL_DELETED",a)}}})},editDefinition:function(i,s,o){var l=a.getServiceParamsForPost("EDIT_METADATA_COLLECTION_AND_FIELD");l.data.collections="dCollectionName:"+this.get("displayName");var d="",r=!1;i&&i.length>0&&(d=n.formatFields(i,l),l.data["fields+"]=d),o&&o.length>0&&(d="",r=!1,t.each(o,(function(e){r&&(d+=","),d=d+"dFieldName:"+e.name,r=!0})),l.data["fields-"]=d);var c=a.getServiceParamsForPost("EDIT_METADATA_FIELD");c.data.collection="dCollectionName:"+this.get("displayName"),d="",r=!1,s&&s.length>0&&(d=n.formatFields(s,c),c.data.fields=d);var u=this;(i&&i.length>0||o&&o.length>0)&&e.ajax(l.url,{type:"POST",data:l.data,async:!1,success:function(){docs.common.Logger("Metadata").info("Successfully added and removed from metadata definition"),u.commitState={result:!0}},error:function(e,i,a){if(u.commitState={result:!1},docs.common.Logger("Metadata").error("Failed to add and remov from metadata definition. Error message from server is: "+a.errorMsg),n.hasErrorToTrap(a.errorMsgKey))if(e.errorHandled=!0,a.errorMsgKey.indexOf("csMetaCollectionDoesntExist")>-1){var s=u.get("displayName")?u.get("displayName"):u.get("name");u.commitState.errorMsg=docs.i18n.t("METADATA_EDIT_GROUP_FAIL_DELETED",s)}else if(a.errorMsgKey.indexOf("csMetaCollectionFieldDoesntExists")>-1){var o,l=a.errorMsgKey.split(","),d=l.length>1?l[1]:"";if(d&&d.startsWith("XF")){var r=t.find(u.get("fields"),(function(e){return d===e.id}));o=r&&r.get("displayName")?r.get("displayName"):r&&r.get("name")?r.get("name"):""}o||(o=d),u.commitState.errorMsg=docs.i18n.t("METADATA_DELETE_FIELD_FAIL_DELETED",o)}else u.commitState.errorMsg=a.errorMsg}}),s&&s.length>0&&e.ajax(c.url,{type:"POST",data:c.data,async:!1,success:function(){docs.common.Logger("Metadata").info("Successfully editted metadata definition"),u.commitState={result:!0}},error:function(e,i,a){if(u.commitState={result:!1},docs.common.Logger("Metadata").error("Failed to edit metadata definition. Error message from server is: "+a.errorMsg),n.hasErrorToTrap(a.errorMsgKey))if(e.errorHandled=!0,a.errorMsgKey.indexOf("csMetaCollectionDoesntExist")>-1){var s=u.get("displayName")?u.get("displayName"):u.get("name");u.commitState.errorMsg=docs.i18n.t("METADATA_EDIT_GROUP_FAIL_DELETED",s)}else if(a.errorMsgKey.indexOf("csMetaDefinitionDoesntExist")>-1){var o,l=a.errorMsgKey.split(","),d=l.length>1?l[1]:"";if(d&&d.startsWith("XF")){var r=t.find(u.get("fields"),(function(e){return d===e.id}));o=r&&r.displayName?r.displayName:r&&r.name?r.name:void 0}o||(o=d),u.commitState.errorMsg=docs.i18n.t("METADATA_EDIT_FIELD_FAIL_DELETED",o)}else u.commitState.errorMsg=a.errorMsg}})},isSaving:function(e){return t.isUndefined(e)||(this.saving=e),this.saving},adjustMultiValueField:function(i,n,s,o){if(o=o||{},n&&!t.isEmpty(n.trim())&&s&&!t.isEmpty(s.trim())){var l=a.getServiceParamsForPost("SET_METADATA");l.data.collection="dCollectionName:"+this.get("displayName");var d="",r=!1;t.each(i,(function(e){r?d+=","+e:(d+=e,r=!0)}),this),l.data.items=d;var c=n;o.removing?c+="-":c+="+",l.data[c]=s,e.ajax(l.url,{type:"POST",data:l.data,async:!!o.async,success:function(e){docs.common.Logger("Metadata").info("Successfully adjusted multi value field"),t.isFunction(o.success)&&o.success(e)},error:function(e,i,a){docs.common.Logger("Metadata").error("Failed to adjust multi value field. Error message from server is: "+a.errorMsg),t.isFunction(o.error)&&o.error(e,i,a)}})}},setValue:function(i,n,s){var o=t.map(i,(function(e){return("F"===e[0]?"fFolderGUID:":"fFileGUID:")+e})).join(","),l=a.getServiceParamsForPost("SET_RESET_METADATA");l.data.collections="dCollectionName:"+this.get("displayName"),l.data.items=o,l.data[n]=s,l.data.fields="dFieldName:"+n;var d=e.Deferred();return e.ajax(l.url,{type:"POST",data:l.data,success:function(e){d.resolve(e)},error:function(e,t,i){d.reject(e,t,i)}}),d}},{assign:function(i,n,s){var o=a.getServiceParamsForPost("ASSIGN_METADATA_COLLECTION");o.data.collections="dCollectionName:"+n,o.data.items=i,e.ajax(o.url,{type:"POST",data:o.data,success:function(){docs.common.Logger("Metadata").info("Successfully assign metadata group"),t.isFunction(s)&&s()},error:function(e,t,i){docs.common.Logger("Metadata").error("Failed to assign metadata group. Error message from server is: "+i.errorMsg)}})}}),docs.models.MetadataDefinition.DefaultMetadata=new docs.models.MetadataDefinition({id:"dDefaultFolderMetaCollection",displayName:"dDefaultFolderMetaCollection"}),docs.models.MetadataDefinition})),define("docs/metadata/model/MetadataDefinitions",["jquery","underscore","backbone","core/util/Service","common/metadata/common/Utils","core/view/MessageBar","core/util/Jsonify","core/util/Globals","core/util/Logger","docs/metadata/model/MetadataDefinition"],(function(e,t,i,a,n,s,o,docs){"use strict";docs.models.MetadataDefinitions=i.Collection.extend({model:docs.models.MetadataDefinition,url:function(){return this.getUrl()},getUrl:function(){throw"Derived collection must override getUrl function"},initialize:function(e,t){t=t||{}},comparator:function(e){return e.get("displayName").toUpperCase()},fetch:function(e){e=e||{},i.Collection.prototype.fetch.call(this,e)},parse:function(e){return o.parseMetadataDefintions(e)},keyToCollectionName:function(e){if(!t.isEmpty(e))return"dCollectionName:"+e;throw"Key is invalid"},keysToCollectionNameList:function(e){var i="",a=!1;return t.isEmpty(e)||t.each(e,(function(e){a&&(i+=","),i+=this.keyToCollectionName(e),a=!0}),this),i},setResetValues:function(i,n){if(!i||!n||t.isEmpty(n))throw"A metadata definition and a defined item must exist to unassign a metadata definition.";this.docsItem=i,this.modifiedCollections=n;var l=this.get("displayName"),d=a.getServiceParamsForPost("SET_RESET_METADATA"),r=t.keys(n);d.data.collections=this.keysToCollectionNameList(r),d.data.items=i.targetId();var c="",u=!1;t.each(r,(function(e){var i=n[e].dirtyValues;if(!t.isEmpty(i)){this.models.filter((function(t){return t.id===n[e].id}))[0].isSaving(!0);var a=t.keys(i);t.each(a,(function(a){u&&(c+=","),c=c+"dFieldName:"+e+"."+a,u=!0,t.isEmpty(i[a])||(d.data[e+"."+a]=i[a])}))}}),this),t.isEmpty(c)||(d.data.fields=c);var h=this;d.data.fields&&d.data.fields.length>0&&e.ajax(d.url,{type:"POST",data:d.data,async:!1,success:function(i){var a=t.isEmpty(h.docsItem.get("targetID"))?h.docsItem.get("id"):h.docsItem.get("targetID"),n=o.parse_item_GET_METADATA(i,a),s=h.docsItem.get("metadata")||{},d=t.keys(h.modifiedCollections),r=t.keys(n);t.each(r,(function(e){t.contains(d,e)||delete n[e]}),this);var c={};e.extend(c,s,n),h.docsItem.set({metadata:c},{silent:!0}),h.docsItem.trigger("change:metadata"),docs.common.Logger("Metadata").info("Successfully set metadata values"+l)},error:function(e,a,n){if(n&&n.errorMsgKey&&n.errorMsgKey.indexOf("csUnableToSetMetadata")>-1){var o=n.errorMsgKey.split(",");if(n.errorMsgKey.indexOf("csMetaCollectionNotAssigned")>-1){var l=i.get("name"),d=i.isFile,r=t.isEmpty(h.docsItem.get("targetID"))?h.docsItem.get("id"):h.docsItem.get("targetID"),c=o.length>2&&o[2].indexOf(r)>-1,u=h.get("displayName"),p=c?d?"METADATA_DEF_SET_VALUES_FAIL_KNOWN_FILE":"METADATA_DEF_SET_VALUES_FAIL_KNOWN_FOLDER":"METADATA_DEF_SET_VALUES_FAIL_UNKNOWN_ITEM";new s({messageText:docs.i18n.t(p,u,l),messageType:"error"}),e.errorHandled=!0}else new s({messageText:docs.i18n.t("METADATA_DEF_SET_VALUES_FAIL_UNKNOWN"),messageType:"error"}),e.errorHandled=!0}e.errorHandled||(n&&n.errorMsg?docs.common.Logger("Metadata").error("Failed to set metadata values. Error message from server is: "+n.errorMsg):docs.common.Logger("Metadata").error("Failed to set metadata values."))}})},assignDefinitions:function(t,i){if(!t)throw"A defined item must exist to assign metadata definitions.";var n=a.getServiceParamsForPost("ASSIGN_METADATA_COLLECTION");n.data.collections=this.keysToCollectionNameList(i),n.data.items=t.targetId(),e.ajax(n.url,{type:"POST",data:n.data,async:!1,success:function(){docs.common.Logger("Metadata").info("Successfully assigned metadata definitions: "+i.toString())},error:function(e,t,i){i&&i.errorMsg?docs.common.Logger("Metadata").error("Failed to assign metadata definitions. Error message from server is: "+i.errorMsg):docs.common.Logger("Metadata").error("Failed to assign metadata definitions.")}})},unassignDefinitions:function(i,n){if(!i)throw"A defined item must exist to unassign metadata definitions.";var s=a.getServiceParamsForPost("UNASSIGN_METADATA_COLLECTION");s.data.collections=this.keysToCollectionNameList(n),s.data.items=i.targetId(),e.ajax(s.url,{type:"POST",data:s.data,async:!1,success:function(){docs.common.Logger("Metadata").info("Successfully unassigned metadata definitions: "+n.toString())},error:function(e,a,s){if(s&&s.errorMsgKey&&s.errorMsgKey.indexOf("csMetaCollectionNotAssigned")>-1){var o=s.errorMsgKey.split(",");if(o&&o.length>1)n.indexOf(o[1])>-1&&1===n.length&&(e.errorHandled=!0);if(!e.errorHandled){var l=i.get("name"),d=i.isFile,r=t.isEmpty(i.get("targetID"))?i.get("id"):i.get("targetID"),c=o.length>2&&o[2].indexOf(r)>-1?d?"METADATA_MANAGE_UNASSIGN_FAIL_KNOWN_FILE":"METADATA_MANAGE_UNASSIGN_FAIL_KNOWN_FOLDER":"METADATA_MANAGE_UNASSIGN_FAIL_UNKNOWN_ITEM";new docs.views.MessageBar({messageText:docs.i18n.t(c,l),messageType:"error"}),e.errorHandled=!0}}e.errorHandled||(s&&s.errorMsg?docs.common.Logger("Metadata").error("Failed to unassign metadata definitions. Error message from server is: "+s.errorMsg):docs.common.Logger("Metadata").error("Failed to unassign metadata definitions."))}})},createDefinition:function(t,i){var o=a.getServiceParamsForPost("CREATE_METADATA_COLLECTION_AND_FIELD");o.data.collections="dCollectionName:"+t.groupName,o.data.dIsMultiValued="0";var l=n.formatFields(i,o);o.data.fields=l;var d=t;e.ajax(o.url,{type:"POST",data:o.data,async:!1,success:function(){docs.common.Logger("Metadata").info("Successfully created metadata definition"+o.data.dAnnotationID),d.commitState={result:!0},new s({messageText:docs.i18n.t("METADATA_CREATE_SUCCESS_MSG",d.groupName),messageType:"success"})},error:function(e,t,i){d.commitState={result:!1},docs.common.Logger("Metadata").error("Failed to create metadata definition. Error message from server is: "+i.errorMsg),n.hasErrorToTrap(i.errorMsgKey)&&(e.errorHandled=!0,i.errorMsgKey.indexOf("csMetaDefinitionExists")>-1?d.commitState.errorMsg=docs.i18n.t("METADATA_CREATE_GROUP_FAIL_EXISTS",d.groupName):d.commitState.errorMsg=i.errorMsg)}})}}),docs.models.AssignedMetadataDefinitions=docs.models.MetadataDefinitions.extend({initialize:function(e,t){this.options=t||{},this.updateAssigned(t.assignedNames),docs.models.MetadataDefinitions.prototype.initialize.call(this,e,t)},updateAssigned:function(e){var i=t.without(e,"dDefaultFolderMetaCollection");this.options.assignedNames=i},fetch:function(e){e=e||{},t.isEmpty(this.options.assignedNames)?this.reset():docs.models.MetadataDefinitions.prototype.fetch.call(this,e)},getUrl:function(){var e=a.formatServiceUrl("GET_METADATA_COLLECTION");return e+="&collections=",e+=encodeURIComponent(this.keysToCollectionNameList(this.options.assignedNames))},getCollectionData:function(t){var i=a.formatServiceUrl("FLD_GET_COLLECTIONS");i+="&item="+t.targetId(),e.ajax(i,{async:!1,success:function(e){var i=o.parse_FLD_GET_COLLECTIONS(e);t.set("collections",i)}})}}),docs.models.AllMetadataDefinitions=docs.models.MetadataDefinitions.extend({initialize:function(e,t){t=t||{},docs.models.MetadataDefinitions.prototype.initialize.call(this,e,t)},getUrl:function(){var e=a.formatServiceUrl("GET_ALL_METADATA_COLLECTIONS");return e+="&doRetrieveCollectionFields=1"}})})),define("docs/metadata/template/MetadataDefinitions.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-defintions-loading">  <img class="bp-center-image" src="'+(null==(__t=loading)?"":_.escape(__t))+'" role="presentation" alt="" /></div><div class="metadata-definitions-bp"></div><div class="metadata-direct-definitions">  <div class="metadata-directs-label metadata-group-label">'+(null==(__t=i18n.t("SIDEBAR_METADATA_DIRECTS_LABEL"))?"":_.escape(__t))+'</div>  <div class="metadata-definitions"></div></div><div class="metadata-acquired-definitions">  <div class="metadata-acquired-label metadata-group-label">'+(null==(__t=i18n.t("SIDEBAR_METADATA_ACQUIRED_LABEL"))?"":_.escape(__t))+'</div>  <div class="metadata-definitions"></div></div>';return __p}})),define("assets/view/BaseSideBarPane",["jquery","underscore","backbone","core/util/Globals","core/view/SpinnerView","common/dialog/ConfirmationDialogView","css!geminiCss/gemini-assets","jqueryui-amd/widgets/button"],(function(e,t,i,docs,a,n){"use strict";var s={default:{deleteConfirmationTitle:"REMOVE_CATEGORY",deleteConfirmationStr:"REMOVE_FROM_CATEGORY_CONFIRM",assignToAllConfirmationStr:"ASSIGN_TO_ALL_ASSETS_CONFIRM",bpNoSelectedAssetsDesc:"BP_NO_CATEGORIES_ASSIGNED_DESC",bpNoAssignedTypeImage:"images/Boilerplate_Missing_Preference_Mono.png",bpNoAssignedTypeMessage:"BP_NO_CATEGORIES_ASSIGNED_TITLE",bpNoAssignedTypeDesc:"BP_NO_CATEGORIES_ASSIGNED_DESC",tableAriaLabel:"CATEGORY_TABLE_LABEL",itemTypeHeaderLabel:"CATEGORY_NAME_LABEL"},categories:{deleteConfirmationTitle:"REMOVE_CATEGORY",deleteConfirmationStr:"REMOVE_FROM_CATEGORY_CONFIRM",assignToAllConfirmationStr:"ASSIGN_TO_ALL_ASSETS_CONFIRM",bpNoSelectedAssetsDesc:"BP_CATEGORIES_NO_SELECTION_DESC",bpNoAssignedTypeImage:"images/Boilerplate_Nothing_to_Display_Mono.png",bpNoAssignedTypeMessage:"BP_NO_CATEGORIES_ASSIGNED_TITLE",bpNoAssignedTypeDesc:"BP_NO_CATEGORIES_ASSIGNED_DESC",tableAriaLabel:"CATEGORY_TABLE_LABEL",itemTypeHeaderLabel:"CATEGORY_NAME_LABEL"},tags:{deleteConfirmationTitle:"REMOVE_TAG",deleteConfirmationStr:"REMOVE_TAG_CONFIRM",assignToAllConfirmationStr:"ASSIGN_TAG_TO_ALL_ASSETS_CONFIRM",bpNoSelectedAssetsDesc:"BP_NO_ASSET_SELECTED_TAGS",bpNoAssignedTypeImage:"images/Boilerplate_Missing_Preference_Mono.png",bpNoAssignedTypeMessage:"BP_NO_ASSIGNED_TAGS_TITLE",bpNoAssignedTypeDesc:"BP_NO_ASSIGNED_TAGS_DESC",tableAriaLabel:"TAG_TABLE_ARIA_LABEL",itemTypeHeaderLabel:"TAG_TABLE_COLUMN_LABEL"},collections:{deleteConfirmationTitle:"REMOVE_COLLECTION",deleteConfirmationStr:"REMOVE_COLLECTION_CONFIRM",assignToAllConfirmationStr:"ASSIGN_COLLECTION_TO_ALL_ASSETS_CONFIRM",bpNoSelectedAssetsDesc:"BP_NO_ASSET_SELECTED_COLLECTIONS",bpNoAssignedTypeImage:"images/Boilerplate_Missing_Preference_Mono.png",bpNoAssignedTypeMessage:"BP_NO_ASSIGNED_COLLECTIONS_TITLE",bpNoAssignedTypeDesc:"BP_NO_ASSIGNED_COLLECTIONS_DESC",tableAriaLabel:"COLLECTION_TABLE_ARIA_LABEL",itemTypeHeaderLabel:"COLLECTION_TABLE_COLUMN_LABEL"},channels:{deleteConfirmationTitle:"REMOVE_CHANNEL",deleteConfirmationStr:"REMOVE_CHANNEL_CONFIRM",assignToAllConfirmationStr:"ASSIGN_CHANNEL_TO_ALL_ASSETS_CONFIRM",bpNoSelectedAssetsDesc:"BP_NO_ASSET_SELECTED_CHANNELS",bpNoAssignedTypeImage:"images/Boilerplate_Nothing_to_Display_Mono.png",bpNoAssignedTypeMessage:"BP_NO_ASSIGNED_CHANNELS_TITLE",bpNoAssignedTypeDesc:"BP_NO_ASSIGNED_CHANNELS_DESC",tableAriaLabel:"CHANNEL_TABLE_ARIA_LABEL",itemTypeHeaderLabel:"CHANNEL_TABLE_COLUMN_LABEL"},properties:{bpNoSelectedAssetsDesc:"BP_NO_ASSET_SELECTED_PROPERTIES",bpNoAssignedTypeImage:"images/Boilerplate_Missing_Preference_Mono.png",tableAriaLabel:"PROPERTIES_TABLE_LABEL",itemTypeHeaderLabel:"PROPERTIES_NAME_LABEL"},tags_collections:{bpNoSelectedAssetsDesc:"BP_NO_ASSET_SELECTED_TAGS_COLLECTIONS",bpNoAssignedTypeImage:"images/Boilerplate_Missing_Preference_Mono.png"},workflows:{bpNoSelectedAssetsDesc:"BP_SELECT_TO_DISPLAY_OR_ASSIGN_WORKFLOWS",bpNoAssignedTypeImage:"images/Boilerplate_Missing_Preference_Mono.png",bpNoAssignedTypeMessage:"BP_NO_SELECTED_ASSETS_TITLE",bpNoAssignedTypeDesc:"BP_SELECT_TO_DISPLAY_OR_ASSIGN_WORKFLOWS"}};return i.View.extend({events:{"click .item-row":"handleClickOnItemRow","keydown .item-row":"handleKeyDownOnItemRow","click .addButton":"onAddItem","click .assignToAllButton":"onAssignToAll","click .removeButton":"handleClickOnRemove"},initialize:function(e){this.options=e||{},t.bindAll(this,"onAddItem","updateActionButtons","handleClickOnRemove","onAssignToAll","onRemoveItem","confirmAssignToAll"),this.contextActions=this.model.get("contextActions");var i=this.model.get("container");i&&i.useContainerSelectMode?this.setItems(t.isFunction(i.containerSelection)?i.containerSelection():[i]):(this.setItems(this.options.items||[]),this.listenTo(this.contextActions,"setSelection",t.debounce(this.onSetSelection,500))),this.listenTo(osn.events,"resize",t.debounce(this.resize,500)),this.i18nKey=s[e.itemType]?s[e.itemType]:s.default},render:function(){},getExtraTemplateProps:function(){},renderInitialView:function(e){var i=this.getExtraTemplateProps(),a=this.model.get("container"),n=a&&a.useContainerSelectMode?"":0===this.items.length?docs.i18n.t("NO_ASSET_SELECTED"):docs.i18n.t1orN("NUM_ASSETS_SELECTED",this.items.length),s=this.options.template({i18n:docs.i18n,itemTypes:this.itemTypes,itemCount:this.items?this.items.length:0,itemCountLabel:n,tableAriaLabel:docs.i18n.t(this.i18nKey.tableAriaLabel),itemTypeHeaderLabel:docs.i18n.t(this.i18nKey.itemTypeHeaderLabel),extra:i,uniqueId:t.uniqueId("-")});this.$el.html(s),this.itemTypes&&0===this.itemTypes.length&&!e&&(this.renderNoAssignedTypeBoilerplate(),this.$("ul").hide()),this.items&&0===this.items.length?(this.renderNoItemsBoilerplate(),this.$("ul").hide()):this.itemTypes&&this.itemTypes.length&&!e&&this.$("ul").show(),this.resize(),this.$(".addButton").button(),this.$(".assignToAllButton").button(),this.$(".removeButton").button()},renderNoAssignedTypeBoilerplate:function(){var e=docs.common.Utils.getGenericBoilerplateHtml("bp-vertical-align-flex bp-redwood-illustration",docs.common.Globals.staticRoot+this.i18nKey.bpNoAssignedTypeImage,docs.i18n.t(this.i18nKey.bpNoAssignedTypeMessage),docs.i18n.t(this.i18nKey.bpNoAssignedTypeDesc));this.$(".bp-content").html(e)},renderNoItemsBoilerplate:function(){var e=docs.common.Utils.getGenericBoilerplateHtml("bp-vertical-align-flex bp-redwood-illustration",docs.common.Globals.staticRoot+"images/Boilerplate_Asset_Selection_Mono.png",docs.i18n.t("BP_NO_ASSETS_SELECTED_TITLE"),docs.i18n.t(this.i18nKey.bpNoSelectedAssetsDesc));this.$("li.item-row").remove(),this.$(".bp-content").html(e)},resize:function(){e(".containerview-content").height()},getInfoFromAssets:function(){},onSetSelection:function(){this.setItems(this.contextActions.selection),this.render()},setItems:function(e){this.items=e},handleClickOnRemove:function(){this.onRemoveItem()},handleClickOnItemRow:function(t){var i=e(t.target).closest(".item-row");i.hasClass("selected")?(i.toggleClass("selected",!1),i.toggleClass("hover",!0)):(i.siblings().each((function(){e(this).removeClass("selected")})),i.toggleClass("selected",!0),i.toggleClass("hover",!1));var a=i.attr("id");this.updateRowSelected(a,i.hasClass("selected")),this.updateActionButtons(a,i.hasClass("selected"))},updateRowSelected:function(e,t){},handleKeyDownOnItemRow:function(t){var i,a=this.$("li.item-row");t.keyCode===e.ui.keyCode.DOWN?((i=a.index(document.activeElement)+1)>=a.length&&(i=a.length-1),a.get(i).focus()):t.keyCode===e.ui.keyCode.UP?((i=a.index(document.activeElement)-1)<0&&(i=0),a.get(i).focus()):t.keyCode!==e.ui.keyCode.SPACE&&t.keyCode!==e.ui.keyCode.ENTER||this.handleClickOnItemRow(t)},updateActionButtons:function(e,i){var a=this.$(".assignToAllButton"),n=this.$(".removeButton");if(!i)return a.prop("disabled",!0),void n.prop("disabled",!0);var s=t.filter(this.itemTypes,(function(t){return t.id===e}))[0];if(s){var o=s.assignedCount===this.items.length;a.prop("disabled",o),n.prop("disabled",!1)}else a.prop("disabled",!0),n.prop("disabled",!0)},onAddItem:function(){},onRemoveItem:function(){},onAssignToAll:function(){var t=e.Deferred();return osn.views.ConfirmationDialogView.show({title:docs.i18n.t("ACTION_ASSIGN_TO_ALL"),confirm:this.confirmAssignToAll,content:"<div class='text-only'>"+docs.i18n.t(this.i18nKey.assignToAllConfirmationStr)+"</div>",primaryButtonTextI18n:"assignButton",secondaryButtonTextI18n:"no"}),t.promise()},confirmAssignToAll:function(){},toggleSpinner:function(e){e?(this.spinnerView=new a({extraClasses:"medium",offscreenText:docs.i18n.t("loading")}),this.spinnerView.$el.detach(),this.$(".assetitem-form-container").append(this.spinnerView.el).show()):this.spinnerView&&this.spinnerView.$el.detach()},nameSort:function(e,t){return e.title>t.title?1:e.title<t.title?-1:0},clean:function(){this.stopListening(),this.$(".items-fields").remove()}})})),define("docs/metadata/template/MetadataDefinitionMenu.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-def-more-menu">  <button class="metadata-def-more-button ws-toolbar-button dropmenu_button">'+(null==(__t=i18n.t("CONTEXT_TOOLBAR_MORE"))?"":_.escape(__t))+'</button>  <ul class="dropmenu_topmenu"></ul></div>';return __p}})),define("docs/metadata/template/MetadataDefinition.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-defintion" data-groupname="'+(null==(__t=groupName)?"":_.escape(__t))+'">  <div class="metadata-def-label-row">    <button tabindex="0" class="ws-toolbar-button metadata-def-fields-toggle" value="'+(null==(__t=expandValue)?"":_.escape(__t))+'"></button>    <label class="metadata-def-label">'+(null==(__t=groupName)?"":_.escape(__t))+'</label>    <div class="metadata-def-mode"></div>  </div>  <div class="metadata-def-fields"></div></div>';return __p}})),define("docs/metadata/template/MetadataFields.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-fields" data-groupname="'+(null==(__t=groupName)?"":_.escape(__t))+'">  <div class="metadata-fields-list"></div></div>';return __p}})),define("docs/metadata/template/MetadataField.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-field">  <div class="metadata-field-label dialog-label" title="'+(null==(__t=fieldLabel)?"":_.escape(__t))+'">'+(null==(__t=fieldLabel)?"":_.escape(__t))+'<div class="metadata-field-control"></div></div></div>';return __p}})),define("docs/metadata/template/MetadataTextField.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-text">  <div class="metadata-text-wrapper">    <input class="metadata-text-value metadata-value" type="text" maxlength="1000" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'"></input>  </div>  <div class="metadata-validation-area"></div></div>';return __p}})),define("docs/metadata/template/MetadataFieldValidation.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<span class="metadata-validation-warning-icon" title="'+(null==(__t=i18n.t("IMG_ALT_WARNING"))?"":_.escape(__t))+'" role="img"></span><span class="metadata-validation-content">  <div class="metadata-validation-detail">    <span>'+(null==(__t=warningDetail)?"":_.escape(__t))+"</span>  </div></span>";return __p}})),define("docs/metadata/template/MetadataBooleanField.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-boolean">\t<div class="metadata-boolean-wrapper">\t\t<select id="metadata-boolean-select" class="metadata-value">\t\t  \x3c!-- These are set as 1 and 0 as that is how they come from CS --\x3e\t\t  <option value="1">'+(null==(__t=i18n.t("TRUE"))?"":_.escape(__t))+'</option>\t\t  <option value="0">'+(null==(__t=i18n.t("FALSE"))?"":_.escape(__t))+'</option>\t\t</select>\t\t<div id="metadata-boolean-dummy-select">\t\t\t<input type="text" readonly="readonly" id="metadata-boolean-input-value" aria-label="Metadata Boolean Value"></input>\t\t\t<span id="metadata-boolean-dropdown-arrow" class="gemini-icon-16 ui-button-icon-secondary ui-icon-triangle-1-s" aria-label="Metadata Boolean Drop Arrow"></span>\t\t</div>\t\t<div class="dropcontainer dropdownhidden">\t\t\t<ul class="dropmenu_topmenu ui-menu ui-widget ui-widget-content ui-corner-all ui-helper-clearfix ui-co-container-up" aria-label="Boolean Value" role="menu">\t\t\t\t<li class="remove_button_style ui-menu-item dropmenu_li" role="menuitem">\t\t\t\t\t'+(null==(__t=i18n.t("TRUE"))?"":_.escape(__t))+'\t\t\t\t</li>\t\t\t\t<li class="remove_button_style ui-menu-item dropmenu_li" role="menuitem">\t\t\t\t\t'+(null==(__t=i18n.t("FALSE"))?"":_.escape(__t))+'\t\t\t\t</li>\t\t\t</ul>\t\t</div>\t</div>\t<div class="metadata-validation-area"></div></div>';return __p}})),define("docs/metadata/template/MetadataNumberField.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-number">  <input class="metadata-num-value metadata-value" type="text" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'"></input>  <div class="metadata-validation-area"></div></div>';return __p}})),define("docs/metadata/template/MetadataDateField.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-date">  <div class="metadata-date-combo">    <input class="metadata-date-value metadata-value" type="text" placeholder="'+(null==(__t=placeholder)?"":_.escape(__t))+'"/>    <button class="metadata-date-picker" title="'+(null==(__t=i18n.t("METADATA_CALENDAR_TITLE"))?"":_.escape(__t))+'"></button>  </div>  <div class="metadata-validation-area"></div></div>';return __p}})),
/*!
 * jQuery UI Datepicker 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
function(e){"use strict";"function"==typeof define&&define.amd?define("jqueryui-amd/widgets/datepicker",["jquery","../version","../keycode"],e):e(jQuery)}((function(e){"use strict";var t;function i(){this._curInst=null,this._keyEvent=!1,this._disabledInputs=[],this._datepickerShowing=!1,this._inDialog=!1,this._mainDivId="ui-datepicker-div",this._inlineClass="ui-datepicker-inline",this._appendClass="ui-datepicker-append",this._triggerClass="ui-datepicker-trigger",this._dialogClass="ui-datepicker-dialog",this._disableClass="ui-datepicker-disabled",this._unselectableClass="ui-datepicker-unselectable",this._currentClass="ui-datepicker-current-day",this._dayOverClass="ui-datepicker-days-cell-over",this.regional=[],this.regional[""]={closeText:"Done",prevText:"Prev",nextText:"Next",currentText:"Today",monthNames:["January","February","March","April","May","June","July","August","September","October","November","December"],monthNamesShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],dayNames:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dayNamesShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayNamesMin:["Su","Mo","Tu","We","Th","Fr","Sa"],weekHeader:"Wk",dateFormat:"mm/dd/yy",firstDay:0,isRTL:!1,showMonthAfterYear:!1,yearSuffix:"",selectMonthLabel:"Select month",selectYearLabel:"Select year"},this._defaults={showOn:"focus",showAnim:"fadeIn",showOptions:{},defaultDate:null,appendText:"",buttonText:"...",buttonImage:"",buttonImageOnly:!1,hideIfNoPrevNext:!1,navigationAsDateFormat:!1,gotoCurrent:!1,changeMonth:!1,changeYear:!1,yearRange:"c-10:c+10",showOtherMonths:!1,selectOtherMonths:!1,showWeek:!1,calculateWeek:this.iso8601Week,shortYearCutoff:"+10",minDate:null,maxDate:null,duration:"fast",beforeShowDay:null,beforeShow:null,onSelect:null,onChangeMonthYear:null,onClose:null,onUpdateDatepicker:null,numberOfMonths:1,showCurrentAtPos:0,stepMonths:1,stepBigMonths:12,altField:"",altFormat:"",constrainInput:!0,showButtonPanel:!1,autoSize:!1,disabled:!1},e.extend(this._defaults,this.regional[""]),this.regional.en=e.extend(!0,{},this.regional[""]),this.regional["en-US"]=e.extend(!0,{},this.regional.en),this.dpDiv=a(e("<div id='"+this._mainDivId+"' class='ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>"))}function a(t){var i="button, .ui-datepicker-prev, .ui-datepicker-next, .ui-datepicker-calendar td a";return t.on("mouseout",i,(function(){e(this).removeClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).removeClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).removeClass("ui-datepicker-next-hover")})).on("mouseover",i,n)}function n(){e.datepicker._isDisabledDatepicker(t.inline?t.dpDiv.parent()[0]:t.input[0])||(e(this).parents(".ui-datepicker-calendar").find("a").removeClass("ui-state-hover"),e(this).addClass("ui-state-hover"),-1!==this.className.indexOf("ui-datepicker-prev")&&e(this).addClass("ui-datepicker-prev-hover"),-1!==this.className.indexOf("ui-datepicker-next")&&e(this).addClass("ui-datepicker-next-hover"))}function s(t,i){for(var a in e.extend(t,i),i)null==i[a]&&(t[a]=i[a]);return t}return e.extend(e.ui,{datepicker:{version:"1.13.2"}}),e.extend(i.prototype,{markerClassName:"hasDatepicker",maxRows:4,_widgetDatepicker:function(){return this.dpDiv},setDefaults:function(e){return s(this._defaults,e||{}),this},_attachDatepicker:function(t,i){var a,n,s;n="div"===(a=t.nodeName.toLowerCase())||"span"===a,t.id||(this.uuid+=1,t.id="dp"+this.uuid),(s=this._newInst(e(t),n)).settings=e.extend({},i||{}),"input"===a?this._connectDatepicker(t,s):n&&this._inlineDatepicker(t,s)},_newInst:function(t,i){return{id:t[0].id.replace(/([^A-Za-z0-9_\-])/g,"\\\\$1"),input:t,selectedDay:0,selectedMonth:0,selectedYear:0,drawMonth:0,drawYear:0,inline:i,dpDiv:i?a(e("<div class='"+this._inlineClass+" ui-datepicker ui-widget ui-widget-content ui-helper-clearfix ui-corner-all'></div>")):this.dpDiv}},_connectDatepicker:function(t,i){var a=e(t);i.append=e([]),i.trigger=e([]),a.hasClass(this.markerClassName)||(this._attachments(a,i),a.addClass(this.markerClassName).on("keydown",this._doKeyDown).on("keypress",this._doKeyPress).on("keyup",this._doKeyUp),this._autoSize(i),e.data(t,"datepicker",i),i.settings.disabled&&this._disableDatepicker(t))},_attachments:function(t,i){var a,n,s,o=this._get(i,"appendText"),l=this._get(i,"isRTL");i.append&&i.append.remove(),o&&(i.append=e("<span>").addClass(this._appendClass).text(o),t[l?"before":"after"](i.append)),t.off("focus",this._showDatepicker),i.trigger&&i.trigger.remove(),"focus"!==(a=this._get(i,"showOn"))&&"both"!==a||t.on("focus",this._showDatepicker),"button"!==a&&"both"!==a||(n=this._get(i,"buttonText"),s=this._get(i,"buttonImage"),this._get(i,"buttonImageOnly")?i.trigger=e("<img>").addClass(this._triggerClass).attr({src:s,alt:n,title:n}):(i.trigger=e("<button type='button'>").addClass(this._triggerClass),s?i.trigger.html(e("<img>").attr({src:s,alt:n,title:n})):i.trigger.text(n)),t[l?"before":"after"](i.trigger),i.trigger.on("click",(function(){return e.datepicker._datepickerShowing&&e.datepicker._lastInput===t[0]?e.datepicker._hideDatepicker():e.datepicker._datepickerShowing&&e.datepicker._lastInput!==t[0]?(e.datepicker._hideDatepicker(),e.datepicker._showDatepicker(t[0])):e.datepicker._showDatepicker(t[0]),!1})))},_autoSize:function(e){if(this._get(e,"autoSize")&&!e.inline){var t,i,a,n,s=new Date(2009,11,20),o=this._get(e,"dateFormat");o.match(/[DM]/)&&(t=function(e){for(i=0,a=0,n=0;n<e.length;n++)e[n].length>i&&(i=e[n].length,a=n);return a},s.setMonth(t(this._get(e,o.match(/MM/)?"monthNames":"monthNamesShort"))),s.setDate(t(this._get(e,o.match(/DD/)?"dayNames":"dayNamesShort"))+20-s.getDay())),e.input.attr("size",this._formatDate(e,s).length)}},_inlineDatepicker:function(t,i){var a=e(t);a.hasClass(this.markerClassName)||(a.addClass(this.markerClassName).append(i.dpDiv),e.data(t,"datepicker",i),this._setDate(i,this._getDefaultDate(i),!0),this._updateDatepicker(i),this._updateAlternate(i),i.settings.disabled&&this._disableDatepicker(t),i.dpDiv.css("display","block"))},_dialogDatepicker:function(t,i,a,n,o){var l,d,r,c,u,h=this._dialogInst;return h||(this.uuid+=1,l="dp"+this.uuid,this._dialogInput=e("<input type='text' id='"+l+"' style='position: absolute; top: -100px; width: 0px;'/>"),this._dialogInput.on("keydown",this._doKeyDown),e("body").append(this._dialogInput),(h=this._dialogInst=this._newInst(this._dialogInput,!1)).settings={},e.data(this._dialogInput[0],"datepicker",h)),s(h.settings,n||{}),i=i&&i.constructor===Date?this._formatDate(h,i):i,this._dialogInput.val(i),this._pos=o?o.length?o:[o.pageX,o.pageY]:null,this._pos||(d=document.documentElement.clientWidth,r=document.documentElement.clientHeight,c=document.documentElement.scrollLeft||document.body.scrollLeft,u=document.documentElement.scrollTop||document.body.scrollTop,this._pos=[d/2-100+c,r/2-150+u]),this._dialogInput.css("left",this._pos[0]+20+"px").css("top",this._pos[1]+"px"),h.settings.onSelect=a,this._inDialog=!0,this.dpDiv.addClass(this._dialogClass),this._showDatepicker(this._dialogInput[0]),e.blockUI&&e.blockUI(this.dpDiv),e.data(this._dialogInput[0],"datepicker",h),this},_destroyDatepicker:function(i){var a,n=e(i),s=e.data(i,"datepicker");n.hasClass(this.markerClassName)&&(a=i.nodeName.toLowerCase(),e.removeData(i,"datepicker"),"input"===a?(s.append.remove(),s.trigger.remove(),n.removeClass(this.markerClassName).off("focus",this._showDatepicker).off("keydown",this._doKeyDown).off("keypress",this._doKeyPress).off("keyup",this._doKeyUp)):"div"!==a&&"span"!==a||n.removeClass(this.markerClassName).empty(),t===s&&(t=null,this._curInst=null))},_enableDatepicker:function(t){var i,a,n=e(t),s=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!1,s.trigger.filter("button").each((function(){this.disabled=!1})).end().filter("img").css({opacity:"1.0",cursor:""})):"div"!==i&&"span"!==i||((a=n.children("."+this._inlineClass)).children().removeClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!1)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})))},_disableDatepicker:function(t){var i,a,n=e(t),s=e.data(t,"datepicker");n.hasClass(this.markerClassName)&&("input"===(i=t.nodeName.toLowerCase())?(t.disabled=!0,s.trigger.filter("button").each((function(){this.disabled=!0})).end().filter("img").css({opacity:"0.5",cursor:"default"})):"div"!==i&&"span"!==i||((a=n.children("."+this._inlineClass)).children().addClass("ui-state-disabled"),a.find("select.ui-datepicker-month, select.ui-datepicker-year").prop("disabled",!0)),this._disabledInputs=e.map(this._disabledInputs,(function(e){return e===t?null:e})),this._disabledInputs[this._disabledInputs.length]=t)},_isDisabledDatepicker:function(e){if(!e)return!1;for(var t=0;t<this._disabledInputs.length;t++)if(this._disabledInputs[t]===e)return!0;return!1},_getInst:function(t){try{return e.data(t,"datepicker")}catch(e){throw"Missing instance data for this datepicker"}},_optionDatepicker:function(t,i,a){var n,o,l,d,r=this._getInst(t);if(2===arguments.length&&"string"==typeof i)return"defaults"===i?e.extend({},e.datepicker._defaults):r?"all"===i?e.extend({},r.settings):this._get(r,i):null;n=i||{},"string"==typeof i&&((n={})[i]=a),r&&(this._curInst===r&&this._hideDatepicker(),o=this._getDateDatepicker(t,!0),l=this._getMinMaxDate(r,"min"),d=this._getMinMaxDate(r,"max"),s(r.settings,n),null!==l&&void 0!==n.dateFormat&&void 0===n.minDate&&(r.settings.minDate=this._formatDate(r,l)),null!==d&&void 0!==n.dateFormat&&void 0===n.maxDate&&(r.settings.maxDate=this._formatDate(r,d)),"disabled"in n&&(n.disabled?this._disableDatepicker(t):this._enableDatepicker(t)),this._attachments(e(t),r),this._autoSize(r),this._setDate(r,o),this._updateAlternate(r),this._updateDatepicker(r))},_changeDatepicker:function(e,t,i){this._optionDatepicker(e,t,i)},_refreshDatepicker:function(e){var t=this._getInst(e);t&&this._updateDatepicker(t)},_setDateDatepicker:function(e,t){var i=this._getInst(e);i&&(this._setDate(i,t),this._updateDatepicker(i),this._updateAlternate(i))},_getDateDatepicker:function(e,t){var i=this._getInst(e);return i&&!i.inline&&this._setDateFromField(i,t),i?this._getDate(i):null},_doKeyDown:function(t){var i,a,n,s=e.datepicker._getInst(t.target),o=!0,l=s.dpDiv.is(".ui-datepicker-rtl");if(s._keyEvent=!0,e.datepicker._datepickerShowing)switch(t.keyCode){case 9:e.datepicker._hideDatepicker(),o=!1;break;case 13:return(n=e("td."+e.datepicker._dayOverClass+":not(."+e.datepicker._currentClass+")",s.dpDiv))[0]&&e.datepicker._selectDay(t.target,s.selectedMonth,s.selectedYear,n[0]),(i=e.datepicker._get(s,"onSelect"))?(a=e.datepicker._formatDate(s),i.apply(s.input?s.input[0]:null,[a,s])):e.datepicker._hideDatepicker(),!1;case 27:e.datepicker._hideDatepicker();break;case 33:e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 34:e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 35:(t.ctrlKey||t.metaKey)&&e.datepicker._clearDate(t.target),o=t.ctrlKey||t.metaKey;break;case 36:(t.ctrlKey||t.metaKey)&&e.datepicker._gotoToday(t.target),o=t.ctrlKey||t.metaKey;break;case 37:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,l?1:-1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?-e.datepicker._get(s,"stepBigMonths"):-e.datepicker._get(s,"stepMonths"),"M");break;case 38:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,-7,"D"),o=t.ctrlKey||t.metaKey;break;case 39:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,l?-1:1,"D"),o=t.ctrlKey||t.metaKey,t.originalEvent.altKey&&e.datepicker._adjustDate(t.target,t.ctrlKey?+e.datepicker._get(s,"stepBigMonths"):+e.datepicker._get(s,"stepMonths"),"M");break;case 40:(t.ctrlKey||t.metaKey)&&e.datepicker._adjustDate(t.target,7,"D"),o=t.ctrlKey||t.metaKey;break;default:o=!1}else 36===t.keyCode&&t.ctrlKey?e.datepicker._showDatepicker(this):o=!1;o&&(t.preventDefault(),t.stopPropagation())},_doKeyPress:function(t){var i,a,n=e.datepicker._getInst(t.target);if(e.datepicker._get(n,"constrainInput"))return i=e.datepicker._possibleChars(e.datepicker._get(n,"dateFormat")),a=String.fromCharCode(null==t.charCode?t.keyCode:t.charCode),t.ctrlKey||t.metaKey||a<" "||!i||i.indexOf(a)>-1},_doKeyUp:function(t){var i=e.datepicker._getInst(t.target);if(i.input.val()!==i.lastVal)try{e.datepicker.parseDate(e.datepicker._get(i,"dateFormat"),i.input?i.input.val():null,e.datepicker._getFormatConfig(i))&&(e.datepicker._setDateFromField(i),e.datepicker._updateAlternate(i),e.datepicker._updateDatepicker(i))}catch(e){}return!0},_showDatepicker:function(t){var i,a,n,o,l,d,r;("input"!==(t=t.target||t).nodeName.toLowerCase()&&(t=e("input",t.parentNode)[0]),e.datepicker._isDisabledDatepicker(t)||e.datepicker._lastInput===t)||(i=e.datepicker._getInst(t),e.datepicker._curInst&&e.datepicker._curInst!==i&&(e.datepicker._curInst.dpDiv.stop(!0,!0),i&&e.datepicker._datepickerShowing&&e.datepicker._hideDatepicker(e.datepicker._curInst.input[0])),!1!==(n=(a=e.datepicker._get(i,"beforeShow"))?a.apply(t,[t,i]):{})&&(s(i.settings,n),i.lastVal=null,e.datepicker._lastInput=t,e.datepicker._setDateFromField(i),e.datepicker._inDialog&&(t.value=""),e.datepicker._pos||(e.datepicker._pos=e.datepicker._findPos(t),e.datepicker._pos[1]+=t.offsetHeight),o=!1,e(t).parents().each((function(){return!(o|="fixed"===e(this).css("position"))})),l={left:e.datepicker._pos[0],top:e.datepicker._pos[1]},e.datepicker._pos=null,i.dpDiv.empty(),i.dpDiv.css({position:"absolute",display:"block",top:"-1000px"}),e.datepicker._updateDatepicker(i),l=e.datepicker._checkOffset(i,l,o),i.dpDiv.css({position:e.datepicker._inDialog&&e.blockUI?"static":o?"fixed":"absolute",display:"none",left:l.left+"px",top:l.top+"px"}),i.inline||(d=e.datepicker._get(i,"showAnim"),r=e.datepicker._get(i,"duration"),i.dpDiv.css("z-index",function(e){for(var t,i;e.length&&e[0]!==document;){if(("absolute"===(t=e.css("position"))||"relative"===t||"fixed"===t)&&(i=parseInt(e.css("zIndex"),10),!isNaN(i)&&0!==i))return i;e=e.parent()}return 0}(e(t))+1),e.datepicker._datepickerShowing=!0,e.effects&&e.effects.effect[d]?i.dpDiv.show(d,e.datepicker._get(i,"showOptions"),r):i.dpDiv[d||"show"](d?r:null),e.datepicker._shouldFocusInput(i)&&i.input.trigger("focus"),e.datepicker._curInst=i)))},_updateDatepicker:function(i){this.maxRows=4,t=i,i.dpDiv.empty().append(this._generateHTML(i)),this._attachHandlers(i);var a,s=this._getNumberOfMonths(i),o=s[1],l=i.dpDiv.find("."+this._dayOverClass+" a"),d=e.datepicker._get(i,"onUpdateDatepicker");l.length>0&&n.apply(l.get(0)),i.dpDiv.removeClass("ui-datepicker-multi-2 ui-datepicker-multi-3 ui-datepicker-multi-4").width(""),o>1&&i.dpDiv.addClass("ui-datepicker-multi-"+o).css("width",17*o+"em"),i.dpDiv[(1!==s[0]||1!==s[1]?"add":"remove")+"Class"]("ui-datepicker-multi"),i.dpDiv[(this._get(i,"isRTL")?"add":"remove")+"Class"]("ui-datepicker-rtl"),i===e.datepicker._curInst&&e.datepicker._datepickerShowing&&e.datepicker._shouldFocusInput(i)&&i.input.trigger("focus"),i.yearshtml&&(a=i.yearshtml,setTimeout((function(){a===i.yearshtml&&i.yearshtml&&i.dpDiv.find("select.ui-datepicker-year").first().replaceWith(i.yearshtml),a=i.yearshtml=null}),0)),d&&d.apply(i.input?i.input[0]:null,[i])},_shouldFocusInput:function(e){return e.input&&e.input.is(":visible")&&!e.input.is(":disabled")&&!e.input.is(":focus")},_checkOffset:function(t,i,a){var n=t.dpDiv.outerWidth(),s=t.dpDiv.outerHeight(),o=t.input?t.input.outerWidth():0,l=t.input?t.input.outerHeight():0,d=document.documentElement.clientWidth+(a?0:e(document).scrollLeft()),r=document.documentElement.clientHeight+(a?0:e(document).scrollTop());return i.left-=this._get(t,"isRTL")?n-o:0,i.left-=a&&i.left===t.input.offset().left?e(document).scrollLeft():0,i.top-=a&&i.top===t.input.offset().top+l?e(document).scrollTop():0,i.left-=Math.min(i.left,i.left+n>d&&d>n?Math.abs(i.left+n-d):0),i.top-=Math.min(i.top,i.top+s>r&&r>s?Math.abs(s+l):0),i},_findPos:function(t){for(var i,a=this._getInst(t),n=this._get(a,"isRTL");t&&("hidden"===t.type||1!==t.nodeType||e.expr.pseudos.hidden(t));)t=t[n?"previousSibling":"nextSibling"];return[(i=e(t).offset()).left,i.top]},_hideDatepicker:function(t){var i,a,n,s,o=this._curInst;!o||t&&o!==e.data(t,"datepicker")||this._datepickerShowing&&(i=this._get(o,"showAnim"),a=this._get(o,"duration"),n=function(){e.datepicker._tidyDialog(o)},e.effects&&(e.effects.effect[i]||e.effects[i])?o.dpDiv.hide(i,e.datepicker._get(o,"showOptions"),a,n):o.dpDiv["slideDown"===i?"slideUp":"fadeIn"===i?"fadeOut":"hide"](i?a:null,n),i||n(),this._datepickerShowing=!1,(s=this._get(o,"onClose"))&&s.apply(o.input?o.input[0]:null,[o.input?o.input.val():"",o]),this._lastInput=null,this._inDialog&&(this._dialogInput.css({position:"absolute",left:"0",top:"-100px"}),e.blockUI&&(e.unblockUI(),e("body").append(this.dpDiv))),this._inDialog=!1)},_tidyDialog:function(e){e.dpDiv.removeClass(this._dialogClass).off(".ui-datepicker-calendar")},_checkExternalClick:function(t){if(e.datepicker._curInst){var i=e(t.target),a=e.datepicker._getInst(i[0]);(i[0].id===e.datepicker._mainDivId||0!==i.parents("#"+e.datepicker._mainDivId).length||i.hasClass(e.datepicker.markerClassName)||i.closest("."+e.datepicker._triggerClass).length||!e.datepicker._datepickerShowing||e.datepicker._inDialog&&e.blockUI)&&(!i.hasClass(e.datepicker.markerClassName)||e.datepicker._curInst===a)||e.datepicker._hideDatepicker()}},_adjustDate:function(t,i,a){var n=e(t),s=this._getInst(n[0]);this._isDisabledDatepicker(n[0])||(this._adjustInstDate(s,i,a),this._updateDatepicker(s))},_gotoToday:function(t){var i,a=e(t),n=this._getInst(a[0]);this._get(n,"gotoCurrent")&&n.currentDay?(n.selectedDay=n.currentDay,n.drawMonth=n.selectedMonth=n.currentMonth,n.drawYear=n.selectedYear=n.currentYear):(i=new Date,n.selectedDay=i.getDate(),n.drawMonth=n.selectedMonth=i.getMonth(),n.drawYear=n.selectedYear=i.getFullYear()),this._notifyChange(n),this._adjustDate(a)},_selectMonthYear:function(t,i,a){var n=e(t),s=this._getInst(n[0]);s["selected"+("M"===a?"Month":"Year")]=s["draw"+("M"===a?"Month":"Year")]=parseInt(i.options[i.selectedIndex].value,10),this._notifyChange(s),this._adjustDate(n)},_selectDay:function(t,i,a,n){var s,o=e(t);e(n).hasClass(this._unselectableClass)||this._isDisabledDatepicker(o[0])||((s=this._getInst(o[0])).selectedDay=s.currentDay=parseInt(e("a",n).attr("data-date")),s.selectedMonth=s.currentMonth=i,s.selectedYear=s.currentYear=a,this._selectDate(t,this._formatDate(s,s.currentDay,s.currentMonth,s.currentYear)))},_clearDate:function(t){var i=e(t);this._selectDate(i,"")},_selectDate:function(t,i){var a,n=e(t),s=this._getInst(n[0]);i=null!=i?i:this._formatDate(s),s.input&&s.input.val(i),this._updateAlternate(s),(a=this._get(s,"onSelect"))?a.apply(s.input?s.input[0]:null,[i,s]):s.input&&s.input.trigger("change"),s.inline?this._updateDatepicker(s):(this._hideDatepicker(),this._lastInput=s.input[0],"object"!=typeof s.input[0]&&s.input.trigger("focus"),this._lastInput=null)},_updateAlternate:function(t){var i,a,n,s=this._get(t,"altField");s&&(i=this._get(t,"altFormat")||this._get(t,"dateFormat"),a=this._getDate(t),n=this.formatDate(i,a,this._getFormatConfig(t)),e(document).find(s).val(n))},noWeekends:function(e){var t=e.getDay();return[t>0&&t<6,""]},iso8601Week:function(e){var t,i=new Date(e.getTime());return i.setDate(i.getDate()+4-(i.getDay()||7)),t=i.getTime(),i.setMonth(0),i.setDate(1),Math.floor(Math.round((t-i)/864e5)/7)+1},parseDate:function(t,i,a){if(null==t||null==i)throw"Invalid arguments";if(""===(i="object"==typeof i?i.toString():i+""))return null;var n,s,o,l,d=0,r=(a?a.shortYearCutoff:null)||this._defaults.shortYearCutoff,c="string"!=typeof r?r:(new Date).getFullYear()%100+parseInt(r,10),u=(a?a.dayNamesShort:null)||this._defaults.dayNamesShort,h=(a?a.dayNames:null)||this._defaults.dayNames,p=(a?a.monthNamesShort:null)||this._defaults.monthNamesShort,m=(a?a.monthNames:null)||this._defaults.monthNames,f=-1,_=-1,g=-1,v=-1,b=!1,D=function(e){var i=n+1<t.length&&t.charAt(n+1)===e;return i&&n++,i},y=function(e){var t=D(e),a="@"===e?14:"!"===e?20:"y"===e&&t?4:"o"===e?3:2,n=new RegExp("^\\d{"+("y"===e?a:1)+","+a+"}"),s=i.substring(d).match(n);if(!s)throw"Missing number at position "+d;return d+=s[0].length,parseInt(s[0],10)},A=function(t,a,n){var s=-1,o=e.map(D(t)?n:a,(function(e,t){return[[t,e]]})).sort((function(e,t){return-(e[1].length-t[1].length)}));if(e.each(o,(function(e,t){var a=t[1];if(i.substr(d,a.length).toLowerCase()===a.toLowerCase())return s=t[0],d+=a.length,!1})),-1!==s)return s+1;throw"Unknown name at position "+d},T=function(){if(i.charAt(d)!==t.charAt(n))throw"Unexpected literal at position "+d;d++};for(n=0;n<t.length;n++)if(b)"'"!==t.charAt(n)||D("'")?T():b=!1;else switch(t.charAt(n)){case"d":g=y("d");break;case"D":A("D",u,h);break;case"o":v=y("o");break;case"m":_=y("m");break;case"M":_=A("M",p,m);break;case"y":f=y("y");break;case"@":f=(l=new Date(y("@"))).getFullYear(),_=l.getMonth()+1,g=l.getDate();break;case"!":f=(l=new Date((y("!")-this._ticksTo1970)/1e4)).getFullYear(),_=l.getMonth()+1,g=l.getDate();break;case"'":D("'")?T():b=!0;break;default:T()}if(d<i.length&&(o=i.substr(d),!/^\s+/.test(o)))throw"Extra/unparsed characters found in date: "+o;if(-1===f?f=(new Date).getFullYear():f<100&&(f+=(new Date).getFullYear()-(new Date).getFullYear()%100+(f<=c?0:-100)),v>-1)for(_=1,g=v;;){if(g<=(s=this._getDaysInMonth(f,_-1)))break;_++,g-=s}if((l=this._daylightSavingAdjust(new Date(f,_-1,g))).getFullYear()!==f||l.getMonth()+1!==_||l.getDate()!==g)throw"Invalid date";return l},ATOM:"yy-mm-dd",COOKIE:"D, dd M yy",ISO_8601:"yy-mm-dd",RFC_822:"D, d M y",RFC_850:"DD, dd-M-y",RFC_1036:"D, d M y",RFC_1123:"D, d M yy",RFC_2822:"D, d M yy",RSS:"D, d M y",TICKS:"!",TIMESTAMP:"@",W3C:"yy-mm-dd",_ticksTo1970:24*(718685+Math.floor(492.5)-Math.floor(19.7)+Math.floor(4.925))*60*60*1e7,formatDate:function(e,t,i){if(!t)return"";var a,n=(i?i.dayNamesShort:null)||this._defaults.dayNamesShort,s=(i?i.dayNames:null)||this._defaults.dayNames,o=(i?i.monthNamesShort:null)||this._defaults.monthNamesShort,l=(i?i.monthNames:null)||this._defaults.monthNames,d=function(t){var i=a+1<e.length&&e.charAt(a+1)===t;return i&&a++,i},r=function(e,t,i){var a=""+t;if(d(e))for(;a.length<i;)a="0"+a;return a},c=function(e,t,i,a){return d(e)?a[t]:i[t]},u="",h=!1;if(t)for(a=0;a<e.length;a++)if(h)"'"!==e.charAt(a)||d("'")?u+=e.charAt(a):h=!1;else switch(e.charAt(a)){case"d":u+=r("d",t.getDate(),2);break;case"D":u+=c("D",t.getDay(),n,s);break;case"o":u+=r("o",Math.round((new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()-new Date(t.getFullYear(),0,0).getTime())/864e5),3);break;case"m":u+=r("m",t.getMonth()+1,2);break;case"M":u+=c("M",t.getMonth(),o,l);break;case"y":u+=d("y")?t.getFullYear():(t.getFullYear()%100<10?"0":"")+t.getFullYear()%100;break;case"@":u+=t.getTime();break;case"!":u+=1e4*t.getTime()+this._ticksTo1970;break;case"'":d("'")?u+="'":h=!0;break;default:u+=e.charAt(a)}return u},_possibleChars:function(e){var t,i="",a=!1,n=function(i){var a=t+1<e.length&&e.charAt(t+1)===i;return a&&t++,a};for(t=0;t<e.length;t++)if(a)"'"!==e.charAt(t)||n("'")?i+=e.charAt(t):a=!1;else switch(e.charAt(t)){case"d":case"m":case"y":case"@":i+="0123456789";break;case"D":case"M":return null;case"'":n("'")?i+="'":a=!0;break;default:i+=e.charAt(t)}return i},_get:function(e,t){return void 0!==e.settings[t]?e.settings[t]:this._defaults[t]},_setDateFromField:function(e,t){if(e.input.val()!==e.lastVal){var i=this._get(e,"dateFormat"),a=e.lastVal=e.input?e.input.val():null,n=this._getDefaultDate(e),s=n,o=this._getFormatConfig(e);try{s=this.parseDate(i,a,o)||n}catch(e){a=t?"":a}e.selectedDay=s.getDate(),e.drawMonth=e.selectedMonth=s.getMonth(),e.drawYear=e.selectedYear=s.getFullYear(),e.currentDay=a?s.getDate():0,e.currentMonth=a?s.getMonth():0,e.currentYear=a?s.getFullYear():0,this._adjustInstDate(e)}},_getDefaultDate:function(e){return this._restrictMinMax(e,this._determineDate(e,this._get(e,"defaultDate"),new Date))},_determineDate:function(t,i,a){var n=null==i||""===i?a:"string"==typeof i?function(i){try{return e.datepicker.parseDate(e.datepicker._get(t,"dateFormat"),i,e.datepicker._getFormatConfig(t))}catch(e){}for(var a=(i.toLowerCase().match(/^c/)?e.datepicker._getDate(t):null)||new Date,n=a.getFullYear(),s=a.getMonth(),o=a.getDate(),l=/([+\-]?[0-9]+)\s*(d|D|w|W|m|M|y|Y)?/g,d=l.exec(i);d;){switch(d[2]||"d"){case"d":case"D":o+=parseInt(d[1],10);break;case"w":case"W":o+=7*parseInt(d[1],10);break;case"m":case"M":s+=parseInt(d[1],10),o=Math.min(o,e.datepicker._getDaysInMonth(n,s));break;case"y":case"Y":n+=parseInt(d[1],10),o=Math.min(o,e.datepicker._getDaysInMonth(n,s))}d=l.exec(i)}return new Date(n,s,o)}(i):"number"==typeof i?isNaN(i)?a:function(e){var t=new Date;return t.setDate(t.getDate()+e),t}(i):new Date(i.getTime());return(n=n&&"Invalid Date"===n.toString()?a:n)&&(n.setHours(0),n.setMinutes(0),n.setSeconds(0),n.setMilliseconds(0)),this._daylightSavingAdjust(n)},_daylightSavingAdjust:function(e){return e?(e.setHours(e.getHours()>12?e.getHours()+2:0),e):null},_setDate:function(e,t,i){var a=!t,n=e.selectedMonth,s=e.selectedYear,o=this._restrictMinMax(e,this._determineDate(e,t,new Date));e.selectedDay=e.currentDay=o.getDate(),e.drawMonth=e.selectedMonth=e.currentMonth=o.getMonth(),e.drawYear=e.selectedYear=e.currentYear=o.getFullYear(),n===e.selectedMonth&&s===e.selectedYear||i||this._notifyChange(e),this._adjustInstDate(e),e.input&&e.input.val(a?"":this._formatDate(e))},_getDate:function(e){return!e.currentYear||e.input&&""===e.input.val()?null:this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay))},_attachHandlers:function(t){var i=this._get(t,"stepMonths"),a="#"+t.id.replace(/\\\\/g,"\\");t.dpDiv.find("[data-handler]").map((function(){var t={prev:function(){e.datepicker._adjustDate(a,-i,"M")},next:function(){e.datepicker._adjustDate(a,+i,"M")},hide:function(){e.datepicker._hideDatepicker()},today:function(){e.datepicker._gotoToday(a)},selectDay:function(){return e.datepicker._selectDay(a,+this.getAttribute("data-month"),+this.getAttribute("data-year"),this),!1},selectMonth:function(){return e.datepicker._selectMonthYear(a,this,"M"),!1},selectYear:function(){return e.datepicker._selectMonthYear(a,this,"Y"),!1}};e(this).on(this.getAttribute("data-event"),t[this.getAttribute("data-handler")])}))},_generateHTML:function(t){var i,a,n,s,o,l,d,r,c,u,h,p,m,f,_,g,v,b,D,y,A,T,w,E,M,C,k,S,I,N,O,x,L,F,V,R,B,P,j,$=new Date,G=this._daylightSavingAdjust(new Date($.getFullYear(),$.getMonth(),$.getDate())),U=this._get(t,"isRTL"),H=this._get(t,"showButtonPanel"),Y=this._get(t,"hideIfNoPrevNext"),K=this._get(t,"navigationAsDateFormat"),z=this._getNumberOfMonths(t),q=this._get(t,"showCurrentAtPos"),W=this._get(t,"stepMonths"),X=1!==z[0]||1!==z[1],Z=this._daylightSavingAdjust(t.currentDay?new Date(t.currentYear,t.currentMonth,t.currentDay):new Date(9999,9,9)),J=this._getMinMaxDate(t,"min"),Q=this._getMinMaxDate(t,"max"),ee=t.drawMonth-q,te=t.drawYear;if(ee<0&&(ee+=12,te--),Q)for(i=this._daylightSavingAdjust(new Date(Q.getFullYear(),Q.getMonth()-z[0]*z[1]+1,Q.getDate())),i=J&&i<J?J:i;this._daylightSavingAdjust(new Date(te,ee,1))>i;)--ee<0&&(ee=11,te--);for(t.drawMonth=ee,t.drawYear=te,a=this._get(t,"prevText"),a=K?this.formatDate(a,this._daylightSavingAdjust(new Date(te,ee-W,1)),this._getFormatConfig(t)):a,n=this._canAdjustMonth(t,-1,te,ee)?e("<a>").attr({class:"ui-datepicker-prev ui-corner-all","data-handler":"prev","data-event":"click",title:a}).append(e("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(U?"e":"w")).text(a))[0].outerHTML:Y?"":e("<a>").attr({class:"ui-datepicker-prev ui-corner-all ui-state-disabled",title:a}).append(e("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(U?"e":"w")).text(a))[0].outerHTML,s=this._get(t,"nextText"),s=K?this.formatDate(s,this._daylightSavingAdjust(new Date(te,ee+W,1)),this._getFormatConfig(t)):s,o=this._canAdjustMonth(t,1,te,ee)?e("<a>").attr({class:"ui-datepicker-next ui-corner-all","data-handler":"next","data-event":"click",title:s}).append(e("<span>").addClass("ui-icon ui-icon-circle-triangle-"+(U?"w":"e")).text(s))[0].outerHTML:Y?"":e("<a>").attr({class:"ui-datepicker-next ui-corner-all ui-state-disabled",title:s}).append(e("<span>").attr("class","ui-icon ui-icon-circle-triangle-"+(U?"w":"e")).text(s))[0].outerHTML,l=this._get(t,"currentText"),d=this._get(t,"gotoCurrent")&&t.currentDay?Z:G,l=K?this.formatDate(l,d,this._getFormatConfig(t)):l,r="",t.inline||(r=e("<button>").attr({type:"button",class:"ui-datepicker-close ui-state-default ui-priority-primary ui-corner-all","data-handler":"hide","data-event":"click"}).text(this._get(t,"closeText"))[0].outerHTML),c="",H&&(c=e("<div class='ui-datepicker-buttonpane ui-widget-content'>").append(U?r:"").append(this._isInRange(t,d)?e("<button>").attr({type:"button",class:"ui-datepicker-current ui-state-default ui-priority-secondary ui-corner-all","data-handler":"today","data-event":"click"}).text(l):"").append(U?"":r)[0].outerHTML),u=parseInt(this._get(t,"firstDay"),10),u=isNaN(u)?0:u,h=this._get(t,"showWeek"),p=this._get(t,"dayNames"),m=this._get(t,"dayNamesMin"),f=this._get(t,"monthNames"),_=this._get(t,"monthNamesShort"),g=this._get(t,"beforeShowDay"),v=this._get(t,"showOtherMonths"),b=this._get(t,"selectOtherMonths"),D=this._getDefaultDate(t),y="",T=0;T<z[0];T++){for(w="",this.maxRows=4,E=0;E<z[1];E++){if(M=this._daylightSavingAdjust(new Date(te,ee,t.selectedDay)),C=" ui-corner-all",k="",X){if(k+="<div class='ui-datepicker-group",z[1]>1)switch(E){case 0:k+=" ui-datepicker-group-first",C=" ui-corner-"+(U?"right":"left");break;case z[1]-1:k+=" ui-datepicker-group-last",C=" ui-corner-"+(U?"left":"right");break;default:k+=" ui-datepicker-group-middle",C=""}k+="'>"}for(k+="<div class='ui-datepicker-header ui-widget-header ui-helper-clearfix"+C+"'>"+(/all|left/.test(C)&&0===T?U?o:n:"")+(/all|right/.test(C)&&0===T?U?n:o:"")+this._generateMonthYearHeader(t,ee,te,J,Q,T>0||E>0,f,_)+"</div><table class='ui-datepicker-calendar'><thead><tr>",S=h?"<th class='ui-datepicker-week-col'>"+this._get(t,"weekHeader")+"</th>":"",A=0;A<7;A++)S+="<th scope='col'"+((A+u+6)%7>=5?" class='ui-datepicker-week-end'":"")+"><span title='"+p[I=(A+u)%7]+"'>"+m[I]+"</span></th>";for(k+=S+"</tr></thead><tbody>",N=this._getDaysInMonth(te,ee),te===t.selectedYear&&ee===t.selectedMonth&&(t.selectedDay=Math.min(t.selectedDay,N)),O=(this._getFirstDayOfMonth(te,ee)-u+7)%7,x=Math.ceil((O+N)/7),L=X&&this.maxRows>x?this.maxRows:x,this.maxRows=L,F=this._daylightSavingAdjust(new Date(te,ee,1-O)),V=0;V<L;V++){for(k+="<tr>",R=h?"<td class='ui-datepicker-week-col'>"+this._get(t,"calculateWeek")(F)+"</td>":"",A=0;A<7;A++)B=g?g.apply(t.input?t.input[0]:null,[F]):[!0,""],j=(P=F.getMonth()!==ee)&&!b||!B[0]||J&&F<J||Q&&F>Q,R+="<td class='"+((A+u+6)%7>=5?" ui-datepicker-week-end":"")+(P?" ui-datepicker-other-month":"")+(F.getTime()===M.getTime()&&ee===t.selectedMonth&&t._keyEvent||D.getTime()===F.getTime()&&D.getTime()===M.getTime()?" "+this._dayOverClass:"")+(j?" "+this._unselectableClass+" ui-state-disabled":"")+(P&&!v?"":" "+B[1]+(F.getTime()===Z.getTime()?" "+this._currentClass:"")+(F.getTime()===G.getTime()?" ui-datepicker-today":""))+"'"+(P&&!v||!B[2]?"":" title='"+B[2].replace(/'/g,"&#39;")+"'")+(j?"":" data-handler='selectDay' data-event='click' data-month='"+F.getMonth()+"' data-year='"+F.getFullYear()+"'")+">"+(P&&!v?"&#xa0;":j?"<span class='ui-state-default'>"+F.getDate()+"</span>":"<a class='ui-state-default"+(F.getTime()===G.getTime()?" ui-state-highlight":"")+(F.getTime()===Z.getTime()?" ui-state-active":"")+(P?" ui-priority-secondary":"")+"' href='#' aria-current='"+(F.getTime()===Z.getTime()?"true":"false")+"' data-date='"+F.getDate()+"'>"+F.getDate()+"</a>")+"</td>",F.setDate(F.getDate()+1),F=this._daylightSavingAdjust(F);k+=R+"</tr>"}++ee>11&&(ee=0,te++),w+=k+="</tbody></table>"+(X?"</div>"+(z[0]>0&&E===z[1]-1?"<div class='ui-datepicker-row-break'></div>":""):"")}y+=w}return y+=c,t._keyEvent=!1,y},_generateMonthYearHeader:function(e,t,i,a,n,s,o,l){var d,r,c,u,h,p,m,f,_=this._get(e,"changeMonth"),g=this._get(e,"changeYear"),v=this._get(e,"showMonthAfterYear"),b=this._get(e,"selectMonthLabel"),D=this._get(e,"selectYearLabel"),y="<div class='ui-datepicker-title'>",A="";if(s||!_)A+="<span class='ui-datepicker-month'>"+o[t]+"</span>";else{for(d=a&&a.getFullYear()===i,r=n&&n.getFullYear()===i,A+="<select class='ui-datepicker-month' aria-label='"+b+"' data-handler='selectMonth' data-event='change'>",c=0;c<12;c++)(!d||c>=a.getMonth())&&(!r||c<=n.getMonth())&&(A+="<option value='"+c+"'"+(c===t?" selected='selected'":"")+">"+l[c]+"</option>");A+="</select>"}if(v||(y+=A+(!s&&_&&g?"":"&#xa0;")),!e.yearshtml)if(e.yearshtml="",s||!g)y+="<span class='ui-datepicker-year'>"+i+"</span>";else{for(u=this._get(e,"yearRange").split(":"),h=(new Date).getFullYear(),m=(p=function(e){var t=e.match(/c[+\-].*/)?i+parseInt(e.substring(1),10):e.match(/[+\-].*/)?h+parseInt(e,10):parseInt(e,10);return isNaN(t)?h:t})(u[0]),f=Math.max(m,p(u[1]||"")),m=a?Math.max(m,a.getFullYear()):m,f=n?Math.min(f,n.getFullYear()):f,e.yearshtml+="<select class='ui-datepicker-year' aria-label='"+D+"' data-handler='selectYear' data-event='change'>";m<=f;m++)e.yearshtml+="<option value='"+m+"'"+(m===i?" selected='selected'":"")+">"+m+"</option>";e.yearshtml+="</select>",y+=e.yearshtml,e.yearshtml=null}return y+=this._get(e,"yearSuffix"),v&&(y+=(!s&&_&&g?"":"&#xa0;")+A),y+="</div>"},_adjustInstDate:function(e,t,i){var a=e.selectedYear+("Y"===i?t:0),n=e.selectedMonth+("M"===i?t:0),s=Math.min(e.selectedDay,this._getDaysInMonth(a,n))+("D"===i?t:0),o=this._restrictMinMax(e,this._daylightSavingAdjust(new Date(a,n,s)));e.selectedDay=o.getDate(),e.drawMonth=e.selectedMonth=o.getMonth(),e.drawYear=e.selectedYear=o.getFullYear(),"M"!==i&&"Y"!==i||this._notifyChange(e)},_restrictMinMax:function(e,t){var i=this._getMinMaxDate(e,"min"),a=this._getMinMaxDate(e,"max"),n=i&&t<i?i:t;return a&&n>a?a:n},_notifyChange:function(e){var t=this._get(e,"onChangeMonthYear");t&&t.apply(e.input?e.input[0]:null,[e.selectedYear,e.selectedMonth+1,e])},_getNumberOfMonths:function(e){var t=this._get(e,"numberOfMonths");return null==t?[1,1]:"number"==typeof t?[1,t]:t},_getMinMaxDate:function(e,t){return this._determineDate(e,this._get(e,t+"Date"),null)},_getDaysInMonth:function(e,t){return 32-this._daylightSavingAdjust(new Date(e,t,32)).getDate()},_getFirstDayOfMonth:function(e,t){return new Date(e,t,1).getDay()},_canAdjustMonth:function(e,t,i,a){var n=this._getNumberOfMonths(e),s=this._daylightSavingAdjust(new Date(i,a+(t<0?t:n[0]*n[1]),1));return t<0&&s.setDate(this._getDaysInMonth(s.getFullYear(),s.getMonth())),this._isInRange(e,s)},_isInRange:function(e,t){var i,a,n=this._getMinMaxDate(e,"min"),s=this._getMinMaxDate(e,"max"),o=null,l=null,d=this._get(e,"yearRange");return d&&(i=d.split(":"),a=(new Date).getFullYear(),o=parseInt(i[0],10),l=parseInt(i[1],10),i[0].match(/[+\-].*/)&&(o+=a),i[1].match(/[+\-].*/)&&(l+=a)),(!n||t.getTime()>=n.getTime())&&(!s||t.getTime()<=s.getTime())&&(!o||t.getFullYear()>=o)&&(!l||t.getFullYear()<=l)},_getFormatConfig:function(e){var t=this._get(e,"shortYearCutoff");return{shortYearCutoff:t="string"!=typeof t?t:(new Date).getFullYear()%100+parseInt(t,10),dayNamesShort:this._get(e,"dayNamesShort"),dayNames:this._get(e,"dayNames"),monthNamesShort:this._get(e,"monthNamesShort"),monthNames:this._get(e,"monthNames")}},_formatDate:function(e,t,i,a){t||(e.currentDay=e.selectedDay,e.currentMonth=e.selectedMonth,e.currentYear=e.selectedYear);var n=t?"object"==typeof t?t:this._daylightSavingAdjust(new Date(a,i,t)):this._daylightSavingAdjust(new Date(e.currentYear,e.currentMonth,e.currentDay));return this.formatDate(this._get(e,"dateFormat"),n,this._getFormatConfig(e))}}),e.fn.datepicker=function(t){if(!this.length)return this;e.datepicker.initialized||(e(document).on("mousedown",e.datepicker._checkExternalClick),e.datepicker.initialized=!0),0===e("#"+e.datepicker._mainDivId).length&&e("body").append(e.datepicker.dpDiv);var i=Array.prototype.slice.call(arguments,1);return"string"!=typeof t||"isDisabled"!==t&&"getDate"!==t&&"widget"!==t?"option"===t&&2===arguments.length&&"string"==typeof arguments[1]?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i)):this.each((function(){"string"==typeof t?e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this].concat(i)):e.datepicker._attachDatepicker(this,t)})):e.datepicker["_"+t+"Datepicker"].apply(e.datepicker,[this[0]].concat(i))},e.datepicker=new i,e.datepicker.initialized=!1,e.datepicker.uuid=(new Date).getTime(),e.datepicker.version="1.13.2",e.datepicker})),define("docsplugins/jquery.ui.datepicker",["jquery","underscore","gdk","jqueryui-amd/widgets/datepicker","css!geminiCss/gemini-form-controls"],(function(e,t,i){"use strict";var a=function(e){return docs.i18n.t(e).replace(/##|\s*/g,"").split(",")},n=t.once((function(){var n=i.getDataLocaleElement().elements,s=t.contains(["ar","he"],n.ISO),o=t.contains(["hu","ja","ko","zh_CN","zh_TW"],n.ISO);e.datepicker.regional[""]={closeText:docs.i18n.t("UI_DATEPICKER_CLOSE"),prevText:docs.i18n.t("UI_DATEPICKER_PREV"),nextText:docs.i18n.t("UI_DATEPICKER_NEXT"),currentText:docs.i18n.t("UI_DATEPICKER_CURRENT"),monthNames:a("UI_DATEPICKER_MONTHS"),monthNamesShort:a("UI_DATEPICKER_MONTHS_SHORT"),dayNames:a("UI_DATEPICKER_DAYS"),dayNamesShort:a("UI_DATEPICKER_DAYS_SHORT"),dayNamesMin:a("UI_DATEPICKER_DAYS_MIN"),firstDay:n.DateTime.StartDayOfTheWeek,isRTL:s,showMonthAfterYear:o,weekHeader:e.datepicker.regional[""].weekHeader,yearSuffix:e.datepicker.regional[""].yearSuffix,dateFormat:e.datepicker.regional[""].dateFormat},e.datepicker.setDefaults(e.datepicker.regional[""])})),s=e.fn.datepicker;e.fn.datepicker=function(){return n(),s.apply(this,arguments)}})),
/*!
 * jQuery UI Spinner 1.13.2
 * http://jqueryui.com
 *
 * Copyright jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 */
function(e){"use strict";"function"==typeof define&&define.amd?define("jqueryui-amd/widgets/spinner",["jquery","./button","../version","../keycode","../safe-active-element","../widget"],e):e(jQuery)}((function(e){"use strict";function t(e){return function(){var t=this.element.val();e.apply(this,arguments),this._refresh(),t!==this.element.val()&&this._trigger("change")}}return e.widget("ui.spinner",{version:"1.13.2",defaultElement:"<input>",widgetEventPrefix:"spin",options:{classes:{"ui-spinner":"ui-corner-all","ui-spinner-down":"ui-corner-br","ui-spinner-up":"ui-corner-tr"},culture:null,icons:{down:"ui-icon-triangle-1-s",up:"ui-icon-triangle-1-n"},incremental:!0,max:null,min:null,numberFormat:null,page:10,step:1,change:null,spin:null,start:null,stop:null},_create:function(){this._setOption("max",this.options.max),this._setOption("min",this.options.min),this._setOption("step",this.options.step),""!==this.value()&&this._value(this.element.val(),!0),this._draw(),this._on(this._events),this._refresh(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_getCreateOptions:function(){var t=this._super(),i=this.element;return e.each(["min","max","step"],(function(e,a){var n=i.attr(a);null!=n&&n.length&&(t[a]=n)})),t},_events:{keydown:function(e){this._start(e)&&this._keydown(e)&&e.preventDefault()},keyup:"_stop",focus:function(){this.previous=this.element.val()},blur:function(e){this.cancelBlur?delete this.cancelBlur:(this._stop(),this._refresh(),this.previous!==this.element.val()&&this._trigger("change",e))},mousewheel:function(t,i){var a=e.ui.safeActiveElement(this.document[0]);if(this.element[0]===a&&i){if(!this.spinning&&!this._start(t))return!1;this._spin((i>0?1:-1)*this.options.step,t),clearTimeout(this.mousewheelTimer),this.mousewheelTimer=this._delay((function(){this.spinning&&this._stop(t)}),100),t.preventDefault()}},"mousedown .ui-spinner-button":function(t){var i;function a(){this.element[0]===e.ui.safeActiveElement(this.document[0])||(this.element.trigger("focus"),this.previous=i,this._delay((function(){this.previous=i})))}i=this.element[0]===e.ui.safeActiveElement(this.document[0])?this.previous:this.element.val(),t.preventDefault(),a.call(this),this.cancelBlur=!0,this._delay((function(){delete this.cancelBlur,a.call(this)})),!1!==this._start(t)&&this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseup .ui-spinner-button":"_stop","mouseenter .ui-spinner-button":function(t){if(e(t.currentTarget).hasClass("ui-state-active"))return!1!==this._start(t)&&void this._repeat(null,e(t.currentTarget).hasClass("ui-spinner-up")?1:-1,t)},"mouseleave .ui-spinner-button":"_stop"},_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap("<span>").parent().append("<a></a><a></a>")},_draw:function(){this._enhance(),this._addClass(this.uiSpinner,"ui-spinner","ui-widget ui-widget-content"),this._addClass("ui-spinner-input"),this.element.attr("role","spinbutton"),this.buttons=this.uiSpinner.children("a").attr("tabIndex",-1).attr("aria-hidden",!0).button({classes:{"ui-button":""}}),this._removeClass(this.buttons,"ui-corner-all"),this._addClass(this.buttons.first(),"ui-spinner-button ui-spinner-up"),this._addClass(this.buttons.last(),"ui-spinner-button ui-spinner-down"),this.buttons.first().button({icon:this.options.icons.up,showLabel:!1}),this.buttons.last().button({icon:this.options.icons.down,showLabel:!1}),this.buttons.height()>Math.ceil(.5*this.uiSpinner.height())&&this.uiSpinner.height()>0&&this.uiSpinner.height(this.uiSpinner.height())},_keydown:function(t){var i=this.options,a=e.ui.keyCode;switch(t.keyCode){case a.UP:return this._repeat(null,1,t),!0;case a.DOWN:return this._repeat(null,-1,t),!0;case a.PAGE_UP:return this._repeat(null,i.page,t),!0;case a.PAGE_DOWN:return this._repeat(null,-i.page,t),!0}return!1},_start:function(e){return!(!this.spinning&&!1===this._trigger("start",e))&&(this.counter||(this.counter=1),this.spinning=!0,!0)},_repeat:function(e,t,i){e=e||500,clearTimeout(this.timer),this.timer=this._delay((function(){this._repeat(40,t,i)}),e),this._spin(t*this.options.step,i)},_spin:function(e,t){var i=this.value()||0;this.counter||(this.counter=1),i=this._adjustValue(i+e*this._increment(this.counter)),this.spinning&&!1===this._trigger("spin",t,{value:i})||(this._value(i),this.counter++)},_increment:function(e){var t=this.options.incremental;return t?"function"==typeof t?t(e):Math.floor(e*e*e/5e4-e*e/500+17*e/200+1):1},_precision:function(){var e=this._precisionOf(this.options.step);return null!==this.options.min&&(e=Math.max(e,this._precisionOf(this.options.min))),e},_precisionOf:function(e){var t=e.toString(),i=t.indexOf(".");return-1===i?0:t.length-i-1},_adjustValue:function(e){var t,i,a=this.options;return i=e-(t=null!==a.min?a.min:0),e=t+(i=Math.round(i/a.step)*a.step),e=parseFloat(e.toFixed(this._precision())),null!==a.max&&e>a.max?a.max:null!==a.min&&e<a.min?a.min:e},_stop:function(e){this.spinning&&(clearTimeout(this.timer),clearTimeout(this.mousewheelTimer),this.counter=0,this.spinning=!1,this._trigger("stop",e))},_setOption:function(e,t){var i,a,n;if("culture"===e||"numberFormat"===e)return i=this._parse(this.element.val()),this.options[e]=t,void this.element.val(this._format(i));"max"!==e&&"min"!==e&&"step"!==e||"string"==typeof t&&(t=this._parse(t)),"icons"===e&&(a=this.buttons.first().find(".ui-icon"),this._removeClass(a,null,this.options.icons.up),this._addClass(a,null,t.up),n=this.buttons.last().find(".ui-icon"),this._removeClass(n,null,this.options.icons.down),this._addClass(n,null,t.down)),this._super(e,t)},_setOptionDisabled:function(e){this._super(e),this._toggleClass(this.uiSpinner,null,"ui-state-disabled",!!e),this.element.prop("disabled",!!e),this.buttons.button(e?"disable":"enable")},_setOptions:t((function(e){this._super(e)})),_parse:function(e){return"string"==typeof e&&""!==e&&(e=window.Globalize&&this.options.numberFormat?Globalize.parseFloat(e,10,this.options.culture):+e),""===e||isNaN(e)?null:e},_format:function(e){return""===e?"":window.Globalize&&this.options.numberFormat?Globalize.format(e,this.options.numberFormat,this.options.culture):e},_refresh:function(){this.element.attr({"aria-valuemin":this.options.min,"aria-valuemax":this.options.max,"aria-valuenow":this._parse(this.element.val())})},isValid:function(){var e=this.value();return null!==e&&e===this._adjustValue(e)},_value:function(e,t){var i;""!==e&&null!==(i=this._parse(e))&&(t||(i=this._adjustValue(i)),e=this._format(i)),this.element.val(e),this._refresh()},_destroy:function(){this.element.prop("disabled",!1).removeAttr("autocomplete role aria-valuemin aria-valuemax aria-valuenow"),this.uiSpinner.replaceWith(this.element)},stepUp:t((function(e){this._stepUp(e)})),_stepUp:function(e){this._start()&&(this._spin((e||1)*this.options.step),this._stop())},stepDown:t((function(e){this._stepDown(e)})),_stepDown:function(e){this._start()&&(this._spin((e||1)*-this.options.step),this._stop())},pageUp:t((function(e){this._stepUp((e||1)*this.options.page)})),pageDown:t((function(e){this._stepDown((e||1)*this.options.page)})),value:function(e){if(!arguments.length)return this._parse(this.element.val());t(this._value).call(this,e)},widget:function(){return this.uiSpinner}}),!1!==e.uiBackCompat&&e.widget("ui.spinner",e.ui.spinner,{_enhance:function(){this.uiSpinner=this.element.attr("autocomplete","off").wrap(this._uiSpinnerHtml()).parent().append(this._buttonHtml())},_uiSpinnerHtml:function(){return"<span>"},_buttonHtml:function(){return"<a></a><a></a>"}}),e.ui.spinner})),define("docs/metadata/view/MetadataFieldView",["jquery","underscore","backbone","docs/metadata/template/MetadataField.template","docs/metadata/template/MetadataTextField.template","docs/metadata/template/MetadataFieldValidation.template","docs/metadata/template/MetadataBooleanField.template","docs/metadata/template/MetadataNumberField.template","docs/metadata/template/MetadataDateField.template","core/util/Globals","common/metadata/common/Utils","docsplugins/jquery.ui.datepicker","css!geminiCss/gemini-assets","jqueryui-amd/widgets/spinner","jqueryui-amd/widgets/button"],(function(e,t,i,a,n,s,o,l,d){"use strict";docs.views.MetadataField=i.View.extend({events:{"keyup .metadata-value":"keyUpMetadataVal","input .metadata-value":"testDirty","blur .metadata-value":"testDirty"},initialize:function(e){t.bindAll(this,"render","renderControl","fieldDisplayValue","getValue","itemFieldValue","itemFieldHint","fieldDefaultValue","isDirty","testDirty","metadataChanged","keyUpMetadataVal","validate","preMetadataChanged"),this.options=e||{}},renderControl:function(){},postRenderControl:function(){},render:function(){var e={i18n:docs.i18n,fieldName:this.options.field.displayName,fieldLabel:this.options.field.displayName,groupName:this.options.definition.get("displayName")},t=a(e);return this.$el.html(t),this.renderControl(),this.$el.find(".metadata-field-label").uniqueId(),this.labelId=this.$el.find(".metadata-field-label").attr("id"),this.$el.find(".metadata-value").attr({"aria-labelledby":this.labelId}),this.postRenderControl(),this.options.item&&this.listenTo(this.options.item,"change:metadata",this.preMetadataChanged),this},fieldDisplayValue:function(){return this.options.item?this.massageValue(this.itemFieldValue()):this.massageValue(this.fieldDefaultValue())},massageValue:function(e){return e},itemFieldValue:function(){if(this.options.item&&this.options.field&&this.options.definition){var e=this.options.definition.get("displayName"),t=this.options.definition.get("id"),i=this.options.field.displayName,a=this.options.field.id,n=this.options.item.get("metadata");if(n&&(e||t)&&(i||a)){var s=n.hasOwnProperty(e)?n[e]:n.hasOwnProperty(t)?n[t]:null;return s?s.values.hasOwnProperty(i)?s.values[i]:s.values.hasOwnProperty(a)?s.values[a]:null:this.fieldDefaultValue()}}return null},fieldDefaultValue:function(){if(this.options.field)switch(this.options.field.fieldType){case"text":case"string":return this.options.field.defaultTextValue;case"number":return this.options.field.defaultNumValue;case"date":return this.options.field.defaultDateValue;case"boolean":return this.options.field.defaultBooleanValue}return null},itemFieldHint:function(){return this.options.field&&this.options.field.description?this.options.field.description:void 0},getValue:function(){return this.$el.find(".metadata-value").val()},isDirty:function(){var e=!1,i=this.fieldDisplayValue(),a=this.getValue();return t.isEqual(i,a)||(e=!0),!i&&t.isEmpty(a)&&(e=!1),e},testDirty:function(e){this.validate(e),t.isFunction(this.options.checkDirty)&&this.options.checkDirty()},keyUpMetadataVal:function(t){t.keycode===e.ui.keyCode.ESCAPE||t.which===e.ui.keyCode.ESCAPE?this.metadataChanged():this.testDirty(t)},validate:function(e){},preMetadataChanged:function(){this.options.definition&&this.options.definition.isSaving()&&this.metadataChanged()},metadataChanged:function(){}}),docs.views.MetadataTextField=docs.views.MetadataField.extend({renderControl:function(){var e=this.$el.find(".metadata-field-control"),t=!this.options.configuringField&&this.itemFieldHint()?this.itemFieldHint():"",i=n({placeholder:t});e.html(i),this.$el.find(".metadata-text-value").val(this.fieldDisplayValue()),(this.options.readOnly||!this.options.configuringField&&!0===this.options.field.isReadOnly)&&e.find(".metadata-text-value").attr("disabled","disabled")},massageValue:function(e){return(e=e||"").replace(/\^/g,",")},metadataChanged:function(){this.$el.find(".metadata-text-value").val(this.fieldDisplayValue()),this.testDirty()},validate:function(e){var i=this.getValue();if(i&&!t.isEmpty(i)){var a=docs.metadata.Utils.containsRestrictedChar(i,docs.views.MetadataTextField.restrictedChars);if(a){var n=s({i18n:docs.i18n,warningSummary:docs.i18n.t("METADATA_INVALID_VALUE_SUMMARY"),warningDetail:docs.i18n.t("METADATA_INVALID_VALUE_DETAIL",docs.views.MetadataTextField.restrictedChars.join(" "))});this.$el.find(".metadata-validation-area").html(n),this.$el.find(".metadata-text").addClass("validation-error")}else this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-text").removeClass("validation-error");this.options.updateButtonCallback&&this.options.updateButtonCallback(a||!1)}else this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-text").removeClass("validation-error")}},{restrictedChars:["#","*","&","|","?","<",">","^",";","{","}","(",")","`","=","+","\\"]}),docs.views.MetadataBooleanField=docs.views.MetadataField.extend({events:{"click .metadata-boolean-wrapper span":"toggleDropContainer","click .metadata-boolean-wrapper input":"toggleDropContainer","click .metadata-boolean-wrapper li":"getSelectedValue"},renderControl:function(){var e=this.$el.find(".metadata-field-control"),t=!this.options.configuringField&&this.itemFieldHint()?this.itemFieldHint():"",i=o({placeholder:t,i18n:docs.i18n});e.html(i),this.$el.find(".metadata-value").val(this.fieldDisplayValue()),(this.options.readOnly||!this.options.configuringField&&!0===this.options.field.isReadOnly)&&(e.find(".metadata-boolean-wrapper input").attr("disabled","disabled"),e.find(".metadata-boolean-wrapper span").attr("disabled","disabled"))},postRenderControl:function(){this.$el.find("#"+this.labelId+" #metadata-boolean-input-value").val(e("#"+this.labelId+" .metadata-value option:selected").text())},getSelectedValue:function(t){var i=t.currentTarget.innerText;i&&(e("#"+this.labelId+" select option").filter((function(){return e(this).text()===i})).prop("selected",!0),e("#"+this.labelId+" #metadata-boolean-input-value").val(i)),this.testDirty(),this.toggleDropContainer(t)},toggleDropContainer:function(t){this.options.readOnly||!this.options.configuringField&&!0===this.options.field.isReadOnly||e("#"+this.labelId+" .dropcontainer").toggleClass("dropdownhidden")},metadataChanged:function(){this.$el.find(".metadata-value").val(this.fieldDisplayValue()),this.testDirty()},normalizeBoolean:function(e){return!e||"1"!==e&&"true"!==e?!e||"0"!==e&&"false"!==e?"":"false":"true"}}),docs.views.MetadataNumberField=docs.views.MetadataField.extend({initialize:function(e){this.options=e||{},docs.views.MetadataField.prototype.initialize.call(this,e)},renderControl:function(){var t=this.$el.find(".metadata-field-control"),i=!this.options.configuringField&&this.itemFieldHint()?this.itemFieldHint():"",a=l({placeholder:i});t.html(a);t.find(".metadata-num-value").spinner({min:-99999999999999,max:999999999999999,step:1,stop:e.proxy(this.testDirty,this)}),this.$el.find(".metadata-value").attr({maxlength:15}),this.$el.find(".metadata-num-value").val(this.fieldDisplayValue()),(this.options.readOnly||!this.options.configuringField&&!0===this.options.field.isReadOnly)&&t.find(".metadata-num-value").spinner("disable")},metadataChanged:function(){this.$el.find(".metadata-num-value").val(this.fieldDisplayValue()),this.testDirty()},validate:function(e){var i=this.getValue();if(i&&!t.isEmpty(i))if(0===i.indexOf("-")&&1===i.length&&e&&"focusout"!==e.type&&"blur"!==e.type&&"spinstop"!==e.type)this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-number").removeClass("validation-error");else{var a=new RegExp("^-?[0-9]{1,15}").exec(i),n=!1;if(a&&a.length>0&&(n=t.isEqual(a[0],i)),n)this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-number").removeClass("validation-error");else{var o=s({i18n:docs.i18n,warningSummary:docs.i18n.t("METADATA_INVALID_NUMBER_SUMMARY"),warningDetail:docs.i18n.t("METADATA_INVALID_NUMBER_DETAIL")});this.$el.find(".metadata-validation-area").html(o),this.$el.find(".metadata-number").addClass("validation-error")}this.options.updateButtonCallback&&this.options.updateButtonCallback(!n||!1)}else this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-number").removeClass("validation-error")}}),docs.views.MetadataDateField=docs.views.MetadataField.extend({initialize:function(e){this.options=e||{},t.bindAll(this,"setFormattedValue"),docs.views.MetadataField.prototype.initialize.call(this,e)},renderControl:function(){var t=this.fieldDisplayValue(),i=window.orai18n.date.getDateFormatHint(),a=i,n=i.indexOf("yyyy"),s=i.indexOf("yy");n>=0?a=a.replace("yyyy","yy"):s>=0&&(a=a.replace("yy","y"));var o=this.$el.find(".metadata-field-control"),l=d({i18n:docs.i18n,fieldValue:t,placeholder:i});o.html(l),o.find(".metadata-date-picker").button({text:!1,icons:{primary:"ui-icon-athena-datepicker"}}).click(e.proxy(this.clickCalendar,this)),o.find(".metadata-date-value").datepicker({showOn:"",onSelect:e.proxy(this.testDirty,this),dateFormat:a}),this.setFormattedValue(t),(this.options.readOnly||!this.options.configuringField&&!0===this.options.field.isReadOnly)&&(o.find(".metadata-date-picker").button("disable"),o.find(".metadata-date-value").datepicker("disable"))},clickCalendar:function(){this.$el.find(".metadata-date-value").datepicker("show")},metadataChanged:function(){this.setFormattedValue(this.fieldDisplayValue()),this.testDirty()},getValue:function(){var i=docs.views.MetadataField.prototype.getValue.call(this);if(!i||t.isEmpty(i))return null;try{var a=e.datepicker.parseDate(this.$el.find(".metadata-date-value").datepicker("option","dateFormat"),i);return new Date(Date.UTC(a.getFullYear(),a.getMonth(),a.getDate(),12,0,0,0)).toISOString().replace(".000Z","Z")}catch(e){return i}},setFormattedValue:function(i){var a=this.$el.find(".metadata-date-value").datepicker("option","dateFormat");if(i&&!t.isEmpty(i)&&a){var n=i.substring(0,i.indexOf("T")).split("-"),s=new Date(parseInt(n[0],10),parseInt(n[1],10)-1,parseInt(n[2],10),12,0,0,0),o=e.datepicker.formatDate(a,s);this.$el.find(".metadata-date-value").datepicker("setDate",o)}else this.$el.find(".metadata-date-value").datepicker("setDate",null)},validate:function(i){var a=docs.views.MetadataField.prototype.getValue.call(this),n=this.$el.find(".validation-error").length>0;if(!a||t.isEmpty(a))return this.$el.find(".metadata-validation-area").empty(),void this.$el.find(".metadata-date").removeClass("validation-error");if(!i||"focusout"===i.type||"blur"===i.type||n)try{e.datepicker.parseDate(this.$el.find(".metadata-date-value").datepicker("option","dateFormat"),a),this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-date").removeClass("validation-error")}catch(e){var o=s({i18n:docs.i18n,warningSummary:docs.i18n.t("METADATA_INVALID_DATE_SUMMARY"),warningDetail:docs.i18n.t("METADATA_INVALID_DATE_DETAIL")});this.$el.find(".metadata-validation-area").html(o),this.$el.find(".metadata-date").addClass("validation-error")}}})})),define("docs/metadata/view/MetadataFieldsView",["jquery","underscore","backbone","docs/metadata/template/MetadataFields.template","docs/metadata/view/MetadataFieldView","css!geminiCss/gemini-admin"],(function(e,t,i,a){"use strict";return docs.views.MetadataFields=i.View.extend({initialize:function(e){t.bindAll(this,"render","addFields","fieldValueChange","getDirtyFieldValues"),this.options=e||{}},render:function(){var e={i18n:docs.i18n,groupName:this.options.definition.get("displayName")},t=a(e);this.$el.html(t),this.fieldViews={},this.addFields()},addFields:function(){var i=this.options.definition.get("fields");t(i).each((function(t){var i="";switch(t.fieldType){case"text":case"string":i="MetadataTextField";break;case"number":i="MetadataNumberField";break;case"date":i="MetadataDateField";break;case"boolean":i="MetadataBooleanField";break;default:return}var a=t.displayName,n=e('<div data-fieldname="'+a+'"></div>');this.$el.find(".metadata-fields-list").append(n);var s={el:n,definition:this.options.definition,field:t,item:this.options.item,readOnly:this.options.readOnly,checkDirty:e.proxy(this.fieldValueChange,this)},o=new docs.views[i](s);o.render(),this.fieldViews[a]=o}),this)},fieldValueChange:function(){var e=!1,i=this.options.definition.get("fields");t(i).each((function(t){var i=t.displayName,a=this.fieldViews[i];a&&(e=e||a.isDirty())}),this);var a={definitionId:this.options.definition.get("id"),isDirty:e};docs.events.trigger("metadata:dirtyFields",a)},getDirtyFieldValues:function(){var e={},i=this.options.definition.get("fields");return t(i).each((function(t){var i=t.displayName,a=this.fieldViews[i];a.isDirty()&&(e[i]=a.getValue())}),this),e},remove:function(){if(this.fieldViews){var e=t.keys(this.fieldViews);t.each(e,(function(e){this.fieldViews[e].remove(),delete this.fieldViews[e]}),this)}i.View.prototype.remove.call(this)}}),docs.views.MetadataFields})),define("docsplugins/jquery.ui.togglebutton",["jquery","underscore"],(function(e,t){"use strict";e.widget("ui.togglebutton",e.ui.button,{_create:function(){var t,i;e(this.element).is(":checkbox")?this.options.values.hasOwnProperty("checked")&&this.options.values.hasOwnProperty("unchecked")?t=this.element.is(":checked")?"checked":"unchecked":(i=this.element.is(":checked")?1:0,t=Object.keys(this.options.values)[i]):(t=e(this.element).val())||(t=Object.keys(this.options.values)[0],e(this.element).val(t)),this.options.displayNext&&(t=this._nextValue(t));var a=this.options.values[t];a.icon&&(this.options.icon=a.icon),a.label&&(this.options.label=a.label),this._super(),e(this.element).is(":checkbox")?this._on(this.element,{change:this._onChange}):this._on(this.element,{click:"_onClick"})},_onChange:function(){var e;if(this.options.values.hasOwnProperty("checked")&&this.options.values.hasOwnProperty("unchecked"))e=this.element.is(":checked")?"checked":"unchecked";else{var t=this.element.is(":checked")?1:0;e=Object.keys(this.options.values)[t]}this._displayValue(e)},_onClick:function(){var t=e(this.element).val();t=this._nextValue(t),e(this.element).val(t),this._displayValue(t)},_displayValue:function(e){var t=this.options.values[e].icon;this.options.displayNext&&(e=this._nextValue(e));var i=this.options.values[e];i.icon&&(this.options.icon=i.icon),i.label&&(this.options.label=i.label),this._enhance(),this.element.attr("title",this.options.label),this._removeClass(this.icon,null,t)},_nextValue:function(e){var t=Object.keys(this.options.values),i=t.indexOf(e)+1;return i>=t.length&&(i=0),t[i]}})})),define("docs/metadata/view/MetadataDefinitionView",["jquery","underscore","backbone","docs/metadata/template/MetadataDefinition.template","docs/metadata/view/MetadataFieldsView","docsplugins/jquery.ui.togglebutton"],(function(e,t,i,a){"use strict";return docs.views.MetadataDefinition=i.View.extend({initialize:function(e){t.bindAll(this,"render","renderControl","getDirtyFieldValues"),this.options=e||{}},render:function(){var t=!!this.options.startExpanded,i={i18n:docs.i18n,groupName:this.options.definition.get("displayName"),expandValue:t?"fields_collapse":"fields_expand"},n=a(i);return this.$el.html(n),this.$el.find(".metadata-def-label-row").addClass(this.options.mode),this.$el.find(".metadata-def-fields-toggle").togglebutton({text:!1,displayNext:!0,values:{fields_expand:{icon:"ui-icon-meta-expanded oj-ux-icon oj-ux-ico-caret-down",label:docs.i18n.t("LAYOUT_LIST_TIP")},fields_collapse:{icon:"ui-icon-meta-collapsed oj-ux-icon oj-ux-ico-caret-right",label:docs.i18n.t("LAYOUT_GRID_TIP")}}}).click(e.proxy(this.toggleClicked,this)),this.$el.find(".metadata-def-label").click(e.proxy(this.labelClicked,this)),this.renderControl(),this.metaFields=new docs.views.MetadataFields({el:this.$el.find(".metadata-def-fields"),item:this.options.item,definition:this.options.definition,readOnly:this.options.readOnly}),this.metaFields.render(),t||this.$el.find(".metadata-def-fields").hide(),this},renderControl:function(){},toggleClicked:function(){switch(this.$el.find(".metadata-def-fields-toggle").val()){case"fields_collapse":this.$el.find(".metadata-def-fields").show(),this.$el.find(".metadata-defintion").addClass("expanded");break;case"fields_expand":this.$el.find(".metadata-def-fields").hide(),this.$el.find(".metadata-defintion").removeClass("expanded")}},labelClicked:function(){this.$el.find(".metadata-def-fields-toggle").click()},getDirtyFieldValues:function(){var e={id:this.options.definition.get("id"),dirtyValues:null};return this.metaFields&&(e.dirtyValues=this.metaFields.getDirtyFieldValues()),e},remove:function(){this.metaFields&&this.metaFields.remove(),i.View.prototype.remove.call(this)}}),docs.views.MetadataDefinition})),define("docs/metadata/view/MetadataDefinitionMenuView",["jquery","underscore","docs/metadata/template/MetadataDefinitionMenu.template","core/util/Globals","docs/metadata/view/MetadataDefinitionView"],(function(e,t,i){"use strict";return docs.views.MetadataDefinitionMenu=docs.views.MetadataDefinition.extend({defaultConfig:[{action:"action_add_field",tooltip:"METADATA_ADD_FIELD_TT",text:"METADATA_ADD_FIELD"},{menuSeparator:!0},{action:"action_edit_group",tooltip:"METADATA_EDIT_GROUP_TT",text:"METADATA_EDIT_GROUP"},{action:"action_delete_group",tooltip:"METADATA_DELETE_GROUP_TT",text:"METADATA_DELETE_GROUP"}],initialize:function(e){this.options=e||{},docs.views.MetadataDefinition.prototype.initialize.call(this,e),this.options.config=this.options.config||this.defaultConfig},renderControl:function(){if(this.options.config.length>0){var a=i({i18n:docs.i18n});this.$el.find(".metadata-def-mode").empty().append(a),t.each(this.options.config,(function(t){if(t.menuSeparator){var i=e('<div class="dropmenu_sep"></div>');this.$el.find("ul.dropmenu_topmenu").append(i)}else{var a=docs.i18n.t(t.tooltip||t.text),n=docs.i18n.t(t.text),s="<li ";s+='data-action="'+t.action+'" ',s+='title="'+a+'" class="remove_button_style">';var o=e(s+='<a href="#"><span></span>'+n+"</a></li>");this.$el.find("ul.dropmenu_topmenu").append(o)}}),this),this.$el.find(".metadata-def-more-menu").dropmenu({select:e.proxy(this.menuItemClicked,this),button:{text:!1,icons:{primary:"ui-icon-more-bullets"}}})}},menuItemClicked:function(i,a){var n=e(a.item).data("action");if(this.options.menuCallback&&t.isFunction(this.options.menuCallback)){var s={groupId:this.options.definition.get("id"),groupName:this.options.definition.get("displayName"),action:n};this.options.menuCallback(s)}}}),docs.views.MetadataDefinitionMenu})),define("docs/metadata/template/MetadataFileProps.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-file-props metadata-defintion">  <div class="metadata-def-fields">    <div class="metadata-fields">      <div class="metadata-fields-list">        <div class="metadata-field">          <div class="metadata-field-label dialog-label" title="'+(null==(__t=tagsLabel)?"":_.escape(__t))+'">'+(null==(__t=tagsLabel)?"":_.escape(__t))+'<div class="metadata-field-control">            <div class="metadata-tags"></div>            <button type="button" class="ui-button-secondary assignTagToAllButton" tabindex="0" >'+(null==(__t=docs.i18n.t("ACTION_ASSIGN_TO_ALL"))?"":_.escape(__t))+'</button>            <div class="metadata-validation-area"></div>          </div></div>        </div>        ',collectionList&&collectionList.length>0&&(__p+='          <div class="metadata-field">            <div class="metadata-field-label dialog-label" title="'+(null==(__t=collectionLabel)?"":_.escape(__t))+'">'+(null==(__t=collectionLabel)?"":_.escape(__t))+'<div class="metadata-field-control">              <div class="collection-list">                ',_.each(collectionList,(function(e){__p+='                  <a id="'+(null==(__t=e.id)?"":_.escape(__t))+'" title="'+(null==(__t=e.name)?"":_.escape(__t))+'" class="collectionLink osn-clickable" href="#">'+(null==(__t=e.name)?"":_.escape(__t))+"</a>                "})),__p+="              </div>            </div></div>          </div>        "),__p+="        ",publishedToList&&publishedToList.length>0&&(__p+='          <div class="metadata-field">            <div class="metadata-field-label dialog-label" title="'+(null==(__t=publishedToLabel)?"":_.escape(__t))+'">'+(null==(__t=publishedToLabel)?"":_.escape(__t))+'<div class="metadata-field-control">              <div class="publishedTo-list">                ',_.each(publishedToList,(function(e){__p+='                  <span class="publishedToLink" title="'+(null==(__t=e.name)?"":_.escape(__t))+'">'+(null==(__t=e.name)?"":_.escape(__t))+"</span>                "})),__p+="              </div>            </div></div>          </div>        "),__p+="      </div>    </div>  </div></div>";return __p}})),define("docs/metadata/view/MetadataFilePropsView",["jquery","underscore","backbone","core/util/Globals","core/util/Jsonify","docs/metadata/template/MetadataFileProps.template","docs/metadata/template/MetadataFieldValidation.template","core/router/DocsController","common/metadata/common/Utils","docs/metadata/model/MetadataDefinition","common/plugin/jquery.ui.bubblewrap","docsplugins/jquery.ui.togglebutton","jqueryui-amd/widgets/button"],(function(e,t,i,docs,a,n,s){"use strict";return docs.views.MetadataFileProps=i.View.extend({tagPrefix:"#",events:{"click a.collectionLink":"handleClickOnAnchor","click .assignTagToAllButton":"addTagToAll","click .subset-tagged":"tagSelected"},initialize:function(e){t.bindAll(this,"render","metadataChanged","adjustedTags","tagError","populateTags","getCurrentTagValues"),this.options=e||{}},render:function(){var i=this.options.item.get("metadata")||{},a=docs.metadata.Utils.metadataValue(i,"dDefaultFolderMetaCollection","xPublishedVersion"),s=[];if(a){var o=docs.metadata.Utils.metadataValue(i,"dDefaultFolderMetaCollection","xPublishedTargets"),l=docs.models.AssetsFolder.getAccessibleTargets(this.options.item);t.each(l,(function(e){o.indexOf(e.id)>=0&&s.push({id:e.id,name:e.id===docs.models.CollectionsFolder.SYSTEM_PUBLIC_TARGET_ID?docs.i18n.t("SYSTEM_PUBLIC_TARGET"):e.id===docs.models.CollectionsFolder.SYSTEM_SECURE_TARGET_ID?docs.i18n.t("SYSTEM_SECURE_TARGET"):e.name})}),this)}var d={definitionLabel:this.options.item.isFolder?docs.i18n.t("METADATA_FOLDER_PROPS_GROUP"):docs.i18n.t("METADATA_FILE_PROPS_GROUP"),expandValue:"fields_collapse",tagsLabel:docs.i18n.t("METADATA_TAGS_FIELD_NAME"),collectionLabel:docs.i18n.t("COLLECTIONS"),collectionList:this.options.item.get("collections"),publishedToLabel:docs.i18n.t("PUBLISHED_TO"),publishedToList:s},r=n(d);return this.$el.html(r),this.$el.find(".metadata-def-fields-toggle").togglebutton({text:!1,displayNext:!0,values:{fields_expand:{icon:"ui-icon-meta-expanded",label:docs.i18n.t("LAYOUT_LIST_TIP")},fields_collapse:{icon:"ui-icon-meta-collapsed",label:docs.i18n.t("LAYOUT_GRID_TIP")}}}).click(e.proxy(this.toggleClicked,this)),this.$el.find(".metadata-def-label").click(e.proxy(this.labelClicked,this)),this.$el.find(".metadata-tags").bubblewrap({prefixChar:this.tagPrefix,addBubbleCallback:e.proxy(this.tagAdded,this),removeBubbleCallback:e.proxy(this.tagRemoved,this),initialBubbles:this.populateTags(),placeholder:docs.i18n.t("METADATA_TAGS_PLACEHOLDER"),styleBubbleCallback:e.proxy(this.styleBubble,this)}),this.$el.find(".metadata-tags .metadata-value").attr("aria-label",docs.i18n.t("METADATA_TAGS_PLACEHOLDER")),this.options.item&&(this.options.item.isAllowedAction("fileUpdate")||this.options.item.isAllowedAction("folderUpdate")||this.$el.find(".metadata-tags").bubblewrap("disable")),this.$(".assignTagToAllButton").button(),this.$(".assignTagToAllButton").button("disable"),this},toggleClicked:function(){switch(this.$el.find(".metadata-def-fields-toggle").val()){case"fields_collapse":this.$el.find(".metadata-def-fields").show(),this.$el.find(".metadata-defintion").addClass("expanded");break;case"fields_expand":this.$el.find(".metadata-def-fields").hide(),this.$el.find(".metadata-defintion").removeClass("expanded")}},labelClicked:function(){this.$el.find(".metadata-def-fields-toggle").click()},getCurrentTagValues:function(){if(this.options.item){var e=this.options.item.get("metadata");if(e.hasOwnProperty("dDefaultFolderMetaCollection")){var t=e.dDefaultFolderMetaCollection.values,i=t.hasOwnProperty("xTags")?t.xTags:null,a=i||[];return a=a.sort((function(e,t){var i=e.toUpperCase(),a=t.toUpperCase();return i>a?1:i<a?-1:0}))}}return[]},populateTags:function(){if(t.isEmpty(this.options.selectedItems)||this.options.item.isFile&&t.isEmpty(this.options.item.tags))return this.getCurrentTagValues();var e=this.options.item.get("tags");return this.populatedTags(e)},populatedTags:function(e){this.tags=e;var i=[];t.each(Object.keys(e),(function(t){i.push(e[t])}));var a=[];a=a.concat.apply(a,i);var n=t.union.apply(null,i);return this.tagsCounted=t.countBy(a),n=n.sort((function(e,t){var i=e.toUpperCase(),a=t.toUpperCase();return i>a?1:i<a?-1:0}))},metadataChanged:function(){var e=this.populateTags();t.defer(function(){this.$el.find(".metadata-tags").bubblewrap("setValue",e)}.bind(this)),this.stopListening(this.options.item,"change:metadata")},getItemIds:function(){var e=[];return this.options.selectedItems.length>0?t.each(this.options.selectedItems,(function(t){var i=t.folderItem.targetId();e.push(i)}),this):e.push(this.options.item.targetId()),e},tagAdded:function(e){e.charAt(0)===this.tagPrefix&&(e=e.slice(1)),new docs.models.MetadataDefinition({id:"dDefaultFolderMetaCollection",displayName:"dDefaultFolderMetaCollection"}).adjustMultiValueField(this.getItemIds(),"xTags",e,{success:this.adjustedTags,removing:!1,async:!0})},tagRemoved:function(e){e.charAt(0)===this.tagPrefix&&(e=e.slice(1)),new docs.models.MetadataDefinition({id:"dDefaultFolderMetaCollection",displayName:"dDefaultFolderMetaCollection"}).adjustMultiValueField(this.getItemIds(),"xTags",e,{success:this.adjustedTags,removing:!0,error:this.tagError,async:!0}),this.$(".assignTagToAllButton").button("disable")},styleBubble:function(e){var t=e.data("bubble"),i=docs.i18n.t("METADATA_EDIT_TAGS_ADD_TO_ALL",t);if(t.charAt(0)===this.tagPrefix&&(t=t.slice(1)),!(!!this.tagsCounted&&this.options.selectedItems.length===this.tagsCounted[t])&&this.tagsCounted&&void 0!==this.tagsCounted[t]){var a="("+this.tagsCounted[t]+")",n=e.find(".bubble-wrap-item-text"),s=n.text();s+=" "+a,n.text(s),e.addClass("subset-tagged"),e.attr({tabindex:"0",title:i})}else e.removeClass("subset-tagged");0===this.$el.find(".subset-tagged").length?this.$el.find(".metadata-tags-dlg-instruction").hide():this.$el.find(".metadata-tags-dlg-instruction").show()},addTagToAll:function(e){this.adjustTags(this.selectedTagText,!1),this.$(".assignTagToAllButton").button("disable")},tagSelected:function(t){var i=e(t.currentTarget);i.hasClass("tag-selected")?(i.removeClass("tag-selected").addClass("tag-not-selected"),this.trigger("tag:tagSelected",""),this.$(".assignTagToAllButton").button("disable")):(this.$el.find(".bubble-wrap-item").removeClass("tag-selected"),i.addClass("tag-selected").removeClass("tag-not-selected"),this.trigger("tag:tagSelected",i.data("bubble")),this.$(".assignTagToAllButton").button("enable")),this.selectedTagText=i.data("bubble").toString()},adjustTags:function(e,t){e.charAt(0)===this.tagPrefix&&(e=e.slice(1)),new docs.models.MetadataDefinition({id:"dDefaultFolderMetaCollection",displayName:"dDefaultFolderMetaCollection"}).adjustMultiValueField(this.getItemIds(),"xTags",e,{success:this.adjustedTags,removing:t,error:this.tagError,async:!0})},adjustedTags:function(){this.options.item&&(this.listenTo(this.options.item,"change:metadata",this.metadataChanged),this.options.item.updateMetadata()),this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadata-tags").closest(".metadata-field").removeClass("validation-error")},tagError:function(e,i,n){a.convertToRealJson(e.responseJSON);var o=a.parseResultSet(e.responseJSON.ResultSets.ActionStatus,"actionStatus",a.fieldMap.actionStatus),l=!1;t.each(o,(function(e){if(e.statusMessage.indexOf("csUnableToRemoveInheritedMetaFieldValue")>-1){var t=e.statusMessage.split(","),i=docs.i18n.t("METADATA_REMOVE_INHERITED_TAG_SUMMARY"),a=docs.i18n.t("METADATA_REMOVE_INHERITED_TAG_DETAIL",this.tagPrefix+t[1]),n=s({i18n:docs.i18n,warningSummary:i,warningDetail:a});this.$el.find(".metadata-validation-area").html(n),this.$el.find(".metadata-tags").closest(".metadata-field").addClass("validation-error")}else e.statusMessage.indexOf("csUnableToRemoveInvalidMetaFieldValue")<0&&"0"!==e.statusCode&&(l=!0)}),this),l||(this.options.item&&this.options.item.updateMetadata(),e.errorHandled=!0)},handleClickOnAnchor:function(t){var i="collections/"+e(t.currentTarget).attr("id");docs.router.navigate(i,{trigger:!0})}}),docs.views.MetadataFileProps})),define("docs/metadata/template/MetadataSidebarHeader.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="containerview-title">    <h1 class="containerview-title-label" title="'+(null==(__t=title)?"":__t)+'">'+(null==(__t=title)?"":__t)+'</h1></div><div class="containerview-header-buttons flush-right"></div>';return __p}})),define("docs/metadata/template/MetadataManageDialog.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-manage-dlg">  <div class="metadata-manage-desc">'+(null==(__t=i18n.t("SIDEBAR_METADATA_MANAGE_DLG_DESC"))?"":_.escape(__t))+'</div>  <div class="metadata-manage-content">    <div class="metadata-manage-definitions"></div>  </div></div>';return __p}})),define("docs/metadata/template/MetadataDefinitionSwitch.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-def-switch"></div>';return __p}})),define("docsplugins/jquery.ui.switchwidget",["jquery","underscore","css!geminiCss/gemini-form-controls"],(function(e,t){"use strict";e.widget("ui.switchwidget",{options:{thinSwitch:!1},_create:function(){this.options.tabstop=this.options.tabstop||!1,this.element.addClass("ui-switch"),this.element.append(this._switchHTML()),this.callback=this.options.callback,this.initialSet=!0,this._setSwitchState(!0===this.options.value),this.initialSet=!1,this.element.on("keydown.switchwidget",e.proxy(this._keyPressedOnButton,this)),this.element.on("click.switchwidget",e.proxy(this._buttonClick,this))},_switchHTML:function(){var e=this.options.tabstop?"0":"-1";return'<input type="checkbox" tabindex="-1"><div class="ui-switch-track '+(this.options.thinSwitch?"ui-thin-weight":"ui-standard-weight")+'" role="switch" tabindex="'+e+'" aria-labelledby="'+this.options.labelId+'"><div class="ui-switch-thumb"></div></div>'},destroy:function(){e.Widget.prototype.destroy.call(this,arguments),this.element.off("switchwidget")},disable:function(){e.Widget.prototype.disable.call(this,arguments),this._setSwitchState(this.getValue())},enable:function(){e.Widget.prototype.enable.call(this,arguments),this._setSwitchState(this.getValue())},getValue:function(){return this.element.data("isOn")},setValue:function(e,t){this._setSwitchState(e,t)},focusSwitch:function(){this.element.focus()},_keyPressedOnButton:function(t){var i=t.keyCode||t.which;i!==e.ui.keyCode.ENTER&&i!==e.ui.keyCode.SPACE||this._buttonClick(t)},_buttonClick:function(e){if(e.preventDefault(),!this.element.hasClass("ui-state-disabled")){var t=!this.element.data("isOn");t&&this.options.checkBeforeEnable&&(t=this.options.checkBeforeEnable(t)),this._setSwitchState(t),document.selection?document.selection.empty():window.getSelection&&window.getSelection()&&window.getSelection().removeAllRanges(),this.element.trigger("change",{state:t})}},_setSwitchState:function(t,i){var a=e(".ui-switch-track",this.element);t?(a.attr({"aria-checked":!0}),this.element.addClass("on").data("isOn",!0),e("input",this.element).prop("checked",!0),e("input",this.element).attr("aria-checked",!0),this.options.enabledTooltip&&a.attr("title",this.options.enabledTooltip)):(a.attr({"aria-checked":!1}),this.element.removeClass("on").data("isOn",!1),e("input",this.element).prop("checked",!1),e("input",this.element).attr("aria-checked",!1),this.options.disabledTooltip&&a.attr("title",this.options.disabledTooltip)),this.options.disabled?this.element.addClass("ui-state-disabled"):this.element.removeClass("ui-state-disabled"),this.options.disabled||!this.callback||this.initialSet||i&&i.noCallback||this.callback(t)}})})),define("docs/metadata/view/MetadataDefinitionSwitchView",["jquery","underscore","docs/metadata/template/MetadataDefinitionSwitch.template","docs/metadata/view/MetadataDefinitionView","docsplugins/jquery.ui.switchwidget"],(function(e,t,i){"use strict";return docs.views.MetadataDefinitionSwitch=docs.views.MetadataDefinition.extend({initialize:function(e){this.options=e||{},docs.views.MetadataDefinition.prototype.initialize.call(this,e),t.bindAll(this,"getSwitchValue","isInherited")},renderControl:function(){var t=i({});this.$el.find(".metadata-def-mode").empty().append(t),this.$el.find(".metadata-def-switch").switchwidget({value:this.options.switchValue,callback:e.proxy(this.switchCallback,this),tabstop:!0}),this.isInherited()&&this.$el.find(".metadata-def-switch").hide()},getSwitchValue:function(){return this.$el.find(".metadata-def-switch").switchwidget("getValue")},switchCallback:function(){var e=this.getSwitchValue();if(this.options.switchCallback&&t.isFunction(this.options.switchCallback)){var i={groupId:this.options.definition.get("id"),groupName:this.options.definition.get("displayName"),switchVal:e};this.options.switchCallback(i)}},isInherited:function(){var e=!1;if(this.options.item){var i=this.options.item.get("metadata");if(i&&!t.isEmpty(i)){var a=this.options.definition.get("displayName");t.has(i,a)&&(e=i[a].inherited)}}return e}}),docs.views.MetadataDefinitionSwitch})),define("docs/metadata/view/MetadataManageDialog",["jquery","underscore","backbone","core/dialog/OJDialog","core/util/Globals","docs/metadata/template/MetadataManageDialog.template","core/util/Utils","docs/metadata/model/MetadataDefinitions","docs/metadata/view/MetadataDefinitionSwitchView"],(function(e,t,i,a,docs,n){"use strict";return docs.dialogs.MetadataManageDialog=i.View.extend({initialize:function(e){this.options=e||{},t.bindAll(this,"onOk","onBeforeOpen","onFocus","onCancel","populateDefinitions","isDirty","closeDialog","updateDefinitions","updateButtons","emptyBPCallback")},render:function(){var e=n({i18n:docs.i18n});this.$el.html(e)},onOk:function(){this.doOk=!0,this.updateDefinitions(),this.options.item.updateMetadata(),this.closeDialog()},onCancel:function(){this.doCancel=!0,this.closeDialog()},closeDialog:function(){this.close(),this.definitionsView&&(this.definitionsView.remove(),delete this.definitionsView)},populateDefinitions:function(){var i=this.options.item.get("metadata");this.assignedKeys=[],t.isEmpty(i)||(this.assignedKeys=Object.keys(i)),this.allDefinitions=new docs.models.AllMetadataDefinitions,this.definitionsView=new docs.views.MetadataDefinitionsSwitch({el:this.$el.find(".metadata-manage-content"),collection:this.allDefinitions,item:this.options.item,startExpanded:!1,readOnly:!0,callback:e.proxy(this.switchCallback,this),emptyBPCallback:e.proxy(this.emptyBPCallback,this)}),this.definitionsView.render()},title:docs.i18n.t("SIDEBAR_METADATA_MANAGE_DLG_TITLE"),width:600,resizable:!1,buttons:function(){return[{text:docs.i18n.t("GENERAL_CMD_CANCEL"),click:this.onCancel.bind(this),chroming:null,id:"cancelButton"},{text:docs.i18n.t("GENERAL_CMD_DONE"),click:this.onCancel.bind(this),chroming:"callToAction",id:"doneButton"},{text:docs.i18n.t("GENERAL_CMD_SAVE"),click:this.onOk.bind(this),chroming:"callToAction",id:"saveButton"}]},onFocus:function(){this.findButton("doneButton").focus()},onBeforeOpen:function(){this.updateButtons(!1),this.populateDefinitions()},isDirty:function(){var e=!1;this.allDefinitions.length&&this.allDefinitions.each((function(i){var a=i.get("displayName"),n=this.definitionsView.getSwitchValue(a);t.contains(this.assignedKeys,a)!==n&&(e=!0)}),this),this.updateButtons(e)},updateButtons:function(e){var t=this.findButton("saveButton"),i=this.findButton("cancelButton"),a=this.findButton("doneButton");e?(a.ariaHideButton(),t.ariaShowButton(),t.removeClass("ui-state-active"),i.ariaShowButton(),i.removeClass("ui-state-active")):(a.ariaShowButton(),a.removeClass("ui-state-active"),t.ariaHideButton(),i.ariaHideButton())},updateDefinitions:function(){if(this.allDefinitions.length){var e=[],i=[];this.allDefinitions.each((function(a){var n=a.get("displayName"),s=this.definitionsView.getSwitchValue(n);t.contains(this.assignedKeys,n)!==s&&(s?e.push(n):i.push(n))}),this),e.length&&this.allDefinitions.assignDefinitions(this.options.item,e),i.length&&this.allDefinitions.unassignDefinitions(this.options.item,i)}},switchCallback:function(e){this.isDirty()},emptyBPCallback:function(){var e=docs.common.Globals.staticRoot+"images/Boilerplate_Nothing_to_Display_Mono.png",t=docs.i18n.t("METADATA_MANAGE_EMPTY_BP_TITLE"),i=docs.i18n.t("METADATA_MANAGE_EMPTY_BP_DESC");return docs.common.Utils.getGenericBoilerplateHtml("metadata-bp bp-vertical-align bp-redwood-illustration",e,t,i)}},{show:function(e){e.DialogClass=docs.dialogs.MetadataManageDialog,a.show(e)}}),docs.dialogs.MetadataManageDialog})),define("docs/metadata/view/MetadataSidebarHeader",["jquery","underscore","core/util/Globals","docs/metadata/template/MetadataSidebarHeader.template","common/container/view/ContainerViewHeader","docs/metadata/view/MetadataManageDialog"],(function(e,t,docs,i){"use strict";return docs.views.MetadataSidebarHeader=docs.views.ContainerViewHeader.extend(t.extend({id:"metadata-header",breadcrumbs:!1,subtitle:!1,template:i,events:t.extend({},docs.views.ContainerViewHeader.prototype.events),initialize:function(e){return docs.views.ContainerViewHeader.prototype.initialize.call(this,e),t.bindAll(this,"actionManage","headerVisible"),docs.events.on("docs:metadataVisible",this.headerVisible),this},render:function(){docs.views.ContainerViewHeader.prototype.render.call(this)},renderData:function(){return{title:docs.i18n.t("METADATA_FIELD_NAME")}},renderHeaderButtons:function(){docs.views.ContainerViewHeader.prototype.renderHeaderButtons.call(this)},configureHeaderButtons:function(){docs.views.ContainerViewHeader.prototype.configureHeaderButtons.call(this)},actionSelected:function(e,t){switch(e){case"action_manage":this.actionManage(!1);break;case"action_close_btn":case"action_close_panel":docs.events.trigger("sidebar:toggleSidebar","metadata")}},actionManage:function(e){new docs.dialogs.MetadataManageDialog({item:this.model,bubble:e}).show()},headerVisible:function(){docs.views.ContainerViewHeader.prototype.updateHeaderButtons.call(this)},hasActions:function(){var e=this.model.get("allowedActions"),i=t.isEqual(this.model.get("ownedBy"),docs.common.Globals.userid),a=!!this.model.isAsset&&!i,n=docs.common.Globals.canManageMetadata&&(e.fileWrite||e.folderWrite)&&!a;return{action_manage:n,action_close_panel:n,action_close_btn:!n}},headerButtonConfig:{menu:{text:"CONTEXT_TOOLBAR_MORE"},hasActions:null,items:[{action:"action_manage",location:"menu",menu:"show",menuOrder:1,title:"SIDEBAR_METADATA_MANAGE_TT",text:"METADATA_MANAGE"},{menuSeparator:!0,location:"menu",menuOrder:3},{action:"action_close_panel",location:"menu",menu:"show",menuOrder:4,title:"METADATA_CLOSE_SIDEBAR",text:"METADATA_CLOSE_SIDEBAR"},{action:"action_close_btn",location:"left",locationOrder:1,menu:"hide",weight:1,title:"METADATA_CLOSE_SIDEBAR",text:"METADATA_CLOSE_SIDEBAR",icon:"ui-icon-closethick"}]}})),docs.views.MetadataSidebarHeader})),define("docs/metadata/view/MetadataDefinitionsView",["jquery","underscore","backbone","core/util/Globals","docs/metadata/template/MetadataDefinitions.template","assets/view/BaseSideBarPane","core/util/Logger","core/util/Utils","docs/metadata/view/MetadataDefinitionMenuView","docs/metadata/view/MetadataFilePropsView","docs/metadata/view/MetadataSidebarHeader","docs/metadata/model/MetadataDefinitions","jqueryui-amd/widgets/button"],(function(e,t,i,docs,a){"use strict";docs.views.MetadataDefinitions=i.View.extend({viewType:docs.views.MetadataDefinition,initialize:function(e){t.bindAll(this,"render","addDefinitions","addDefinition","patchDefinitions","definitionAdded","definitionRemoved","noDefintions","viewData","hideLoading","hideBoilerplate","hideDefinitions","isInherited","showLoading","showBoilerplate","showDefinitions","emptyDefinitions","displayInheritance","splitByInheritance","sortedKeys","showingPropsDefinition","addPropsDefinition"),this.options=e||{},this.definitionViews={},this.acquired={},this.directs={}},render:function(){var e=a({i18n:docs.i18n,loading:docs.common.Globals.staticRoot+"images/t.gif"});this.$el.html(e),this.$el.addClass("metadata-definitions-content"),this.showLoading(),this.listenTo(this.options.collection,"reset",this.addDefinitions),this.listenTo(this.options.collection,"change",this.patchDefinitions),this.listenTo(this.options.collection,"add",this.definitionAdded),this.listenTo(this.options.collection,"remove",this.definitionRemoved),this.options.collection.fetch({reset:!0})},hideLoading:function(){var e=this.$(".metadata-defintions-loading > img");osn.views.SpinnerView.hideSpinner(e),this.$el.find(".metadata-defintions-loading").hide()},hideBoilerplate:function(){this.$el.find(".metadata-definitions-bp").hide()},hideDefinitions:function(){this.$el.find(".metadata-direct-definitions").hide(),this.$el.find(".metadata-acquired-definitions").hide()},showLoading:function(){var e=this.$(".metadata-defintions-loading > img");this.hideBoilerplate(),this.hideDefinitions(),this.$el.find(".metadata-defintions-loading").show(),osn.views.SpinnerView.showSpinner(e)},showBoilerplate:function(){this.hideLoading(),this.hideDefinitions(),this.$el.find(".metadata-definitions-bp").show()},showDefinitions:function(){this.hideLoading(),this.hideBoilerplate(),this.$el.find(".metadata-direct-definitions").show(),this.$el.find(".metadata-acquired-definitions").show()},emptyDefinitions:function(){var i=t.keys(this.definitionViews);t.each(i,(function(e){this.definitionViews[e].remove(),delete this.definitionViews[e],t.has(this.directs,e)&&delete this.directs[e],t.has(this.acquired,e)&&delete this.acquired[e]}),this);var a=this.$el.find(".metadata-definitions").children(".metadata-group");t.each(a,(function(t){e(t).hasClass("metadata-props-group")||e(t).remove()}),this)},showingPropsDefinition:function(){var e=this.options.includePropsDefinition;if(e){var i=!t.isUndefined(this.options.item);e=e&&i}return e},addDefinitions:function(){if(0===this.options.collection.length&&(this.emptyDefinitions(),this.noDefintions(),this.addManageMetadataGroup()),this.showingPropsDefinition()&&(this.filePropsView||this.addPropsDefinition(),this.showDefinitions(),this.displayInheritance()),this.options.selectedItems&&this.options.selectedItems.length>1)this.emptyDefinitions();else if(this.options.collection.length){this.showDefinitions(),this.splitByInheritance();var e=this.sortedKeys(this.directs),i=this.sortedKeys(this.acquired);t.each(e,(function(e){var t=this.options.collection.get(this.directs[e]);this.addDefinition(t,{direct:!0})}),this),t.each(i,(function(e){var t=this.options.collection.get(this.acquired[e]);this.addDefinition(t,{direct:!1})}),this),this.displayInheritance()}},addMetadataManageIcon:function(){this.$el.find(".metadata-manage-action").button({text:!1,icons:{primary:"ui-metadata-manage-action"}})},viewData:function(e){return{}},addPropsDefinition:function(){var t=e('<div class="metadata-group metadata-props-group"></div>');this.$el.find(".metadata-direct-definitions").find(".metadata-definitions").prepend(t),this.filePropsView=new docs.views.MetadataFileProps({el:t,item:this.options.item,startExpanded:!0,selectedItems:this.options.selectedItems}),this.filePropsView.render(),this.addManageMetadataGroup()},addDefinition:function(i,a){a=a||{};var n=!!this.options.readOnly;if(!n&&this.options.item){var s=this.options.item.get("allowedActions");n=!s.fileWrite&&!s.folderWrite}var o=a.direct?this.$el.find(".metadata-direct-definitions"):this.$el.find(".metadata-acquired-definitions"),l=i.get("displayName"),d=i.get("id"),r=e('<div class="metadata-group" data-groupname="'+l+'" data-groupid="'+d+'"></div>');if(a.after&&!t.isEmpty(a.after)){var c='.metadata-group[data-groupname="'+a.after+'"]';o.find(c).after(r)}else a.first?a.direct&&this.showingPropsDefinition()?(o.find(".metadata-props-group").after(r),this.addManageMetadataGroup()):o.find(".metadata-definitions").prepend(r):o.find(".metadata-definitions").append(r);var u=t.extend({el:r,i18n:docs.i18n,item:this.options.item,definition:i,readOnly:n,startExpanded:this.options.startExpanded},this.viewData(i)),h=new this.viewType(u);h.render(),this.definitionViews[l]=h},patchDefinitions:function(e,t){var i=this.collection.get(e.get("id"));i&&this.collection.remove(i),this.collection.add(e)},noDefintions:function(){if(t.isFunction(this.options.emptyBPCallback)){var e=this.options.emptyBPCallback();this.$el.find(".metadata-definitions-bp").html(e)}else{var i=docs.common.Utils.getGenericBoilerplateHtml("metadata-bp bp-vertical-align bp-redwood-illustration",docs.common.Globals.staticRoot+"images/Boilerplate_Missing_Preference_Mono.png",docs.i18n.t("METADATA_NO_METADATA_BP_TITLE_FILE"),docs.i18n.t("METADATA_NO_METADATA_BP_DESC_FILE"));this.$el.find(".metadata-definitions-bp").html(i)}this.showBoilerplate()},definitionAdded:function(e,i,a){this.showDefinitions();var n=this.isInherited(e),s=n?this.acquired:this.directs,o=e.get("displayName");s[o]=e.get("id");var l=this.sortedKeys(s),d=t.indexOf(l,o,!0);if(0===d)this.addDefinition(e,{first:!0,direct:!n});else if(d<l.length-1){var r=l[d-1];this.addDefinition(e,{after:r,direct:!n})}else this.addDefinition(e,{direct:!n});this.displayInheritance()},definitionRemoved:function(e,i,a){var n='.metadata-group[data-groupid="'+e.get("id")+'"]',s=this.$el.find(n),o=e.get("displayName");s.length>0&&(o=s.data("groupname")),t.has(this.definitionViews,o)&&(this.definitionViews[o].remove(),delete this.definitionViews[o]),t.has(this.directs,o)&&delete this.directs[o],t.has(this.acquired,o)&&delete this.acquired[o],this.displayInheritance(),i.length<1&&!this.showingPropsDefinition()&&this.noDefintions()},displayInheritance:function(){var e=t.keys(this.acquired).length>0,i=(t.keys(this.directs).length>0||this.showingPropsDefinition())&&e;this.options.sidePaneLabelRules&&(e=!(e&&!i)&&e,i=!1),this.$el.find(".metadata-directs-label").toggle(i),this.$el.find(".metadata-acquired-label").toggle(e)},splitByInheritance:function(){if(this.acquired={},this.directs={},this.options.item&&this.options.collection.length){var e=this.options.item.get("metadata");e&&!t.isEmpty(e)?this.options.collection.each((function(i){var a=i.get("displayName"),n=!1;t.has(e,a)&&(n=e[a].inherited),n?this.acquired[a]=i.get("id"):this.directs[a]=i.get("id")}),this):this.options.collection.each((function(e){this.directs[e.get("displayName")]=e.get("id")}),this)}else this.options.collection.length&&this.options.collection.each((function(e){this.directs[e.get("displayName")]=e.get("id")}),this)},sortedKeys:function(e){var i=t.keys(e);return i=i.sort((function(e,t){var i=e.toUpperCase(),a=t.toUpperCase();return i>a?1:i<a?-1:0}))},isInherited:function(e){var i=!1;if(this.options.item){var a=this.options.item.get("metadata");if(a&&!t.isEmpty(a)){var n=e.get("displayName");t.has(a,n)&&(i=a[n].inherited)}}return i},remove:function(){if(this.definitionViews){var e=t.keys(this.definitionViews);t.each(e,(function(e){this.definitionViews[e].remove(),delete this.definitionViews[e]}),this)}this.filePropsView&&(this.filePropsView.remove(),delete this.filePropsView),i.View.prototype.remove.call(this)},addManageMetadataGroup:function(){var e=0===this.options.collection.length?"":docs.i18n.t("METADATA_FIELD_NAME"),t=docs.i18n.t("SIDEBAR_METADATA_MANAGE_TT"),i=this.$el.find(".metadata-direct-definitions");i.find(".metadata-title").remove(),i.find(".metadata-props-group").after("<div class='metadata-group metadata-field-label dialog-label metadata-title' title="+e+">"+e+"<button class='metadata-manage-action' title='"+t+"'></button></div>"),this.addMetadataManageIcon()}}),docs.views.MetadataDefinitionsSwitch=docs.views.MetadataDefinitions.extend({viewType:docs.views.MetadataDefinitionSwitch,initialize:function(e){this.options=e||{},docs.views.MetadataDefinitions.prototype.initialize.call(this,e)},viewData:function(e){var i=!1;if(this.options.item){var a=this.options.item.get("metadata"),n=e.get("displayName");i=t.has(a,n)}return{switchValue:i,switchCallback:this.options.callback}},getSwitchValue:function(e){if(t.has(this.definitionViews,e))return this.definitionViews[e].getSwitchValue();throw"Invalid key"}}),docs.views.MetadataDefinitionsMenu=docs.views.MetadataDefinitions.extend({viewType:docs.views.MetadataDefinitionMenu,initialize:function(e){this.options=e||{},docs.views.MetadataDefinitions.prototype.initialize.call(this,e)},viewData:function(e){return{config:this.options.menuConfig,menuCallback:this.options.callback}}}),docs.views.MetadataDefinitionsSave=docs.views.MetadataDefinitions.extend({viewType:docs.views.MetadataDefinition,initialize:function(e){this.options=e||{},docs.views.MetadataDefinitions.prototype.initialize.call(this,e),t.bindAll(this,"getDirtyFieldValues")},viewData:function(e){return{}},getDirtyFieldValues:function(){if(this.definitionViews){var e=t.keys(this.definitionViews),i={};return t.each(e,(function(e){i[e]=this.definitionViews[e].getDirtyFieldValues()}),this),i}return{}}})})),define("docs/metadata/template/MetadataDefinitionDialog.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-admin-dialogs">  <div class="dialog-flex-webbar"></div>  <div class="dialog-section">    <span class="metadata-descriptive-text">'+(null==(__t=prompt)?"":_.escape(__t))+'</span>    <div class="metadef-body">      <label id="metadata-group-name" class="dialog-label metadata-padtop">'+(null==(__t=i18n.t("METADATA_GROUP_NAME"))?"":_.escape(__t))+'</label>      <div class="dialog-value metadef-groupname-value">        <input id="metadata-groupName" class="dialog_texteditor" aria-labelledby="metadata-group-name" type="text" value="'+(null==(__t=groupName)?"":_.escape(__t))+'" maxlength="'+(null==(__t=maxlen)?"":_.escape(__t))+'" placeholder="'+(null==(__t=i18n.t("METADATA_DLG_NAME_PROMPT_PLACEHOLDER"))?"":_.escape(__t))+'"></input        ><div class="metadata-validation-area"></div>      </div>      <div class="metadata-padtop metadata-padbottom metadata-definition-dialog-buttons">        <button id="metadata-defintion-dialog-add" class="metadata-definition-dialog-button">'+(null==(__t=i18n.t("ADD"))?"":_.escape(__t))+'</button>        <button id="metadata-defintion-dialog-edit" class="metadata-definition-dialog-button">'+(null==(__t=i18n.t("APP_EDIT_LABEL"))?"":_.escape(__t))+'</button>        <button id="metadata-defintion-dialog-delete" class="metadata-definition-dialog-button">'+(null==(__t=i18n.t("VER_DEL_REV"))?"":_.escape(__t))+'</button>      </div>          </div>    <div class="metadef-tbl-wrapper">      <table class="metadef-tbl" summary="'+(null==(__t=i18n.t("METADATA_GROUP_FIELDS_TABLE_SUMMARY"))?"":_.escape(__t))+'">        <thead>          <tr>            <th class="metadef-tbl-col1 metadef-tbl-th-lined" scope="col">'+(null==(__t=i18n.t("METADATA_LABEL"))?"":_.escape(__t))+'</th>            <th class="metadef-tbl-col2 metadef-tbl-th-lined" scope="col">'+(null==(__t=i18n.t("METADATA_VALUE"))?"":_.escape(__t))+'</th>            <th class="metadef-tbl-col3" scope="col">'+(null==(__t=i18n.t("METADATA_TYPE"))?"":_.escape(__t))+'</th>          </tr>        </thead>      </table>      <table class="metadef-tbl">        <tbody>          <tr>            <td colspan="3">              <div class="metadef-row-wrap">                <table class="metadef-tbl-row-body">                  <tbody></tbody>                </table>              </div>            </td>          </tr>        </tbody>      </table>    </div>  </div></div>';return __p}})),define("docs/metadata/template/MetadataFieldDefinitionDialog.template",["underscore"],(function(_){return function(obj){var __t,__p="",__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,"")};with(obj||{})__p+='<div class="metadata-admin-dialogs metadata-defintion">  <div class="dialog-section">    <div class="metadef-type metadata-field">      <label class="metadata-field-label dialog-label" for="metadef-field-type-menu-btn">'+(null==(__t=i18n.t("METADATA_TYPE"))?"":_.escape(__t))+'</label>      <div class="metadef-field-type-area">        <div class="metadef-field-type-menu">          <button id="metadef-field-type-menu-btn" title="'+(null==(__t=i18n.t("METADATA_TEXT_FIELD"))?"":_.escape(__t))+'" data-field-type="text" class="dropmenu_button">'+(null==(__t=i18n.t("METADATA_TEXT_FIELD"))?"":_.escape(__t))+'</button>          <ul class="dropmenu_topmenu">             <li data-field-type="text" title="'+(null==(__t=i18n.t("METADATA_TEXT_FIELD"))?"":_.escape(__t))+'" class="remove_button_style"><a href="#"><span></span>'+(null==(__t=i18n.t("METADATA_TEXT_FIELD"))?"":_.escape(__t))+'</a></li>            <li data-field-type="date" title="'+(null==(__t=i18n.t("METADATA_DATE_FIELD"))?"":_.escape(__t))+'" class="remove_button_style"><a href="#"><span></span>'+(null==(__t=i18n.t("METADATA_DATE_FIELD"))?"":_.escape(__t))+'</a></li>            <li data-field-type="number" title="'+(null==(__t=i18n.t("METADATA_NUMBER_FIELD"))?"":_.escape(__t))+'" class="remove_button_style"><a href="#"><span></span>'+(null==(__t=i18n.t("METADATA_NUMBER_FIELD"))?"":_.escape(__t))+'</a></li>            <li data-field-type="boolean" title="'+(null==(__t=i18n.t("METADATA_BOOLEAN_FIELD"))?"":_.escape(__t))+'" class="remove_button_style"><a href="#"><span></span>'+(null==(__t=i18n.t("METADATA_BOOLEAN_FIELD"))?"":_.escape(__t))+'</a></li>          </ul>        </div>      </div>    </div>    <div class="metadef-label metadata-field">      <label class="metadata-field-label dialog-label" for="metadef-field-label">'+(null==(__t=i18n.t("METADATA_LABEL"))?"":_.escape(__t))+'</label>      <div class="dialog-value">        <input type="text" class="dialog_texteditor" id="metadef-field-label" value="'+(null==(__t=label)?"":_.escape(__t))+'" maxlength="'+(null==(__t=labelMaxlen)?"":_.escape(__t))+'"               placeholder="" aria-label="Metadata Field Label"        /><div class="metadata-validation-area"></div>      </div>    </div>    <div class="metadef-defvalue">      <div class="metadef-field" data-fieldname="defaultValue"></div>    </div>    <div class="metadef-label metadata-field">      <label class="metadata-field-label dialog-label" for="metadef-field-hint">'+(null==(__t=i18n.t("METADATA_HINT"))?"":_.escape(__t))+'</label>      <div class="dialog-value">        <input type="text" class="dialog_texteditor" id="metadef-field-hint" value="'+(null==(__t=hint)?"":_.escape(__t))+'" maxlength="'+(null==(__t=hintMaxlen)?"":_.escape(__t))+'"               placeholder="'+(null==(__t=i18n.t("METADATA_HINT_PLACEHOLDER"))?"":_.escape(__t))+'" aria-required="true"/>      </div>    </div>    <div class="metadef-read-only-div">      <fieldset>        <legend>          <label class="form-label">'+(null==(__t=i18n.t("METADATA_FIELD_READ_ONLY"))?"":_.escape(__t))+'</label>          <input id="metadef-read-only" class="adminField oj-ux-icon-radio" type="radio" name="metadef-read-only" '+(null==(__t=readOnlyOn)?"":_.escape(__t))+' ></input>          <label for="metadef-read-only">'+(null==(__t=i18n.t("YES"))?"":_.escape(__t))+'</label>          <input id="metadef-read-only-off" class="adminField oj-ux-icon-radio" type="radio" name="metadef-read-only" '+(null==(__t=readOnlyOff)?"":_.escape(__t))+'>          <label for="metadef-read-only-off">'+(null==(__t=i18n.t("NO"))?"":_.escape(__t))+"</label>        </legend>      </fieldset>    </div>  </div></div>";return __p}})),define("docs/metadata/view/MetadataFieldDefinitionDialog",["jquery","underscore","backbone","core/dialog/OJDialog","docs/metadata/template/MetadataFieldDefinitionDialog.template","docs/metadata/template/MetadataFieldValidation.template","core/util/Globals","common/metadata/common/Utils","docs/metadata/view/MetadataFieldView","jqueryui-amd/widgets/datepicker","jqueryui-amd/widgets/button"],(function(e,t,i,a,n,s){"use strict";var o=docs.metadata.Utils,l=o.State;return docs.dialogs.MetadataFieldDefinitionDialog=i.View.extend({events:{"change #metadef-field-type":"formatDefaultFieldInput","keyup #metadef-field-label":"enableCommmit","blur #metadef-field-label":"enableCommmit","keyup .metadef-defvalue input":"enableReadOnly","blur .metadef-defvalue input":"enableReadOnly","click .metadata-boolean-wrapper li":"enableReadOnly","click .dialog-row-value span":"toggleDropContainer","click .dialog-row-value input":"toggleDropContainer","click .dialog-row-value li":"getSelectedValue"},initialize:function(e){e=e||{},t.bindAll(this,"onCommit","onCancel","formatDefaultFieldInput","enableCommmit","enableReadOnly","calendarClosed","updateButton","changeFieldType","updateFieldTypeMenu","onOpen")},render:function(){var t=this.options.fieldDef,i=t&&t.fieldType?t.fieldType:"text",a=t&&t.name?t.name:"",s=t&&t.description?t.description:"";e(this.el).html(n({label:a,defaultValue:o.getDefaultValue(t),hint:s,i18n:docs.i18n,labelMaxlen:200,hintMaxlen:50,defMaxlen:512,readOnlyOn:t&&t.isReadOnly&&!0===t.isReadOnly?"checked='checked'":"",readOnlyOff:t&&t.isReadOnly&&!0===t.isReadOnly?"":"checked='checked'"})),e(".metadef-field-type-menu",this.$el).dropmenu({align:"right",select:this.changeFieldType,selectionMenu:!0,elementWidth:".metadef-field-type-area"}),this.updateFieldTypeMenu(i)},formatDefaultFieldInput:function(){var t,i,a=this.$el.find("#metadef-field-type-menu-btn").data("field-type");switch(a){case"text":case"string":t=docs.views.MetadataTextField;break;case"number":t=docs.views.MetadataNumberField;break;case"date":t=docs.views.MetadataDateField;break;case"boolean":t=docs.views.MetadataBooleanField}this.fieldDef?((i=e.extend(!0,{},this.fieldDef)).fieldType=a,i.displayName=docs.i18n.t("METADATA_DEFAULT_VALUE")):i={displayName:docs.i18n.t("METADATA_DEFAULT_VALUE")};var n;n=this.group?this.group:{displayName:"Nothing",get:function(){return"Nothing"}};var s=e('<div class="metadef-field dialog_texteditor" data-fieldname="defaultValue"></div>');this.$el.find(".metadef-field").replaceWith(s);var o=new t({el:s,definition:n,field:i,item:void 0,readOnly:!1,configuringField:!0,checkDirty:void 0,updateButtonCallback:this.updateButton});o.render(),this.fieldView=o;var l=this.$el.find(".metadata-field-control");if(l&&"text"===a||"string"===a?l.addClass("metadata-text-field"):l&&l.removeClass("metadata-text-field"),"date"===a){var d=this;e((function(){var e=d.$el.find(".metadata-field-control"),t=e.find(".metadata-date-value").datepicker("option","onSelect");e.find(".metadata-date-value").datepicker("option","onSelect",(function(e,i){t(e,i),d.calendarClosed()}))}))}this.enableHint(a)},calendarClosed:function(){this.enableReadOnly(),this.$el.find(".metadata-field-control").find(".metadata-date-picker").button({text:!1,icons:{primary:"ui-icon-athena-datepicker"}}).focus()},changeFieldType:function(t,i){var a=e(i.item).data("field-type");this.updateFieldTypeMenu(a),this.formatDefaultFieldInput()},updateFieldTypeMenu:function(e){e=e||"text",t.isEqual(e.toLowerCase(),"string")&&(e="text");var i=this.$el.find("#metadef-field-type-menu-btn"),a="METADATA_TEXT_FIELD";switch(e.toLowerCase()){case"date":a="METADATA_DATE_FIELD";break;case"number":a="METADATA_NUMBER_FIELD";break;case"boolean":a="METADATA_BOOLEAN_FIELD";break;default:a="METADATA_TEXT_FIELD"}i.attr({title:docs.i18n.t(a)}).button("option","label",docs.i18n.t(a)),i.data("field-type",e),this.$el.find(".metadef-field-type-menu .dropmenu_topmenu li a").removeClass("osn-selected"),this.$el.find('.metadef-field-type-menu .dropmenu_topmenu li[data-field-type="'+e+'"] a').addClass("osn-selected")},getSelectedValue:function(t){var i=t.currentTarget.innerText;i&&(e("#metadef-field-type option",this.$el).filter((function(){return e(this).text()==i})).prop("selected",!0),e("#metadata-fieldtype-input-value").val(i)),this.toggleDropContainer(t),this.formatDefaultFieldInput()},toggleDropContainer:function(t){e(".dialog-row-value .dropcontainer").toggleClass("dropdownhidden")},enableHint:function(e){var t=this.$el.find("#metadef-field-hint");!t||"date"!==e&&"number"!==e&&"boolean"!==e?t&&t.prop("disabled",!1):t.prop("disabled",!0)},enableReadOnly:function(e){(this.fieldView&&this.fieldView.getValue()?this.fieldView.getValue():void 0)?this.$el.find(".metadef-read-only-div input").prop("disabled",!1):this.$el.find(".metadef-read-only-div input").prop("disabled",!0)},enableCommmit:function(){var t,i,a,n=e("#metadef-field-label").val(),d=!1,r=this.fieldDef?e.extend(!0,{},this.fieldDef):{name:n};if(r.name=r.name!==n?n:r.name,t=docs.i18n.t("METADATA_INVALID_FIELD_NAME_TITLE"),this.group&&this.group.getExistingField&&(a=this.group.getExistingField(r)),a&&(a.state&&a.state&l.DELETED||(i=docs.i18n.t("METADATA_DUPLICATE_FIELD_NAME",n),d=!0)),!d){var c=o.containsRestrictedChar(n);if(c)i=docs.i18n.t("METADATA_FIELD_INVALID_CHARS",c),d=!0;else o.isRestrictedName(n)&&(i=docs.i18n.t("METADATA_FIELD_INVALID_NAME",n),d=!0)}if(d){var u=s({i18n:docs.i18n,warningSummary:t,warningDetail:i});this.$el.find(".metadata-validation-area").html(u),this.$el.find(".metadef-label").addClass("validation-error"),!1}else this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadef-label").removeClass("validation-error");n&&!d?this.enableButton("submitButton",!0):this.enableButton("submitButton",!1)},updateButton:function(e){this.enableButton("submitButton",!e)},onCommit:function(){var t=this.$el.find("#metadef-field-type-menu-btn").data("field-type"),i={fieldType:t,name:e("#metadef-field-label").val(),description:e("#metadef-field-hint").val(),isReadOnly:e("#metadef-read-only").prop("checked")};if(this.fieldDef){var a=this.fieldDef.id?this.fieldDef.id:void 0;a&&(i.id=a)}if(i){var n=this.fieldView.getValue()&&null!==this.fieldView.getValue()?this.fieldView.getValue():void 0;switch(t){case"text":case"string":i.defaultTextValue=n;break;case"number":i.defaultNumValue=n;break;case"date":i.defaultDateValue=n;break;case"boolean":i.defaultBooleanValue=n}}this.close(),!this.options.cbOk||this.options.cbOk.call(this.options.cbContext,this.options.group,i)},onCancel:function(){this.close()},title:function(){return this.options.group&&this.options.fieldDef?docs.i18n.t("APP_EDIT_LABEL")+" "+this.options.fieldDef.name:this.options.group&&this.options.group.get("displayName")?docs.i18n.t("METADATA_ADD_FIELD_TO")+" "+this.options.group.get("displayName"):docs.i18n.t("METADATA_ADD_FIELD")},buttons:function(){var e=this.options.fieldDef?docs.i18n.t("GENERAL_CMD_SAVE"):docs.i18n.t("ADD");return[{text:docs.i18n.t("GENERAL_CMD_CANCEL"),click:this.onCancel.bind(this),id:null,chroming:null},{text:e,click:this.onCommit.bind(this),chroming:"callToAction",id:"submitButton"}]},dialogClassName:"MetadataFieldDefDialog",resizable:!1,minWidth:600,width:600,onOpen:function(){this.group=this.options.group?e.extend(!0,{},this.options.group):this.options.group,this.fieldDef=this.options.fieldDef?e.extend(!0,{},this.options.fieldDef):this.options.fieldDef,e("#metadef-field-label").focus(),this.formatDefaultFieldInput(),this.enableCommmit(),this.enableReadOnly(),e("#metadata-fieldtype-input-value").val(e("#metadef-field-type :selected",this.$el).text())}},{show:function(e){e.DialogClass=docs.dialogs.MetadataFieldDefinitionDialog,a.show(e)}}),docs.dialogs.MetadataFieldDefinitionDialog})),define("docs/metadata/view/MetadataDefinitionDialog",["jquery","underscore","backbone","core/dialog/OJDialog","docs/metadata/template/MetadataDefinitionDialog.template","docs/metadata/template/MetadataFieldValidation.template","core/util/Globals","common/metadata/common/Utils","core/view/MessageBar","core/dialog/DialogBar","docs/metadata/model/MetadataDefinitions","docs/metadata/view/MetadataFieldDefinitionDialog","jqueryui-amd/widgets/button"],(function(e,t,i,a,n,s){"use strict";var o=docs.metadata.Utils,l=o.State;return docs.dialogs.MetadataDefinitionDialog=i.View.extend({events:{"mouseover .metadef-tbl-row-body tbody tr":"hoverRow","click .metadef-tbl-row-body tbody tr":"selectRow","click #metadata-defintion-dialog-add":"onAdd","click #metadata-defintion-dialog-edit":"onEdit","click #metadata-defintion-dialog-delete":"onDelete","keyup #metadata-groupName":"enableSave","blur #metadata-groupName":"enableSave"},initialize:function(e){e=e||{},t.bindAll(this,"onAdd","onEdit","onDelete","onCommit","onCancel","onClose","selectRow","enableSave","checkForExistingGroupName","onBeforeOpen"),this.newFieldIdPlaceholder=0},render:function(){this.callbackFn=this.options.cbOk,this.definitions=this.options.definitions,this.group=this.options.group?e.extend(!0,{},this.options.group):this.options.group,this.fields=this.group?this.group.get("fields"):[],t.each(this.fields,(function(e){e.state=l.EXISTING})),this.prompt=this.group?docs.i18n.t("METADATA_DLG_EDIT_DEFINITION_DESC"):docs.i18n.t("METADATA_DLG_NEW_DEFINITION_DESC"),this.groupName=this.group?this.group.get("displayName"):"",this.$el.html(n({prompt:this.prompt,groupName:this.groupName,i18n:docs.i18n,maxlen:200})),docs.dialogs.DialogBar.addBar(this.$el,{showCloseButton:!0,htmlSelector:".dialog-flex-webbar",messageType:"error"}),e("#metadata-defintion-dialog-add",this.$el).button(),e("#metadata-defintion-dialog-edit",this.$el).button(),e("#metadata-defintion-dialog-delete",this.$el).button()},selectRow:function(t){e(".metadef-tbl-row-body tbody tr",this.$el).removeClass("selected"),e(".metadef-tbl-row-body tbody tr",this.$el).removeClass("hover"),t.target.parentNode.className=t.target.parentNode.className+" selected",this.enableEditDelete()},hoverRow:function(t){e(".metadef-tbl-row-body tbody tr",this.$el).removeClass("hover"),t.target.parentNode.className=t.target.parentNode.className+" hover"},formatRow:function(e){return'<tr class="clickable-row" tabindex="0"><td class="metadef-tbl-id-col">'+(e.id?e.id:"")+'</td><td class="metadef-tbl-col1">'+e.name+'</td><td class="metadef-tbl-col2">'+o.getDefaultValue(e,!0)+'</td><td class="metadef-tbl-col3 metadef-adjustable-col">'+e.fieldType+"</td></tr>"},findField:function(e){var t;return e.id&&""!==e.id&&(t=this.findFieldById(e.id)),t||(t=this.findFieldByName(e.name)),t},findFieldByName:function(e){return t.find(this.fields,(function(t){return t.name===e}))},findFieldById:function(e){return t.find(this.fields,(function(t){return t.id.toString()===e.toString()}))},findFieldLocById:function(t){return e(this.fields).index(this.findFieldById(t))},findFieldLocByName:function(t){return e(this.fields).index(this.findFieldByName(t))},onAdd:function(){var t=this.group;this.group||(t=new docs.models.MetadataDefinition({fields:e.extend(!0,{},this.fields)})),docs.dialogs.MetadataFieldDefinitionDialog.show({cbOk:function(t,i){var a=i,n=this.findField(i);return n&&isNaN(n.id)?(n.name=i.name,n.fieldType=i.fieldType,n.defaultTextValue=i.defaultTextValue?i.defaultTextValue:"",n.defaultNumValue=i.defaultNumValue?i.defaultNumValue:"",n.defaultDateValue=i.defaultDateValue?i.defaultDateValue:"",n.defaultBooleanValue=i.defaultBooleanValue?i.defaultBooleanValue:"",n.description=i.description,n.isReadOnly=i.isReadOnly,n.state=l.EXISTING|l.UPDATED,a=n,e(".metadef-tbl-row-body td",this.$el).filter((function(){return e(this).text()===n.id})).closest("tr").remove()):(i.id=--this.newFieldIdPlaceholder,i.state=l.ADDED,this.fields.push(i),a=i),this.tableBody=e(".metadef-tbl-row-body tbody",this.el$),this.tableBody.last().append(this.formatRow(a)),this.adjustTableForScroll(),this.enableSave(),!0}.bind(this),cbContext:this,group:t})},onEdit:function(){var t,i=e(".metadef-tbl-row-body tr.selected td:first",this.$el).text(),a=e(".metadef-tbl-row-body tr.selected td:nth-child(2)",this.$el).text();i&&""!==i&&(t=this.findFieldById(i)),t||(t=this.findFieldByName(a));var n=this.group;this.group||(n=new docs.models.MetadataDefinition({fields:e.extend(!0,{},this.fields)})),docs.dialogs.MetadataFieldDefinitionDialog.show({cbOk:function(t,i){var a=this.findField(i);return a&&(a.name=i.name,a.displayName=i.displayName?i.displayName:i.name,a.fieldType=i.fieldType,a.defaultTextValue=i.defaultTextValue,a.defaultNumValue=i.defaultNumValue,a.defaultDateValue=i.defaultDateValue,a.defaultBooleanValue=i.defaultBooleanValue,a.description=i.description,a.isReadOnly=i.isReadOnly,a.state=a.state&l.EXISTING?l.EXISTING|l.UPDATED:l.ADDED,a),e(".metadef-tbl-row-body tr.selected",this.$el).remove(),this.tableBody=e(".metadef-tbl-row-body tbody",this.el$),this.tableBody.last().append(this.formatRow(a)),this.adjustTableForScroll(),this.enableSave(),this.enableEditDelete(),!0}.bind(this),cbContext:this,group:n,fieldDef:t})},onDelete:function(){var t=e(".metadef-tbl-row-body tr.selected td:first",this.$el).text(),i=e(".metadef-tbl-row-body tr.selected td:nth-child(2)",this.$el).text(),a=this.findFieldById(t);a||(a=this.findFieldByName(i));var n=this.findFieldLocById(t);-1===n&&(n=this.findFieldLocByName(i)),a.state=a.state&l.EXISTING?l.EXISTING|l.DELETED:this.fields.splice(n,1),e(".metadef-tbl-row-body tr.selected",this.$el).remove(),this.adjustTableForScroll(),this.enableEditDelete(),this.enableSave()},createApplyGroups:function(e,i,a,n){t.each(e,(function(e){e.state&l.EXISTING&&e.state&l.DELETED?n.push(e):e.state&l.EXISTING&&e.state&l.UPDATED?a.push(e):e.state&l.ADDED&&i.push(e)}))},onCommit:function(){if(this.close(),this.callbackFn){var t=e("#metadata-groupName",this.$el).val(),i=this.group?this.group:{groupName:t},a=[],n=[],s=[];this.createApplyGroups(this.fields,a,n,s);var o=this.callbackFn(i,a,n,s);if(!o.result)return void(o.errorMsg&&this.showWebbar(o.errorMsg))}},onCancel:function(){this.close()},onClose:function(){this.close()},addInitialRows:function(){if(this.fields){var i=this;t.each(this.fields,(function(t){this.tableBody=e(".metadef-tbl-row-body tbody",i.$el),this.tableBody.last().append(i.formatRow(t))}),this)}},adjustTableForScroll:function(){this.tableBody||(this.tableBody=e(".metadef-tbl-row-body tbody",this.$el));var t=e("tr",this.tableBody).length;this.tableBody.find(".metadef-adjustable-col").css({width:t>5?"91px":"109px"})},setTableHeight:function(){e(".metadef-row-wrap",this.$el).css("height","102px")},enableSave:function(){var t,i,a=!1,n=e("#metadata-groupName",this.$el).val(),l=this.group?e.extend(!0,{},this.group):{name:n};if(l.name=l.name!==n?n:l.name,t=docs.i18n.t("METADATA_INVALID_GROUP_NAME_TITLE"),this.checkForExistingGroupName(l))t=docs.i18n.t("METADATA_DUPLICATE_GROUP_NAME_TITLE"),i=docs.i18n.t("METADATA_CREATE_GROUP_FAIL_EXISTS",n),a=!0;else{var d=o.containsRestrictedChar(n);if(d)i=docs.i18n.t("METADATA_GROUP_INVALID_CHARS",d),a=!0;else o.isRestrictedName(n)&&(i=docs.i18n.t("METADATA_GROUP_INVALID_NAME",n),a=!0)}if(a){var r=s({i18n:docs.i18n,warningSummary:t,warningDetail:i});this.$el.find(".metadata-validation-area").html(r),this.$el.find(".metadef-groupname-value").addClass("validation-error")}else this.$el.find(".metadata-validation-area").empty(),this.$el.find(".metadef-groupname-value").removeClass("validation-error");this.tableBody||(this.tableBody=e(".metadef-tbl-row-body tbody",this.$el));var c=e("tr",this.tableBody).length;n&&!a&&c>0?this.enableButton("submitButton",!0):this.enableButton("submitButton",!1)},enableEditDelete:function(){e(".metadef-tbl-row-body tr.selected td:nth-child(2)",this.$el).text()?(this.$el.find("#metadata-defintion-dialog-edit").button("enable"),this.$el.find("#metadata-defintion-dialog-delete").button("enable")):(this.$el.find("#metadata-defintion-dialog-edit").button("disable"),this.$el.find("#metadata-defintion-dialog-delete").button("disable"))},disableGroupName:function(){this.group&&this.group.id&&(this.$el.find("#metadata-groupName").prop("disabled",!0),this.$el.parent().find("#metadata-defintion-dialog-add").focus()),this.enableButton("submitButton",!1)},showWebbar:function(e){docs.dialogs.DialogBar.showErrorBar(this.$el,e)},hideWebbar:function(){docs.dialogs.DialogBar.hideBar(this.$el)},title:function(){return this.group=this.options.group?e.extend(!0,{},this.options.group):this.options.group,this.group?docs.i18n.t("APP_EDIT_LABEL")+" "+this.group.get("displayName"):docs.i18n.t("METADATA_NEW_GROUP")},resizable:!1,width:600,buttons:function(){return[{text:docs.i18n.t("GENERAL_CMD_CANCEL"),click:this.onCancel.bind(this),chroming:null,id:null},{text:docs.i18n.t("GENERAL_CMD_SAVE"),click:this.onCommit.bind(this),chroming:"callToAction",class:"ui-button-primary dlg-submit-button",id:"submitButton"}]},onBeforeOpen:function(){this.addInitialRows(),this.setTableHeight(),this.adjustTableForScroll(),this.enableEditDelete(),this.disableGroupName()},checkForExistingGroupName:function(e){var t=!1;return this.definitions.each((function(i){e.id&&e.id!==i.get("id")&&i.get("displayName").toUpperCase()===e.name.toUpperCase()&&(t=!0),t||e.id||i.get("displayName").toUpperCase()!==e.name.toUpperCase()||(t=!0)})),t}},{show:function(e){e.DialogClass=docs.dialogs.MetadataDefinitionDialog,a.show(e)}}),docs.dialogs.MetadataDefinitionDialog})),define("docs/metadata/view/MetadataAdminView",["jquery","underscore","backbone","core/dialog/MessageDialog","docs/metadata/template/MetadataAdmin.template","core/view/BaseView","core/util/Globals","core/view/MessageBar","docs/metadata/model/MetadataTenantInfo","docs/metadata/model/MetadataDefinitions","docs/metadata/view/MetadataDefinitionsView","docs/metadata/view/MetadataDefinitionDialog","docs/metadata/view/MetadataFieldDefinitionDialog","jqueryui-amd/widgets/button"],(function(e,t,i,a,n){"use strict";var s=docs.views.MessageBar,o=docs.common.Globals;return docs.views.MetadataAdminView=osn.views.BaseView.extend({model:docs.models.MetadataTenantInfo,displayName:"MetadataAdminView",className:"metadata-admin admin-settings-page",events:{"click #metadata-admin-button":"createGroup","click #enable-metadata-pairs":"enableMetadata","click #enable-metadata-pairs-off":"enableMetadata"},initialize:function(e){return osn.debug("view","MetadataAdminView: initializing for user"),t.bindAll(this,"render","createGroup"),this.options=e||{},this.model=new docs.models.MetadataTenantInfo,this},render:function(){this.$el.empty();var t=!(!this.model.get("enableMetadataPairs")||"true"!==this.model.get("enableMetadataPairs")),i=n({i18n:docs.i18n,enableMetadataPairs:t?"checked='checked'":"",enableMetadataPairsOff:t?"":"checked='checked'"});return this.$el.html(i),o.canManageMetadata?(e("#metadata-admin-button",this.$el).button(),this.populateDefinitions()):(e("#metadata-admin",this.$el).hide(),e(".admin-metadata-flex",this.$el).hide()),this},populateDefinitions:function(){this.allDefinitions=new docs.models.AllMetadataDefinitions,this.definitionsView=new docs.views.MetadataDefinitionsMenu({el:this.$el.find(".admin-metadata-flex"),collection:this.allDefinitions,item:void 0,startExpanded:!1,readOnly:!0,callback:e.proxy(this.menuCallback,this),emptyBPCallback:function(){return""}}),this.definitionsView.render()},menuCallback:function(e){switch(e.action){case"action_add_field":this.addField(e.groupId);break;case"action_edit_group":this.editGroup(e.groupId);break;case"action_delete_group":this.verifyDeleteGroup(e.groupId)}},createGroup:function(e){var i=t.bind(this.createDefinition,this);docs.dialogs.MetadataDefinitionDialog.show({cbOk:i,cbContext:this,definitions:this.allDefinitions}),e.preventDefault(),e.stopPropagation()},createDefinition:function(e,t){return this.allDefinitions.createDefinition(e,t),this.allDefinitions.fetch({update:!0}),e.commitState},editGroup:function(e){var i=this.allDefinitions.get(e),a=t.bind(this.editDefinition,this);docs.dialogs.MetadataDefinitionDialog.show({cbOk:a,cbContext:this,definitions:this.allDefinitions,group:i})},editDefinition:function(e,t,i,a){return e.editDefinition(t,i,a),this.allDefinitions.fetch({update:!0}),e.commitState.result&&new s({messageText:docs.i18n.t("METADATA_EDIT_SUCCESS_MSG",e.get("displayName")),messageType:"success"}),e.commitState},verifyDeleteGroup:function(t){var i=this.allDefinitions.get(t),n=docs.i18n.t("METADATA_DELETE_TITLE",i.get("displayName")),s=[];s.push(docs.i18n.t("METADATA_DELETE_DEFINITION",i.get("displayName")));var o=e(document.activeElement);a.show({title:n,message:s,danger:!0,context:this,cancelButtonText:docs.i18n.t("NO"),cancelCallback:function(){o&&o.focus()},okButtonText:docs.i18n.t("YES"),callback:function(e){e.deleteGroup(t)},reverseButtons:"no",defaultButton:"ok"})},deleteGroup:function(e){var t=this.allDefinitions.get(e);return t.deleteDefinition(),this.allDefinitions.remove(t),t.commitState},addField:function(e){var t=this.allDefinitions.get(e);docs.dialogs.MetadataFieldDefinitionDialog.show({cbOk:function(e,t){return e.editDefinition([t]),this.allDefinitions.fetch({update:!0}),e.commitState}.bind(this),cbContext:this,group:t})},checkForExistingGroupName:function(e){var t=!1;return this.allDefinitions.each((function(i){e.id&&e.id!==i.get("id")&&i.get("displayName").toUpperCase()===e.name.toUpperCase()&&(t=!0),t||e.id||i.get("displayName").toUpperCase()!==e.name.toUpperCase()||(t=!0)})),t},enableMetadata:function(e){var t={enableMetadataPairs:this.$("#enable-metadata-pairs").is(":checked")?"true":"false"};this.model.commit(t)}}),docs.views.MetadataAdminView})),define("docs-shared-15b22b9.cache",(function(){}));